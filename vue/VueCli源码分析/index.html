<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VueCli源码分析 | Sewen 博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="./mylogo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="manifest" href="/myblog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://sewar-x.github.io/myblog/atom.xml" title="Sewen 博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 RSS Feed">
    <meta name="description" content="sewen 的前端学习笔记、博客、前端基础总结、技术深度剖析、面试题总结、算法总结、项目过程总结">
    <meta property="og:url" content="https://sewar-x.github.io/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html">
    <meta property="og:site_name" content="Sewen 博客">
    <meta property="og:title" content="VueCli源码分析">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.645fbc6f.css" as="style"><link rel="preload" href="/myblog/assets/js/app.9d2b617a.js" as="script"><link rel="preload" href="/myblog/assets/js/layout-Layout.d2d4ce64.js" as="script"><link rel="preload" href="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js" as="script"><link rel="preload" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" as="script"><link rel="prefetch" href="/myblog/assets/js/199.a9216960.js"><link rel="prefetch" href="/myblog/assets/js/200.4c66fc79.js"><link rel="prefetch" href="/myblog/assets/js/layout-Blog.1fca7e90.js"><link rel="prefetch" href="/myblog/assets/js/layout-NotFound.3c74e8aa.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/AlgoliaSearch/Dropdown.70fcebe7.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Anchor.3235541c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleInfo.7b815b20.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleItem.b0e177e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleList.d1cf1b24.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleType.b630b80e.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHero.621312ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHome.4fe44489.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogInfo.b2a94760.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogPage.e0fbe820.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BloggerInfo.0df38355.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/CategoryList.ec1bcd96.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ProjectList.8550a110.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TagList.bcf7b782.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/Timeline.b6cf5471.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TimelineList.3c6e08a6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Clipboard.e940a903.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Common.820a8694.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Home.70383986.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/MyTransition.0de46069.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/DropdownLink.e3f6c118.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLink.93b11770.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLinks.8ba214e6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/Navbar.b90a94f9.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/RepoLink.663a7f55.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/SidebarButton.76b0035a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Page.98b5d09c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageFooter.20bc9bd8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageMeta.b7e6b12f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageNav.8305dd1f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Password.45e0e82a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/DropdownTransition.068c5eea.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/Sidebar.f6f90d52.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarDropdownLink.505127a8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarGroup.7eecf370.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarLink.6e39fe32.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarNavLinks.0f8566cb.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/DarkmodeSwitch.20ac7b92.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeColor.6086e4ed.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeOptions.483238c9.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ArticleIcon.0a22e2b1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/AutoIcon.2ff1c790.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/BookIcon.419b49ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/DarkIcon.7d81873b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EditIcon.8ada485d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EmptyIcon.d704a5cf.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/I18nIcon.ffad8b3e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LightIcon.47d807da.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LinkIcon.1a8a7826.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LockIcon.a29a2b79.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/NextIcon.0214ee59.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/Page404Icon.8bc1ebbb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PresentationIcon.17500d9b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PrevIcon.2ae04a70.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ProjectIcon.b336d567.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/StickyIcon.0f509b9d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Baidu.244b9a41.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Bitbucket.11ba94e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dingding.e8a3d90d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Discord.3295a55b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dribbble.464dac3b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Email.f9254caa.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Evernote.991472fb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Facebook.08e78e47.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Flipboard.a1124d0f.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitee.c44bc20a.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Github.5667e5ae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitlab.ad95c7a7.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gmail.b5acc6bc.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Instagram.56be85f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Lines.d9db3dce.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Linkedin.b82d8d8b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pinterest.0f3ffe71.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pocket.41ef3c92.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/QQ.7558f4ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Qzone.bf658fae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Reddit.9c4c95ee.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Rss.9780139e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Steam.06abbae2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Twitter.26fa5bda.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Wechat.9cac8c4c.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Weibo.5206a632.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Whatsapp.0738f1e3.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Youtube.f41fd7f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Zhihu.4d851d2f.js"><link rel="prefetch" href="/myblog/assets/js/page--0abc50bf.0d6f1484.js"><link rel="prefetch" href="/myblog/assets/js/page--1cd40f4c.dd76c7b3.js"><link rel="prefetch" href="/myblog/assets/js/page--53f93199.e80bdec8.js"><link rel="prefetch" href="/myblog/assets/js/page--5afd2fd0.adea4e92.js"><link rel="prefetch" href="/myblog/assets/js/page--67c584d3.0a3f3cd9.js"><link rel="prefetch" href="/myblog/assets/js/page--776a8506.cdf48aac.js"><link rel="prefetch" href="/myblog/assets/js/page-CSS.eb94b29f.js"><link rel="prefetch" href="/myblog/assets/js/page-Chrome开发工具使用指南.a2675120.js"><link rel="prefetch" href="/myblog/assets/js/page-DevServer.0281863d.js"><link rel="prefetch" href="/myblog/assets/js/page-Echarts二次封装.4387b8ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Elementui与Element-plusui二次封装.82f12a09.js"><link rel="prefetch" href="/myblog/assets/js/page-Git基础.03c616ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Git规范.e2fdc38a.js"><link rel="prefetch" href="/myblog/assets/js/page-HTML.1e3c14b9.js"><link rel="prefetch" href="/myblog/assets/js/page-Home.f0b7e772.js"><link rel="prefetch" href="/myblog/assets/js/page-JSON配置化组件二次封装.12060fd9.js"><link rel="prefetch" href="/myblog/assets/js/page-JS原理实现.3c427e19.js"><link rel="prefetch" href="/myblog/assets/js/page-JS应用题.3d313b34.js"><link rel="prefetch" href="/myblog/assets/js/page-JavaScript基础.551be887.js"><link rel="prefetch" href="/myblog/assets/js/page-Linux.c6159ebd.js"><link rel="prefetch" href="/myblog/assets/js/page-Loader和Plugin原理.b2971b76.js"><link rel="prefetch" href="/myblog/assets/js/page-MySQL.0b1d704a.js"><link rel="prefetch" href="/myblog/assets/js/page-NPM.a55851b2.js"><link rel="prefetch" href="/myblog/assets/js/page-Node.ec405a21.js"><link rel="prefetch" href="/myblog/assets/js/page-Nodejs常见问题集合.12844e69.js"><link rel="prefetch" href="/myblog/assets/js/page-Node性能优化.b4ea1c34.js"><link rel="prefetch" href="/myblog/assets/js/page-Promise专题.7869a31b.js"><link rel="prefetch" href="/myblog/assets/js/page-React.d76cf0ac.js"><link rel="prefetch" href="/myblog/assets/js/page-SSG移动端项目实践.2122615b.js"><link rel="prefetch" href="/myblog/assets/js/page-TypeScript.4f597fda.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite.637881bf.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite原理解析.6677fdb4.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue25项目webpack构建分析.7bbea0fa.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2VsVue3.10be4140.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2x原理源码分析.e9e753b6.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3基础.210247ff.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3源码分析.17379e04.js"><link rel="prefetch" href="/myblog/assets/js/page-VueRouter原理分析.0a092eb6.js"><link rel="prefetch" href="/myblog/assets/js/page-VueSSR原理分析.63006040.js"><link rel="prefetch" href="/myblog/assets/js/page-VueVsReact.2156be28.js"><link rel="prefetch" href="/myblog/assets/js/page-Vuex原理分析.5ba3e6e4.js"><link rel="prefetch" href="/myblog/assets/js/page-WEB安全.5aa0eeef.js"><link rel="prefetch" href="/myblog/assets/js/page-WebPack构建原理.9c29703e.js"><link rel="prefetch" href="/myblog/assets/js/page-webpackAPI分析.4c8b152b.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack优化.dcc6c3bc.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack基础.3820ee6c.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack项目实践.77e22417.js"><link rel="prefetch" href="/myblog/assets/js/page-一次后台管理系统的性能优化.7c2d8712.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建SSR项目.855376fc.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue2项目和规范设计.93017fd2.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue3单页面应用.de152d54.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建公共组件库.93278073.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js"><link rel="prefetch" href="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js"><link rel="prefetch" href="/myblog/assets/js/page-分治.e3dfc22d.js"><link rel="prefetch" href="/myblog/assets/js/page-前端发版静态资源404问题.9eb1ca89.js"><link rel="prefetch" href="/myblog/assets/js/page-前端存储.cd82cf54.js"><link rel="prefetch" href="/myblog/assets/js/page-前端工程化.1e6e58d0.js"><link rel="prefetch" href="/myblog/assets/js/page-前端性能优化方案.83718d22.js"><link rel="prefetch" href="/myblog/assets/js/page-前端架构实践.171dbc0f.js"><link rel="prefetch" href="/myblog/assets/js/page-前端渲染架构.3b783de8.js"><link rel="prefetch" href="/myblog/assets/js/page-前端自动部署.5076846c.js"><link rel="prefetch" href="/myblog/assets/js/page-前端部署原理.82ecd8a7.js"><link rel="prefetch" href="/myblog/assets/js/page-动态规划.a3af92f1.js"><link rel="prefetch" href="/myblog/assets/js/page-哈希表.c76000e8.js"><link rel="prefetch" href="/myblog/assets/js/page-回溯算法.cd914c32.js"><link rel="prefetch" href="/myblog/assets/js/page-图.dfd9828a.js"><link rel="prefetch" href="/myblog/assets/js/page-基础.7bf5a37b.js"><link rel="prefetch" href="/myblog/assets/js/page-堆.4657e538.js"><link rel="prefetch" href="/myblog/assets/js/page-字符串.252f2a08.js"><link rel="prefetch" href="/myblog/assets/js/page-异步编程.904f4c65.js"><link rel="prefetch" href="/myblog/assets/js/page-性能优化指标和监控.f2175836.js"><link rel="prefetch" href="/myblog/assets/js/page-排序算法.c7a51b99.js"><link rel="prefetch" href="/myblog/assets/js/page-搭建低代码平台.19eaf5ec.js"><link rel="prefetch" href="/myblog/assets/js/page-操作系统.473c4281.js"><link rel="prefetch" href="/myblog/assets/js/page-数学运算.c82748fb.js"><link rel="prefetch" href="/myblog/assets/js/page-数据结构算法.84480586.js"><link rel="prefetch" href="/myblog/assets/js/page-数组.692b0d0a.js"><link rel="prefetch" href="/myblog/assets/js/page-权限管理.c7e10db0.js"><link rel="prefetch" href="/myblog/assets/js/page-查找.790e52df.js"><link rel="prefetch" href="/myblog/assets/js/page-栈和队列.8dbc3586.js"><link rel="prefetch" href="/myblog/assets/js/page-树.24efdeaa.js"><link rel="prefetch" href="/myblog/assets/js/page-浏览器.bee9ec04.js"><link rel="prefetch" href="/myblog/assets/js/page-混合桌面应用开发.9e10d1c3.js"><link rel="prefetch" href="/myblog/assets/js/page-登录.bb830451.js"><link rel="prefetch" href="/myblog/assets/js/page-目录.c85b4d0b.js"><link rel="prefetch" href="/myblog/assets/js/page-移动端开发.56ac22ec.js"><link rel="prefetch" href="/myblog/assets/js/page-组件和组件封装.b5e86da2.js"><link rel="prefetch" href="/myblog/assets/js/page-计算机网络基础.0a106662.js"><link rel="prefetch" href="/myblog/assets/js/page-设计模式.ffdc7cfd.js"><link rel="prefetch" href="/myblog/assets/js/page-调试技巧.485ae36e.js"><link rel="prefetch" href="/myblog/assets/js/page-贪心算法.0f417640.js"><link rel="prefetch" href="/myblog/assets/js/page-输入url到页面展示全过程.510aef2e.js"><link rel="prefetch" href="/myblog/assets/js/page-递归.5e55e552.js"><link rel="prefetch" href="/myblog/assets/js/page-链表.1cf6927f.js"><link rel="prefetch" href="/myblog/assets/js/page-项目总结.ffcd2a4b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~docsearch.f3877d0d.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~5d377965.d9712593.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-components/Blog/ArticleItem~layout-components/Blog/ArticleL~b56f3aac.47bb5cb5.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-NotFound~layout-components/Common~layout-components/Page.57d58db9.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Slide.81546b3b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/AlgoliaSearch/Full.b30f067a.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Blog/BlogPage.bcccbd38.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Navbar/Navbar.e2a7361e.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Page.6c65077c.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Sidebar/Sidebar.34cd9cf7.js"><link rel="prefetch" href="/myblog/assets/js/vendors~photo-swipe.428df1da.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.645fbc6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/myblog/" class="home-link router-link-active"><img src="./mylogo.png" alt="Sewen 博客" class="logo"> <!----> <span class="site-name can-hide">Sewen 博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
        前端基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><a href="/myblog/vue/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><a href="/myblog/vue/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><a href="/myblog/vue/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
        计算机基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><a href="/myblog/vue/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><a href="/myblog/vue/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><a href="/myblog/vue/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><a href="/myblog/vue/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/myblog/vue/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
        框架和源码分析
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><a href="/myblog/vue/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><a href="/myblog/vue/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><a href="/myblog/vue/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><a href="/myblog/vue/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
        浏览器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><a href="/myblog/vue/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><a href="/myblog/vue/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
        服务器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><a href="/myblog/vue/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><a href="/myblog/vue/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><a href="/myblog/vue/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><a href="/myblog/vue/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
        性能优化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><a href="/myblog/vue/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><a href="/myblog/vue/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
        前端工程
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><a href="/myblog/vue/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><a href="/myblog/vue/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><a href="/myblog/vue/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><a href="/myblog/vue/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
        项目实践
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><a href="/myblog/vue/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
        项目搭建
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><a href="/myblog/vue/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="./mylogo.png" class="avatar round"> <div property="name" class="name">Sewen 博客</div> <meta property="url" content="../outline.md"></div> <div class="num-wrapper"><div><div class="num">91</div> <div>Articles</div></div> <div><div class="num">0</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">91</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/Sewar-x/myblog" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="1567910907" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up" class="media-link"><span class="sr-only">Wechat</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E"></circle> <path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#FFF"></path> <path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
      前端基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
      计算机基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
      框架和源码分析
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
      浏览器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
      服务器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
      性能优化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
      前端工程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
      项目实践
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
      项目搭建
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><!----> <a href="/myblog/vue/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">Vue2</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="sidebar-link">Vue2.x 原理源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#框架设计" class="sidebar-link">框架设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#mvc-mvvm" class="sidebar-link heading3">MVC &amp; MVVM</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#单页面-多页面应用" class="sidebar-link heading3">单页面 &amp; 多页面应用</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#原理分析" class="sidebar-link">原理分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#构建流程" class="sidebar-link heading3">构建流程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#执行流程" class="sidebar-link heading3">执行流程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#生命周期" class="sidebar-link heading3">生命周期</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#初始化" class="sidebar-link heading3">初始化</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#响应式" class="sidebar-link heading3">响应式</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#挂载组件" class="sidebar-link heading3">挂载组件</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#模板编译" class="sidebar-link heading3">模板编译</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#首次渲染" class="sidebar-link heading3">首次渲染</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#virtual-dom" class="sidebar-link heading3">Virtual DOM</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#diff-算法" class="sidebar-link heading3">diff 算法</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#派发更新" class="sidebar-link heading3">派发更新</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#销毁实例" class="sidebar-link heading3">销毁实例</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#手写响应式原理" class="sidebar-link">手写响应式原理</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#组件" class="sidebar-link">组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#组件基础" class="sidebar-link heading3">组件基础</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#组件注册" class="sidebar-link heading3">组件注册</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#组件生命周期" class="sidebar-link heading3">组件生命周期</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#组件分类" class="sidebar-link heading3">组件分类</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#组件通信" class="sidebar-link heading3">组件通信</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#扩展组件方式" class="sidebar-link heading3">扩展组件方式</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#高阶组件" class="sidebar-link heading3">高阶组件</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#内置组件" class="sidebar-link heading3">内置组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#全局api" class="sidebar-link">全局API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-extend-options" class="sidebar-link heading3">Vue.extend(options)</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-nexttick" class="sidebar-link heading3">Vue.nextTick</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-set" class="sidebar-link heading3">Vue.set</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-use-plugin" class="sidebar-link heading3">Vue.use( plugin )</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-mixin-mixin" class="sidebar-link heading3">Vue.mixin( mixin )</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#选项合并策略" class="sidebar-link heading3">选项合并策略</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#选项-数据" class="sidebar-link">选项/数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#data" class="sidebar-link heading3">data</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#computed-计算属性" class="sidebar-link heading3">computed 计算属性</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#watch-侦听器" class="sidebar-link heading3">watch 侦听器</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#this-options-data-和-this-data" class="sidebar-link heading3">this.$options.data() 和 this.$data</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#指令" class="sidebar-link">指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#v-if-v-show" class="sidebar-link heading3">v-if &amp; v-show</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#v-model-双向绑定" class="sidebar-link heading3">v-model 双向绑定</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#实例方法-事件" class="sidebar-link">实例方法 / 事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-事件机制" class="sidebar-link heading3">VUE 事件机制</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#修饰符" class="sidebar-link heading3">修饰符</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#手写-on-off-emit-once" class="sidebar-link heading3">手写$on,$off,$emit,$once</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#特殊属性" class="sidebar-link">特殊属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#key" class="sidebar-link heading3">key</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-2-x-缺陷" class="sidebar-link">VUE 2.X 缺陷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#数组和对象的检测缺陷" class="sidebar-link heading3">数组和对象的检测缺陷</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#为什么-vue2-无法检测到-data-对象属性的新增或删除" class="sidebar-link heading3">为什么 Vue2 无法检测到 data 对象属性的新增或删除？</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue2-x数组变更方法" class="sidebar-link">Vue2.x数组变更方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-不能检测到数组的变动" class="sidebar-link heading3">Vue 不能检测到数组的变动</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#数组变更方法实现" class="sidebar-link heading3">数组变更方法实现</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#数组方法包裹实现原理" class="sidebar-link heading3">数组方法包裹实现原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue2-x-问答题" class="sidebar-link">VUE2.x 问答题</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue2-x源码问答题" class="sidebar-link">VUE2.x源码问答题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#初始化过程相关问题" class="sidebar-link heading3">初始化过程相关问题</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#全局api-问答" class="sidebar-link heading3">全局API 问答</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#响应式原理相关问题" class="sidebar-link heading3">响应式原理相关问题</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#数据更新相关问题" class="sidebar-link heading3">数据更新相关问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2%E5%8E%9F%E7%90%86%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#源码相关" class="sidebar-link heading3">源码相关</a></li></ul></li></ul></li><li><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="sidebar-link">Vuex原理分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#vuex-基础" class="sidebar-link">VUEX 基础</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#实例化" class="sidebar-link">实例化</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#相关问题" class="sidebar-link">相关问题</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#应用" class="sidebar-link">应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#vuex和localstorage-比较" class="sidebar-link heading3">Vuex和localStorage 比较</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#vuex数据持久化" class="sidebar-link heading3">Vuex数据持久化</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vuex%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="sidebar-link">VueRouter原理分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#路由基础" class="sidebar-link">路由基础</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#总体流程" class="sidebar-link">总体流程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#路由对象" class="sidebar-link">路由对象</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#路由模式" class="sidebar-link">路由模式</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#路由安装" class="sidebar-link">路由安装</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#路由匹配" class="sidebar-link">路由匹配</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#路由切换" class="sidebar-link">路由切换</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#内置组件" class="sidebar-link">内置组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#router-link" class="sidebar-link heading3">&lt;router-link&gt;</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#router-view" class="sidebar-link heading3">&lt;router-view&gt;</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#相关问题" class="sidebar-link">相关问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#路由匹配过程" class="sidebar-link heading3">路由匹配过程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#响应路由参数的变化" class="sidebar-link heading3">响应路由参数的变化</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#对同一个组件中参数的变化做出响应" class="sidebar-link heading3">对同一个组件中参数的变化做出响应</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#beforerouteenter-能否拿到组件实例-this-为什么" class="sidebar-link heading3">beforeRouteEnter 能否拿到组件实例 this? 为什么?</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#如何在路由守卫进行管道中的下一个钩子" class="sidebar-link heading3">如何在路由守卫进行管道中的下一个钩子？</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#为什么路由路由守卫中必须调用-next-才会前进到下一个导航守卫钩子函数中" class="sidebar-link heading3">为什么路由路由守卫中必须调用 next()，才会前进到下一个导航守卫钩子函数中？</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#切换路由时需要保存草稿的功能-怎么实现" class="sidebar-link heading3">切换路由时需要保存草稿的功能，怎么实现？</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#刷新无法触发-router-beforeeach-守卫问题" class="sidebar-link heading3">刷新无法触发 router.beforeEach 守卫问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueRouter%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" class="sidebar-link">VueSSR原理分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#ssr是什么" class="sidebar-link">SSR是什么？</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#为什么要用-ssr" class="sidebar-link">为什么要用 SSR？</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#前端渲染架构类型" class="sidebar-link">前端渲染架构类型</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#同构应用原理" class="sidebar-link">同构应用原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#组件基于-vnode-渲染" class="sidebar-link heading3">组件基于 VNode 渲染</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#vnode" class="sidebar-link heading3">VNode</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#ssr架构" class="sidebar-link">SSR架构</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#项目源码" class="sidebar-link">项目源码</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#源码分析" class="sidebar-link">源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#项目目录" class="sidebar-link heading3">项目目录</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#app-js" class="sidebar-link heading3">app.js</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#entry-client-js" class="sidebar-link heading3">entry-client.js</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#entry-server-js" class="sidebar-link heading3">entry-server.js</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#server-js" class="sidebar-link heading3">server.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#编译流程" class="sidebar-link">编译流程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#webpack-构建" class="sidebar-link">Webpack 构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#服务端构建流程" class="sidebar-link heading3">服务端构建流程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#客户端构建流程" class="sidebar-link heading3">客户端构建流程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#编译产物分析" class="sidebar-link heading3">编译产物分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#webpack-配置" class="sidebar-link">Webpack 配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#webpack-base-config" class="sidebar-link heading3">`webpack.base.config`</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#webpack-server-config" class="sidebar-link heading3">`webpack.server.config`</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#webpack-client-config" class="sidebar-link heading3">`webpack.client.config`</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#setup-dev-server" class="sidebar-link heading3">`setup-dev-server`</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#vue-server-renderer-分析" class="sidebar-link">`vue-server-renderer` 分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#vue-server-renderer-使用" class="sidebar-link heading3">`vue-server-renderer`  使用</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#vue-server-renderer-源码分析" class="sidebar-link heading3">`vue-server-renderer`  源码分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#注意事项" class="sidebar-link">注意事项</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" aria-current="page" class="active sidebar-link">VueCli源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#是什么" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#为什么" class="sidebar-link">为什么</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-cli-集成插件-库" class="sidebar-link">Vue-cli 集成插件/库</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#功能" class="sidebar-link">功能</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#创建项目过程分析" class="sidebar-link">创建项目过程分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#安装-vue-cli" class="sidebar-link heading3">安装 Vue-Cli</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#命令解析" class="sidebar-link heading3">命令解析</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-create-命令执行过程" class="sidebar-link heading3">`vue create` 命令执行过程</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-create-命令解析" class="sidebar-link heading3">`vue create` 命令解析</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#creator-创建项目" class="sidebar-link heading3">Creator 创建项目</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#generator-生成项目文件" class="sidebar-link heading3">Generator 生成项目文件</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#初始化插件" class="sidebar-link heading3">初始化插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#cli-服务分析" class="sidebar-link">CLI 服务分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#使用" class="sidebar-link heading3">使用</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#shell-命令解析" class="sidebar-link heading3">Shell 命令解析</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#service-对象初始化" class="sidebar-link heading3">Service 对象初始化</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#service-run-启动构建" class="sidebar-link heading3">`Service.run ` 启动构建</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#解析插件" class="sidebar-link heading3">解析插件</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#serve-命令解析" class="sidebar-link heading3">serve 命令解析</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#build-命令解析" class="sidebar-link heading3">`build` 命令解析</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#webpack-配置原理" class="sidebar-link">WebPack 配置原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#配置方式" class="sidebar-link heading3">配置方式</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#链式操作-高级" class="sidebar-link heading3">链式操作 (高级)</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#模式和环境变量" class="sidebar-link">模式和环境变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#模式" class="sidebar-link heading3">模式</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#环境变量" class="sidebar-link heading3">环境变量</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#源码分析-3" class="sidebar-link heading3">源码分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">Vue3</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/vue/Vue3%E5%9F%BA%E7%A1%80/" class="sidebar-link">Vue3基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue3%E5%9F%BA%E7%A1%80/#ref-原理" class="sidebar-link">ref 原理</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue3%E5%9F%BA%E7%A1%80/#reactive-原理" class="sidebar-link">reactive 原理</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue3%E5%9F%BA%E7%A1%80/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/vue/Vue3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="sidebar-link">Vue3源码分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">框架对比</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/vue/Vue2VsVue3/" class="sidebar-link">Vue2 Vs Vue3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#对比总览" class="sidebar-link">对比总览</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#源码管理" class="sidebar-link">源码管理</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#typescript-支持" class="sidebar-link">TypeScript 支持</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#响应式系统" class="sidebar-link">响应式系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#object-defineproperty缺陷" class="sidebar-link heading3">`Object.defineProperty`缺陷</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#proxy-优势" class="sidebar-link heading3">Proxy 优势</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#体积优化" class="sidebar-link">体积优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#tree-shaking-支持" class="sidebar-link heading3">Tree-shaking 支持</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#更小的包体积" class="sidebar-link heading3">更小的包体积</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#编译优化" class="sidebar-link">编译优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#diff-算法优化" class="sidebar-link heading3">diff 算法优化</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#静态提升" class="sidebar-link heading3">静态提升</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#事件监听缓存" class="sidebar-link heading3">事件监听缓存</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#ssr优化" class="sidebar-link heading3">SSR优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#composition-vs-options" class="sidebar-link">Composition VS Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#options-api" class="sidebar-link heading3">Options API</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#composition-api" class="sidebar-link heading3">Composition Api</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#优化逻辑组织" class="sidebar-link heading3">优化逻辑组织</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#优化逻辑复用" class="sidebar-link heading3">优化逻辑复用</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#hooks-vs-mixins" class="sidebar-link">Hooks VS Mixins</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#语法差异" class="sidebar-link">语法差异</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#创建实例方式" class="sidebar-link">创建实例方式</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#生命周期钩子" class="sidebar-link">生命周期钩子</a></li><li class="sidebar-sub-header"><a href="/myblog/vue/Vue2VsVue3/#内置组件" class="sidebar-link">内置组件</a></li></ul></li><li><a href="/myblog/vue/VueVsReact/" class="sidebar-link">Vue Vs React</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueVsReact/#vue-vs-react" class="sidebar-link">Vue Vs React</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/vue/VueVsReact/#总览" class="sidebar-link heading3">总览</a></li></ul></li></ul></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">VueCli源码分析</span></h1> <div class="page-info"><!----> <true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#是什么" class="anchor-link heading2"><div>是什么</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#为什么" class="anchor-link heading2"><div>为什么</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-cli-集成插件-库" class="anchor-link heading2"><div>Vue-cli 集成插件/库</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#功能" class="anchor-link heading2"><div>功能</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#创建项目过程分析" class="anchor-link heading2"><div>创建项目过程分析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#安装-vue-cli" class="anchor-link heading3"><div>安装 Vue-Cli</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#命令解析" class="anchor-link heading3"><div>命令解析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-create-命令执行过程" class="anchor-link heading3"><div>`vue create` 命令执行过程</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#vue-create-命令解析" class="anchor-link heading3"><div>`vue create` 命令解析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#creator-创建项目" class="anchor-link heading3"><div>Creator 创建项目</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#generator-生成项目文件" class="anchor-link heading3"><div>Generator 生成项目文件</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#初始化插件" class="anchor-link heading3"><div>初始化插件</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#cli-服务分析" class="anchor-link heading2"><div>CLI 服务分析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#使用" class="anchor-link heading3"><div>使用</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#shell-命令解析" class="anchor-link heading3"><div>Shell 命令解析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#service-对象初始化" class="anchor-link heading3"><div>Service 对象初始化</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#service-run-启动构建" class="anchor-link heading3"><div>`Service.run ` 启动构建</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#解析插件" class="anchor-link heading3"><div>解析插件</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#serve-命令解析" class="anchor-link heading3"><div>serve 命令解析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#build-命令解析" class="anchor-link heading3"><div>`build` 命令解析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#webpack-配置原理" class="anchor-link heading2"><div>WebPack 配置原理</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#配置方式" class="anchor-link heading3"><div>配置方式</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#链式操作-高级" class="anchor-link heading3"><div>链式操作 (高级)</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#模式和环境变量" class="anchor-link heading2"><div>模式和环境变量</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#模式" class="anchor-link heading3"><div>模式</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#环境变量" class="anchor-link heading3"><div>环境变量</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#源码分析-3" class="anchor-link heading3"><div>源码分析</div></a></li><li class="anchor"><a href="/myblog/vue/VueCli%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#参考资料" class="anchor-link heading2"><div>参考资料</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="vuecli源码分析"><a href="#vuecli源码分析" class="header-anchor">#</a> VueCli源码分析</h1> <p><img src="/myblog/assets/img/VueCli.9bebcbb0.png" alt=""></p> <h2 id="是什么"><a href="#是什么" class="header-anchor">#</a> <strong>是什么</strong></h2> <p>Vue CLI（Vue Command Line Interface）是一个官方提供的命令行工具，用于快速搭建和管理Vue.js项目。</p> <p>它提供了一整套完整的开发解决方案，包括代码构建、热更新、代码分割、代码压缩、版本控制等功能，大大简化了Vue.js项目的开发过程。</p> <h2 id="为什么"><a href="#为什么" class="header-anchor">#</a> <strong>为什么</strong></h2> <p>在开发Vue.js项目时，如果没有一个统一的构建工具，开发人员需要手动配置各种工具和插件，这不仅浪费时间，还容易出错。</p> <p>而Vue CLI作为官方的构建工具，提供了预先配置好的最佳实践，使得开发人员可以专注于编写业务逻辑，而不是花费大量时间在配置上。</p> <p>Vue CLI还可以自动化处理许多繁琐的任务，如代码压缩、热更新等，从而提高开发效率。</p> <h2 id="vue-cli-集成插件-库"><a href="#vue-cli-集成插件-库" class="header-anchor">#</a> <strong>Vue-cli 集成插件/库</strong></h2> <table><thead><tr><th style="text-align:left;">技术</th> <th style="text-align:left;">作用</th></tr></thead> <tbody><tr><td style="text-align:left;">Vue.js</td> <td style="text-align:left;">用于构建用户界面的流行JavaScript前端框架</td></tr> <tr><td style="text-align:left;">Webpack</td> <td style="text-align:left;">静态模块打包工具，处理项目中的资源文件并打包成可用的文件</td></tr> <tr><td style="text-align:left;">Babel</td> <td style="text-align:left;">JavaScript 编译器，将ES6+代码转换为向后兼容的JavaScript版本</td></tr> <tr><td style="text-align:left;">ESLint</td> <td style="text-align:left;">可插拔的JavaScript代码检查工具，帮助保持一致的代码风格和发现潜在问题</td></tr> <tr><td style="text-align:left;">Vue Router</td> <td style="text-align:left;">Vue.js官方提供的路由管理器，用于构建单页应用程序的路由系统</td></tr> <tr><td style="text-align:left;">Vuex</td> <td style="text-align:left;">Vue.js官方提供的状态管理库，用于管理应用程序的全局状态</td></tr> <tr><td style="text-align:left;">Axios</td> <td style="text-align:left;">用于发起 GET 、或 POST 等 http请求，基于 Promise 设计</td></tr> <tr><td style="text-align:left;">Jest</td> <td style="text-align:left;">单元测试框架，用于编写和运行单元测试</td></tr> <tr><td style="text-align:left;">Cypress</td> <td style="text-align:left;">端到端测试框架，用于编写和运行整个应用程序的端到端测试</td></tr> <tr><td style="text-align:left;">Sass</td> <td style="text-align:left;">CSS预处理器，增强CSS的编程能力和可维护性</td></tr> <tr><td style="text-align:left;">Less</td> <td style="text-align:left;">CSS预处理器，增强CSS的编程能力和可维护性</td></tr> <tr><td style="text-align:left;">Prettier</td> <td style="text-align:left;">代码格式化工具，用于自动格式化代码</td></tr> <tr><td style="text-align:left;">代码分割</td> <td style="text-align:left;">将代码拆分成多个小块，实现按需加载和提高应用程序性能</td></tr> <tr><td style="text-align:left;">懒加载</td> <td style="text-align:left;">延迟加载页面中的资源，提高应用程序的性能</td></tr> <tr><td style="text-align:left;"><code>emit.js</code> 文件</td> <td style="text-align:left;">用于 vue 事件机制的管理</td></tr></tbody></table> <p><code>Vue-CLi</code> 集成的所有内置插件位于 <code>./node_modules/@vue/</code>目录下：</p> <p><img src="/myblog/assets/img/vuecli集成的插件.80b19243.png" alt="image-20240201112118335"></p> <h2 id="功能"><a href="#功能" class="header-anchor">#</a> <strong>功能</strong></h2> <p>Vue-Cli 主要有两个核心功能：</p> <ol><li>快速搭建和管理Vue.js项目： <code>vue-cli</code> 内置 Vue 项目的脚手架模板，通过使用 <code>vue create</code> 即可创建一个 Vue 项目；</li> <li>提供开发和部署服务：开发和部署解决方案通过 <code>vue-cli-service</code> 服务实现，<code>vue-cli-service</code> 服务对 webpack 进行了二次封装，内置 webpack dev server 开发服务和 webpack 构建部署服务。</li></ol> <p>下面将通过分析 创建 <code>vue create</code> 项目模板（项目脚手架）过程和 <code>vue-cli-service</code> 服务过程源码，来了解 vue-cli 的两大核心功能的实现。</p> <h2 id="创建项目过程分析"><a href="#创建项目过程分析" class="header-anchor">#</a> 创建项目过程分析</h2> <h3 id="安装-vue-cli"><a href="#安装-vue-cli" class="header-anchor">#</a> <strong>安装 Vue-Cli</strong></h3> <p>可以使用下列任一命令安装这个新的包：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @vue/cli
<span class="token comment"># OR</span>
<span class="token function">yarn</span> global <span class="token function">add</span> @vue/cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>安装之后，你就可以在命令行中访问 <code>vue</code> 命令。</p> <p>以上通过全局安装 <code>vue-cli</code>，默认情况下 windows 会安装到 <code>C:\Users\\AppData\Roaming\npm\node_modules\@vue\cli</code> 目录中;</p> <h3 id="命令解析"><a href="#命令解析" class="header-anchor">#</a> <strong>命令解析</strong></h3> <p>运行以下命令来创建一个新项目：(详细参考官方文档：<a href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create" target="_blank" rel="noopener noreferrer">创建一个项目 | Vue CLI (vuejs.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>vue create hello-world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><code>vue create</code> 命令在 Windows 下的解析流程常在用户执行命令时自动进行：</p> <ol><li><strong>命令行输入</strong>：当你在命令提示符（Command Prompt）或 PowerShell 中输入 <code>vue create</code> 命令时，首先会检查系统环境变量中定义的全局安装包目录。</li> <li><strong>环境变量查找</strong>：Windows 会检查系统的 <code>PATH</code> 环境变量中列出的目录，寻找 <code>@vue/cli</code> 的可执行文件。在全局安装 npm 包时，通常会将包的 bin 目录添加到系统的 PATH 中。</li> <li><strong>全局安装包目录</strong>：找到 <code>@vue/cli</code> 的安装位置后，系统会在该目录下的 <code>bin</code> 子目录中查找名为 <code>vue</code> 的可执行文件。</li> <li><strong>执行文件关联</strong>：一旦找到 <code>vue</code> 可执行文件，系统会将其与 <code>vue create</code> 命令关联起来。这意味着当你输入 <code>vue create</code> 时，实际上是在执行这个可执行文件。</li> <li><strong>命令执行</strong>：<code>vue</code> 可执行文件会接收到 <code>create</code> 命令及其后续参数（例如 <code>hello-world</code>），并执行相应的操作。这通常涉及启动一个脚本来创建新的 Vue 项目。</li> <li><strong>子进程调用</strong>：在某些情况下，<code>vue create</code> 命令可能会通过子进程调用其他工具或脚本，如 <code>yarn</code> 或 <code>npm</code>，来安装项目的依赖项或执行其他初始化任务。</li> <li><strong>输出与反馈</strong>：命令的执行结果（如成功创建项目或遇到错误）会显示在命令行界面上，为用户提供反馈。</li></ol></blockquote> <p>当运行 <code>vue create</code> 命令时，默认会执行安装的 <code>vue-cli</code> 项目下的 <code>/bin/vue.js</code> 文件（以下是全局安装的 <code>vue-cli</code> 项目目录）：</p> <p><img src="/myblog/assets/img/vue-cli.30380a21.png" alt="image-20240131164539288"></p> <blockquote><p><code>/bin/vue.js</code> 文件执行流程：</p> <ol><li><p>检查 Node.js 版本；</p></li> <li><p>定义所有 vue 命令;</p> <ul><li><p>vue 使用 commander 库定义命令的配置项，并在配置中指明命令的执行文件；</p></li> <li><p><code>vue create</code> 命令在文件中的定义和执行路径如下：</p> <p><img src="/myblog/assets/img/vue-create文件执行.5b60a9df.png" alt="image-20240131170240448"></p></li></ul></li> <li><p>解析 shell 命令，并根据命令执行路径执行命令；</p></li></ol></blockquote> <h3 id="vue-create-命令执行过程"><a href="#vue-create-命令执行过程" class="header-anchor">#</a> <strong><code>vue create</code> 命令执行过程</strong></h3> <ol><li>终端输入<code>vue create vue-test-app</code>;</li> <li>终端解析出<code>vue</code>主命令;</li> <li>终端在环境变量中找到<code>vue</code>命令;</li> <li>终端根据<code>vue</code>命令链接到实际可执行文件vue.js;</li> <li>终端利用 node 执行 vue.js;</li> <li>vue.js 解析 command 和 option;</li> <li>vue.js 执行 command;</li> <li>执行完毕，退出执行;</li></ol> <h3 id="vue-create-命令解析"><a href="#vue-create-命令解析" class="header-anchor">#</a> <strong><code>vue create</code> 命令解析</strong></h3> <p>执行 <code>vue create</code> 命令时，最终是解析 <code>./@vue/cli/lib/create.js</code> 文件：</p> <p><img src="/myblog/assets/img/vue-create文件分析.819f151d.png" alt="image-20240131171951445"></p> <blockquote><p><code>vue create</code> 命令主要执行以下逻辑：</p> <ol><li>检查输入的 projectName 是否符合规范；必须指定一个 <code>app-name</code>，否则会报错；</li> <li>判断 target  目录是否存在，然后通过交互询问用户是否覆盖（对应的是操作是删除原目录;</li> <li>创建 Creator 类,并执行<code>creator.create(options)</code>;</li></ol></blockquote> <h3 id="creator-创建项目"><a href="#creator-创建项目" class="header-anchor">#</a> <strong>Creator 创建项目</strong></h3> <p>Creator 类是主要创建脚手架的类，该类定义如下：</p> <p><img src="/myblog/assets/img/creator类.94433a85.png" alt="image-20240131190642601"></p> <p>由以上 Creator 类的定义，创建项目的核心方法在 <code>Creator.create()</code> 中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// 根据用户交互提示创建项目</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">cliOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> preset <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断是否是测试或调试环境</span>
    <span class="token keyword">const</span> isTestOrDebug <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_DEBUG</span>
    <span class="token comment">// 获取 run、name、context、afterInvokeCbs、afterAnyInvokeCbs 五个属性</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> run<span class="token punctuation">,</span> name<span class="token punctuation">,</span> context<span class="token punctuation">,</span> afterInvokeCbs<span class="token punctuation">,</span> afterAnyInvokeCbs <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>

    <span class="token comment">// 如果没有提供preset，则根据cliOptions的参数来决定使用哪个preset</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>preset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>preset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// vue create foo --preset bar</span>
        preset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolvePreset</span><span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>preset<span class="token punctuation">,</span> cliOptions<span class="token punctuation">.</span>clone<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>default<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// vue create foo --default</span>
        preset <span class="token operator">=</span> defaults<span class="token punctuation">.</span>presets<span class="token punctuation">.</span>default
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>inlinePreset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// vue create foo --inlinePreset {...}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          preset <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>inlinePreset<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">CLI inline preset is not valid JSON: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cliOptions<span class="token punctuation">.</span>inlinePreset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 用户没有提供任何preset，因此弹出一个提示，让用户选择</span>
        preset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">promptAndResolvePreset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// clone before mutating</span>
    <span class="token comment">// 克隆一份preset，因为后面会修改它</span>
    preset <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>preset<span class="token punctuation">)</span>
    <span class="token comment">// inject core service</span>
    <span class="token comment">// 注入核心服务</span>
    preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">projectName</span><span class="token operator">:</span> name
    <span class="token punctuation">}</span><span class="token punctuation">,</span> preset<span class="token punctuation">)</span>

    <span class="token comment">// 判断cliOptions.bare是否存在，存在则将preset.plugins['@vue/cli-service'].bare设置为true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cliOptions<span class="token punctuation">.</span>bare<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bare <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// legacy support for router</span>
    <span class="token comment">// 判断preset.router是否存在，存在则将preset.plugins['@vue/cli-plugin-router']设置为空对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>preset<span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-router'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

      <span class="token comment">// 判断preset.routerHistoryMode是否存在，存在则将preset.plugins['@vue/cli-plugin-router'].historyMode设置为true</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>preset<span class="token punctuation">.</span>routerHistoryMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-router'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>historyMode <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Introducing this hack because typescript plugin must be invoked after router.</span>
    <span class="token comment">// Currently we rely on the `plugins` object enumeration order,</span>
    <span class="token comment">// which depends on the order of the field initialization.</span>
    <span class="token comment">// FIXME: Remove this ugly hack after the plugin ordering API settled down</span>
    <span class="token comment">// 如果preset.plugins中包含@vue/cli-plugin-router和@vue/cli-plugin-typescript，则删除@vue/cli-plugin-typescript，并将@vue/cli-plugin-typescript设置为preset.plugins['@vue/cli-plugin-typescript']</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-router'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-typescript'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tmp <span class="token operator">=</span> preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-typescript'</span><span class="token punctuation">]</span>
      <span class="token keyword">delete</span> preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-typescript'</span><span class="token punctuation">]</span>
      preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-typescript'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp
    <span class="token punctuation">}</span>

    <span class="token comment">// legacy support for vuex</span>
    <span class="token comment">// 如果preset.vuex存在，则将preset.plugins['@vue/cli-plugin-vuex']设置为空对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>preset<span class="token punctuation">.</span>vuex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'@vue/cli-plugin-vuex'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 加载cliOptions中的packageManager属性，如果没有则加载options中的packageManager属性，</span>
    <span class="token comment">// 如果没有则根据是否有yarn，pnpm3或更高版本，返回对应的packageManager</span>
    <span class="token keyword">const</span> packageManager <span class="token operator">=</span> <span class="token punctuation">(</span>
      cliOptions<span class="token punctuation">.</span>packageManager <span class="token operator">||</span>
      <span class="token function">loadOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>packageManager <span class="token operator">||</span>
      <span class="token punctuation">(</span><span class="token function">hasYarn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'yarn'</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token punctuation">(</span><span class="token function">hasPnpm3OrLater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'pnpm'</span> <span class="token operator">:</span> <span class="token string">'npm'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">await</span> <span class="token function">clearConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> pm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackageManager</span><span class="token punctuation">(</span><span class="token punctuation">{</span> context<span class="token punctuation">,</span> <span class="token literal-property property">forcePackageManager</span><span class="token operator">:</span> packageManager <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✨  Creating project in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'creating'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// get latest CLI plugin version</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> latestMinor <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getVersions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// generate package.json with plugin dependencies</span>
    <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">,</span>
      <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">'0.1.0'</span><span class="token punctuation">,</span>
      <span class="token keyword">private</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">devDependencies</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token function">resolvePkg</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> deps <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>preset<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span>
    deps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">dep</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 过滤掉 preset 插件</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>dep<span class="token punctuation">]</span><span class="token punctuation">.</span>_isPreset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">let</span> <span class="token punctuation">{</span> version <span class="token punctuation">}</span> <span class="token operator">=</span> preset<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>dep<span class="token punctuation">]</span>

      <span class="token comment">// 如果没有指定版本，则根据不同的插件类型，使用不同的默认版本</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>version<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOfficialPlugin</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token operator">||</span> dep <span class="token operator">===</span> <span class="token string">'@vue/cli-service'</span> <span class="token operator">||</span> dep <span class="token operator">===</span> <span class="token string">'@vue/babel-preset-env'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          version <span class="token operator">=</span> isTestOrDebug <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">file:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../../../'</span><span class="token punctuation">,</span> dep<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">~</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latestMinor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          version <span class="token operator">=</span> <span class="token string">'latest'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 添加到依赖中</span>
      pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">[</span>dep<span class="token punctuation">]</span> <span class="token operator">=</span> version
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// write package.json</span>
    <span class="token comment">// 写入文件树，context为上下文，pkg为包信息</span>
    <span class="token keyword">await</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'package.json'</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// generate a .npmrc file for pnpm, to persist the `shamefully-flatten` flag</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>packageManager <span class="token operator">===</span> <span class="token string">'pnpm'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> pnpmConfig <span class="token operator">=</span> <span class="token function">hasPnpmVersionOrLater</span><span class="token punctuation">(</span><span class="token string">'4.0.0'</span><span class="token punctuation">)</span>
        <span class="token operator">?</span> <span class="token string">'shamefully-hoist=true\n'</span>
        <span class="token operator">:</span> <span class="token string">'shamefully-flatten=true\n'</span>

      <span class="token keyword">await</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'.npmrc'</span><span class="token operator">:</span> pnpmConfig
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>packageManager <span class="token operator">===</span> <span class="token string">'yarn'</span> <span class="token operator">&amp;&amp;</span> semver<span class="token punctuation">.</span><span class="token function">satisfies</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>version<span class="token punctuation">,</span> <span class="token string">'8.x'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Vue CLI 4.x should support Node 8.x,</span>
      <span class="token comment">// but some dependenices already bumped `engines` field to Node 10</span>
      <span class="token comment">// and Yarn treats `engines` field too strictly</span>
      <span class="token keyword">await</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'.yarnrc'</span><span class="token operator">:</span> <span class="token string">'# Hotfix for Node 8.x\n--install.ignore-engines true\n'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// intilaize git repository before installing deps</span>
    <span class="token comment">// so that vue-cli-service can setup git hooks.</span>
    <span class="token comment">// 判断是否初始化git仓库</span>
    <span class="token keyword">const</span> shouldInitGit <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shouldInitGit</span><span class="token punctuation">(</span>cliOptions<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldInitGit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🗃  Initializing git repository...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'git-init'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git init'</span><span class="token punctuation">)</span><span class="token comment">//初始化git仓库</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// install plugins</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">⚙\u{fe0f}  Installing CLI plugins. This might take a while...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'plugins-install'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 如果isTestOrDebug为true，且process.env.VUE_CLI_TEST_DO_INSTALL_PLUGIN为false，则执行setupDevProject函数，否则执行install函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isTestOrDebug <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST_DO_INSTALL_PLUGIN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// in development, avoid installation process</span>
      <span class="token keyword">await</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./util/setupDevProject'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> pm<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// run generator</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'invoking-generators'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 解析插件</span>
    <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolvePlugins</span><span class="token punctuation">(</span>preset<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> pkg<span class="token punctuation">)</span>
    <span class="token comment">// 创建生成器</span>
    <span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      pkg<span class="token punctuation">,</span>
      plugins<span class="token punctuation">,</span>
      afterInvokeCbs<span class="token punctuation">,</span>
      afterAnyInvokeCbs
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 生成文件</span>
    <span class="token keyword">await</span> generator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">extractConfigFiles</span><span class="token operator">:</span> preset<span class="token punctuation">.</span>useConfigFiles
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// install additional deps (injected by generators)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">📦  Installing additional dependencies...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'deps-install'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 判断是否是测试或者调试环境，或者VUE_CLI_TEST_DO_INSTALL_PLUGIN环境变量是否为true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTestOrDebug <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST_DO_INSTALL_PLUGIN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 安装插件</span>
      <span class="token keyword">await</span> pm<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// run complete cbs if any (injected by generators)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">⚓  Running completion hooks...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// 触发创建事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'completion-hooks'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 执行afterInvokeCbs中的回调函数</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> cb <span class="token keyword">of</span> afterInvokeCbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 执行afterAnyInvokeCbs中的回调函数</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> cb <span class="token keyword">of</span> afterAnyInvokeCbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 生成  README.md</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>generator<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'README.md'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// generate README.md</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'📄  Generating README.md...'</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'README.md'</span><span class="token operator">:</span> <span class="token function">generateReadme</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span>pkg<span class="token punctuation">,</span> packageManager<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// commit initial state</span>
    <span class="token keyword">let</span> gitCommitFailed <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldInitGit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 添加所有文件到 git</span>
      <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git add -A'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isTestOrDebug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置测试配置</span>
        <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'user.name'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'user.email'</span><span class="token punctuation">,</span> <span class="token string">'test@test.com'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'commit.gpgSign'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token keyword">typeof</span> cliOptions<span class="token punctuation">.</span>git <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> cliOptions<span class="token punctuation">.</span>git <span class="token operator">:</span> <span class="token string">'init'</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 提交</span>
        <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'commit'</span><span class="token punctuation">,</span> <span class="token string">'-m'</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">'--no-verify'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果提交失败，则设置gitCommitFailed为true</span>
        gitCommitFailed <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// log instructions</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🎉  Successfully created project </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cliOptions<span class="token punctuation">.</span>skipGetStarted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">👉  Get started with the following commands:\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">===</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> cd </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager <span class="token operator">===</span> <span class="token string">'yarn'</span> <span class="token operator">?</span> <span class="token string">'yarn serve'</span> <span class="token operator">:</span> packageManager <span class="token operator">===</span> <span class="token string">'pnpm'</span> <span class="token operator">?</span> <span class="token string">'pnpm run serve'</span> <span class="token operator">:</span> <span class="token string">'npm run serve'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>gitCommitFailed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Skipped git commit due to missing username and email in git config, or failed to sign commit.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You will need to perform the initial commit yourself.\n</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    generator<span class="token punctuation">.</span><span class="token function">printExitLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br></div></div><blockquote><p><code>Creator.create()</code> 方法主要逻辑：</p> <ol><li><p>preset 预设参数初始化；</p> <ul><li>Preset 是一个包含创建新项目所需预定义选项和插件的 JSON 对象，让用户无需在命令提示中选择它们。</li></ul></li> <li><p>包管理器实例初始化；</p></li> <li><p>根据插件依赖生成 package.json 文件；</p> <ul><li>Vue CLI 在创建目录下写入一个基础的 <code>package.json</code></li></ul></li> <li><p>根据包管理器自动判断 NPM 源，生成对应管理器的 xxxrc 文件；</p></li> <li><p>判断是否初始化 Git 仓库，并初始化 Git 仓库环境；</p></li> <li><p>判断是否为是测试或调试环境：</p> <ul><li>是，则调用<code>setupDevProject</code> 启动开发服务；在开发过程中，避免安装过程；</li> <li>否，根据 package.json 文件安装项目依赖；</li></ul></li> <li><p>生成项目文件： 解析插件对象，并创建生成器实例生成项目文件；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 解析插件</span>
    <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolvePlugins</span><span class="token punctuation">(</span>preset<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> pkg<span class="token punctuation">)</span>
    <span class="token comment">// 创建生成器</span>
    <span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      pkg<span class="token punctuation">,</span>
      plugins<span class="token punctuation">,</span>
      afterInvokeCbs<span class="token punctuation">,</span>
      afterAnyInvokeCbs
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 生成文件</span>
    <span class="token keyword">await</span> generator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">extractConfigFiles</span><span class="token operator">:</span> preset<span class="token punctuation">.</span>useConfigFiles
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>安装由生成器实例注入的依赖；</p></li> <li><p>运行初始化后的回调；</p></li> <li><p>生成  README.md；</p></li> <li><p>暂存 git ，拉取远程 preset；</p></li> <li><p>打印创建结果；</p></li></ol> <p><code>Creator</code>  类是继承于 Node.js 的 <code>EventEmitter</code> 类,<code>events</code>  是 Node.js 中最重要的一个模块，而 <code>EventEmitter</code> 类就是其基础，是 Node.js 中事件触发与事件监听等功能的封装。</p> <p>在 <code>create</code>  过程中 <code>emit</code>  一些事件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'creating'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建项目时</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'git-init'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化 git 时</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'plugins-install'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安装插件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'invoking-generators'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 generator</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'deps-install'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安装额外的依赖</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'completion-hooks'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 完成之后的回调</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create 流程结束</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'creation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'fetch-remote-preset'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拉取远程 preset</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></blockquote> <p><code>Creator.create()</code> 方法主要执行项目的参数初始化、包管理初始化、npm 初始化、仓库初始化，通过Generator生成项目文件，并安装项目依赖；</p> <h3 id="generator-生成项目文件"><a href="#generator-生成项目文件" class="header-anchor">#</a> <strong>Generator 生成项目文件</strong></h3> <p>通过以上分析可知，<code>Creator.create()</code> 方法用于创建项目,Generator 对象创建生成项目文件：</p> <p><img src="/myblog/assets/img/vue-cli-文件生成对象定义.e5c08aae.png" alt="image-20240131200047619"></p> <p>Generator 对象通过 <code>Generator.generate</code> 方法生成  Vue 项目文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">//生成文件系统</span>
  <span class="token keyword">async</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
    extractConfigFiles <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    checkExisting <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//初始化插件</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initPlugins</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// save the file system before applying plugin for comparison</span>
    <span class="token keyword">const</span> initialFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">)</span>
    <span class="token comment">// extract configs from package.json into dedicated files.</span>
    <span class="token comment">//提取配置文件从 package.json 中，并将它们分解为单独的文件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extractConfigFiles</span><span class="token punctuation">(</span>extractConfigFiles<span class="token punctuation">,</span> checkExisting<span class="token punctuation">)</span>
    <span class="token comment">// wait for file resolve</span>
    <span class="token comment">//等待文件解析</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// set package.json</span>
    <span class="token comment">//排序 package.json 并将其添加到文件系统中</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sortPkg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'package.json'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
    <span class="token comment">// write/update file tree to disk</span>
    <span class="token comment">//将文件系统写入磁盘</span>
    <span class="token keyword">await</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">,</span> initialFiles<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p>generate 方法用于生成文件系统。它接受一个对象作为参数，可以设置两个选项：<code>extractConfigFiles</code> 和 <code>checkExisting</code>。</p> <p>函数的实现原理如下：</p> <ol><li>首先，初始化插件。</li> <li>从 <code>package.json</code> 中提取配置文件，并将它们分解为单独的文件。</li> <li>等待文件解析。</li> <li>排序 <code>package.json</code> 并将其添加到文件系统中。</li> <li>将文件系统写入磁盘。</li></ol> <p>注意事项：</p> <ul><li>确保在调用此函数之前已正确初始化上下文和文件系统。</li> <li>设置 <code>extractConfigFiles</code> 为 <code>true</code> 以从 <code>package.json</code> 中提取配置文件。</li> <li>设置 <code>checkExisting</code> 为 <code>true</code> 以在提取配置文件之前检查现有文件。</li> <li>此函数为异步函数，应在适当的事件循环或回调函数中使用。</li> <li>如果需要，可以在函数结束后检查错误并处理它们。</li></ul></blockquote> <h3 id="初始化插件"><a href="#初始化插件" class="header-anchor">#</a> <strong>初始化插件</strong></h3> <p><code>Generator.generate</code> 方法生成  Vue 项目文件第一步中，先执行的是一个 <code>initPlugins</code>  方法，代码如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token function">initPlugins</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> id <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>allPluginIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratorAPI</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rootOptions<span class="token punctuation">)</span>
    <span class="token keyword">const</span> pluginGenerator <span class="token operator">=</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/generator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>pluginGenerator <span class="token operator">&amp;&amp;</span> pluginGenerator<span class="token punctuation">.</span>hooks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> pluginGenerator<span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rootOptions<span class="token punctuation">,</span> pluginIds<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在这里会给每一个 <code>package.json</code>  里的插件初始化一个 <code>GeneratorAPI</code>  实例，将实例传入对应插件的 <code>generator</code>  方法并执行:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/generator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过以上代码执行时，会加载两类插件：</p> <ul><li><code>cli-service</code> 插件： Vue CLI 的核心插件；</li> <li><code>cli-plugin-xxx/</code>扩展插件：预选项插件，根据用户选择加载；</li></ul> <p><strong>加载<code>cli-service</code> 核心插件：</strong></p> <p>加载<code>cli-service</code> 核心插件，会执行 <code>@vue/cli-service/generator/index.js</code> 目录：</p> <p><img src="/myblog/assets/img/image-20240201103647431.e1be70d3.png" alt="image-20240201103647431"></p> <blockquote><p><code>cli-service</code> 核心插件的 generator 方法主要逻辑：</p> <ol><li><p>渲染 Vue 项目模板；</p> <ul><li><p>Vue 项目模板位于  <code>@vue/cli-service/tempalte/</code> 目录，可以看到该目录下文件即为一个使用 vue-cli 创建的 vue 基础项目目录文件；</p></li> <li><p><code>api.render</code> 会通过 EJS 将模板文件渲染成字符串放在内存中。</p></li></ul></li> <li><p>通过 <code>extendPackage</code> 往 <code>pacakge.json</code> 中写入 <code>Vue</code>   的相关依赖和 script；</p></li> <li><p>通过 <code>extendPackage</code> 往 <code>pacakge.json</code> 中写入 <code>CSS</code> 预处理参数;</p></li> <li><p>调用 router 插件和 vuex 插件。</p></li></ol> <p>执行了 <code>generate</code>  的所有逻辑之后，内存中已经有了需要输出的各种文件，放在 <code>this.files</code>  里。 <code>generate</code>  的最后一步就是调用 <code>writeFileTree</code>  将内存中的所有文件写入到硬盘</p></blockquote> <p><strong>加载<code>cli-plugin-xxx/</code>扩展插件：</strong></p> <p>加载<code>cli-plugin-xxx/</code>扩展插件，会去 <code>@vue/</code> 目录下加载对应 <code>cli-plugin-xxx/generator.js</code> 插件的  generator 方法。</p> <p>以加载 <code>@vue/cli-plugin-babel</code> 插件的  <code>@vue/cli-plugin-babel/generator.js</code> 为例：</p> <p>执行以上代码时候，会在当前项目的 <code>./node_modules/@vue/cli-plugin-babel/</code>  目录下加载 <code>generator.js</code> 文件：</p> <p><img src="/myblog/assets/img/vue-cli-babel-generator.e6aaa676.png" alt="image-20240201100829288"></p> <blockquote><p>这里 <code>api</code>  就是一个 <code>GeneratorAPI</code> 实例，这里用到了一个 <code>extendPackage</code>  方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// GeneratorAPI.js</span>
<span class="token comment">// 删减部分代码，只针对 @vue/cli-plugin-babel 分析</span>
<span class="token function">extendPackage</span> <span class="token punctuation">(</span><span class="token parameter">fields<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>generator<span class="token punctuation">.</span>pkg
  <span class="token keyword">const</span> toMerge <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">fields</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span> <span class="token operator">:</span> fields
  <span class="token comment">// 遍历传入的参数，这里是 babel 和 dependencies 两个对象</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> toMerge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> toMerge<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">const</span> existing <span class="token operator">=</span> pkg<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token comment">// 如果 key 的名称是 dependencies 和 devDependencies</span>
    <span class="token comment">// 就通过 mergeDeps 方法往 package.json 合并依赖</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'dependencies'</span> <span class="token operator">||</span> key <span class="token operator">===</span> <span class="token string">'devDependencies'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pkg<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mergeDeps</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        existing <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        value<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>generator<span class="token punctuation">.</span>depSources<span class="token punctuation">,</span>
        extendOptions
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>extendOptions<span class="token punctuation">.</span>merge <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> pkg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pkg<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></blockquote> <p>通过<code>extendPackage</code>  方法加载 <code>cli-plugin-babel</code> 后，默认的 <code>package.json</code>  就变成：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;babel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@vue/cli-plugin-babel/preset&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;core-js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.6.5&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="cli-服务分析"><a href="#cli-服务分析" class="header-anchor">#</a> <strong>CLI 服务分析</strong></h2> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> <strong>使用</strong></h3> <p>在一个 Vue CLI 项目中，<code>@vue/cli-service</code> 安装了一个名为 <code>vue-cli-service</code> 的命令。</p> <p>可以在 npm scripts 中以 <code>vue-cli-service</code>、或者从终端中以 <code>./node_modules/.bin/vue-cli-service</code> 访问这个命令。</p> <p>这是你使用默认 preset 的项目的 <code>package.json</code>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;serve&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;vue-cli-service serve&quot;</span>,
    <span class="token string">&quot;build&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;vue-cli-service build&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>你可以通过 npm 或 Yarn 调用这些 script：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> run serve
<span class="token comment"># OR</span>
<span class="token function">yarn</span> serve
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果你可以使用 <a href="https://github.com/npm/npx" target="_blank" rel="noopener noreferrer">npx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (最新版的 npm 应该已经自带)，也可以直接这样调用命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>npx vue-cli-service serve
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="shell-命令解析"><a href="#shell-命令解析" class="header-anchor">#</a> <strong>Shell 命令解析</strong></h3> <ol><li>在 shell 命令行中输入 <code>npm run serve</code> 时候，会执行 <code>vue-cli-service serve</code></li> <li>当遇到 <code>vue-cli-service</code> 命令时，会在 <code>./node_modules/.bin</code> 目录下根据 windows 或 mac 平台查找 shell 或 cmd 脚本执行，在 windows 平台下会执行 <code>./node_modules/.bin/vue-cli-service.cmd</code> :</li></ol> <p><img src="/myblog/assets/img/vue-cli-server源码分析.9f78f355.png" alt="image-20240129173804799"></p> <ol start="3"><li>该批处理脚本的主要作用是找到并设置Vue CLI服务的执行路径，然后使用Node.js来运行Vue CLI服务，Vue CLI服务的执行路径执行路径为 <code>..\@vue\cli-service\bin\vue-cli-service.js</code></li></ol> <p><code>vue-cli-service.js</code> 文件主要作用是<strong>检查运行环境、解析命令行参数，并运行 Vue CLI 服务</strong>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">// 设定脚本的解释器为 node，这样这个脚本就是一个 node 脚本，可以在命令行中运行。  </span>
#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node  
  
<span class="token comment">// 从 '@vue/cli-shared-utils' 模块中引入 'semver' 和 'error' 函数。'semver' 用于处理语义版本，'error' 用于输出错误信息。  </span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> semver<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-shared-utils'</span><span class="token punctuation">)</span>  
  
<span class="token comment">// 从 '../package.json' 文件中获取 'engines.node' 的值，这个值是运行这个脚本所需要的 Node.js 的版本。  </span>
<span class="token keyword">const</span> requiredVersion <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>engines<span class="token punctuation">.</span>node  
  
<span class="token comment">// 检查当前运行的 Node.js 版本是否满足 'requiredVersion'，如果不满足，则输出错误信息并退出进程。  </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>semver<span class="token punctuation">.</span><span class="token function">satisfies</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>version<span class="token punctuation">,</span> requiredVersion<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token function">error</span><span class="token punctuation">(</span>  
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You are using Node </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, but vue-cli-service </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>  
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">requires Node </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>requiredVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.\nPlease upgrade your Node version.</span><span class="token template-punctuation string">`</span></span>  
  <span class="token punctuation">)</span>  
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">// 从 '../lib/Service' 文件中引入 'Service' 类，并创建一个新的 'Service' 实例。  </span>
<span class="token keyword">const</span> Service <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/Service'</span><span class="token punctuation">)</span>  
<span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Service</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_CONTEXT</span> <span class="token operator">||</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
  
<span class="token comment">// 获取命令行参数（除了脚本名和路径参数），并存储到 'rawArgv' 中。  </span>
<span class="token keyword">const</span> rawArgv <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  
  
<span class="token comment">// 使用 'minimist' 库解析 'rawArgv' 中的参数。这里定义了一些布尔类型的参数。  </span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>rawArgv<span class="token punctuation">,</span> <span class="token punctuation">{</span>  
  <span class="token literal-property property">boolean</span><span class="token operator">:</span> <span class="token punctuation">[</span>  
    <span class="token comment">// build  </span>
    <span class="token string">'modern'</span><span class="token punctuation">,</span>  
    <span class="token string">'report'</span><span class="token punctuation">,</span>  
    <span class="token string">'report-json'</span><span class="token punctuation">,</span>  
    <span class="token string">'inline-vue'</span><span class="token punctuation">,</span>  
    <span class="token string">'watch'</span><span class="token punctuation">,</span>  
    <span class="token comment">// serve  </span>
    <span class="token string">'open'</span><span class="token punctuation">,</span>  
    <span class="token string">'copy'</span><span class="token punctuation">,</span>  
    <span class="token string">'https'</span><span class="token punctuation">,</span>  
    <span class="token comment">// inspect  </span>
    <span class="token string">'verbose'</span>  
  <span class="token punctuation">]</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>  
  
<span class="token comment">// 获取 'args._[0]'，即第一个命令行参数（不包括参数名），这个参数通常表示命令。  </span>
<span class="token keyword">const</span> command <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  
  
<span class="token comment">// 运行 'service' 的 'run' 方法，传入命令、参数和原始的命令行参数。如果运行过程中出现错误，则捕获并输出错误信息，然后退出进程。  </span>
service<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> rawArgv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
  <span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>  
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><blockquote><p>以上代码主要执行以下操作：</p> <ol><li><strong>检查运行环境</strong>：首先，脚本检查当前运行的 Node.js 版本是否满足所需的版本要求。如果不满足，它会输出错误信息并退出进程。</li> <li><strong>解析命令行参数</strong>：然后，脚本使用 'minimist' 库解析命令行参数。它定义了一些布尔类型的参数，并根据这些参数的值设置相应的数据结构。</li> <li><strong>运行 Vue CLI 服务</strong>：最后，脚本运行 'service' 的 'run' 方法，传入命令、参数和原始的命令行参数。如果运行过程中出现错误，它会捕获并输出错误信息，然后退出进程。</li></ol></blockquote> <p><code>vue-cli-service</code> 常用命令：</p> <ul><li><p><strong><code>vue-cli-service serve</code> 命令:</strong> 启动一个开发服务器 (基于 <a href="https://github.com/webpack/webpack-dev-server" target="_blank" rel="noopener noreferrer">webpack-dev-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) 并附带开箱即用的模块热重载 (Hot-Module-Replacement)。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>用法：vue-cli-service serve <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>entry<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong><code>vue-cli-service build</code> 命令:</strong>  会在 <code>dist/</code> 目录产生一个可用于生产环境的包，带有 JS/CSS/HTML 的压缩，和为更好的缓存而做的自动的 vendor chunk splitting。它的 chunk manifest 会内联在 HTML 里。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>用法：vue-cli-service build <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>entry<span class="token operator">|</span>pattern<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>通过以上代码可知，<code>vue-cli-service</code> 命令执行前，先创建了一个 Service 类，并通过 <code>service.run()</code> 方法执行执行命令。</p> <h3 id="service-对象初始化"><a href="#service-对象初始化" class="header-anchor">#</a> <strong>Service 对象初始化</strong></h3> <p>Service 对象定义位于 <code>./node_modules/@vue/cli-service/lib/Service.js</code> 中;</p> <p><code>Service</code>的类包含了Vue CLI中的服务对象。</p> <p>服务对象负责<strong>处理命令行选项、插件加载、Webpack配置和其他与项目构建相关的任务</strong>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token punctuation">{</span> plugins<span class="token punctuation">,</span> pkg<span class="token punctuation">,</span> inlineOptions<span class="token punctuation">,</span> useBuiltIn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token constant">VUE_CLI_SERVICE</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context
    <span class="token keyword">this</span><span class="token punctuation">.</span>inlineOptions <span class="token operator">=</span> inlineOptions
    <span class="token keyword">this</span><span class="token punctuation">.</span>webpackChainFns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webpackRawConfigFns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>devServerConfigFns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>commands <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// Folder containing the target package.json for plugins</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pkgContext <span class="token operator">=</span> context<span class="token comment">//context参数，它是一个包含项目路径和其他配置的环境对象</span>
    <span class="token comment">// package.json containing the plugins</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pkg <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolvePkg</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span><span class="token comment">//解析pkg参数，如果pkg是相对路径，它会相对于context目录来解析。</span>
    <span class="token comment">// If there are inline plugins, they will be used instead of those</span>
    <span class="token comment">// found in package.json.</span>
    <span class="token comment">// When useBuiltIn === false, built-in plugins are disabled. This is mostly</span>
    <span class="token comment">// for testing.</span>
    <span class="token comment">//根据plugins参数和useBuiltIn标志来加载插件。如果useBuiltIn为false，则禁用内置插件。</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolvePlugins</span><span class="token punctuation">(</span>plugins<span class="token punctuation">,</span> useBuiltIn<span class="token punctuation">)</span><span class="token comment">//</span>
    <span class="token comment">// pluginsToSkip will be populated during run()</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pluginsToSkip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//用于记录要跳过的插件的集合</span>
    <span class="token comment">// resolve the default mode to use for each command</span>
    <span class="token comment">// this is provided by plugins as module.exports.defaultModes</span>
    <span class="token comment">// so we can get the information without actually applying the plugin.</span>
    <span class="token comment">//默认模式对象，用于定义每个命令的默认模式。这个对象是通过插件的apply对象中的defaultModes来构建的。</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">modes<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token punctuation">{</span> defaultModes <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>modes<span class="token punctuation">,</span> defaultModes<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//解析pkg参数，如果pkg是相对路径，它会相对于context目录来解析</span>
 <span class="token comment">//如果inlinePkg存在，则直接返回。</span>
  <span class="token comment">//否则，使用resolvePkg方法来解析context目录下的包。</span>
  <span class="token comment">//如果解析后的包包含vuePlugins属性，则设置pkgContext属性为context与vuePlugins.resolveFrom的路径分辨率。</span>
  <span class="token comment">//递归调用resolvePkg方法，直到pkgContext被设置为止。</span>
  <span class="token function">resolvePkg</span> <span class="token punctuation">(</span><span class="token parameter">inlinePkg<span class="token punctuation">,</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> pkg
  <span class="token punctuation">}</span>
  <span class="token comment">//初始化</span>
  <span class="token function">init</span> <span class="token punctuation">(</span><span class="token parameter">mode <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_MODE</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//根据环境变量VUE_CLI_MODE来加载相应的配置文件</span>
  <span class="token function">loadEnv</span> <span class="token punctuation">(</span><span class="token parameter">mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//用于记录要跳过的插件的集合</span>
  <span class="token function">setPluginsToSkip</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//根据plugins参数和useBuiltIn标志来加载插件。如果useBuiltIn为false，则禁用内置插件。</span>
  <span class="token function">resolvePlugins</span> <span class="token punctuation">(</span><span class="token parameter">inlinePlugins<span class="token punctuation">,</span> useBuiltIn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> plugins
  <span class="token punctuation">}</span>

<span class="token comment">// async函数，用于运行name，args，rawArgv</span>
 <span class="token keyword">async</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rawArgv <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> rawArgv<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token comment">//加载用户提供的chainable配置文件。链入Webpack配置处理函数，以便在构建过程中使用。</span>
 <span class="token function">resolveChainableWebpackConfig</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token comment">// ...</span>
    <span class="token keyword">return</span> chainableConfig
  <span class="token punctuation">}</span>

  	<span class="token comment">//链入Webpack配置处理函数，以便在构建过程中使用。</span>
  	<span class="token comment">//解析用户提供的chainable配置文件。</span>
    <span class="token comment">//执行配置文件处理函数，以便在构建过程中使用。</span>
    <span class="token comment">//检查配置项entry的类型，并将其转换为数组。</span>
    <span class="token comment">//将entry文件解析为具体的路径，并设置环境变量VUE_CLI_ENTRY_FILES。</span>
  <span class="token function">resolveWebpackConfig</span> <span class="token punctuation">(</span><span class="token parameter">chainableConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveChainableWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span>
  <span class="token comment">//加载用户提供的选项，并使用默认值来填充缺失的选项。</span>
  <span class="token function">loadUserOptions</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> resolved
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><blockquote><p>以上代码为 <code>Service</code> 类的定义，在该类中定义了<code>Service</code> 类的属性和方法：</p> <ol><li>初始化<code>Service</code>类时：
<ul><li>会设置一些基本的状态：如<code>initialized</code>、<code>context</code>、<code>inlineOptions</code>、<code>webpackChainFns</code>、<code>webpackRawConfigFns</code>、<code>devServerConfigFns</code>、<code>commands</code>和<code>pkgContext</code>。</li></ul></li> <li>构造函数： 会接收一个<code>context</code>参数，它是一个包含项目路径和其他配置的环境对象。</li> <li><code>resolvePkg</code>方法：用于解析<code>pkg</code>参数，如果<code>pkg</code>是相对路径，它会相对于<code>context</code>目录来解析。</li> <li><code>resolvePlugins</code>方法：会根据<code>plugins</code>参数和<code>useBuiltIn</code>标志来加载插件。如果<code>useBuiltIn</code>为<code>false</code>，则禁用内置插件。</li> <li><code>pluginsToSkip</code>：是一个用于记录要跳过的插件的集合。</li> <li><code>modes</code>：是一个默认模式对象，用于定义每个命令的默认模式。这个对象是通过插件的<code>apply</code>对象中的<code>defaultModes</code>来构建的。</li> <li><code>init</code> 方法：
<ul><li>初始化<code>Service</code>类，设置一些基本的状态。</li> <li>根据环境变量<code>VUE_CLI_MODE</code>来加载相应的配置文件（<code>vue-cli-service serve [options] [entry]</code> 命令通过 <code>--mode</code> 参数指定环境模式 ，默认值为 development，该参数会加载当前目录下指定环境的下配置文件）。</li> <li>加载用户提供的选项，并使用默认值来填充缺失的选项。</li> <li>遍历插件列表，并执行它们的方法。</li> <li>链入Webpack配置处理函数，以便在构建过程中使用。</li> <li>创建一个新的Webpack配置处理函数，以便在构建过程中使用。</li></ul></li> <li><code>run</code>方法：用于启动项目构建过程，它会遍历插件列表，并执行它们的方法。</li></ol> <p>这些方法、属性和状态的定义允许服务对象在项目构建过程中执行各种任务，如加载插件、配置Webpack和处理开发服务器配置等。</p></blockquote> <p>通过以上 Service 对象定义可知：</p> <ol><li>在 shell 执行命令时候，首先解析参数，并将参数传递给 Service 类: <code>new Service(process.env.VUE_CLI_CONTEXT || process.cwd())</code>;</li> <li>Service 类初始化时，调用 <code>resolvePkg(pkg)</code> 解析解析参数指定目录下的包；</li> <li>初始化完成后调用 <code>run</code>方法，用于启动项目构建过程，它会遍历插件列表，并执行它们的方法。</li></ol> <h3 id="service-run-启动构建"><a href="#service-run-启动构建" class="header-anchor">#</a> <strong><code>Service.run</code> 启动构建</strong></h3> <p><code>Service.run</code> 方法详细代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// async函数，用于运行name，args，rawArgv</span>
 <span class="token keyword">async</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rawArgv <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// resolve mode</span>
    <span class="token comment">// prioritize inline --mode</span>
    <span class="token comment">// fallback to resolved default modes from plugins or development if --watch is defined</span>
    <span class="token comment">//解析`args.mode`和`args.watch`参数，确定当前模式</span>
    <span class="token keyword">const</span> mode <span class="token operator">=</span> args<span class="token punctuation">.</span>mode <span class="token operator">||</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'build'</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>watch <span class="token operator">?</span> <span class="token string">'development'</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modes<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// --skip-plugins arg may have plugins that should be skipped during init()</span>
    <span class="token comment">// set plugins to skip</span>
    <span class="token comment">//设置要跳过的插件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setPluginsToSkip</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment">// load env variables, load user config, apply plugins</span>
    <span class="token comment">// 加载环境变量，加载用户配置，应用插件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span>

    <span class="token comment">// resolve args</span>
    <span class="token comment">// 解析参数</span>
    args<span class="token punctuation">.</span>_ <span class="token operator">=</span> args<span class="token punctuation">.</span>_ <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> command <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>command <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">command &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; does not exist.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>command <span class="token operator">||</span> args<span class="token punctuation">.</span>help <span class="token operator">||</span> args<span class="token punctuation">.</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      command <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">.</span>help
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      args<span class="token punctuation">.</span>_<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// remove command itself</span>
      rawArgv<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span> <span class="token operator">=</span> command
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> rawArgv<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><blockquote><p>该方法执行以下操作：</p> <ul><li>解析<code>args.mode</code>和<code>args.watch</code>参数，确定当前模式。</li> <li>设置要跳过的插件。</li> <li>加载环境变量和用户配置。</li> <li>应用插件。</li> <li>解析参数。</li> <li>调用<code>command</code>方法，并返回结果。</li></ul></blockquote> <p>根据以上 &quot;Shell 命令解析&quot; 部分代码中，<code>vue-cli-service.js</code> 文件中调用了 <code>service.run</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>service<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> rawArgv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
  <span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>  
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>而<code>vue-cli-service</code> 命令用法为：（以 serve参数为例） <code>vue-cli-service serve [options] [entry]</code>，则 <code>service.run</code> 方法的 command 参数为该命令的 <code>serve</code> 方法；</p> <p>在  <code>service.run</code> 方法中最后执行 :</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span> <span class="token operator">=</span> command
<span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> rawArgv<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>说明在 <code>vue-cli-service serve [options] [entry]</code> 命令中最后执行 <code>serve</code> 方法并传入 <code>[options] [entry]</code> 参数。</p> <h3 id="解析插件"><a href="#解析插件" class="header-anchor">#</a> <strong>解析插件</strong></h3> <p>以 <code>serve</code> 方法为例，<code>vue-cli-service</code> 构建命令为： <code>vue-cli-service serve[options] [entry|pattern]</code></p> <p>通过以上代码分析可知，命令行参数方法 serve 通过 <code>command</code> 参数执行， <code>command</code> 参数在 Service 构造函数中定义，并通过 <code>Service.resolvePlugins</code> 方法初始化，该方法定义如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">// 解析插件</span>
  <span class="token function">resolvePlugins</span> <span class="token punctuation">(</span><span class="token parameter">inlinePlugins<span class="token punctuation">,</span> useBuiltIn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据id获取插件</span>
    <span class="token keyword">const</span> <span class="token function-variable function">idToPlugin</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> id<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">'built-in:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> plugins

    <span class="token comment">// 内置插件</span>
    <span class="token keyword">const</span> builtInPlugins <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token string">'./commands/serve'</span><span class="token punctuation">,</span>
      <span class="token string">'./commands/build'</span><span class="token punctuation">,</span>
      <span class="token string">'./commands/inspect'</span><span class="token punctuation">,</span>
      <span class="token string">'./commands/help'</span><span class="token punctuation">,</span>
      <span class="token comment">// config plugins are order sensitive</span>
      <span class="token string">'./config/base'</span><span class="token punctuation">,</span>
      <span class="token string">'./config/css'</span><span class="token punctuation">,</span>
      <span class="token string">'./config/prod'</span><span class="token punctuation">,</span>
      <span class="token string">'./config/app'</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>idToPlugin<span class="token punctuation">)</span>

    <span class="token comment">// 判断是否使用内置插件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inlinePlugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 判断是否使用内置插件</span>
      plugins <span class="token operator">=</span> useBuiltIn <span class="token operator">!==</span> <span class="token boolean">false</span>
        <span class="token operator">?</span> builtInPlugins<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>inlinePlugins<span class="token punctuation">)</span>
        <span class="token operator">:</span> inlinePlugins
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取项目插件</span>
      <span class="token keyword">const</span> projectPlugins <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>devDependencies <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>dependencies <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isPlugin<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 判断是否可选依赖</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>optionalDependencies <span class="token operator">&amp;&amp;</span>
            id <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>optionalDependencies
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token comment">// 尝试加载插件</span>
              apply <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 加载失败，输出警告</span>
              <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Optional dependency </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not installed.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> apply <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 根据id获取插件</span>
            <span class="token keyword">return</span> <span class="token function">idToPlugin</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 合并内置插件和项目插件</span>
      plugins <span class="token operator">=</span> builtInPlugins<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>projectPlugins<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Local plugins</span>
    <span class="token comment">// 判断是否有本地插件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>vuePlugins <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>vuePlugins<span class="token punctuation">.</span>service<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取文件</span>
      <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>vuePlugins<span class="token punctuation">.</span>service
      <span class="token comment">// 判断文件类型是否为数组</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不是数组，抛出错误</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Invalid type for option 'vuePlugins.service', expected 'array' but got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">typeof</span> files<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 合并插件</span>
      plugins <span class="token operator">=</span> plugins<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">local:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pkgContext<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> plugins
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><blockquote><p>该方法主要解析插件：</p> <ol><li>根据id获取插件;</li> <li>判断是否使用内置插件，获取项目插件</li> <li>合并内置插件和项目插件；</li> <li>判断是否有本地插件，合并插件</li> <li>返回合并后的插件。</li></ol></blockquote> <p>根据以上<code>resolvePlugins</code> 方法可知，  <code>serve</code> 方法 插件定义在<code>./commands/serve</code>，所有内置插件定义如下：</p> <p><img src="/myblog/assets/img/vue-cli-service内置插件.8c34bac3.png" alt="image-20240129200352382"></p> <blockquote><p>自定义开发插件可以参考官方文档： <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#service-%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">插件开发指南 | Vue CLI (vuejs.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="serve-命令解析"><a href="#serve-命令解析" class="header-anchor">#</a> <strong>serve 命令解析</strong></h3> <p><code>vue-cli-service serve</code> 命令用于开发环境，在本地启动一个 HTTP 服务：</p> <h4 id="使用-2"><a href="#使用-2" class="header-anchor">#</a> <strong>使用</strong></h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>用法：vue-cli-service serve <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>entry<span class="token punctuation">]</span>

选项：

  <span class="token parameter variable">--open</span>    在服务器启动时打开浏览器
  <span class="token parameter variable">--copy</span>    在服务器启动时将 URL 复制到剪切版
  <span class="token parameter variable">--mode</span>    指定环境模式 <span class="token punctuation">(</span>默认值：development<span class="token punctuation">)</span>
  <span class="token parameter variable">--host</span>    指定 <span class="token function">host</span> <span class="token punctuation">(</span>默认值：0.0.0.0<span class="token punctuation">)</span>
  <span class="token parameter variable">--port</span>    指定 port <span class="token punctuation">(</span>默认值：8080<span class="token punctuation">)</span>
  <span class="token parameter variable">--https</span>   使用 https <span class="token punctuation">(</span>默认值：false<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>通过 npm script 执行该命令：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="原理"><a href="#原理" class="header-anchor">#</a> <strong>原理</strong></h4> <p><code>vue-cli-service serve</code> 命令会启动一个开发服务器 (基于 <a href="https://github.com/webpack/webpack-dev-server" target="_blank" rel="noopener noreferrer">webpack-dev-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) 并附带开箱即用的模块热重载 (Hot-Module-Replacement)。</p> <h4 id="源码分析"><a href="#源码分析" class="header-anchor">#</a> <strong>源码分析</strong></h4> <p>在通过以上“解析插件” 步骤时，执行<code>vue-cli-service serve</code>命令时，最终是通过调用 <code>serve</code> 插件方法，serve 命令脚本在 <code>cli-service/lib/commands/serve.js</code> 中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//调用 registerCommand 注册一个 serve 命令</span>
  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'serve'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'start development server'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usage</span><span class="token operator">:</span> <span class="token string">'vue-cli-service serve [options] [entry]'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'--open'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">open browser on server start</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--copy'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">copy url to clipboard on server start</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--stdin'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">close when stdin ends</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--mode'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">specify env mode (default: development)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--host'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">specify host (default: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>defaults<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--port'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">specify port (default: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>defaults<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--https'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">use https (default: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>defaults<span class="token punctuation">.</span>https<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--public'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">specify the public network URL for the HMR client</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'--skip-plugins'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">comma-separated list of plugin names to skip for this run</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">serve</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Starting development server...'</span><span class="token punctuation">)</span>
 	<span class="token comment">// 启动一个开发服务器，以下代码省略...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>在 <code>serve.js</code> 中主要调用了 <code>api.registerCommand</code> 进行注册命令，并传入三个参数:</p> <ul><li>第一个参数：serve 命令名称；</li> <li>第二个参数：命令选项；</li> <li>第三个参数：命令回调函数，在该回调函数中使用 webpack 启动一个本地开发服务;</li></ul> <p><code>api.registerCommand</code>  方式实际上在 <code>cli-service/lib/PluginAPI.js</code> 中定义：主要作用是在 Service 类中注册一个命令</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token function">registerCommand</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> opts <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fn <span class="token operator">=</span> opts
      opts <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>commands<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> fn<span class="token punctuation">,</span> <span class="token literal-property property">opts</span><span class="token operator">:</span> opts <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></blockquote> <p>该命令的主要执行逻辑为<code>api.registerCommand</code> 的第三个参数回调方法，下面分析该回调 <code>serve</code> 方法 :</p> <h4 id="serve-回调"><a href="#serve-回调" class="header-anchor">#</a> <strong><code>serve</code> 回调</strong></h4> <p>serve 回调中主要<strong>使用 webpack 启动一个启动一个本地开发服务</strong>,内部主要逻辑：</p> <ol><li><strong>配置初始化</strong>： webpack 和 webpack 开发服务配置项初始化；</li> <li>创建 webpack 实例 和 开发服务实例；</li> <li>返回 HTTP 服务实例，并启动本地 HTTP 服务;</li></ol> <p>代码简化逻辑为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">serve</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Starting development server...'</span><span class="token punctuation">)</span>
  
    <span class="token comment">// although this is primarily a dev server, it is possible that we</span>
    <span class="token comment">// are running it in a mode with a production env, e.g. in E2E tests.</span>
    <span class="token keyword">const</span> isInContainer <span class="token operator">=</span> <span class="token function">checkInContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>

    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> chalk <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-shared-utils'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> WebpackDevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> portfinder <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'portfinder'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> prepareURLs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/prepareURLs'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> prepareProxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/prepareProxy'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> launchEditorMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'launch-editor-middleware'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> validateWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/validateWebpackConfig'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> isAbsoluteUrl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/isAbsoluteUrl'</span><span class="token punctuation">)</span>
   <span class="token comment">// ==================webpack 和 webpack 开发服务配置项 初始化====================</span>
    <span class="token comment">// 往 service.webpackChainFns 队列中添加回调...</span>
    <span class="token comment">// 1.设置开发环境下 webpack 开发工具...</span>
    <span class="token comment">// 2.解析 webpack 配置</span>
    <span class="token comment">// 3.检查常见的 webpack 配置错误</span>
    <span class="token comment">// 4.暴露高级统计信息...</span>
    <span class="token comment">//5.解析 webpack 入口参数...</span>
    <span class="token comment">// 6.解析服务器选项...</span>
    <span class="token comment">// 7.非生产环境下，注入开发和热重载中间件...</span>
  
    <span class="token comment">//========== webpack 配置项初始化完成 ====================</span>
    <span class="token comment">//========== 创建 webpack 实例 和 开发服务实例============</span>
    <span class="token comment">// create compiler</span>
    <span class="token comment">// 核心：创建 webpack 实例，返回一个编译器对象</span>
    <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span>

    <span class="token comment">// create server</span>
    <span class="token comment">// 核心：创建一个 webpack 开发服务, 传入一个编译器实例 和 参数选项</span>
    <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackDevServer</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
     <span class="token comment">//配置项省略...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 返回一个 HTTP 服务实例</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// log instructions &amp; open browser on first compilation complete</span>
      <span class="token keyword">let</span> isFirstCompile <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// 监听 webpack 插件 done 事件</span>
      compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue-cli-service serve'</span><span class="token punctuation">,</span> <span class="token parameter">stats</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  	  <span class="token comment">// 配置操作....</span>
      <span class="token comment">// 启动服务，并监听</span>
      server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>完整代码和注释为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">serve</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Starting development server...'</span><span class="token punctuation">)</span>
    <span class="token comment">// ==================webpack 和 webpack 开发服务配置项 初始化====================</span>
    <span class="token comment">// although this is primarily a dev server, it is possible that we</span>
    <span class="token comment">// are running it in a mode with a production env, e.g. in E2E tests.</span>
    <span class="token keyword">const</span> isInContainer <span class="token operator">=</span> <span class="token function">checkInContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>

    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> chalk <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-shared-utils'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> WebpackDevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> portfinder <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'portfinder'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> prepareURLs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/prepareURLs'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> prepareProxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/prepareProxy'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> launchEditorMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'launch-editor-middleware'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> validateWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/validateWebpackConfig'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> isAbsoluteUrl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../util/isAbsoluteUrl'</span><span class="token punctuation">)</span>

    <span class="token comment">// configs that only matters for dev server</span>
    <span class="token comment">// 往 service.webpackChainFns 队列中添加回调</span>
    api<span class="token punctuation">.</span><span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 设置开发环境下 webpack 开发工具</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        webpackConfig
          <span class="token punctuation">.</span><span class="token function">devtool</span><span class="token punctuation">(</span><span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">)</span>

        <span class="token comment">// 添加 webpack 热更新插件</span>
        webpackConfig
          <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'hmr'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/HotModuleReplacementPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">// https://github.com/webpack/webpack/issues/6642</span>
        <span class="token comment">// https://github.com/vuejs/vue-cli/issues/3539</span>
        <span class="token comment">// https://v3.vuejs.org/api/global-api.html#definecomponnet</span>
        <span class="token comment">// 设置 webpack 全局对象 一些插件需要它来正确工作</span>
        webpackConfig
          <span class="token punctuation">.</span>output
            <span class="token punctuation">.</span><span class="token function">globalObject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(typeof self !== 'undefined' ? self : this)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

        <span class="token comment">// 添加 webpack 进度条</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span> <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>devServer<span class="token punctuation">.</span>progress <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          webpackConfig
            <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/ProgressPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// resolve webpack config 解析 webpack 配置</span>
    <span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// check for common config errors</span>
    <span class="token comment">// 检查常见的 webpack 配置错误</span>
    <span class="token function">validateWebpackConfig</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> api<span class="token punctuation">,</span> options<span class="token punctuation">)</span>

    <span class="token comment">// load user devServer options with higher priority than devServer</span>
    <span class="token comment">// in webpack config</span>
    <span class="token comment">// 加载用户 devServer 选项，具有比 webpack 配置中的 devServer 更高的优先级</span>
    <span class="token keyword">const</span> projectDevServerOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>
      webpackConfig<span class="token punctuation">.</span>devServer <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      options<span class="token punctuation">.</span>devServer
    <span class="token punctuation">)</span>

    <span class="token comment">// expose advanced stats</span>
    <span class="token comment">// 暴露高级统计信息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>dashboard<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// https://github.com/FormidableLabs/webpack-dashboard</span>
      <span class="token keyword">const</span> DashboardPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../webpack/DashboardPlugin'</span><span class="token punctuation">)</span>
      <span class="token punctuation">;</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">.</span>plugins <span class="token operator">=</span> webpackConfig<span class="token punctuation">.</span>plugins <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DashboardPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'serve'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// entry arg</span>
    <span class="token comment">//解析 webpack 入口参数</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      webpackConfig<span class="token punctuation">.</span>entry <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">app</span><span class="token operator">:</span> api<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// resolve server options</span>
    <span class="token comment">// 解析服务器选项</span>
    <span class="token keyword">const</span> useHttps <span class="token operator">=</span> args<span class="token punctuation">.</span>https <span class="token operator">||</span> projectDevServerOptions<span class="token punctuation">.</span>https <span class="token operator">||</span> defaults<span class="token punctuation">.</span>https   
    <span class="token keyword">const</span> protocol <span class="token operator">=</span> useHttps <span class="token operator">?</span> <span class="token string">'https'</span> <span class="token operator">:</span> <span class="token string">'http'</span>
    <span class="token keyword">const</span> host <span class="token operator">=</span> args<span class="token punctuation">.</span>host <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">HOST</span> <span class="token operator">||</span> projectDevServerOptions<span class="token punctuation">.</span>host <span class="token operator">||</span> defaults<span class="token punctuation">.</span>host
    portfinder<span class="token punctuation">.</span>basePort <span class="token operator">=</span> args<span class="token punctuation">.</span>port <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> projectDevServerOptions<span class="token punctuation">.</span>port <span class="token operator">||</span> defaults<span class="token punctuation">.</span>port
    <span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token keyword">await</span> portfinder<span class="token punctuation">.</span><span class="token function">getPortPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> rawPublicUrl <span class="token operator">=</span> args<span class="token punctuation">.</span>public <span class="token operator">||</span> projectDevServerOptions<span class="token punctuation">.</span>public
    <span class="token keyword">const</span> publicUrl <span class="token operator">=</span> rawPublicUrl
      <span class="token operator">?</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z]+:\/\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>rawPublicUrl<span class="token punctuation">)</span>
        <span class="token operator">?</span> rawPublicUrl
        <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rawPublicUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">:</span> <span class="token keyword">null</span>

    <span class="token keyword">const</span> urls <span class="token operator">=</span> <span class="token function">prepareURLs</span><span class="token punctuation">(</span>
      protocol<span class="token punctuation">,</span>
      host<span class="token punctuation">,</span>
      port<span class="token punctuation">,</span>
      <span class="token function">isAbsoluteUrl</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>publicPath<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'/'</span> <span class="token operator">:</span> options<span class="token punctuation">.</span>publicPath
    <span class="token punctuation">)</span>
    <span class="token keyword">const</span> localUrlForBrowser <span class="token operator">=</span> publicUrl <span class="token operator">||</span> urls<span class="token punctuation">.</span>localUrlForBrowser
    <span class="token comment">// proxy config</span>
    <span class="token keyword">const</span> proxySettings <span class="token operator">=</span> <span class="token function">prepareProxy</span><span class="token punctuation">(</span>
      projectDevServerOptions<span class="token punctuation">.</span>proxy<span class="token punctuation">,</span>
      api<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// inject dev &amp; hot-reload middleware entries</span>
    <span class="token comment">// 非生产环境下，注入开发和热重载中间件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProduction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// socket 连接路径</span>
      <span class="token keyword">const</span> sockPath <span class="token operator">=</span> projectDevServerOptions<span class="token punctuation">.</span>sockPath <span class="token operator">||</span> <span class="token string">'/sockjs-node'</span>
      <span class="token keyword">const</span> sockjsUrl <span class="token operator">=</span> publicUrl
        <span class="token comment">// explicitly configured via devServer.public</span>
        <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>publicUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;sockPath=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token operator">:</span> isInContainer
          <span class="token comment">// can't infer public network url if inside a container...</span>
          <span class="token comment">// use client-side inference (note this would break with non-root publicPath)</span>
          <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
          <span class="token comment">// otherwise infer the url</span>
          <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> url<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            protocol<span class="token punctuation">,</span>
            port<span class="token punctuation">,</span>
            <span class="token literal-property property">hostname</span><span class="token operator">:</span> urls<span class="token punctuation">.</span>lanUrlForConfig <span class="token operator">||</span> <span class="token string">'localhost'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&amp;sockPath=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> devClients <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token comment">// dev server client</span>
        require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack-dev-server/client</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> sockjsUrl<span class="token punctuation">,</span>
        <span class="token comment">// hmr client</span>
        require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>projectDevServerOptions<span class="token punctuation">.</span>hotOnly
          <span class="token operator">?</span> <span class="token string">'webpack/hot/only-dev-server'</span>
          <span class="token operator">:</span> <span class="token string">'webpack/hot/dev-server'</span><span class="token punctuation">)</span>
        <span class="token comment">// TODO custom overlay client</span>
        <span class="token comment">// `@vue/cli-overlay/dist/client`</span>
      <span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APPVEYOR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        devClients<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack/hot/poll?500</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// inject dev/hot client</span>
      <span class="token comment">// 添加开发和热重载客户端到 entry</span>
      <span class="token function">addDevClientToEntry</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> devClients<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//========== webpack 配置项初始化完成 ====================</span>
    <span class="token comment">//========== 创建 webpack 实例 和 开发服务实例============</span>
    <span class="token comment">// create compiler</span>
    <span class="token comment">// 核心：创建 webpack 实例，返回一个编译器对象</span>
    <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span>

    <span class="token comment">// handle compiler error</span>
    <span class="token comment">// webpack 处理编译错误，监听错误，发生错误时退出程序</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>failed<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue-cli-service serve'</span><span class="token punctuation">,</span> <span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// create server</span>
    <span class="token comment">// 核心：创建一个 webpack 开发服务, 传入一个编译器实例 和 参数选项</span>
   <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackDevServer</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 关闭 webpack 的日志</span>
      <span class="token literal-property property">logLevel</span><span class="token operator">:</span> <span class="token string">'silent'</span><span class="token punctuation">,</span>
      <span class="token comment">// 关闭 webpack-dev-server 的日志</span>
      <span class="token literal-property property">clientLogLevel</span><span class="token operator">:</span> <span class="token string">'silent'</span><span class="token punctuation">,</span>
      <span class="token comment">// 支持页面跳转</span>
      <span class="token literal-property property">historyApiFallback</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 禁用点式规则</span>
        <span class="token literal-property property">disableDotRule</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 生成历史api回退重写</span>
        <span class="token literal-property property">rewrites</span><span class="token operator">:</span> <span class="token function">genHistoryApiFallbackRewrites</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span> options<span class="token punctuation">.</span>pages<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 指定内容基础</span>
      <span class="token literal-property property">contentBase</span><span class="token operator">:</span> api<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 非生产环境时，监听内容基础</span>
      <span class="token literal-property property">watchContentBase</span><span class="token operator">:</span> <span class="token operator">!</span>isProduction<span class="token punctuation">,</span>
      <span class="token comment">// 非生产环境时，启用热更新</span>
      <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token operator">!</span>isProduction<span class="token punctuation">,</span>
      <span class="token comment">// 禁用注入客户端</span>
      <span class="token literal-property property">injectClient</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// 压缩</span>
      <span class="token literal-property property">compress</span><span class="token operator">:</span> isProduction<span class="token punctuation">,</span>
      <span class="token comment">// 指定publicPath</span>
      <span class="token literal-property property">publicPath</span><span class="token operator">:</span> options<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span>
      <span class="token comment">// 非生产环境时，启用覆盖</span>
      <span class="token literal-property property">overlay</span><span class="token operator">:</span> isProduction <span class="token comment">// TODO disable this</span>
        <span class="token operator">?</span> <span class="token boolean">false</span>
        <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> projectDevServerOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// 使用https</span>
      <span class="token literal-property property">https</span><span class="token operator">:</span> useHttps<span class="token punctuation">,</span>
      <span class="token comment">// 代理设置</span>
      <span class="token literal-property property">proxy</span><span class="token operator">:</span> proxySettings<span class="token punctuation">,</span>
      <span class="token comment">// 注册中间件</span>
      <span class="token comment">// eslint-disable-next-line no-shadow</span>
      <span class="token function">before</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// launch editor support.</span>
        <span class="token comment">// this works with vue-devtools &amp; @vue/cli-overlay</span>
        <span class="token comment">// 启动编辑器支持</span>
        <span class="token comment">// 此功能与vue-devtools和@vue/cli-overlay一起工作</span>
        app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/__open-in-editor'</span><span class="token punctuation">,</span> <span class="token function">launchEditorMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">To specify an editor, specify the EDITOR env variable or </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">add &quot;editor&quot; field to your Vue project config.\n</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// allow other plugins to register middlewares, e.g. PWA</span>
        <span class="token comment">// 允许其他插件注册中间件，例如PWA</span>
        api<span class="token punctuation">.</span>service<span class="token punctuation">.</span>devServerConfigFns<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// apply in project middlewares</span>
        <span class="token comment">// 应用项目中间件</span>
        projectDevServerOptions<span class="token punctuation">.</span>before <span class="token operator">&amp;&amp;</span> projectDevServerOptions<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> server<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// avoid opening browser</span>
      <span class="token comment">// 避免打开浏览器</span>
      <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

   <span class="token comment">// 注册 node 信号</span>
   <span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">'SIGINT'</span><span class="token punctuation">,</span> <span class="token string">'SIGTERM'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">signal</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当收到SIGINT或SIGTERM信号时，关闭服务器</span>
      process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>signal<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 退出进程</span>
          process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

   <span class="token comment">// 判断args.stdin是否存在</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>stdin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当标准输入流结束时</span>
      process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 关闭服务器</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 退出进程</span>
          process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 恢复标准输入流</span>
      process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

   <span class="token comment">// on appveyor, killing the process with SIGTERM causes execa to</span>
    <span class="token comment">// throw error</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'close'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'got close signal!'</span><span class="token punctuation">)</span>
          server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// log instructions &amp; open browser on first compilation complete</span>
      <span class="token keyword">let</span> isFirstCompile <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// 监听 webpack 插件 done 事件</span>
      compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'vue-cli-service serve'</span><span class="token punctuation">,</span> <span class="token parameter">stats</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> copied <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment">// 首次编译将服务地址添加到粘贴板</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isFirstCompile <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>copy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clipboardy'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeSync</span><span class="token punctuation">(</span>localUrlForBrowser<span class="token punctuation">)</span>
            copied <span class="token operator">=</span> chalk<span class="token punctuation">.</span><span class="token function">dim</span><span class="token punctuation">(</span><span class="token string">'(copied to clipboard)'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* catch exception if copy to clipboard isn't supported (e.g. WSL), see issue #3476 */</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> networkUrl <span class="token operator">=</span> publicUrl
          <span class="token operator">?</span> publicUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^/])$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">'$1/'</span><span class="token punctuation">)</span>
          <span class="token operator">:</span> urls<span class="token punctuation">.</span>lanUrlForTerminal

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  App running at:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  - Local:   </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span>localUrlForTerminal<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>copied<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInContainer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  - Network: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>networkUrl<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  It seems you are running Vue CLI inside a container.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>publicUrl <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>publicPath <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>publicPath <span class="token operator">!==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  Since you are using a non-root publicPath, the hot-reload socket</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  will not be able to infer the correct URL to connect. You should</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  explicitly specify the URL via </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">blue</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">devServer.public</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  Access the dev server via </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://localhost:&lt;your container's external mapped port&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>publicPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>isFirstCompile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          isFirstCompile <span class="token operator">=</span> <span class="token boolean">false</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProduction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> buildCommand <span class="token operator">=</span> <span class="token function">hasProjectYarn</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">getCwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">yarn build</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token function">hasProjectPnpm</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">getCwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pnpm run build</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm run build</span><span class="token template-punctuation string">`</span></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  Note that the development build is not optimized.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  To create a production build, run </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>buildCommand<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  App is served in production mode.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  Note this is for preview or E2E testing only.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// 打开浏览器</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>open <span class="token operator">||</span> projectDevServerOptions<span class="token punctuation">.</span>open<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> pageUri <span class="token operator">=</span> <span class="token punctuation">(</span>projectDevServerOptions<span class="token punctuation">.</span>openPage <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> projectDevServerOptions<span class="token punctuation">.</span>openPage <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span>
              <span class="token operator">?</span> projectDevServerOptions<span class="token punctuation">.</span>openPage
              <span class="token operator">:</span> <span class="token string">''</span>
            <span class="token function">openBrowser</span><span class="token punctuation">(</span>localUrlForBrowser <span class="token operator">+</span> pageUri<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// Send final app URL</span>
          <span class="token comment">// 发送 url 到粘贴板</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>dashboard<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> ipc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IpcMessenger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            ipc<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">vueServe</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> localUrlForBrowser
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// resolve returned Promise</span>
          <span class="token comment">// so other commands can do api.service.run('serve').then(...)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            server<span class="token punctuation">,</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> localUrlForBrowser
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// signal for test to check HMR</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App updated'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 启动服务，并监听</span>
      server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br></div></div><h3 id="build-命令解析"><a href="#build-命令解析" class="header-anchor">#</a> <strong><code>build</code> 命令解析</strong></h3> <p><code>vue-cli-service build</code> 命令用于生产环境，使用 webpack 对项目进行构建：</p> <h4 id="使用-3"><a href="#使用-3" class="header-anchor">#</a> <strong>使用</strong></h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>用法：vue-cli-service build <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>entry<span class="token operator">|</span>pattern<span class="token punctuation">]</span>

选项：

  <span class="token parameter variable">--mode</span>        指定环境模式 <span class="token punctuation">(</span>默认值：production<span class="token punctuation">)</span>
  <span class="token parameter variable">--dest</span>        指定输出目录 <span class="token punctuation">(</span>默认值：dist<span class="token punctuation">)</span>
  <span class="token parameter variable">--modern</span>      面向现代浏览器带自动回退地构建应用
  <span class="token parameter variable">--target</span>      app <span class="token operator">|</span> lib <span class="token operator">|</span> <span class="token function">wc</span> <span class="token operator">|</span> wc-async <span class="token punctuation">(</span>默认值：app<span class="token punctuation">)</span>
  <span class="token parameter variable">--name</span>        库或 Web Components 模式下的名字 <span class="token punctuation">(</span>默认值：package.json 中的 <span class="token string">&quot;name&quot;</span> 字段或入口文件名<span class="token punctuation">)</span>
  --no-clean    在构建项目之前不清除目标目录的内容
  <span class="token parameter variable">--report</span>      生成 report.html 以帮助分析包内容
  --report-json 生成 report.json 以帮助分析包内容
  <span class="token parameter variable">--watch</span>       监听文件变化
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>vue-cli-service build</code> 会在 <code>dist/</code> 目录产生一个可用于生产环境的包，带有 JS/CSS/HTML 的压缩，和为更好的缓存而做的自动的 vendor chunk splitting。它的 chunk manifest 会内联在 HTML 里。</p> <p>这里还有一些有用的命令参数：</p> <ul><li><code>--modern</code> 使用<a href="https://cli.vuejs.org/zh/guide/browser-compatibility.html#%E7%8E%B0%E4%BB%A3%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener noreferrer">现代模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>构建应用，为现代浏览器交付原生支持的 ES2015 代码，并生成一个兼容老浏览器的包用来自动回退。</li> <li><code>--target</code> 允许你将项目中的任何组件以一个库或 Web Components 组件的方式进行构建。更多细节请查阅<a href="https://cli.vuejs.org/zh/guide/build-targets.html" target="_blank" rel="noopener noreferrer">构建目标<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li><code>--report</code> 和 <code>--report-json</code> 会根据构建统计生成报告，它会帮助你分析包中包含的模块们的大小。</li></ul> <p>通过 npm script 执行该命令：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git pull &amp;&amp; vue-cli-service build &amp;&amp; npm run upload prod&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git pull &amp;&amp; vue-cli-service build --mode staging &amp;&amp; npm run upload test&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="源码分析-2"><a href="#源码分析-2" class="header-anchor">#</a> <strong>源码分析</strong></h4> <p><code>build</code> 命令插件位于 <code>cli-service/lib/commands/build/index.js</code>:<img src="/myblog/assets/img/vue-cli-build命令插件.7e80a410.png" alt="image-20240131201435242"></p> <blockquote><p>该命令入口文件使用 <code>api.registerCommand('build',options, callback)</code> 注册一个 build 命令：</p> <ul><li>注册并处理一个名为 <code>build</code> 的命令。</li> <li>根据命令的参数和选项来设置默认值。</li> <li>根据 <code>args.modern</code> 的值来执行不同的构建操作。</li> <li>在 Modern 模式下，通过子进程来执行构建操作。</li> <li>删除构建操作中产生的临时文件。</li></ul></blockquote> <p>在注册完成 <code>build</code> 命令后，解析命令参数，最后传入一个 <code>build</code> 方法解析命令行参数、配置 Webpack 配置、执行 Webpack 构建执行 webpack 构建：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//负责解析命令行参数、配置 Webpack 配置、执行 Webpack 构建</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> chalk <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-shared-utils'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> formatStats <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./formatStats'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> validateWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../util/validateWebpackConfig'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">,</span>
    done<span class="token punctuation">,</span>
    info<span class="token punctuation">,</span>
    logWithSpinner<span class="token punctuation">,</span>
    stopSpinner
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-shared-utils'</span><span class="token punctuation">)</span>

  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> mode <span class="token operator">=</span> api<span class="token punctuation">.</span>service<span class="token punctuation">.</span>mode
  <span class="token comment">//检查命令行参数，并根据参数内容修改了构建模式（如 --modern 和 --no-modern）</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">'app'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bundleTag <span class="token operator">=</span> args<span class="token punctuation">.</span>modern
      <span class="token operator">?</span> args<span class="token punctuation">.</span>modernBuild
        <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">modern bundle </span><span class="token template-punctuation string">`</span></span>
        <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">legacy bundle </span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
    <span class="token function">logWithSpinner</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Building </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bundleTag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> buildMode <span class="token operator">=</span> buildModes<span class="token punctuation">[</span>args<span class="token punctuation">.</span>target<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>buildMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> additionalParams <span class="token operator">=</span> buildMode <span class="token operator">===</span> <span class="token string">'library'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span>formats<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
      <span class="token function">logWithSpinner</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Building for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> as </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildMode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>additionalParams<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown build target: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>dest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Override outputDir before resolving webpack config as config relies on it (#2327)</span>
    options<span class="token punctuation">.</span>outputDir <span class="token operator">=</span> args<span class="token punctuation">.</span>dest
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> targetDir <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>outputDir<span class="token punctuation">)</span>
  <span class="token keyword">const</span> isLegacyBuild <span class="token operator">=</span> args<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">'app'</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>modern <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>args<span class="token punctuation">.</span>modernBuild

  <span class="token comment">// resolve raw webpack config</span>
  <span class="token comment">//加载了相应的webpack配置文件</span>
  <span class="token keyword">let</span> webpackConfig
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">'lib'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./resolveLibConfig'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> args<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
    args<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">'wc'</span> <span class="token operator">||</span>
    args<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">'wc-async'</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./resolveWcConfig'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> args<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./resolveAppConfig'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> args<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// check for common config errors</span>
  <span class="token comment">//检查了 Webpack 配置是否包含错误，并进行了修正</span>
  <span class="token function">validateWebpackConfig</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> api<span class="token punctuation">,</span> options<span class="token punctuation">,</span> args<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
  <span class="token comment">//启动一个监听器来监听文件变化并自动重新构建</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">modifyConfig</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>watch <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 判断是否有标准输入</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>stdin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当标准输入结束时，退出程序</span>
    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 恢复标准输入</span>
    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Expose advanced stats</span>
  <span class="token comment">// 判断参数dashboard是否存在</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>dashboard<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 引入DashboardPlugin插件</span>
    <span class="token keyword">const</span> DashboardPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../webpack/DashboardPlugin'</span><span class="token punctuation">)</span>
    <span class="token comment">// 修改webpack配置</span>
    <span class="token function">modifyConfig</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 将DashboardPlugin插件添加到配置中</span>
      config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DashboardPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">modernBuild</span><span class="token operator">:</span> args<span class="token punctuation">.</span>modernBuild<span class="token punctuation">,</span>
        <span class="token literal-property property">keepAlive</span><span class="token operator">:</span> args<span class="token punctuation">.</span>keepAlive
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果args.report或者args['report-json']存在，则引入webpack-bundle-analyzer插件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>report <span class="token operator">||</span> args<span class="token punctuation">[</span><span class="token string">'report-json'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span>
    <span class="token comment">// 修改webpackConfig配置</span>
    <span class="token function">modifyConfig</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 根据target参数，设置bundleName</span>
      <span class="token keyword">const</span> bundleName <span class="token operator">=</span> args<span class="token punctuation">.</span>target <span class="token operator">!==</span> <span class="token string">'app'</span>
        <span class="token operator">?</span> config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>filename<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> isLegacyBuild <span class="token operator">?</span> <span class="token string">'legacy-'</span> <span class="token operator">:</span> <span class="token string">''</span>
      <span class="token comment">// 添加BundleAnalyzerPlugin插件</span>
      config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 设置日志等级</span>
        <span class="token literal-property property">logLevel</span><span class="token operator">:</span> <span class="token string">'warn'</span><span class="token punctuation">,</span>
        <span class="token comment">// 关闭浏览器</span>
        <span class="token literal-property property">openAnalyzer</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// 根据args.report参数，设置analyzerMode</span>
        <span class="token literal-property property">analyzerMode</span><span class="token operator">:</span> args<span class="token punctuation">.</span>report <span class="token operator">?</span> <span class="token string">'static'</span> <span class="token operator">:</span> <span class="token string">'disabled'</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置报告文件名</span>
        <span class="token literal-property property">reportFilename</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bundleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">report.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 设置报告文件名</span>
        <span class="token literal-property property">statsFilename</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bundleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">report.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 根据args['report-json']参数，设置generateStatsFile</span>
        <span class="token literal-property property">generateStatsFile</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>args<span class="token punctuation">[</span><span class="token string">'report-json'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>clean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果args.clean为true，则执行fs.remove函数，删除targetDir目录</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行webpack构建</span>
    <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 停止spinner</span>
      <span class="token function">stopSpinner</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token comment">// 如果出现错误，则返回错误</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 如果构建有错误，则返回错误</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Build failed with errors.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 如果不是静默模式，则输出构建信息</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>silent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> targetDirShort <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>
          api<span class="token punctuation">.</span>service<span class="token punctuation">.</span>context<span class="token punctuation">,</span>
          targetDir
        <span class="token punctuation">)</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token function">formatStats</span><span class="token punctuation">(</span>stats<span class="token punctuation">,</span> targetDirShort<span class="token punctuation">,</span> api<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 如果是app目标，且不是legacy构建，则输出部署信息</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">'app'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isLegacyBuild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果不是watch模式，则输出构建完成信息</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">done</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Build complete. The </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>targetDirShort<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> directory is ready to be deployed.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Check out deployment instructions at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://cli.vuejs.org/guide/deployment.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">done</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Build complete. Watching for changes...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// test-only signal</span>
      <span class="token comment">// 测试only信号</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_TEST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Build complete.'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 构建成功，返回成功</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br></div></div><blockquote><p>该方法主要逻辑为：</p> <ol><li>代码检查了命令行参数，并根据参数内容修改了构建模式（如 <code>--modern</code> 和 <code>--no-modern</code>）。</li> <li>然后，代码加载了相应的配置文件（如 <code>resolveAppConfig</code>、<code>resolveLibConfig</code> 等），并根据命令行参数进行了相应的配置修改。</li> <li>接着，代码检查了 Webpack 配置是否包含错误，并进行了修正。</li> <li>最后，代码根据命令行参数（如 <code>--silent</code> 和 <code>--report</code>）决定是否输出构建结果。</li> <li>如果需要，代码还会启动一个监听器来监听文件变化并自动重新构建。</li> <li>执行 webpack 构建；</li> <li>为了方便测试，代码还允许在测试环境中输出一些信号。</li></ol></blockquote> <h2 id="webpack-配置原理"><a href="#webpack-配置原理" class="header-anchor">#</a> <strong>WebPack 配置原理</strong></h2> <h3 id="配置方式"><a href="#配置方式" class="header-anchor">#</a> <strong>配置方式</strong></h3> <p>在 <code>vue.config.js</code> 中的 <code></code> 选项提供一个对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">MyAwesomeWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>该对象将会被 <a href="https://github.com/survivejs/webpack-merge" target="_blank" rel="noopener noreferrer">webpack-merge<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 合并入最终的 webpack 配置。</p> <p>使用 Vue-Cli 创建的项目 <code>vue.config.js</code> 配置为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use strict'</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> defaultSettings <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/settings/projectSettings.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> LodashModuleReplacementPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> UpdatePopup <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@femessage/update-popup'</span><span class="token punctuation">)</span> <span class="token comment">// 版本更新提醒插件</span>
<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> name <span class="token operator">=</span> defaultSettings<span class="token punctuation">.</span>title page title

<span class="token comment">// If your port is set to 80,</span>
<span class="token comment">// use administrator privileges to execute the command line.</span>
<span class="token comment">// For example, Mac: sudo npm run</span>
<span class="token comment">// You can change the port by the following methods:</span>
<span class="token comment">// port = 8080 npm run dev OR npm run dev --port = 8080</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>port <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_port <span class="token operator">||</span> <span class="token number">8080</span> <span class="token comment">// dev port</span>

<span class="token comment">// All configuration item explanations can be find in https://cli.vuejs.org/config/</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * You will need to set publicPath if you plan to deploy your site under a sub path,
   * for example GitHub Pages. If you plan to deploy your site to https://foo.github.io/bar/,
   * then publicPath should be set to &quot;/bar/&quot;.
   * In most cases please use '/' !!!
   * Detail: https://cli.vuejs.org/config/#publicpath
   */</span>
  <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">'./'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">outputDir</span><span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">assetsDir</span><span class="token operator">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lintOnSave</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">productionSourceMap</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> port<span class="token punctuation">,</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">overlay</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// websocket 配置代理</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'/socket.io'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span> <span class="token comment">// target host</span>
        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// needed for virtual hosted sites</span>
        <span class="token literal-property property">logLevel</span><span class="token operator">:</span> <span class="token string">'debug'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// provide the app's title in webpack's name field, so that</span>
    <span class="token comment">// it can be accessed in index.html to inject the correct title.</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'@'</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// it can improve the speed of the first screen, it is recommended to turn on preload</span>
    config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'preload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">rel</span><span class="token operator">:</span> <span class="token string">'preload'</span><span class="token punctuation">,</span>
        <span class="token comment">// to ignore runtime.js</span>
        <span class="token comment">// https://github.com/vuejs/vue-cli/blob/dev/packages/@vue/cli-service/lib/config/views/App.js#L171</span>
        <span class="token literal-property property">fileBlacklist</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.map$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hot-update\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">runtime\..*\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token string">'initial'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 版本更新提醒插件</span>
    config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'femessage-update-popup'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>UpdatePopup<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">auto</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// when there are many pages, it will cause too many meaningless requests</span>
    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'prefetch'</span><span class="token punctuation">)</span>

    <span class="token comment">// set svg-sprite-loader</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>exclude<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/icons'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'icons'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.svg$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>include<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/icons'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'svg-sprite-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'svg-sprite-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">symbolId</span><span class="token operator">:</span> <span class="token string">'icon-[name]'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    config
      <span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
        <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          config
            <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'ScriptExtHtmlWebpackPlugin'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'script-ext-html-webpack-plugin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token comment">// `runtime` must same as runtimeChunk name. default is `runtime`</span>
              <span class="token literal-property property">inline</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">runtime\..*\.js$</span><span class="token regex-delimiter">/</span></span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          config
            <span class="token punctuation">.</span>optimization<span class="token punctuation">.</span><span class="token function">splitChunks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">libs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'chunk-libs'</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'initial'</span> <span class="token comment">// only package third parties that are initially dependent</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">elementUI</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'chunk-elementUI'</span><span class="token punctuation">,</span> <span class="token comment">// split elementUI into a single package</span>
                  <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// the weight needs to be larger than libs and app or it will be packaged into libs or app</span>
                  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]_?element-ui(.*)</span><span class="token regex-delimiter">/</span></span> <span class="token comment">// in order to adapt to cnpm</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">commons</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'chunk-commons'</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/components'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// can customize your rules</span>
                  <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">//  minimum common number</span>
                  <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">// https:// webpack.js.org/configuration/optimization/#optimizationruntimechunk</span>
          config<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span><span class="token function">runtimeChunk</span><span class="token punctuation">(</span><span class="token string">'single'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>

    config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'loadshReplace'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LodashModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">loaderOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">sass</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">prependData</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import &quot;~@/styles/variables.scss&quot;;</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br></div></div><h4 id="configurewebpack-属性"><a href="#configurewebpack-属性" class="header-anchor">#</a> <strong><code>configureWebpack</code>  属性</strong></h4> <blockquote><p>Type: <code>Object | Function</code></p> <p>webpack 配置属性：</p> <ul><li><p>如果这个值是一个对象，则会通过 <a href="https://github.com/survivejs/webpack-merge" target="_blank" rel="noopener noreferrer">webpack-merge<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 合并到最终的配置中。</p></li> <li><p>如果这个值是一个函数，则会接收被解析的配置作为参数。该函数既可以修改配置并不返回任何东西，也可以返回一个被克隆或合并过的配置版本。</p></li></ul></blockquote> <p><strong>原理</strong></p> <p><code>configureWebpack</code> 属性在 CLI 服务对象 <code>Service</code> 类初始化 <code>init</code> 方法中，通过将用户配置的 webpack 项存储到 <code>webpackRawConfigFns</code>，最后通过 <a href="https://github.com/survivejs/webpack-merge" target="_blank" rel="noopener noreferrer">webpack-merge<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 合并到最终的配置中：</p> <p><img src="/myblog/assets/img/vue-cli-webpack配置项.160c5aa7.png" alt="image-20240131135803195"></p> <h3 id="链式操作-高级"><a href="#链式操作-高级" class="header-anchor">#</a> <strong>链式操作 (高级)</strong></h3> <p>Vue CLI 内部的 webpack 配置是通过 <a href="https://github.com/mozilla-neutrino/webpack-chain" target="_blank" rel="noopener noreferrer">webpack-chain<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 维护的。</p> <p>这个库提供了一个 webpack 原始配置的上层抽象，使其可以定义具名的 loader 规则和具名插件，并有机会在后期进入这些规则并对它们的选项进行修改。
链式操作通过  <code>vue.config.js</code> 中的 <code>chainWebpack</code> 属性配置：</p> <h4 id="chainwebpack-属性"><a href="#chainwebpack-属性" class="header-anchor">#</a> <strong><code>chainWebpack</code> 属性</strong></h4> <blockquote><p>Type: <code>Function</code></p> <p>是一个函数，会接收一个基于 <a href="https://github.com/mozilla-neutrino/webpack-chain" target="_blank" rel="noopener noreferrer">webpack-chain<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <code>ChainableConfig</code> 实例。</p> <p>允许对内部的 webpack 配置进行更细粒度的修改。</p></blockquote> <p><code>chainWebpack</code> 属性使用方式参考 <a href="https://github.com/mozilla-neutrino/webpack-chain" target="_blank" rel="noopener noreferrer">webpack-chain<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 官方文档使用方式。</p> <h4 id="webpack-chain"><a href="#webpack-chain" class="header-anchor">#</a> <strong><a href="https://github.com/mozilla-neutrino/webpack-chain" target="_blank" rel="noopener noreferrer">webpack-chain<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></h4> <p><strong>webpack-chain 是什么？</strong></p> <blockquote><p><code>webpack-chain</code> 是一个工具，它通过链式 API 生成和简化 webpack 2-4 版本的配置的修改</p></blockquote> <p><strong>为什么要使用 webpack-chain ？</strong></p> <blockquote><p>Webpack-chain 的出现是为了解决 webpack 配置的问题。</p> <p>Webpack 的配置过程极其复杂，需要输入大量的信息来保证打包结果符合预期。</p> <p>Webpack-chain 通过提供一个链式 API 来解决这个问题:</p> <ol><li>它允许用户以链式方式创建和修改 webpack 配置，这使得配置过程更加直观和易于管理。</li> <li>API 的 Key 部分可以由用户指定的名称引用，这有助于标准化跨项目的配置修改方式。</li></ol></blockquote> <h2 id="模式和环境变量"><a href="#模式和环境变量" class="header-anchor">#</a> <strong><a href="https://cli.vuejs.org/zh/guide/mode-and-env.html#%E6%A8%A1%E5%BC%8F%E5%92%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" target="_blank" rel="noopener noreferrer">模式和环境变量<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></h2> <h3 id="模式"><a href="#模式" class="header-anchor">#</a> <strong>模式</strong></h3> <p><strong>模式</strong>是 Vue CLI 项目中一个重要的概念。默认情况下，一个 Vue CLI 项目有三个模式：</p> <ul><li>开发模式：<code>development</code> 字段表示，使用 <code>vue-cli-service serve</code> 命令启动；</li> <li>测试模式：<code>test</code> 字段表示，使用 <code>vue-cli-service test:unit</code> 命令启动；</li> <li>生产模式：<code>production</code> 字段表示，使用  <code>vue-cli-service build</code> 命令启动；</li></ul> <p>你可以通过传递 <code>--mode</code> 选项参数为命令行覆写默认的模式。例如，如果你想要在构建命令中使用开发环境变量：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vue-cli-service build --mode development
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当运行 <code>vue-cli-service</code> 命令时，所有的环境变量都从对应的<a href="https://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" target="_blank" rel="noopener noreferrer">环境文件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中载入。</p> <p>通过以上 &quot;serve 命令解析&quot; 部分可知：<code>vue-cli-service</code> 中 <code>serve</code> 和 <code>build</code> 命令最终实际执行 <code>server.js</code> 和 <code>build</code> 插件，插件目录如下：<img src="/myblog/assets/img/vue-cli-service-插件.0e323071.png" alt="image-20240131160413569"></p> <h3 id="环境变量"><a href="#环境变量" class="header-anchor">#</a> <strong>环境变量</strong></h3> <p>项目根目录中放置下列文件来指定环境变量：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>.env                <span class="token comment"># 在所有的环境中被载入</span>
.env.local          <span class="token comment"># 在所有的环境中被载入，但会被 git 忽略</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>         <span class="token comment"># 只在指定的模式中被载入</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>.local   <span class="token comment"># 只在指定的模式中被载入，但会被 git 忽略</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一个环境文件只包含环境变量的“键=值”对：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">FOO</span><span class="token operator">=</span>bar
<span class="token assign-left variable">VUE_APP_NOT_SECRET_CODE</span><span class="token operator">=</span>some_value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="源码分析-3"><a href="#源码分析-3" class="header-anchor">#</a> <strong>源码分析</strong></h3> <p>模式和环境变量初始化在 Service 类初始化时 <code>init</code> 方法中，通过 <code>loadEnv</code> 方法初始化：</p> <p><img src="/myblog/assets/img/vue-cli-service-loadEnv.a89ff61f.png" alt="image-20240131144841437"></p> <p><code>loadEnv</code> 方法定义：</p> <p><img src="/myblog/assets/img/loadEnv方法.44ea7f69.png" alt="image-20240131145425965"></p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> <strong>参考资料</strong></h2> <p><a href="https://cli.vuejs.org/zh/guide/" target="_blank" rel="noopener noreferrer">vue-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://cloud.tencent.com/developer/article/1781202#:~:text=Vue%20CLI%20%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%20Vue.js%20%E8%BF%9B%E8%A1%8C%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%E7%9A%84%E5%AE%8C%E6%95%B4%E7%B3%BB%E7%BB%9F%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86%E7%BB%88%E7%AB%AF%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E3%80%81%E9%9B%B6%E9%85%8D%E7%BD%AE%E8%84%9A%E6%89%8B%E6%9E%B6%E3%80%81%E6%8F%92%E4%BB%B6%E4%BD%93%E7%B3%BB%E3%80%81%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2%E7%AD%89%E3%80%82,%E6%9C%AC%E6%96%87%E6%9A%82%E4%B8%94%E5%8F%AA%E5%88%86%E6%9E%90%20%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96%20%E9%83%A8%E5%88%86%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E7%BB%88%E7%AB%AF%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0%E3%80%82%200.%20%E7%94%A8%E6%B3%95" target="_blank" rel="noopener noreferrer">剖析 Vue CLI 实现原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">March 20, 2024 20:28</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 596777598@qq.com" class="contributor">
          sewar
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/myblog/assets/js/app.9d2b617a.js" defer></script><script src="/myblog/assets/js/layout-Layout.d2d4ce64.js" defer></script><script src="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js" defer></script><script src="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" defer></script>
  </body>
</html>
