<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 docker 部署 Node 服务 | Sewen 博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="./mylogo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="manifest" href="/myblog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://sewar-x.github.io/myblog/atom.xml" title="Sewen 博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 RSS Feed">
    <meta name="description" content="sewen 的前端学习笔记、博客、前端基础总结、技术深度剖析、面试题总结、算法总结、项目过程总结">
    <meta property="og:url" content="https://sewar-x.github.io/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2.html">
    <meta property="og:site_name" content="Sewen 博客">
    <meta property="og:title" content="使用 docker 部署 Node 服务">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.645fbc6f.css" as="style"><link rel="preload" href="/myblog/assets/js/app.9d2b617a.js" as="script"><link rel="preload" href="/myblog/assets/js/layout-Layout.d2d4ce64.js" as="script"><link rel="preload" href="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js" as="script"><link rel="preload" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" as="script"><link rel="prefetch" href="/myblog/assets/js/199.a9216960.js"><link rel="prefetch" href="/myblog/assets/js/200.4c66fc79.js"><link rel="prefetch" href="/myblog/assets/js/layout-Blog.1fca7e90.js"><link rel="prefetch" href="/myblog/assets/js/layout-NotFound.3c74e8aa.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/AlgoliaSearch/Dropdown.70fcebe7.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Anchor.3235541c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleInfo.7b815b20.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleItem.b0e177e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleList.d1cf1b24.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleType.b630b80e.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHero.621312ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHome.4fe44489.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogInfo.b2a94760.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogPage.e0fbe820.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BloggerInfo.0df38355.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/CategoryList.ec1bcd96.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ProjectList.8550a110.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TagList.bcf7b782.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/Timeline.b6cf5471.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TimelineList.3c6e08a6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Clipboard.e940a903.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Common.820a8694.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Home.70383986.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/MyTransition.0de46069.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/DropdownLink.e3f6c118.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLink.93b11770.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLinks.8ba214e6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/Navbar.b90a94f9.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/RepoLink.663a7f55.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/SidebarButton.76b0035a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Page.98b5d09c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageFooter.20bc9bd8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageMeta.b7e6b12f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageNav.8305dd1f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Password.45e0e82a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/DropdownTransition.068c5eea.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/Sidebar.f6f90d52.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarDropdownLink.505127a8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarGroup.7eecf370.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarLink.6e39fe32.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarNavLinks.0f8566cb.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/DarkmodeSwitch.20ac7b92.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeColor.6086e4ed.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeOptions.483238c9.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ArticleIcon.0a22e2b1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/AutoIcon.2ff1c790.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/BookIcon.419b49ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/DarkIcon.7d81873b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EditIcon.8ada485d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EmptyIcon.d704a5cf.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/I18nIcon.ffad8b3e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LightIcon.47d807da.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LinkIcon.1a8a7826.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LockIcon.a29a2b79.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/NextIcon.0214ee59.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/Page404Icon.8bc1ebbb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PresentationIcon.17500d9b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PrevIcon.2ae04a70.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ProjectIcon.b336d567.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/StickyIcon.0f509b9d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Baidu.244b9a41.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Bitbucket.11ba94e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dingding.e8a3d90d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Discord.3295a55b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dribbble.464dac3b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Email.f9254caa.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Evernote.991472fb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Facebook.08e78e47.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Flipboard.a1124d0f.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitee.c44bc20a.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Github.5667e5ae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitlab.ad95c7a7.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gmail.b5acc6bc.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Instagram.56be85f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Lines.d9db3dce.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Linkedin.b82d8d8b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pinterest.0f3ffe71.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pocket.41ef3c92.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/QQ.7558f4ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Qzone.bf658fae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Reddit.9c4c95ee.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Rss.9780139e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Steam.06abbae2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Twitter.26fa5bda.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Wechat.9cac8c4c.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Weibo.5206a632.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Whatsapp.0738f1e3.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Youtube.f41fd7f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Zhihu.4d851d2f.js"><link rel="prefetch" href="/myblog/assets/js/page--0abc50bf.0d6f1484.js"><link rel="prefetch" href="/myblog/assets/js/page--1cd40f4c.dd76c7b3.js"><link rel="prefetch" href="/myblog/assets/js/page--53f93199.e80bdec8.js"><link rel="prefetch" href="/myblog/assets/js/page--5afd2fd0.adea4e92.js"><link rel="prefetch" href="/myblog/assets/js/page--67c584d3.0a3f3cd9.js"><link rel="prefetch" href="/myblog/assets/js/page--776a8506.cdf48aac.js"><link rel="prefetch" href="/myblog/assets/js/page-CSS.eb94b29f.js"><link rel="prefetch" href="/myblog/assets/js/page-Chrome开发工具使用指南.a2675120.js"><link rel="prefetch" href="/myblog/assets/js/page-DevServer.0281863d.js"><link rel="prefetch" href="/myblog/assets/js/page-Echarts二次封装.4387b8ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Elementui与Element-plusui二次封装.82f12a09.js"><link rel="prefetch" href="/myblog/assets/js/page-Git基础.03c616ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Git规范.e2fdc38a.js"><link rel="prefetch" href="/myblog/assets/js/page-HTML.1e3c14b9.js"><link rel="prefetch" href="/myblog/assets/js/page-Home.f0b7e772.js"><link rel="prefetch" href="/myblog/assets/js/page-JSON配置化组件二次封装.12060fd9.js"><link rel="prefetch" href="/myblog/assets/js/page-JS原理实现.3c427e19.js"><link rel="prefetch" href="/myblog/assets/js/page-JS应用题.3d313b34.js"><link rel="prefetch" href="/myblog/assets/js/page-JavaScript基础.551be887.js"><link rel="prefetch" href="/myblog/assets/js/page-Linux.c6159ebd.js"><link rel="prefetch" href="/myblog/assets/js/page-Loader和Plugin原理.b2971b76.js"><link rel="prefetch" href="/myblog/assets/js/page-MySQL.0b1d704a.js"><link rel="prefetch" href="/myblog/assets/js/page-NPM.a55851b2.js"><link rel="prefetch" href="/myblog/assets/js/page-Node.ec405a21.js"><link rel="prefetch" href="/myblog/assets/js/page-Nodejs常见问题集合.12844e69.js"><link rel="prefetch" href="/myblog/assets/js/page-Node性能优化.b4ea1c34.js"><link rel="prefetch" href="/myblog/assets/js/page-Promise专题.7869a31b.js"><link rel="prefetch" href="/myblog/assets/js/page-React.d76cf0ac.js"><link rel="prefetch" href="/myblog/assets/js/page-SSG移动端项目实践.2122615b.js"><link rel="prefetch" href="/myblog/assets/js/page-TypeScript.4f597fda.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite.637881bf.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite原理解析.6677fdb4.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue25项目webpack构建分析.7bbea0fa.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2VsVue3.10be4140.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2x原理源码分析.e9e753b6.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3基础.210247ff.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3源码分析.17379e04.js"><link rel="prefetch" href="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js"><link rel="prefetch" href="/myblog/assets/js/page-VueRouter原理分析.0a092eb6.js"><link rel="prefetch" href="/myblog/assets/js/page-VueSSR原理分析.63006040.js"><link rel="prefetch" href="/myblog/assets/js/page-VueVsReact.2156be28.js"><link rel="prefetch" href="/myblog/assets/js/page-Vuex原理分析.5ba3e6e4.js"><link rel="prefetch" href="/myblog/assets/js/page-WEB安全.5aa0eeef.js"><link rel="prefetch" href="/myblog/assets/js/page-WebPack构建原理.9c29703e.js"><link rel="prefetch" href="/myblog/assets/js/page-webpackAPI分析.4c8b152b.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack优化.dcc6c3bc.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack基础.3820ee6c.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack项目实践.77e22417.js"><link rel="prefetch" href="/myblog/assets/js/page-一次后台管理系统的性能优化.7c2d8712.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建SSR项目.855376fc.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue2项目和规范设计.93017fd2.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue3单页面应用.de152d54.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建公共组件库.93278073.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js"><link rel="prefetch" href="/myblog/assets/js/page-分治.e3dfc22d.js"><link rel="prefetch" href="/myblog/assets/js/page-前端发版静态资源404问题.9eb1ca89.js"><link rel="prefetch" href="/myblog/assets/js/page-前端存储.cd82cf54.js"><link rel="prefetch" href="/myblog/assets/js/page-前端工程化.1e6e58d0.js"><link rel="prefetch" href="/myblog/assets/js/page-前端性能优化方案.83718d22.js"><link rel="prefetch" href="/myblog/assets/js/page-前端架构实践.171dbc0f.js"><link rel="prefetch" href="/myblog/assets/js/page-前端渲染架构.3b783de8.js"><link rel="prefetch" href="/myblog/assets/js/page-前端自动部署.5076846c.js"><link rel="prefetch" href="/myblog/assets/js/page-前端部署原理.82ecd8a7.js"><link rel="prefetch" href="/myblog/assets/js/page-动态规划.a3af92f1.js"><link rel="prefetch" href="/myblog/assets/js/page-哈希表.c76000e8.js"><link rel="prefetch" href="/myblog/assets/js/page-回溯算法.cd914c32.js"><link rel="prefetch" href="/myblog/assets/js/page-图.dfd9828a.js"><link rel="prefetch" href="/myblog/assets/js/page-基础.7bf5a37b.js"><link rel="prefetch" href="/myblog/assets/js/page-堆.4657e538.js"><link rel="prefetch" href="/myblog/assets/js/page-字符串.252f2a08.js"><link rel="prefetch" href="/myblog/assets/js/page-异步编程.904f4c65.js"><link rel="prefetch" href="/myblog/assets/js/page-性能优化指标和监控.f2175836.js"><link rel="prefetch" href="/myblog/assets/js/page-排序算法.c7a51b99.js"><link rel="prefetch" href="/myblog/assets/js/page-搭建低代码平台.19eaf5ec.js"><link rel="prefetch" href="/myblog/assets/js/page-操作系统.473c4281.js"><link rel="prefetch" href="/myblog/assets/js/page-数学运算.c82748fb.js"><link rel="prefetch" href="/myblog/assets/js/page-数据结构算法.84480586.js"><link rel="prefetch" href="/myblog/assets/js/page-数组.692b0d0a.js"><link rel="prefetch" href="/myblog/assets/js/page-权限管理.c7e10db0.js"><link rel="prefetch" href="/myblog/assets/js/page-查找.790e52df.js"><link rel="prefetch" href="/myblog/assets/js/page-栈和队列.8dbc3586.js"><link rel="prefetch" href="/myblog/assets/js/page-树.24efdeaa.js"><link rel="prefetch" href="/myblog/assets/js/page-浏览器.bee9ec04.js"><link rel="prefetch" href="/myblog/assets/js/page-混合桌面应用开发.9e10d1c3.js"><link rel="prefetch" href="/myblog/assets/js/page-登录.bb830451.js"><link rel="prefetch" href="/myblog/assets/js/page-目录.c85b4d0b.js"><link rel="prefetch" href="/myblog/assets/js/page-移动端开发.56ac22ec.js"><link rel="prefetch" href="/myblog/assets/js/page-组件和组件封装.b5e86da2.js"><link rel="prefetch" href="/myblog/assets/js/page-计算机网络基础.0a106662.js"><link rel="prefetch" href="/myblog/assets/js/page-设计模式.ffdc7cfd.js"><link rel="prefetch" href="/myblog/assets/js/page-调试技巧.485ae36e.js"><link rel="prefetch" href="/myblog/assets/js/page-贪心算法.0f417640.js"><link rel="prefetch" href="/myblog/assets/js/page-输入url到页面展示全过程.510aef2e.js"><link rel="prefetch" href="/myblog/assets/js/page-递归.5e55e552.js"><link rel="prefetch" href="/myblog/assets/js/page-链表.1cf6927f.js"><link rel="prefetch" href="/myblog/assets/js/page-项目总结.ffcd2a4b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~docsearch.f3877d0d.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~5d377965.d9712593.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-components/Blog/ArticleItem~layout-components/Blog/ArticleL~b56f3aac.47bb5cb5.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-NotFound~layout-components/Common~layout-components/Page.57d58db9.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Slide.81546b3b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/AlgoliaSearch/Full.b30f067a.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Blog/BlogPage.bcccbd38.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Navbar/Navbar.e2a7361e.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Page.6c65077c.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Sidebar/Sidebar.34cd9cf7.js"><link rel="prefetch" href="/myblog/assets/js/vendors~photo-swipe.428df1da.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.645fbc6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/myblog/" class="home-link router-link-active"><img src="./mylogo.png" alt="Sewen 博客" class="logo"> <!----> <span class="site-name can-hide">Sewen 博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
        前端基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><a href="/myblog/node/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><a href="/myblog/node/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><a href="/myblog/node/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
        计算机基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><a href="/myblog/node/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><a href="/myblog/node/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><a href="/myblog/node/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><a href="/myblog/node/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/myblog/node/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
        框架和源码分析
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><a href="/myblog/node/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><a href="/myblog/node/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><a href="/myblog/node/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><a href="/myblog/node/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
        浏览器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><a href="/myblog/node/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><a href="/myblog/node/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
        服务器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><a href="/myblog/node/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><a href="/myblog/node/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><a href="/myblog/node/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><a href="/myblog/node/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
        性能优化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><a href="/myblog/node/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><a href="/myblog/node/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
        前端工程
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><a href="/myblog/node/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><a href="/myblog/node/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><a href="/myblog/node/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><a href="/myblog/node/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><a href="/myblog/node/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
        项目实践
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><a href="/myblog/node/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
        项目搭建
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/node/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><a href="/myblog/node/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="./mylogo.png" class="avatar round"> <div property="name" class="name">Sewen 博客</div> <meta property="url" content="../outline.md"></div> <div class="num-wrapper"><div><div class="num">91</div> <div>Articles</div></div> <div><div class="num">0</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">91</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/Sewar-x/myblog" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="1567910907" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up" class="media-link"><span class="sr-only">Wechat</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E"></circle> <path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#FFF"></path> <path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
      前端基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
      计算机基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
      框架和源码分析
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
      浏览器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
      服务器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
      性能优化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
      前端工程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
      项目实践
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
      项目搭建
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><!----> <a href="/myblog/node/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/node/" aria-current="page" class="sidebar-link">Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/#总览" class="sidebar-link">总览</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#中间件" class="sidebar-link">中间件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/#概念" class="sidebar-link heading3">概念</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#中间件封装" class="sidebar-link heading3">中间件封装</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#日志中间件" class="sidebar-link heading3">日志中间件</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#请求响应参数封装" class="sidebar-link heading3">请求响应参数封装</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/#jwt-鉴权机制" class="sidebar-link">JWT 鉴权机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/#概念-2" class="sidebar-link heading3">概念</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#为什么使用-jwt" class="sidebar-link heading3">为什么使用 JWT？</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#使用流程" class="sidebar-link heading3">使用流程</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#node-token-中间件" class="sidebar-link heading3">Node Token 中间件</a></li><li class="sidebar-sub-header"><a href="/myblog/node/#前端如何保存-token" class="sidebar-link heading3">前端如何保存 Token?</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/#常见问题" class="sidebar-link">常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/#node-js-中-readfile-和-createreadstream-的区别" class="sidebar-link heading3">Node.js 中 readFile 和 createReadStream 的区别？</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/" class="sidebar-link">Node 性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#性能指标" class="sidebar-link">性能指标</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#cpu" class="sidebar-link heading3">CPU</a></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#内存指标" class="sidebar-link heading3">内存指标</a></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#磁盘-io" class="sidebar-link heading3">磁盘 IO</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#性能监控" class="sidebar-link">性能监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#性能监控工具" class="sidebar-link heading3">性能监控工具</a></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#easy-monitor" class="sidebar-link heading3">easy-monitor</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#性能优化" class="sidebar-link">性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#正确使用流-stream" class="sidebar-link heading3">正确使用流 stream</a></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#数据库优化" class="sidebar-link heading3">数据库优化</a></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#内存管理优化" class="sidebar-link heading3">内存管理优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/Node%E6%80%A7%E8%83%BD/#参考资料-2" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/" aria-current="page" class="active sidebar-link">使用 docker 部署 Node 服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#部署总流程" class="sidebar-link">部署总流程</a></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#部署命令行" class="sidebar-link">部署命令行</a></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#部署发布脚本" class="sidebar-link">部署发布脚本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#使用-pm2-运行-node" class="sidebar-link heading3">使用 PM2 运行 node</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#使用-docker-部署" class="sidebar-link">使用 docker 部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#docker-是什么" class="sidebar-link heading3">docker 是什么?</a></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#为什么要使用-docker-部署" class="sidebar-link heading3">为什么要使用 docker 部署？</a></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#构建-doker-镜像" class="sidebar-link heading3">构建 doker 镜像</a></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#发布脚本" class="sidebar-link heading3">发布脚本</a></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#使用-webhook-推送通知构建" class="sidebar-link heading3">使用 webhook 推送通知构建</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/node/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/" class="sidebar-link">Node.js 常见问题集合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/node/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/myblog/node/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">Node</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">使用 docker 部署 Node 服务</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">使用 docker 部署 Node 服务</span></h1> <div class="page-info"><!----> <true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#部署总流程" class="anchor-link heading2"><div>部署总流程</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#部署命令行" class="anchor-link heading2"><div>部署命令行</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#部署发布脚本" class="anchor-link heading2"><div>部署发布脚本</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#使用-pm2-运行-node" class="anchor-link heading3"><div>使用 PM2 运行 node</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#使用-docker-部署" class="anchor-link heading2"><div>使用 docker 部署</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#docker-是什么" class="anchor-link heading3"><div>docker 是什么?</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#为什么要使用-docker-部署" class="anchor-link heading3"><div>为什么要使用 docker 部署？</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#构建-doker-镜像" class="anchor-link heading3"><div>构建 doker 镜像</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#发布脚本" class="anchor-link heading3"><div>发布脚本</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#使用-webhook-推送通知构建" class="anchor-link heading3"><div>使用 webhook 推送通知构建</div></a></li><li class="anchor"><a href="/myblog/node/%E4%BD%BF%E7%94%A8docker%E6%9C%8D%E5%8A%A1node%E9%83%A8%E7%BD%B2/#参考资料" class="anchor-link heading2"><div>参考资料</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="使用-docker-部署-node-服务"><a href="#使用-docker-部署-node-服务" class="header-anchor">#</a> 使用 docker 部署 Node 服务</h1> <h2 id="部署总流程"><a href="#部署总流程" class="header-anchor">#</a> 部署总流程</h2> <p><img src="data:image/png;base64,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" alt="未命名文件(5)"></p> <h5 id="总流程"><a href="#总流程" class="header-anchor">#</a> 总流程</h5> <ol><li>本地同步远程分支</li> <li>本地构建 docker 镜像</li> <li>本地打包 docker 镜像</li> <li>上传 docker 镜像到服务器</li> <li>解压服务器 docker 镜像</li></ol> <h2 id="部署命令行"><a href="#部署命令行" class="header-anchor">#</a> 部署命令行</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 本地开发环境</span>
 <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node cross-env NODE_ENV=development ./src/server.js&quot;</span><span class="token punctuation">,</span> 
 <span class="token comment">// 本地开发环境</span>
  <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development nodemon ./src/server.js&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//本地链接生产环境</span>
  <span class="token string-property property">&quot;prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production node ./src/server.js&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//本地链接测试环境</span>
  <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=test nodemon ./src/server.js&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//sql服务</span>
  <span class="token string-property property">&quot;sqlserver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=test node ./src/server.js&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//pm2 测试环境</span>
  <span class="token string-property property">&quot;pm2:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pm2-runtime start pm2.json --env test&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//pm2 生产环境</span>
  <span class="token string-property property">&quot;pm2:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pm2-runtime start pm2.json --env production&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 构建docker测试环境</span>
  <span class="token string-property property">&quot;build:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=test &amp;&amp; node ./deploy/index.js build&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 构建docker生产环境</span>
  <span class="token string-property property">&quot;build:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; node ./deploy/index.js build&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//上传docker包到测试服</span>
  <span class="token string-property property">&quot;upload:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=test &amp;&amp; node ./deploy/index.js upload&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//上传docker包到正式服</span>
  <span class="token string-property property">&quot;upload:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; node ./deploy/index.js upload&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//解压测试服docker包</span>
  <span class="token string-property property">&quot;decompress:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; node ./deploy/index.js decompress&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//解压正式服docker包</span>
  <span class="token string-property property">&quot;decompress:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; node ./deploy/index.js decompress&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//构建、上传、解压docker测试服包</span>
  <span class="token string-property property">&quot;deploy:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=test &amp;&amp; node ./deploy/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//构建、上传、解压docker正式包</span>
  <span class="token string-property property">&quot;deploy:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; node ./deploy/index.js&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="部署发布脚本"><a href="#部署发布脚本" class="header-anchor">#</a> 部署发布脚本</h2> <ul><li>使用命令构建 docker 镜像:</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker image build -t low-code-node .
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>构建容器：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker container run -d -p 9991:9991 -it low-code-node /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>打包镜像</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker save  low-code-node &gt; ./package/lowcode.tar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>命令行 docker 构建/上传/解压</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm run deploy:prod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>上传 doker 镜像</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm run upload:prod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：使用 docker save  打包后的包默认放入 <code>/package</code> 目录下</p> <h3 id="使用-pm2-运行-node"><a href="#使用-pm2-运行-node" class="header-anchor">#</a> 使用 PM2 运行 node</h3> <ul><li>安装 PM2</li> <li><code>npm install -g pm2</code></li> <li>使用 pm2 的自动部署上传项目</li> <li><code>pm2 start pm2.json</code></li></ul> <h2 id="使用-docker-部署"><a href="#使用-docker-部署" class="header-anchor">#</a> 使用 docker 部署</h2> <h3 id="docker-是什么"><a href="#docker-是什么" class="header-anchor">#</a> docker 是什么?</h3> <ul><li><strong>Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口</strong></li> <li>Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。</li></ul> <h3 id="为什么要使用-docker-部署"><a href="#为什么要使用-docker-部署" class="header-anchor">#</a> 为什么要使用 docker 部署？</h3> <ul><li>使用 docker 部署优点
<ul><li><strong>环境一致性</strong>：Docker 可以创建一个独立的容器，其中包含了你的应用程序及其所有依赖项，包括 Node.js 运行时环境、操作系统、库和工具。这确保了在不同的环境中具有一致的运行结果，减少了因环境差异导致的问题。</li> <li><strong>可移植性</strong>：Docker 容器是可移植的，可以在不同的主机、云服务提供商或开发者之间轻松部署和共享。你可以将容器打包为镜像，并在任何支持 Docker 的环境中运行，无需担心环境配置和依赖项安装。</li> <li><strong>隔离性</strong>：每个 Docker 容器都是相互隔离的，它们拥有自己的文件系统、网络和进程空间。这意味着你可以在同一主机上运行多个容器，每个容器都可以独立运行和管理，互不干扰。</li> <li><strong>扩展性</strong>：使用 Docker，你可以根据需要快速扩展应用程序的实例数量。通过简单地创建和启动多个容器副本，可以轻松地实现水平扩展，以应对高流量和负载增加的情况。</li></ul></li> <li>使用 docker 部署缺点
<ul><li><strong>资源消耗大</strong>：Docker 需要一定的系统资源来运行容器，包括内存、存储和处理器等。在某些情况下，如果部署的容器数量较多或容器配置不合理，可能会对系统资源造成一定的压力。</li> <li><strong>镜像大小</strong>：Docker 镜像的大小可能会比传统的部署方式更大，特别是包含了完整操作系统和依赖项的镜像。这可能会增加镜像的传输时间和存储成本。</li></ul></li></ul> <h3 id="构建-doker-镜像"><a href="#构建-doker-镜像" class="header-anchor">#</a> 构建 doker 镜像</h3> <h4 id="一-使用-dockerfile-创建-docker-镜像"><a href="#一-使用-dockerfile-创建-docker-镜像" class="header-anchor">#</a> 一. <strong>使用 Dockerfile 创建 docker 镜像</strong></h4> <blockquote><p>总流程：</p> <ol><li>复制 package.json 并安装依赖；</li> <li>安装 node 镜像和复制安装的依赖；</li> <li>复制项目目录;</li> <li>安装 pm2;</li> <li>挂载卷;</li> <li>对外暴露端口号；</li> <li>运行 pm2;</li></ol></blockquote> <ul><li><p>在项目根目录创建 <code>Dockerfile</code> 文件，编写容器构建脚本</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 使用多阶段构建（multi-stage build）的方法，将构建和生产环境分开</span>

<span class="token comment"># 第一阶段（builder）中，只复制 package.json 和 package-lock.json 并安装生产依赖，以减少构建产物的大小</span>
<span class="token comment"># 在第一阶段（builder）中安装生产依赖，以保证构建产物的轻量化</span>
<span class="token instruction"><span class="token keyword">FROM</span> node:14.17.0 <span class="token keyword">as</span> builder</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> package.json .</span>
<span class="token instruction"><span class="token keyword">COPY</span> package-lock.json .</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm install --registry=https://registry.npm.taobao.org --production</span>
 
<span class="token comment"># 在第二阶段中，只复制构建产物和运行时所需的依赖,使用更轻量级的 Node 镜像，例如 node:14.17.0-alpine。Alpine 镜像基于 Alpine Linux，体积更小</span>
<span class="token comment"># 在第二阶段中只复制已安装的生产依赖，避免复制整个 node_modules 目录</span>
<span class="token comment"># 将 COPY . . 命令移动到最后，以减少构建产物的大小。这样，只有必要的文件和目录会被复制到镜像中</span>
<span class="token comment"># 将全局安装的依赖（pm2、cross-env、nodemon）移动到第二阶段中，并逐个安装，以确保只安装所需的依赖</span>
<span class="token instruction"><span class="token keyword">FROM</span> node:14.17.0-alpine</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">ENV</span> NODE_ENV=production</span>
<span class="token instruction"><span class="token keyword">RUN</span> apk add --no-cache git</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">builder</span></span> /app/node_modules /app/node_modules</span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm install pm2 -g &amp;&amp; npm i cross-env &amp;&amp; npm i nodemon</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> [<span class="token string">&quot;/low-code-node-app&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 9991</span>
<span class="token instruction"><span class="token keyword">CMD</span> npm run pm2:prod</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>使用命令构建 docker 镜像:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker image build -t low-code-node .
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>构建容器：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker container run -d -p 9991:9991 -it low-code-node /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="二、使用docker-卷-volumes-挂载数据"><a href="#二、使用docker-卷-volumes-挂载数据" class="header-anchor">#</a> 二、<strong>使用Docker 卷（Volumes）挂载数据</strong></h4> <ul><li><p>卷（Volumes）是什么？</p> <ul><li>Docker 卷提供了一种方便的机制来持久化、共享和管理容器中的数据，使数据在容器之间和容器的生命周期之外仍然可用。</li></ul></li> <li><p>卷有什么作用？</p> <ul><li><strong>数据持久化</strong>：Docker 卷可以用于持久化容器中的数据。容器中的文件系统层是临时的，当容器被删除时，文件系统的更改也会丢失。通过将卷挂载到容器中，可以将数据存储到主机上的卷中，使数据在容器重新启动或删除后仍然可访问。</li> <li><strong>数据共享</strong>：卷可以在多个容器之间共享数据。通过将同一卷挂载到多个容器中，这些容器可以访问相同的数据，实现容器之间的数据共享和通信。</li> <li><strong>数据备份和恢复</strong>：通过将卷挂载到主机上的特定位置，可以轻松备份和恢复数据。这使得在容器升级、迁移或重新创建时，可以方便地恢复数据。</li> <li><strong>数据共享与主机解耦</strong>：使用卷可以将容器的数据与特定主机解耦。这意味着可以更轻松地迁移容器和应用程序到其他主机，而不需要担心数据的位置和依赖关系。</li> <li><strong>数据管理</strong>：Docker 提供了一套命令和工具，可以方便地管理和操作卷，如创建、删除、列出和备份等。</li></ul></li> <li><p>使用卷：</p> <ul><li><p>使用 <code>docker volume create</code> 命令创建卷：(low-code-node 应用程序将其数据存储在 /temp 容器文件系统)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker volume create low-code-node 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动 low-code-node 应用程序容器，但添加--mount指定卷安装的选项。为卷命名，并将其安装到 /temp 容器中，该容器捕获在该路径中创建的所有文件。</p> <ul><li>在 Mac 或 Linux 终端中，或者在 Windows 命令提示符或 PowerShell 中，运行以下命令：<code>docker run -dp 9991:9991 --mount type=volume,src=low-code-node,target=/temp low-code-node</code> ( 该-d标志（ 的缩写--detach）在后台运行容器。该-p标志（ 的缩写--publish）在主机和容器之间创建端口映射。该-p标志采用 格式的字符串值HOST:CONTAINER，其中HOST是主机上的地址，CONTAINER是容器上的端口。该命令将容器的端口 9991 发布到主机上的127.0.0.1:9991( )。localhost:9991 如果没有端口映射，您将无法从主机访问应用程序。)</li></ul></li> <li><p>绑定安装来运行开发容器：
<code>docker run -dp 9991:9991 -w /app --mount type=bind,src=$pwd,target=/app low-code-node</code></p> <ul><li>-dp 9991:9991 和之前一样。以分离（后台）模式运行并创建端口映射</li> <li>-w /app- 设置“工作目录”或命令将从中运行的当前目录</li> <li>--mount &quot;type=bind,src=$pwd,target=/app&quot;- 将当前目录从主机绑定挂载到/app容器中的目录</li></ul></li></ul></li></ul> <h4 id="三、使用-docker-compose-自动构建容器"><a href="#三、使用-docker-compose-自动构建容器" class="header-anchor">#</a> 三、<strong>使用 Docker Compose  自动构建容器</strong></h4> <ul><li><p>Docker Compose  是什么？</p> <ul><li>Docker Compose 是一个用于定义和管理多容器 Docker 应用程序的工具。它使用一个简单的 YAML 文件来配置应用程序的服务、网络和卷等方面的设置，并提供一组命令来启动、停止和管理这些容器。</li></ul></li> <li><p>作用：</p> <ul><li><strong>简化多容器应用程序的管理</strong>：在复杂的应用程序中，可能需要同时运行多个容器，例如前端应用、后端服务、数据库等。使用 Docker Compose，可以通过一个配置文件定义和管理这些容器，使得整个应用程序的部署和管理变得更加简单。</li> <li><strong>定义和维护应用程序的环境</strong>：Docker Compose 允许你在配置文件中明确定义应用程序的服务、网络、卷和环境变量等设置。这样可以确保在不同环境中（如开发、测试、生产）具有一致的部署和运行结果，避免了手动配置的错误和差异。</li> <li><strong>快速启动和停止容器</strong>：使用 Docker Compose，可以通过一个命令一次性启动或停止整个应用程序的所有容器。这对于开发、测试和调试应用程序非常有用，可以节省时间和精力。</li> <li><strong>容器间的依赖管理</strong>：在多容器应用程序中，容器之间可能存在依赖关系，例如一个容器需要依赖于数据库容器。Docker Compose 允许你定义这些依赖关系，确保容器按正确的顺序启动和连接，简化了容器间的管理和通信。</li> <li><strong>可扩展性和重用性</strong>：Docker Compose 配置文件是可扩展和可重用的。你可以根据需要添加、修改或删除容器和服务，以适应不同的应用程序需求。此外，你可以将 Docker Compose 配置文件与代码存储在版本控制系统中，方便团队协作和代码复用。</li></ul></li> <li><p>使用 docker compose 管理 docker:</p> <ul><li><p>创建 <code>docker-compose.yml</code> 文件，输入以下内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">low-code-node</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9991<span class="token punctuation">:</span><span class="token number">9991</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./<span class="token punctuation">:</span>/app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>使用命令自动构建 docker 镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul> <h3 id="发布脚本"><a href="#发布脚本" class="header-anchor">#</a> 发布脚本</h3> <ul><li><p>发布流程： 构建并打包 docker 镜像 -&gt;  上传 docker 镜像 -&gt; 解压 docker 镜像</p></li> <li><p>发布脚本目录：在 <code>/deploy</code> 目录下保存所有发布相关脚本</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>├── deploy
│  ├── build  构建 docker 脚本
│  ├── config 文件上传配置
│  ├── deploy.sh 构建 docker bash 脚本
│  ├── serverConfig   ftp 文件上传配置
│  ├── upload  文件上传脚本
│  └── users   ftp 上传用户信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>注意:  ftp 上传用户信息 文件不上传到git仓库中，在本地中存储，避免 ftp 用户账号密码泄露</p></blockquote></li></ul> <h4 id="构建打包-docker"><a href="#构建打包-docker" class="header-anchor">#</a> 构建打包 docker</h4> <ul><li><p>在 <code>/deploy/deploy.sh</code> 目录中存在构建打包 docker 镜像 bash 脚本：</p> <blockquote><p>总流程：</p> <ol><li>检查 GIT 仓库并初始化；</li> <li>同步远程仓库代码；</li> <li>构建 docker ；</li> <li>打包 docker</li></ol></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/sh</span>

<span class="token comment"># 检查当前目录是否为 Git 仓库</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> .git <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;当前目录不是 Git 仓库&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;正在初始化 Git 仓库...&quot;</span>
  <span class="token function">git</span> init
<span class="token keyword">fi</span>

<span class="token comment"># 设置远程仓库和拉取远程分支代码</span>
<span class="token assign-left variable">remote</span><span class="token operator">=</span><span class="token string">&quot;mygit&quot;</span>
<span class="token assign-left variable">branch</span><span class="token operator">=</span><span class="token string">&quot;low-code-node&quot;</span>
<span class="token assign-left variable">remote_repository_url</span><span class="token operator">=</span><span class="token string">&quot;https://gitee.com/jokerxw/low-code-node.git&quot;</span>


<span class="token comment"># 检查远程仓库是否已设置</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">git</span> remote <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">&quot;<span class="token variable">$remote</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;远程仓库未配置，配置远程仓库...&quot;</span>
  <span class="token function">git</span> remote <span class="token function">add</span> <span class="token string">&quot;<span class="token variable">$remote</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$remote_repository_url</span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># 拉取远程分支代码</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;同步修改...&quot;</span>
<span class="token function">git</span> pull <span class="token string">&quot;<span class="token variable">$remote</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$branch</span>&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;docker 构建镜像...&quot;</span>
nvm use <span class="token number">14.17</span>.5
<span class="token function">docker</span> image build <span class="token parameter variable">-t</span> low-code-node <span class="token builtin class-name">.</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;docker 保存镜像...&quot;</span>
<span class="token function">docker</span> save  low-code-node <span class="token operator">&gt;</span> ./package/lowcode.tar


<span class="token comment"># 检查拉取是否成功</span>
<span class="token comment"># if [ $? -eq 0 ]; then</span>
<span class="token comment">#   echo &quot;远程仓库同步成功.&quot;</span>
<span class="token comment">#   pm2 restart low-code-node</span>
<span class="token comment"># else</span>
<span class="token comment">#   echo &quot;远程仓库同步失败.&quot;</span>
<span class="token comment"># fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></li></ul> <h4 id="上传-docker-镜像"><a href="#上传-docker-镜像" class="header-anchor">#</a> 上传 docker 镜像</h4> <ul><li><p>使用 <code>ftp-deploy</code> 上传 docker 镜像，<code>ftp-deploy</code>  为异步上传文件，这里对 异步上传文件使用 <code>promise</code> 封装：</p> <ul><li><p>上传文件： <code>/deploy/upload.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> FtpDeploy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ftp-deploy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ftpDeploy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FtpDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DeployConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 上传文件
 * @param {*} config 
 * @returns 
 */</span>
<span class="token keyword">function</span> <span class="token function">uploadToFtp</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        ftpDeploy<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'上传成功!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 上传文件函数
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> DeployConfig<span class="token punctuation">.</span><span class="token function">getFtpDeployConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">uploadToFtp</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    upload
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></li> <li><p>ftp 文件上传配置： <code>/deploy/serverConfig.js</code></p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * ===========================
 *  ftp 文件上传配置
 * ===========================
 */</span>
<span class="token comment">// const OUTPUT_DIR = require(&quot;../build/constant.ts&quot;).OUTPUT_DIR;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token comment">//获取上传配置信息</span>
<span class="token keyword">const</span> <span class="token function-variable function">getConfig</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    users <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./users.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户信息文件不存在 '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> users<span class="token operator">?.</span>user<span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> users<span class="token operator">?.</span>password<span class="token punctuation">,</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">production</span><span class="token operator">:</span> <span class="token string">&quot; &quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token number">2021</span><span class="token punctuation">,</span>
      <span class="token literal-property property">production</span><span class="token operator">:</span> <span class="token number">2021</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">localRoot</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../package</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">remoteRoot</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 远程静态资源文件路径</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>
      <span class="token literal-property property">production</span><span class="token operator">:</span> <span class="token string">' '</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


module<span class="token punctuation">.</span>exports <span class="token operator">=</span> getConfig

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><ul><li><p>文件上传配置: <code>/deploy/config</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * ===========================
 * 文件上传配置
 * ===========================
 */</span>

<span class="token keyword">const</span> deployConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./serverConfig.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取执行脚本的 NODE_ENV值</span>
<span class="token keyword">const</span> <span class="token function-variable function">getNODE_ENV</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_lifecycle_script<span class="token punctuation">;</span>
  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&quot;NODE_ENV=([a-z_\\d]+)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">getFtpDeployConfig</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getFtpDeployConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">deployConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> config<span class="token punctuation">.</span>user<span class="token punctuation">[</span><span class="token function">getNODE_ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 服务器登录账号</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> config<span class="token punctuation">.</span>password<span class="token punctuation">[</span><span class="token function">getNODE_ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 服务器密码</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> config<span class="token punctuation">.</span>host<span class="token punctuation">[</span><span class="token function">getNODE_ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 服务器地址</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> config<span class="token punctuation">.</span>port<span class="token punctuation">[</span><span class="token function">getNODE_ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ftp的服务器端口</span>
    <span class="token literal-property property">localRoot</span><span class="token operator">:</span> config<span class="token punctuation">.</span>localRoot<span class="token punctuation">,</span> <span class="token comment">// 上传的文件</span>
    <span class="token literal-property property">remoteRoot</span><span class="token operator">:</span> config<span class="token punctuation">.</span>remoteRoot<span class="token punctuation">[</span><span class="token function">getNODE_ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 远程服务器文件存储路径</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'**/*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 这将上传除了点文件之外的所有文件</span>
    <span class="token comment">// 排除sourcemaps和node_modules中的所有文件</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dist/**/*.map&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules/**/.*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.git/**&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">deleteRemote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果为true，则在上传前删除目的地的所有现有文件</span>
    <span class="token literal-property property">forcePasv</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 主动模式/被动模式</span>
    <span class="token literal-property property">sftp</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 使用 sftp协议 或 ftp协议</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div></li></ul></li></ul> <h4 id="解压-docker-镜像"><a href="#解压-docker-镜像" class="header-anchor">#</a> 解压 docker 镜像</h4> <ul><li><p>此处解压 docker 镜像中，后端使用 php 调用 bash 执行解压命令，并启动一个解压 docker 服务，因此此处仅调用该服务并监听返回结果即可：此处使用 axios 请求解压 docker 镜像服务</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 解压 docker 包
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">decompress</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">' '</span><span class="token comment">//远程解压 docker 镜像服务地址</span>
    <span class="token comment">// 使用 axios 发送 GET 请求  </span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 服务器文件解成功！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 服务器文件解失败！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul> <h4 id="总流程-2"><a href="#总流程-2" class="header-anchor">#</a> 总流程</h4> <ul><li><p>发布脚本总流程在 <code>/deploy/index.js</code> 中进行发布：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">const</span> <span class="token punctuation">{</span> build <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./build.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> upload <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./upload.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 解压 docker 包
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">decompress</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">// 使用 axios 发送 GET 请求  </span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 服务器文件解成功！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 服务器文件解失败！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 发布脚本
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">deploy</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 自动打包中...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 打包完成！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 文件上传中...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 文件上传完成！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'docker 服务器文件解压中...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">decompress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></li></ul> <h3 id="使用-webhook-推送通知构建"><a href="#使用-webhook-推送通知构建" class="header-anchor">#</a> 使用 webhook 推送通知构建</h3> <ol><li>使用 docker 构建 node 镜像并部署；</li> <li>使用  docker 卷挂载文件</li> <li>使用 webhook 推送分支推送任务：通过 git 推送指定分支代码到 gitee / gogs 仓库后， gitee / gogs  通过 wehook 推送任务到部署程序中，部署服务接受到 gitee / gogs 的 webhook 最新通知后， 执行 bash 脚本，拉取最新代码，并重新启动服务。</li> <li>使用 pm2 重新启动 node 进程</li></ol> <h4 id="部署流程"><a href="#部署流程" class="header-anchor">#</a> 部署流程</h4> <ul><li><p>通过以上步骤，构建 docker 镜像；</p></li> <li><p>编写 webhook 服务：</p> <ul><li><p>监听 webhook 推送任务：在路由中，新增 webhook 推送路由；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use strict'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> webhook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../../deploy/webhook'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> router</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/goview/deploy/wehook'</span><span class="token punctuation">,</span> webhook<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> router
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>gitee / gogs 仓库中配置 webhook 地址；</p></li> <li><p>webhook 任务接受脚本：验证 webhook 推送签名，并执行 bash 脚本</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * webhook  自动部署测试 
 */</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> verify_signature <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./gogs-signature.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cross-spawn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deployScriptPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'deploy.sh'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">webhook</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">verify_signature</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           
            res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
                <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'webhook 签名错误'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>


        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'====自动部署===='</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> deployProcess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>deployScriptPath<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">shell</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deployProcess<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        deployProcess<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        deployProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">exec error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        deployProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child process exited with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        res<span class="token punctuation">.</span><span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'操作成功'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
            <span class="token literal-property property">msg</span><span class="token operator">:</span> error<span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> error
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    webhook
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div></li> <li><p>bash 脚本： 拉取最新代码，并重新启动 pm2</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#!/bin/sh

# 检查当前目录是否为 Git 仓库
if [ ! -d .git ]; then
  echo &quot;当前目录不是 Git 仓库&quot;
  echo &quot;正在初始化 Git 仓库...&quot;
  git init
fi

# 设置远程仓库和拉取远程分支代码
remote=&quot;origin&quot;
branch=&quot;low-code-node&quot;
remote_repository_url=&quot;http://szmoka.tclking.com:8081/xuwen/low-code-node.git&quot;


# 检查远程仓库是否已设置
if ! git remote | grep -q &quot;$remote&quot;; then
  echo &quot;远程仓库未配置，配置远程仓库...&quot;
  git remote add &quot;$remote&quot; &quot;$remote_repository_url&quot;
fi

# 拉取远程分支代码
echo &quot;同步修改...&quot;
git pull &quot;$remote&quot; &quot;$branch&quot;

# 检查拉取是否成功
if [ $? -eq 0 ]; then
  echo &quot;远程仓库同步成功.&quot;
  pm2 restart low-code-node
else
  echo &quot;远程仓库同步失败.&quot;
fi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li></ul></li></ul> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">docker 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener noreferrer">docker 教程(阮一峰)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.w3cschool.cn/reqsgr/" target="_blank" rel="noopener noreferrer">Docker 从入门到实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://pm2.fenxianglu.cn/docs/start/" target="_blank" rel="noopener noreferrer">pm2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">January 22, 2024 14:49</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 596777598@qq.com" class="contributor">
          sewar
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/myblog/assets/js/app.9d2b617a.js" defer></script><script src="/myblog/assets/js/layout-Layout.d2d4ce64.js" defer></script><script src="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js" defer></script><script src="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" defer></script>
  </body>
</html>
