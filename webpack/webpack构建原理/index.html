<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebPack 构建原理 | Sewen 博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="./mylogo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="manifest" href="/myblog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://sewar-x.github.io/myblog/atom.xml" title="Sewen 博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 RSS Feed">
    <meta name="description" content="sewen 的前端学习笔记、博客、前端基础总结、技术深度剖析、面试题总结、算法总结、项目过程总结">
    <meta property="og:url" content="https://sewar-x.github.io/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86.html">
    <meta property="og:site_name" content="Sewen 博客">
    <meta property="og:title" content="WebPack 构建原理">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.645fbc6f.css" as="style"><link rel="preload" href="/myblog/assets/js/app.9d2b617a.js" as="script"><link rel="preload" href="/myblog/assets/js/layout-Layout.d2d4ce64.js" as="script"><link rel="preload" href="/myblog/assets/js/page-WebPack构建原理.9c29703e.js" as="script"><link rel="preload" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" as="script"><link rel="prefetch" href="/myblog/assets/js/199.a9216960.js"><link rel="prefetch" href="/myblog/assets/js/200.4c66fc79.js"><link rel="prefetch" href="/myblog/assets/js/layout-Blog.1fca7e90.js"><link rel="prefetch" href="/myblog/assets/js/layout-NotFound.3c74e8aa.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/AlgoliaSearch/Dropdown.70fcebe7.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Anchor.3235541c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleInfo.7b815b20.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleItem.b0e177e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleList.d1cf1b24.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleType.b630b80e.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHero.621312ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHome.4fe44489.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogInfo.b2a94760.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogPage.e0fbe820.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BloggerInfo.0df38355.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/CategoryList.ec1bcd96.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ProjectList.8550a110.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TagList.bcf7b782.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/Timeline.b6cf5471.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TimelineList.3c6e08a6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Clipboard.e940a903.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Common.820a8694.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Home.70383986.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/MyTransition.0de46069.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/DropdownLink.e3f6c118.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLink.93b11770.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLinks.8ba214e6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/Navbar.b90a94f9.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/RepoLink.663a7f55.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/SidebarButton.76b0035a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Page.98b5d09c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageFooter.20bc9bd8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageMeta.b7e6b12f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageNav.8305dd1f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Password.45e0e82a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/DropdownTransition.068c5eea.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/Sidebar.f6f90d52.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarDropdownLink.505127a8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarGroup.7eecf370.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarLink.6e39fe32.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarNavLinks.0f8566cb.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/DarkmodeSwitch.20ac7b92.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeColor.6086e4ed.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeOptions.483238c9.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ArticleIcon.0a22e2b1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/AutoIcon.2ff1c790.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/BookIcon.419b49ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/DarkIcon.7d81873b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EditIcon.8ada485d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EmptyIcon.d704a5cf.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/I18nIcon.ffad8b3e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LightIcon.47d807da.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LinkIcon.1a8a7826.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LockIcon.a29a2b79.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/NextIcon.0214ee59.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/Page404Icon.8bc1ebbb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PresentationIcon.17500d9b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PrevIcon.2ae04a70.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ProjectIcon.b336d567.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/StickyIcon.0f509b9d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Baidu.244b9a41.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Bitbucket.11ba94e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dingding.e8a3d90d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Discord.3295a55b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dribbble.464dac3b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Email.f9254caa.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Evernote.991472fb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Facebook.08e78e47.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Flipboard.a1124d0f.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitee.c44bc20a.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Github.5667e5ae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitlab.ad95c7a7.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gmail.b5acc6bc.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Instagram.56be85f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Lines.d9db3dce.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Linkedin.b82d8d8b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pinterest.0f3ffe71.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pocket.41ef3c92.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/QQ.7558f4ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Qzone.bf658fae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Reddit.9c4c95ee.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Rss.9780139e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Steam.06abbae2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Twitter.26fa5bda.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Wechat.9cac8c4c.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Weibo.5206a632.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Whatsapp.0738f1e3.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Youtube.f41fd7f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Zhihu.4d851d2f.js"><link rel="prefetch" href="/myblog/assets/js/page--0abc50bf.0d6f1484.js"><link rel="prefetch" href="/myblog/assets/js/page--1cd40f4c.dd76c7b3.js"><link rel="prefetch" href="/myblog/assets/js/page--53f93199.e80bdec8.js"><link rel="prefetch" href="/myblog/assets/js/page--5afd2fd0.adea4e92.js"><link rel="prefetch" href="/myblog/assets/js/page--67c584d3.0a3f3cd9.js"><link rel="prefetch" href="/myblog/assets/js/page--776a8506.cdf48aac.js"><link rel="prefetch" href="/myblog/assets/js/page-CSS.eb94b29f.js"><link rel="prefetch" href="/myblog/assets/js/page-Chrome开发工具使用指南.a2675120.js"><link rel="prefetch" href="/myblog/assets/js/page-DevServer.0281863d.js"><link rel="prefetch" href="/myblog/assets/js/page-Echarts二次封装.4387b8ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Elementui与Element-plusui二次封装.82f12a09.js"><link rel="prefetch" href="/myblog/assets/js/page-Git基础.03c616ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Git规范.e2fdc38a.js"><link rel="prefetch" href="/myblog/assets/js/page-HTML.1e3c14b9.js"><link rel="prefetch" href="/myblog/assets/js/page-Home.f0b7e772.js"><link rel="prefetch" href="/myblog/assets/js/page-JSON配置化组件二次封装.12060fd9.js"><link rel="prefetch" href="/myblog/assets/js/page-JS原理实现.3c427e19.js"><link rel="prefetch" href="/myblog/assets/js/page-JS应用题.3d313b34.js"><link rel="prefetch" href="/myblog/assets/js/page-JavaScript基础.551be887.js"><link rel="prefetch" href="/myblog/assets/js/page-Linux.c6159ebd.js"><link rel="prefetch" href="/myblog/assets/js/page-Loader和Plugin原理.b2971b76.js"><link rel="prefetch" href="/myblog/assets/js/page-MySQL.0b1d704a.js"><link rel="prefetch" href="/myblog/assets/js/page-NPM.a55851b2.js"><link rel="prefetch" href="/myblog/assets/js/page-Node.ec405a21.js"><link rel="prefetch" href="/myblog/assets/js/page-Nodejs常见问题集合.12844e69.js"><link rel="prefetch" href="/myblog/assets/js/page-Node性能优化.b4ea1c34.js"><link rel="prefetch" href="/myblog/assets/js/page-Promise专题.7869a31b.js"><link rel="prefetch" href="/myblog/assets/js/page-React.d76cf0ac.js"><link rel="prefetch" href="/myblog/assets/js/page-SSG移动端项目实践.2122615b.js"><link rel="prefetch" href="/myblog/assets/js/page-TypeScript.4f597fda.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite.637881bf.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite原理解析.6677fdb4.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue25项目webpack构建分析.7bbea0fa.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2VsVue3.10be4140.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2x原理源码分析.e9e753b6.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3基础.210247ff.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3源码分析.17379e04.js"><link rel="prefetch" href="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js"><link rel="prefetch" href="/myblog/assets/js/page-VueRouter原理分析.0a092eb6.js"><link rel="prefetch" href="/myblog/assets/js/page-VueSSR原理分析.63006040.js"><link rel="prefetch" href="/myblog/assets/js/page-VueVsReact.2156be28.js"><link rel="prefetch" href="/myblog/assets/js/page-Vuex原理分析.5ba3e6e4.js"><link rel="prefetch" href="/myblog/assets/js/page-WEB安全.5aa0eeef.js"><link rel="prefetch" href="/myblog/assets/js/page-webpackAPI分析.4c8b152b.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack优化.dcc6c3bc.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack基础.3820ee6c.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack项目实践.77e22417.js"><link rel="prefetch" href="/myblog/assets/js/page-一次后台管理系统的性能优化.7c2d8712.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建SSR项目.855376fc.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue2项目和规范设计.93017fd2.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue3单页面应用.de152d54.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建公共组件库.93278073.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js"><link rel="prefetch" href="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js"><link rel="prefetch" href="/myblog/assets/js/page-分治.e3dfc22d.js"><link rel="prefetch" href="/myblog/assets/js/page-前端发版静态资源404问题.9eb1ca89.js"><link rel="prefetch" href="/myblog/assets/js/page-前端存储.cd82cf54.js"><link rel="prefetch" href="/myblog/assets/js/page-前端工程化.1e6e58d0.js"><link rel="prefetch" href="/myblog/assets/js/page-前端性能优化方案.83718d22.js"><link rel="prefetch" href="/myblog/assets/js/page-前端架构实践.171dbc0f.js"><link rel="prefetch" href="/myblog/assets/js/page-前端渲染架构.3b783de8.js"><link rel="prefetch" href="/myblog/assets/js/page-前端自动部署.5076846c.js"><link rel="prefetch" href="/myblog/assets/js/page-前端部署原理.82ecd8a7.js"><link rel="prefetch" href="/myblog/assets/js/page-动态规划.a3af92f1.js"><link rel="prefetch" href="/myblog/assets/js/page-哈希表.c76000e8.js"><link rel="prefetch" href="/myblog/assets/js/page-回溯算法.cd914c32.js"><link rel="prefetch" href="/myblog/assets/js/page-图.dfd9828a.js"><link rel="prefetch" href="/myblog/assets/js/page-基础.7bf5a37b.js"><link rel="prefetch" href="/myblog/assets/js/page-堆.4657e538.js"><link rel="prefetch" href="/myblog/assets/js/page-字符串.252f2a08.js"><link rel="prefetch" href="/myblog/assets/js/page-异步编程.904f4c65.js"><link rel="prefetch" href="/myblog/assets/js/page-性能优化指标和监控.f2175836.js"><link rel="prefetch" href="/myblog/assets/js/page-排序算法.c7a51b99.js"><link rel="prefetch" href="/myblog/assets/js/page-搭建低代码平台.19eaf5ec.js"><link rel="prefetch" href="/myblog/assets/js/page-操作系统.473c4281.js"><link rel="prefetch" href="/myblog/assets/js/page-数学运算.c82748fb.js"><link rel="prefetch" href="/myblog/assets/js/page-数据结构算法.84480586.js"><link rel="prefetch" href="/myblog/assets/js/page-数组.692b0d0a.js"><link rel="prefetch" href="/myblog/assets/js/page-权限管理.c7e10db0.js"><link rel="prefetch" href="/myblog/assets/js/page-查找.790e52df.js"><link rel="prefetch" href="/myblog/assets/js/page-栈和队列.8dbc3586.js"><link rel="prefetch" href="/myblog/assets/js/page-树.24efdeaa.js"><link rel="prefetch" href="/myblog/assets/js/page-浏览器.bee9ec04.js"><link rel="prefetch" href="/myblog/assets/js/page-混合桌面应用开发.9e10d1c3.js"><link rel="prefetch" href="/myblog/assets/js/page-登录.bb830451.js"><link rel="prefetch" href="/myblog/assets/js/page-目录.c85b4d0b.js"><link rel="prefetch" href="/myblog/assets/js/page-移动端开发.56ac22ec.js"><link rel="prefetch" href="/myblog/assets/js/page-组件和组件封装.b5e86da2.js"><link rel="prefetch" href="/myblog/assets/js/page-计算机网络基础.0a106662.js"><link rel="prefetch" href="/myblog/assets/js/page-设计模式.ffdc7cfd.js"><link rel="prefetch" href="/myblog/assets/js/page-调试技巧.485ae36e.js"><link rel="prefetch" href="/myblog/assets/js/page-贪心算法.0f417640.js"><link rel="prefetch" href="/myblog/assets/js/page-输入url到页面展示全过程.510aef2e.js"><link rel="prefetch" href="/myblog/assets/js/page-递归.5e55e552.js"><link rel="prefetch" href="/myblog/assets/js/page-链表.1cf6927f.js"><link rel="prefetch" href="/myblog/assets/js/page-项目总结.ffcd2a4b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~docsearch.f3877d0d.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~5d377965.d9712593.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-components/Blog/ArticleItem~layout-components/Blog/ArticleL~b56f3aac.47bb5cb5.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-NotFound~layout-components/Common~layout-components/Page.57d58db9.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Slide.81546b3b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/AlgoliaSearch/Full.b30f067a.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Blog/BlogPage.bcccbd38.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Navbar/Navbar.e2a7361e.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Page.6c65077c.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Sidebar/Sidebar.34cd9cf7.js"><link rel="prefetch" href="/myblog/assets/js/vendors~photo-swipe.428df1da.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.645fbc6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/myblog/" class="home-link router-link-active"><img src="./mylogo.png" alt="Sewen 博客" class="logo"> <!----> <span class="site-name can-hide">Sewen 博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
        前端基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><a href="/myblog/webpack/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><a href="/myblog/webpack/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><a href="/myblog/webpack/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
        计算机基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><a href="/myblog/webpack/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><a href="/myblog/webpack/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><a href="/myblog/webpack/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><a href="/myblog/webpack/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/myblog/webpack/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
        框架和源码分析
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><a href="/myblog/webpack/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><a href="/myblog/webpack/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><a href="/myblog/webpack/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><a href="/myblog/webpack/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
        浏览器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><a href="/myblog/webpack/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><a href="/myblog/webpack/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
        服务器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><a href="/myblog/webpack/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><a href="/myblog/webpack/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><a href="/myblog/webpack/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><a href="/myblog/webpack/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
        性能优化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><a href="/myblog/webpack/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><a href="/myblog/webpack/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
        前端工程
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><a href="/myblog/webpack/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><a href="/myblog/webpack/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><a href="/myblog/webpack/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><a href="/myblog/webpack/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
        项目实践
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><a href="/myblog/webpack/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
        项目搭建
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><a href="/myblog/webpack/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="./mylogo.png" class="avatar round"> <div property="name" class="name">Sewen 博客</div> <meta property="url" content="../outline.md"></div> <div class="num-wrapper"><div><div class="num">91</div> <div>Articles</div></div> <div><div class="num">0</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">91</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/Sewar-x/myblog" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="1567910907" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up" class="media-link"><span class="sr-only">Wechat</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E"></circle> <path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#FFF"></path> <path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
      前端基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
      计算机基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
      框架和源码分析
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
      浏览器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
      服务器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
      性能优化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
      前端工程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
      项目实践
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
      项目搭建
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><!----> <a href="/myblog/webpack/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/" aria-current="page" class="active sidebar-link">WebPack 构建原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#webpack-基础配置项" class="sidebar-link">webpack 基础配置项</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#webpack-构建示例" class="sidebar-link">WebPack 构建示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#使用方式" class="sidebar-link heading3">使用方式</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#区别" class="sidebar-link heading3">区别</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#使用-webpack-核心对象构建" class="sidebar-link heading3">使用 webpack 核心对象构建</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#webpack-构建流程" class="sidebar-link">Webpack 构建流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#构建执行总流程" class="sidebar-link heading3">构建执行总流程</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#函数调用流程" class="sidebar-link heading3">函数调用流程</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#初始化流程" class="sidebar-link heading3">初始化流程</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#编译流程" class="sidebar-link heading3">编译流程</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#输出流程" class="sidebar-link heading3">输出流程</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#构建函数流程图" class="sidebar-link heading3">构建函数流程图</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#常见问题" class="sidebar-link heading3">常见问题</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#参考资料" class="sidebar-link heading3">参考资料</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#手动实现打包器" class="sidebar-link">手动实现打包器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#打包流程" class="sidebar-link heading3">打包流程</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#核心步骤" class="sidebar-link heading3">核心步骤</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#打包器流程图" class="sidebar-link heading3">打包器流程图</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#实现代码" class="sidebar-link heading3">实现代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#参考资料-2" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/" class="sidebar-link">Loader和Plugin原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#loader" class="sidebar-link">Loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#loader-是什么" class="sidebar-link heading3">Loader 是什么？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#为什么要-loader" class="sidebar-link heading3">为什么要 Loader?</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#loader-怎么用" class="sidebar-link heading3">Loader 怎么用？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#loader-特性" class="sidebar-link heading3">Loader 特性</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#loader-原理" class="sidebar-link heading3">Loader 原理？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#常见-loader" class="sidebar-link heading3">常见 Loader</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#手写-loader" class="sidebar-link heading3">手写 Loader</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#参考资料" class="sidebar-link heading3">参考资料</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#plugin" class="sidebar-link">Plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#plugin-是什么" class="sidebar-link heading3">Plugin 是什么？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#为什么要-plugin" class="sidebar-link heading3">为什么要 Plugin?</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#plugin-怎么用" class="sidebar-link heading3">Plugin 怎么用？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#plugin-原理" class="sidebar-link heading3">Plugin 原理？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#plugin-常用-api" class="sidebar-link heading3">Plugin 常用 API</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#手写-plugin" class="sidebar-link heading3">手写 Plugin</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#常见的-plugin" class="sidebar-link heading3">常见的 Plugin</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Loader%E5%92%8CPlugin%E5%8E%9F%E7%90%86/#plugin-与-loader-区别" class="sidebar-link">Plugin 与 Loader 区别？</a></li></ul></li><li><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/" class="sidebar-link">DevServer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#devserver-是什么" class="sidebar-link">DevServer 是什么</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#devserver-功能" class="sidebar-link">DevServer 功能</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#使用-devserver" class="sidebar-link">使用 DevServer</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#devserver-原理" class="sidebar-link">DevServer 原理</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#webpack-dev-middleware-原理" class="sidebar-link">`webpack-dev-middleware` 原理</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#webpack-proxy" class="sidebar-link">WebPack proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#是什么" class="sidebar-link heading3">是什么？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#为什么" class="sidebar-link heading3">为什么？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#怎么用" class="sidebar-link heading3">怎么用？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#解决跨域原理" class="sidebar-link heading3">解决跨域原理</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#代理原理" class="sidebar-link heading3">代理原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#devserver-实时预览功能" class="sidebar-link">DevServer 实时预览功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#监听模式" class="sidebar-link heading3">监听模式</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#模块热替换" class="sidebar-link heading3">模块热替换</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#source-map" class="sidebar-link">Source Map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#是什么-2" class="sidebar-link heading3">是什么？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#为什么需要-sourcemap" class="sidebar-link heading3">为什么需要 SourceMap？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#怎么用-2" class="sidebar-link heading3">怎么用？</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#如何选择devtool-配置项" class="sidebar-link heading3">如何选择Devtool 配置项</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/DevServer%E5%8E%9F%E7%90%86/#加载现有的-source-map" class="sidebar-link heading3">加载现有的 Source Map</a></li></ul></li></ul></li><li><a href="/myblog/webpack/webpack%E4%BC%98%E5%8C%96/" class="sidebar-link">webpack优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E4%BC%98%E5%8C%96/#总览" class="sidebar-link">总览</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpack%E4%BC%98%E5%8C%96/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/webpack/webpackAPI%E5%88%86%E6%9E%90/" class="sidebar-link">webpackAPI分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/webpackAPI%E5%88%86%E6%9E%90/#webpack-模块方法" class="sidebar-link">webpack 模块方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/webpackAPI%E5%88%86%E6%9E%90/#require-context" class="sidebar-link heading3">require.context</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/webpack/webpackAPI%E5%88%86%E6%9E%90/#参考" class="sidebar-link">参考</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/webpack/webpack%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/" class="sidebar-link">webpack项目实践</a></li><li><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/" class="sidebar-link">Vue2.5 项目 webpack 构建分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#技术栈" class="sidebar-link">技术栈</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#源码分析" class="sidebar-link">源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#构建命令" class="sidebar-link heading3">构建命令</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#webpack-目录分析" class="sidebar-link heading3">WebPack 目录分析</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#构建入口分析" class="sidebar-link heading3">构建入口分析</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#检查版本文件分析" class="sidebar-link heading3">检查版本文件分析</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#工具脚本文件分析" class="sidebar-link heading3">工具脚本文件分析</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#webpack-基础配置" class="sidebar-link heading3">WebPack 基础配置</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#webpack-开发配置" class="sidebar-link heading3">Webpack 开发配置</a></li><li class="sidebar-sub-header"><a href="/myblog/webpack/Vue2.5%E9%A1%B9%E7%9B%AEwebpack%E5%88%86%E6%9E%90/#webpack-生产配置" class="sidebar-link heading3">WebPack 生产配置</a></li></ul></li></ul></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/myblog/webpack/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">目录</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">WebPack 构建原理</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">WebPack 构建原理</span></h1> <div class="page-info"><!----> <true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#webpack-基础配置项" class="anchor-link heading2"><div>webpack 基础配置项</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#webpack-构建示例" class="anchor-link heading2"><div>WebPack 构建示例</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#使用方式" class="anchor-link heading3"><div>使用方式</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#区别" class="anchor-link heading3"><div>区别</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#使用-webpack-核心对象构建" class="anchor-link heading3"><div>使用 webpack 核心对象构建</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#webpack-构建流程" class="anchor-link heading2"><div>Webpack 构建流程</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#构建执行总流程" class="anchor-link heading3"><div>构建执行总流程</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#函数调用流程" class="anchor-link heading3"><div>函数调用流程</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#初始化流程" class="anchor-link heading3"><div>初始化流程</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#编译流程" class="anchor-link heading3"><div>编译流程</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#输出流程" class="anchor-link heading3"><div>输出流程</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#构建函数流程图" class="anchor-link heading3"><div>构建函数流程图</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#常见问题" class="anchor-link heading3"><div>常见问题</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#参考资料" class="anchor-link heading3"><div>参考资料</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#手动实现打包器" class="anchor-link heading2"><div>手动实现打包器</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#打包流程" class="anchor-link heading3"><div>打包流程</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#核心步骤" class="anchor-link heading3"><div>核心步骤</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#打包器流程图" class="anchor-link heading3"><div>打包器流程图</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#实现代码" class="anchor-link heading3"><div>实现代码</div></a></li><li class="anchor"><a href="/myblog/webpack/webpack%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86/#参考资料-2" class="anchor-link heading2"><div>参考资料</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="webpack-构建原理"><a href="#webpack-构建原理" class="header-anchor">#</a> WebPack 构建原理</h1> <p>[TOC]</p> <h2 id="webpack-基础配置项"><a href="#webpack-基础配置项" class="header-anchor">#</a> <strong>webpack 基础配置项</strong></h2> <ul><li><strong>Entry</strong>：入口，Webpack 执行构建的第一步将从 Entry 开始，可抽象成输入。</li> <li><strong>Module</strong>：模块，在 Webpack 里一切皆模块，一个模块对应着一个文件。Webpack 会从配置的 Entry 开始递归找出所有依赖的模块。</li> <li><strong>Chunk</strong>：代码块，code splitting 后的产物，也就是按需加载的分块，装载了不同的 module。
<ul><li>Chunk 是一系列文件的集合，一个 Chunk 中会包含这个 Chunk 的入口文件和入口文件依赖的文件，由多个module组合而成，用于代码合并与分割。</li></ul></li> <li><strong>Loader</strong>：模块转换器，用于把模块原内容按照需求转换成新内容。loader 间可以串行使用。</li> <li><strong>Plugin</strong>：扩展插件，在 Webpack 构建流程中的特定时机会广播出对应的事件，插件可以监听这些事件的发生，在特定时机做对应的事情。</li></ul> <p>module 和 chunk 的关系图：（Webpack会根据一定的规则将Module打包成一个Chunk，Chunk可以被进一步处理和优化，最终被合并成Bundle，下图中圆数字代表模块）</p> <p><img src="/myblog/assets/img/module和chunk的关系.abbd553b.png" alt="img"></p> <h2 id="webpack-构建示例"><a href="#webpack-构建示例" class="header-anchor">#</a> WebPack 构建示例</h2> <h3 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> <strong>使用方式</strong></h3> <p>使用 webpack 可以有两种方式：</p> <ol><li>使用 webpack-cli 构建；（使用参考官网或 <a href="https://webpack.wuhaolin.cn/1%E5%85%A5%E9%97%A8/1-3%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html" target="_blank" rel="noopener noreferrer">安装与使用 · 深入浅出 Webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li>使用 <code>webpack</code> 核心对象构建（通过 Node.js API 启动 Webpack）；</li></ol> <h3 id="区别"><a href="#区别" class="header-anchor">#</a> 区别</h3> <p>使用 webpack-cli 创建项目和使用直接使用 webpack 构建项目的主要区别在于: 配置文件和命令行工具的使用。</p> <ul><li><p>使用 webpack-cli 创建项目时，您可以使用 <code>webpack-cli</code> 命令行工具来生成一个基本的 webpack 项目结构，包括配置文件、入口文件、输出文件等。这个过程相对简单，只需要运行一次命令即可完成项目的初始化。在生成的配置文件中，您可以根据需要修改和扩展 webpack 的配置选项，以满足项目的需求。</p></li> <li><p>直接使用 webpack 构建项目需要手动编写 webpack 的配置对象，并执行相应的编译过程。这种方式需要更多的手动操作和配置工作，但对于一些特定的需求或项目结构，可能会更加灵活和可控。</p></li></ul> <h3 id="使用-webpack-核心对象构建"><a href="#使用-webpack-核心对象构建" class="header-anchor">#</a> <strong>使用 webpack 核心对象构建</strong></h3> <p>Webpack API  ： <code>webpack(config , callback);</code></p> <ul><li>如果不传 callback 回调函数，就会返回一个 Compiler 实例：<code>const compiler = webpack(config)</code>;</li> <li>如果传入 callbakc 不会返回任何参数：</li></ul> <p>使用方法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// Webpack 配置，和 webpack.config.js 文件一致</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">||</span> stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构建过程出错</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 成功执行完构建</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用示例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/** 
  * 使用方式： webpack(config , callback);
  * 传入webpack配置参数，webpack 将返回一个编译对象，该编译对象包含一个run 方法,run 方法将执行编译
**/</span> 
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">'./serve/App.vue'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">target</span><span class="token operator">:</span><span class="token string">'node'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&quot;commonjs&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">publicPath</span><span class="token operator">:</span><span class="token string">'/dist/'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>使用流程：</p> <ol><li>引入webpack: <code>const webpack = require('webpack')</code>；</li> <li>调用 webpack 并传入配置参数，webpack 将返回一个编译对象；</li> <li>调用编译对象的 run 方法,run 方法将执行编译。</li></ol></blockquote> <h2 id="webpack-构建流程"><a href="#webpack-构建流程" class="header-anchor">#</a> Webpack 构建流程</h2> <p>Webpack 的构建流程可以分为以下三大阶段：</p> <ol><li><strong>初始化</strong>：启动构建，读取与合并配置参数，加载 Plugin，实例化 Compiler。</li> <li><strong>编译</strong>：从 Entry 发出，针对每个 Module 串行调用对应的 Loader 去翻译文件内容，再找到该 Module 依赖的 Module，递归地进行编译处理。</li> <li><strong>输出</strong>：对编译后的 Module 组合成 Chunk，把 Chunk 转换成文件，输出到文件系统。</li></ol> <p>如果只执行一次构建，以上阶段将会按照顺序各执行一次。但在开启监听模式下，流程将变为如下：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVMAAAGfCAMAAADVv8GJAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAB+UExURUdwTDMzM2dnZ3h4eCcnJwAAABwcHJmZmZmZmQkJCQAAAFtbWzAwMAcHBwAAAAAAAAAAAAAAAAAAAAAAAAAAAJqamjo6OgAAAJmZmZKSkpmZmQAAAEdwTJeXl9nZ2ZeXlwAAAIuLi6Ghoa6urr+/v8vLyxoaGlBQUEJCQtTU1Mrzew0AAAAedFJOUwD9/v38WxrCv/w5/QrpsJ/LeZHVvVDixIbYpsEANpyQtr0AABLNSURBVHja7J0Jd6o8EIbLasOiILb2tqcYZZ3//we/SYKKLGqt3zmEznuvVFbLw5uZSWjLywuJRCKRSCQSiUQikUgkEolEIpFIJBKJRCKRSCQSiUQidbTTV9NlmuqqqTMFDSdTZgqaUp24T3W06bSZtr5PfQRTZtoiCuKrJpOpt30tjapH3pfT5gVTnwVd8v7pm748lQnOpnrk/Xbrh25CmNos6JP34dTEpm9UfeJp2xPTDah6+HTAqFMuTvGlS32qi01TLerTnk0nHU5Bg3iqXd6ffn3aDv0/zvtFBr21+b5Qs3l+sfGhSAt8XYbtmeb9fvf0/jjnc+h1wvY8V+MHhtG+Yjnz0wPPLj5lznm/b9Q7lfM9mtUWMvBVi2UmU+sO/NDmV7NCMf1lbQFa1qd32UX8L7KDXWdZ4fsVr33ft0uxe2WoLdCmYFbHIx+4lTY+Lar8PML0QN7Xsx91O6ypqMaFbOlXcX0qGytHsyxNcydWok33EqLYwSihYZobwty/CqdTr08f6++rwcwcVfoiWMp2XqFPzZKXJfehEMtTUOEADSugg2CalUekD+Z9TWqpB/L+UcqJCAukT6VlwTbTusQ0nx98FVRNLhMXbnZgbP/bSliDmv+xvN/ALysVBfLGpyDSPtv7vLQZBgbGRHS1eMlFDD1wk5WHX/bY9Bg/fTDvg2zTeWFk6FaRdKRPqxIKfthXprXfZYUMq3teqwILA3BdpOmvcv+88740oJHbRgEmE/O1jVOMoJmqUNUmGBr8Wro397lI/g/YFLoZdL55P91j82YGOs+QqajGdl4gNgtjwN5shGtzEXbzA+OGqvlhCOH1gf1OrprlOL/qbfLK9muWSZA4L5jmvAbDByzxZU/AbnpOe5YXPmLNbjTqsRGITgLVZfz0h3kfZJu2fahL2ClyRi1OlxmibqpVEZUdmR7zfofQj40KOtSnD/f3sSqF1PbTYocFvdxPFaPYxosLpqB8emQqSqv8Rx/Uvwwa3N9/uL8vmApUe7k7lvm4d854hXFg1Kci5h7u/yAY2nCeeb85V8EUDBsUPxlVjdLiZuNTyM7xtOlHyV5X9iObdtOaVvf3f9a7OfrUl519AF+iMrEgNVlRl6Zvmn7VdPiPPj2omeJHcbufQGd7f7/xqSnsmdV1yWtpRRNXZNDk/bLt0xRYWde1zW2494Mg7d9+nPX9fcXUMsVuflXJoZFMxdHhvJ9mPjKt/LwXwq8bVbf69OH7+wPOapu40+2CWxXp8AcNFaizvb8Po+GiN9zcZTZ2E2zsU+DP3N/vhAEYx9NaOrDjqE0HVs/7/v7pJ2xHYh6MVENjjXrwavaDwJzv78Pwj9z0nAodo8INm46FXOi4fZ739/sQYQhwB2PnI3pXYajp65j3H+nv94Ij9MJrj/4FJkjT4Rhw+QJ98/5P+/udkx3i0rVjfw+4a8B/MO/Prb8/4FO4GnZhNP/DqE1hODfN9P4+pL0QPBxhIR29YjCQvYYvDgz392d2f79/8tdLqrQVG6EHbJzcVZvO7f4+jP8E4xVnjXczIb1iVNAy7//8/v7ZmNcGAC58Cdfu1/VH8cd7sLO+vz9gHrjSatMr95VvDuzPO+9DL3nDwG+sDc1f6SQN2LRvbe1+/vTevJ8O9N1H7xv3Olpw26YwUHL1Z2c1zg/DNebwaEd6s3yAkZv3w0UW6PV7fHfn/cFqv/P2bqOmV4w6UlOBLuOnd+f9S14w8ru/dwdUGHHqMEvQ5Xd46W8h6aU/etrElJgSU0JATIkpMSURU2JKTEnElJgSUxIxJabElERMiSkxJRFTYkpMSTNiGjhBZ4mnFnheZ7HY0O1s63q9A7qxN7CR5wZ/h6nL1h123HkJEMByc8LuLpHlOlTrjnJWuJHD3N5FCjsHfFnhRl/Lv+TTmF/6ao0EBL8z05eYI76vjXwXHxd+JQIsPzN11lKrJFRv1g1/j+E+27/EFE93c8FY+DZZXjDdiLfKfs4RqsvXInC0mMaJEA+TJOTybbPlJhRXRDJ14pkzXTIl8XfcpJbKky7yil33a+uiRBQMBEe3afZx07Idvl2tVlu+kjoF5UBs1iaN4UHsKH3q8CSYN1Mnjrdh3Ihv4licuxtuxLmf5EgUy/VqiZN2m96wLSrkUSS+rlXc3TquYho4URNR3DCSkQKZrnnkzr/te8dYenLWkq+w6Uee40UJThyxON5GUcQYTpJIyDnHgI4jEw99Goil7lLaE5GKAwqfBku+Cf5CPD3G0k1zujFHBI4kvfzqhdlWtRAmL12mK74MWm0/Fnu4CWeS6dfXlq/Hkb59z4epwneqkVy2SlYiJQVdpp3qYMlVFdtmupYFbONTGVuCIGJeIi9GxEPnyvfx8e/f51swk7yfSKOuwiYWREG0aqr95eai6ORhyEIhsTJI4kB1GHg3QnruqScQoJ29F7xIL07Ckxuh9Pvjc7f4+J4+09cbWrxa/P311efm50LMocL3hVpj260Nfc5t3/ff/YjJDRcL610o5PLLuyX2tyLxR4yi5qUOuXhl7682D5nxeluLf+IHmafN9HV38zQ+fTzn8P3ztCA0Xt+bGisU04VaGr7zT5RYrfaz0LJlWHIxCRNLLnxPGsQCtnU84Pun77/a0R1IFwsNmL7esdGKRe2qUbR9WV1hzS4UNPE2CKNAdTNP8aCb97FLu1VN3F2eO7FJk/dvfBvfb69atP27mLqct3s30eqYhr5aWR5rTC9M3BV3OgMwnXgaJIkYMAnP2wWKqepHBZ6je466h6kTJljOu9eYBpFM+l7IuNOrGzqpJ1jxdcyTVpFw4dN1pHstdZspOm/lItdzoXNmujkXnmvpyZDzjXfdp3jEDedhe6u2T19Wdwyl6M3UW4dNb2fLt84Y01j0hAIsh5aumKgdGmHZ2rxTcdfBOnQdJ3wbn8ZLFVM5DIOBYD1vpjGef9zYLPC+uKo5e0wDgXSNHXtHjgxipRmLmr8rPN6GoZHlaIq3wrfbtXtmGvPtcrkMuTdvpstlKzoGL56CeGJ6aqaO3NY7NXexm+cc1bzD1fEy9s4FhOcsVy2f4m6olRPMve0/QzchBcEPj0hMny9iSkyJKTElpsSUmBJTYkpMiSkxJabElJgSU2JKTIkpMSWmxJSYElNi2uhNMn0jpk/U4huZfi+I6RP18YFMcUJMn6fvf8h08U1Mn5qhAvGPmD5Tn2+Htyl/2zoy/fjcfb4R06cq2O1238T0ydXU7h/V/M8OqLsPYvrsntTujZhSf580UaZ/+Hkn/x/TVFdNnCloOJk2Uy2JwtR9qiXWKTMFzeLo054b+b/6FE7PgdNgcqJKef/pNp162x9/iPEEZ7XI++n4w7anN6tJ3r/7GfETmIVUi7yvg017T+kFXWr+yYbTIZtOmSmk6eRL1P7DpEGDHKWJUfWpT2HyAXXo2eC69E01yfvpH8r7WaHeHk5Hhafn/VNw+BN5P03tSr31y2PXvLAtfJOZRxVPyPughU/hObk543i0bL/bWdzCqQzVFjcxndjcNlAlz3+b98821qAf9ftueOrbOKmY/INKOC3lJjuO5gW7EqYtKzjzgd/l/anXp0/ohuOkYFaag28052+VTRsVAeHA92lhsHxolOmBvK/F+Okz0rFVAvrxgukZhMX9sswv7Am/6u/D3PO+TEdsX1g890vTkv9qZJofskOuCJScm3mX0oN5f/I56inhFOOkzwU2qJjRqMbgipG1Sot9VfJ67zNm+LtLTA/mffgbeT89WDuTFWldtZblWY7ZyWIGWjQrir1vWI983oBNNalPf56OO1YSSQpr1GMtKvGlRpVCIVZiluqOLMw17w8lhQfja4XpCcqK12VZM8Nm0DBFD+/3e+7jJP8jeb+TBh4d9scmfrDqnJsstaqU5QeWnpja4lks4mEs1tPy/uTrU3iCTQ9IzfAz/l97Z9vbqA5E4QYidVH2a6XeSrXNe87//4PXQNIFbEgAr5YJ53SVblbdxHkyzBnPtHVqekzRMsXg2g/h+yLqU3gbakvKgDLKbN7UJjP1uUkAp584zZuvtUz72XCb74ub72N9HYCyPuXmcjpfTF0n7cs/1dE5akorUzW3Oojvy5nv93Pcmno1j2x8pnl77VeFvsVpZdL4Ute1OdX2U3YY3x+te9QBei7tZZWpYluh5v18ausrk3WFVj+fbvZ9IfP9QaBiue9nl9wa/EXdmGZR25cqqxx3phjm0df1fc+LWBWm3d0oh2WqU1XHSVfzl/eu1d2jNvq+rPn+uDxd1Y33biO7uqAcQzvQfB8rrR+jQPLmEGz0fWnzfbhBsTRQh7dwozXYfl/GfH/ykn8y7Q1Cc6aSCOD7Uub7Ht9Xi/b7fXiDHukgUEP4vhLq+2vDdHS1KycVBtjvQ17/dJgMFyS9cV71FryB9vuy+vxY2fjHCB281hKmzy+sf+q8kIXhhJkaKKDvy5jvTxZVy9zZG+qBfV/KfH86UBe5M9wGAkL7vpj5vjd4lrX9J7/7IrDvy5nv+wqWpW3/8aO4W8ogvg+Bvr+67Y9HHbpAvi/t+089d5cH6vTM40jzfbj7/cVt/ynfhzqY72Oq2l/c9seM7/d6VYeY70O5ZLGi7T+5FQvu+5DzM7yYYftMOp1+c4Lv9/dcn/J3IYnSvn8NGpmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZmSKZl69dEy/SDTgHr/tky/38k0oD4/LVN7Q6bhZENUv/33TaYB9Vs3H/SosEv+yD6+yDSs8X/pr08yDZtQtda/yTRwNaXf38g0rEl96i8yDZ1Q9QeZBq+muN8/mnjeiaDzTrSSKhHnRgq7EXFupLAbCedGCrsRcm6kJGH350UPDiAUcSPivGjQ9/+C7z9/5uAO7kKK7z9/2va/vivlvOg1Z7j+q7uQ4/ues8x3G6hy8un4IOd9JlQh50XDe67xXovTfZ/Di8mEuuMwVSLqU+9Z17tNpxCQT8X5/v7r037q3+L7ury94iwfHBiPIi08J8S/tu+729M1ea4wWff32Jh8cF58lmT9N+0ovu8G6vIduGnjFFES18ktUnXV/FvW0FZlpcP5vrz6dMG++/4ni05JdIlyFZkIuFZF+0Bpy7mJU4XSpKF8X+Y+6ul9911pZarz+awvpm5i8txitEyLP3FqUgRLp3uvT9fv99GLoTJpgr429blRfW2ish+nNt+m3qt4+V0htdRK3++9Vp3gmqpTjDSN01SrKG3jtMQwTjEu31/S97HF939eK+paJbFCJ4U86/JpbAHbFJta0oM43ZpQ998/3eT77deXRqOKlaqMMZWKy8u1eaTUmMT8KA3TTziE77c1qDmfrUvlVVTElUryy7V7pEb22gfKJnx/Hn95Y3/koAfwfZRRFCXXqKhSpA3TqI3ToqHXMm33U4CThhcXGDL2USF8v1V77Sf2Q1VdnHal1M2j7sbvcn32iSCqPg3g+1ZJXJZVlEXdtY8hUwyKKawPVEioT8P4fpHFSWW0jdX0J582THGvT29Mh2G6YOc0rMIEzPc3+/6lcfirLqtG93w6uPYxitMFjw/J8/2Vvm9vcl20tdT50lz71+Iep1CjOP3zCMsa+xhu2wTN91f5/v1u0nhU6/s2bjum19rqev+U+l18/olGl86rz/cx3IW3vh9np5PK9Llur/1TX7drH24QzjwRlDt+fOn5/hBsF6f1yW72q1PTQdW3ll+notJOK+TZQJVWn26Z78PnI5jwlQeVlP+JfAXq68/3MdOS8+RpeDPHrOnjSPP9kaVNfivbdKDOPdH40sER5vtK+SB6Z3JOH0S5T6b8VOHzxZed78PNwlM9j8k4xfxXen3/pef7yrOH9LY85sJ0NlCl+v72/b7zrcFLwnQ2oUKu72/e799fPvwI5uP00cPjgH1+16GeD9RHjX2f7x+gzw81n09X+P5UCXWY+b4P62yj7rHvPwrT15/vw8XqfsUy3/fUvoJ8P8R8/2EnaaHvO80rpzp7/fk+Ru+Md1MJb1/kmcb+IX3fjVM82uzP+f50AjnMfB9T1dSovwKvp8829uG9e4g+f3/PAzXRpPKWWZ4yaaqXAFk/xxdmvu+P00nDmvT9mf8HKf3Tzb4P5fRRRg2UyXQ6UUZgqs8vYMbH34UkSXtfM5mSKZmSKZmSKddHplwzmXJ9ZMo1kynXR6ZcM5lyfWTKNZMp10emXDOZkimZkimZkimZkimZkinXR6ZcM5lyfWTKNZMp10emXDOZcn0vwVT/Eif9a/dvujy9URRFURRFURRFURRFURRFURRFURRFURRFURRFURRFvb39D7cXmrh1icSsAAAAAElFTkSuQmCC" alt="图5-1-1 监听模式的构建流程"></p> <p>在每个大阶段中又会发生很多事件，Webpack 会把这些事件广播出来供给 Plugin 使用</p> <h3 id="构建执行总流程"><a href="#构建执行总流程" class="header-anchor">#</a> 构建执行总流程</h3> <p><img src="/myblog/assets/img/webpack编译流程.35d4fb73.png" alt="image-20240109142721825"></p> <p>Webpack 的运行流程是一个串行的过程，从启动到结束会依次执行以下流程：</p> <ol><li><strong>初始化参数</strong>：
<ul><li>从配置文件（如 <code>webpack.config.js</code>）和 Shell 语句中读取参数。</li> <li>合并参数，得出最终的配置参数。</li></ul></li> <li><strong>开始编译</strong>：
<ul><li>初始化 Compiler 对象。</li> <li>加载所有配置的插件。</li> <li>执行 Compiler 对象的 <code>run</code> 方法开始编译过程。</li></ul></li> <li><strong>确定入口</strong>：
<ul><li>根据配置中的 <code>entry</code> 选项找出入口文件。</li> <li>可以有多个入口，对应生成多个 bundle。</li></ul></li> <li><strong>编译模块</strong>：
<ul><li>从入口文件开始，递归地处理每个模块。</li> <li>使用配置的 Loader 对模块进行转换（如将 ES6 代码转换为 ES5）。</li> <li>处理模块依赖，递归地处理依赖模块。</li></ul></li> <li><strong>完成模块编译</strong>：
<ul><li>收集所有模块的内容和依赖关系。</li> <li>可以生成 dependency graph（依赖图）。</li></ul></li> <li><strong>输出资源</strong>：
<ul><li>根据入口和模块依赖关系，组装成 Chunk。</li> <li>将每个 Chunk 转换成一个单独的文件，并加入到输出列表。</li> <li>这一步是修改输出内容的最后机会。</li></ul></li> <li><strong>输出完成</strong>：
<ul><li>根据配置确定输出路径和文件名。</li> <li>将文件内容写入到文件系统。</li></ul></li> <li><strong>插件事件与API调用</strong>：
在编译过程中的特定阶段，Webpack 会触发特定的事件，插件可以监听这些事件并执行特定的逻辑。插件还可以使用 Webpack 提供的 API 来修改编译结果。</li> <li><strong>优化与部署</strong>：在完成构建后，可能还需要进行进一步的优化和部署步骤，如压缩代码、创建生产环境版本等。这些步骤可以在 Webpack 的配置中进行，也可以使用插件来实现。</li></ol> <h3 id="函数调用流程"><a href="#函数调用流程" class="header-anchor">#</a> 函数调用流程</h3> <p><img src="/myblog/assets/img/webpack构建执行流程.18bc1cb5.png" alt="TB1GVGFNXXXXXaTapXXXXXXXXXX-4436-4244.jpg"></p> <h3 id="初始化流程"><a href="#初始化流程" class="header-anchor">#</a> 初始化流程</h3> <p><img src="/myblog/assets/img/webpack参数初始化流程.297ac103.png" alt=""></p> <p>在使用了 webpack-cli 的工程项目中，就会执行 webpack 的初始化流程；</p> <p>通过 webpack-cli 构建一个 webpack 构建的流程：</p> <ol><li>从配置文件和 <code>Shell</code> 语句中读取与合并参数，得出最终的参数。</li> <li>安装 webpack-cli;</li> <li>执行 WebpackCli，并将参数传入，运行 webpack。</li></ol> <h4 id="初始化事件"><a href="#初始化事件" class="header-anchor">#</a> <strong>初始化事件</strong></h4> <table><thead><tr><th>事件名</th> <th>解释</th></tr></thead> <tbody><tr><td>初始化参数</td> <td>从配置文件和 Shell 语句中读取与合并参数，得出最终的参数。 这个过程中还会执行配置文件中的插件实例化语句 <code>new Plugin()</code>。</td></tr> <tr><td>实例化 Compiler</td> <td>用上一步得到的参数初始化 Compiler 实例，Compiler 负责文件监听和启动编译。Compiler 实例中包含了完整的 Webpack 配置，全局只有一个 Compiler 实例。</td></tr> <tr><td>加载插件</td> <td>依次调用插件的 apply 方法，让插件可以监听后续的所有事件节点。同时给插件传入 compiler 实例的引用，以方便插件通过 compiler 调用 Webpack 提供的 API。</td></tr> <tr><td>environment</td> <td>开始应用 Node.js 风格的文件系统到 compiler 对象，以方便后续的文件寻找和读取。</td></tr> <tr><td>entry-option</td> <td>读取配置的 Entrys，为每个 Entry 实例化一个对应的 EntryPlugin，为后面该 Entry 的递归解析工作做准备。</td></tr> <tr><td>after-plugins</td> <td>调用完所有内置的和配置的插件的 apply 方法。</td></tr> <tr><td>after-resolvers</td> <td>根据配置初始化完 resolver，resolver 负责在文件系统中寻找指定路径的文件。</td></tr></tbody></table> <h4 id="webpack配置项"><a href="#webpack配置项" class="header-anchor">#</a> <strong>webpack配置项</strong></h4> <p>配置文件默认下为<code>webpack.config.js</code>，也或者通过命令的形式指定配置文件，主要作用是用于激活<code>webpack</code>的加载项和插件</p> <p>关于文件配置内容分析，如下注释：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> node_modules <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pathToReact <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>node_modules<span class="token punctuation">,</span> <span class="token string">'react/dist/react.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 入口文件，是模块构建的起点，同时每一个入口文件对应最后生成的一个 chunk。</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span>，
  <span class="token comment">// 文件路径指向(可加快打包过程)。</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'react'</span><span class="token operator">:</span> pathToReact
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 生成文件，是模块构建的终点，包括输出文件与输出路径。</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 这里配置了处理各模块的 loader ，包括 css 预处理 loader ，es6 编译 loader，图片处理 loader。</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'es2015'</span><span class="token punctuation">,</span> <span class="token string">'react'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token punctuation">[</span>pathToReact<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// webpack 各插件对象，在 webpack 的事件流中执行对应的方法。</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p><code>webpack</code> 将 <code>webpack.config.js</code> 中的各个配置项拷贝到 <code>options</code> 对象中，并加载用户配置的 `plugins；</p> <h4 id="webpack-命令和-shell-脚本参数解析"><a href="#webpack-命令和-shell-脚本参数解析" class="header-anchor">#</a> <strong>webpack 命令和 shell 脚本参数解析</strong></h4> <p>shell 脚本参数一般通过 shell 直接输入或者通过 npm script 输入：</p> <p><img src="/myblog/assets/img/webpack参数.b80f9f83.png" alt="image-20240110100043397"></p> <blockquote><p>上图中，通过 shell 执行 npm run start 后，执行  <code>webpack --config webpack.config.js</code> ，通过 shell 的 config 参数和 webpack 命令将配置文件传入 webpack 中</p></blockquote> <p>每次在命令行输入 <code>webpack</code> 命令后，操作系统都会去调用 <code>./node_modules/.bin/webpack</code> 这个 shell 脚本。（在 window 下是执行<code>./node_modules/.bin/webpack.cmd</code> 文件）</p> <p><img src="/myblog/assets/img/webpack命令解析.00f5900d.png" alt="image-20240110172442818"></p> <p>这个脚本会去调用 <code>./node_modules/webpack/bin/webpack.js</code> 并追加输入的参数，如 -p , -w 。(图中 webpack.js 是 webpack 的启动文件，而 $@ 是后缀参数)</p> <p><img src="/myblog/assets/img/webpack参数解析.3df5c073.png" alt="img"></p> <h4 id="shell-与-webpack-config-解析"><a href="#shell-与-webpack-config-解析" class="header-anchor">#</a> <strong>shell 与 webpack.config 解析</strong></h4> <p>在 webpack.js 这个文件中 webpack 通过 optimist 将用户配置的 webpack.config.js 和 shell 脚本传过来的参数整合成 options 对象传到了下一个流程的控制对象中。</p> <p><strong>optimist 介绍</strong></p> <blockquote><p>为了整合 webpack.config.js 中的配置和命令行参数，Webpack 使用了一个叫做 optimist 的库。</p> <p>optimist 是一个用于解析命令行参数的库，可以将命令行参数解析为 JavaScript 对象，这样它们就可以与 webpack.config.js 中的配置进行合并。</p></blockquote> <p>和 commander 一样，<a href="https://github.com/substack/node-optimist" target="_blank" rel="noopener noreferrer">optimist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现了 node 命令行的解析，其 API 调用非常方便。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">var</span> optimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;optimist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
optimist
  <span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;j&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token string">&quot;colors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;colors&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;colors&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token string">&quot;watch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;watch&quot;</span><span class="token punctuation">)</span>
  <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>获取到后缀参数后，optimist 分析参数并以键值对的形式把参数对象保存在 optimist.argv 中，来看看 argv 究竟有什么？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack --hot -w</span>
<span class="token punctuation">{</span>  <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="config-合并与插件加载"><a href="#config-合并与插件加载" class="header-anchor">#</a> <strong>config 合并与插件加载</strong></h5> <ol><li><p>在加载插件之前，webpack 将 webpack.config.js 中的各个配置项拷贝到 options 对象中，并加载用户配置在 webpack.config.js 的 plugins 。</p></li> <li><p>接着 optimist.argv 会被传入到<code>./node_modules/webpack/bin/convert-argv.js</code> 中，通过判断 argv 中参数的值决定是否去加载对应插件。</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">ifBooleanArg</span><span class="token punctuation">(</span><span class="token string">&quot;hot&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">ensureArray</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> HotModuleReplacementPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../lib/HotModuleReplacementPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token keyword">return</span> options<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>options</code> 作为最后返回结果，包含了之后构建阶段所需的重要信息。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span> 
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//入口配置</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//输出配置</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//插件集合(配置文件 + shell指令) </span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//模块配置</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token comment">//工程路径</span>
  <span class="token operator">...</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这和 webpack.config.js 的配置非常相似，只是多了一些经 shell 传入的插件对象。</p> <p>插件对象一初始化完毕， options 也就传入到了下个流程中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>	
<span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../lib/webpack.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="webpakc-cli-安装"><a href="#webpakc-cli-安装" class="header-anchor">#</a> <strong>webpakc-cli 安装</strong></h4> <p>在 webpack.js 这个文件，检查用户是否安装webpack-cli，没有安装则进行安装，安装后执行 webpack-cli，并将参数传入 webpack-cli 中：</p> <p><code>webpack.js</code> 源码：(位于项目中 <code>./node_modules/webpack/bin/webpack.js</code> )</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token comment">/**
 * 解析并运行命令行
 * @param {string} command process to run
 * @param {string[]} args command line arguments
 * @returns {Promise&lt;void&gt;} promise
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">runCommand</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> executedCommand <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span><span class="token punctuation">,</span>
			<span class="token literal-property property">shell</span><span class="token operator">:</span> <span class="token boolean">true</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token parameter">code</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 检查包是否安装 
 * @param {string} packageName name of the package
 * @returns {boolean} is the package installed?
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isInstalled</span> <span class="token operator">=</span> <span class="token parameter">packageName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>pnp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;graceful-fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">let</span> dir <span class="token operator">=</span> __dirname<span class="token punctuation">;</span>

	<span class="token keyword">do</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>
				fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> packageName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Nothing</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>dir <span class="token operator">!==</span> <span class="token punctuation">(</span>dir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// https://github.com/nodejs/node/blob/v18.9.1/lib/internal/modules/cjs/loader.js#L1274</span>
	<span class="token comment">// eslint-disable-next-line no-warning-comments</span>
	<span class="token comment">// @ts-ignore</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> internalPath <span class="token keyword">of</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalPaths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>internalPath<span class="token punctuation">,</span> packageName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Nothing</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 运行脚手架
 * @param {CliOption} cli options
 * @returns {void}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">runCli</span> <span class="token operator">=</span> <span class="token parameter">cli</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> pkgPath <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cli<span class="token punctuation">.</span>package<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// eslint-disable-next-line node/no-missing-require</span>
	<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;module&quot;</span> <span class="token operator">||</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.mjs</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>bin<span class="token punctuation">[</span>cli<span class="token punctuation">.</span>binName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// eslint-disable-next-line node/no-unsupported-features/es-syntax</span>
		<span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">,</span> pkg<span class="token punctuation">.</span>bin<span class="token punctuation">[</span>cli<span class="token punctuation">.</span>binName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>
			<span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// eslint-disable-next-line node/no-missing-require</span>
		<span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">,</span> pkg<span class="token punctuation">.</span>bin<span class="token punctuation">[</span>cli<span class="token punctuation">.</span>binName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 脚手架参数
 * @typedef {Object} CliOption
 * @property {string} name display name
 * @property {string} package npm package name
 * @property {string} binName name of the executable file
 * @property {boolean} installed currently installed?
 * @property {string} url homepage
 */</span>

<span class="token comment">/** @type {CliOption} */</span>
<span class="token keyword">const</span> cli <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
	<span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">binName</span><span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">installed</span><span class="token operator">:</span> <span class="token function">isInstalled</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/webpack/webpack-cli&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 判断脚手架是否被安装，若没有安装，询问用户是否安装，并根据用户的包管理工具下载安装webpack-cli</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cli<span class="token punctuation">.</span>installed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;graceful-fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> readLine <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;readline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> notify <span class="token operator">=</span>
		<span class="token string">&quot;CLI for webpack must be installed.\n&quot;</span> <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cli<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cli<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>notify<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">let</span> packageManager<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;yarn.lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		packageManager <span class="token operator">=</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;pnpm-lock.yaml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		packageManager <span class="token operator">=</span> <span class="token string">&quot;pnpm&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		packageManager <span class="token operator">=</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> installOptions <span class="token operator">=</span> <span class="token punctuation">[</span>packageManager <span class="token operator">===</span> <span class="token string">&quot;yarn&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;add&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;install&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-D&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
		<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">We will use &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; to install the CLI via &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
			<span class="token string">&quot; &quot;</span>
		<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cli<span class="token punctuation">.</span>package<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> question <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Do you want to install 'webpack-cli' (yes/no): </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> questionInterface <span class="token operator">=</span> readLine<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
		<span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stderr
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// In certain scenarios (e.g. when STDIN is not in terminal mode), the callback function will not be</span>
	<span class="token comment">// executed. Setting the exit code here to ensure the script exits correctly in those cases. The callback</span>
	<span class="token comment">// function is responsible for clearing the exit code if the user wishes to install webpack-cli.</span>
	process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	questionInterface<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span>question<span class="token punctuation">,</span> <span class="token parameter">answer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		questionInterface<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 格式化用户输入</span>
		<span class="token keyword">const</span> normalizedAnswer <span class="token operator">=</span> answer<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>normalizedAnswer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
				<span class="token string">&quot;You need to install 'webpack-cli' to use webpack via CLI.\n&quot;</span> <span class="token operator">+</span>
					<span class="token string">&quot;You can also install the CLI manually.&quot;</span>
			<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
			<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Installing '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
				cli<span class="token punctuation">.</span>package
			<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' (running '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
				cli<span class="token punctuation">.</span>package
			<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')...</span><span class="token template-punctuation string">`</span></span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">runCommand</span><span class="token punctuation">(</span>packageManager<span class="token punctuation">,</span> installOptions<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cli<span class="token punctuation">.</span>package<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token function">runCli</span><span class="token punctuation">(</span>cli<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token function">runCli</span><span class="token punctuation">(</span>cli<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br></div></div><blockquote><p>webpack 入口文件，先是检查用户是否完成安装 webpack-cli ，若没有安装，则进行安装</p> <p>安装成功以后，运行 webpack-cli 脚手架，并将参数 shell 和 webpack.config.js 的参数传入</p></blockquote> <h4 id="运行-webpack-cli-初始化-webpack"><a href="#运行-webpack-cli-初始化-webpack" class="header-anchor">#</a> <strong>运行 webpack-cli 初始化 webpack</strong></h4> <ol><li><p>在安装完成 webpack-cli 后(文件位于<code>./node_modules/webpack-cli/.bin/cli.js</code>)，执行 webpack-cli 下的 <code>cli.js</code>，将文件参数传入，执行 WebpackCLI 对象（文件位于 <code>./node_modules/webpack-cli/lib/webpack-cli.js</code> ）；</p></li> <li><p><code>WebpackCLI</code> 对象中声明了一些列的 webpack 初始化方法（如: webpack 的执行方法<code>run</code>）</p></li></ol> <p><img src="/myblog/assets/img/webpack-cli执行流程.aa2d9de4.png" alt="image-20240110103942104"></p> <ol start="3"><li><code>WebpackCLI</code> 对象的 <code>run</code> 方法中，调用 <code>loadWebpack</code> 方法，该方法将查找 webpack 的核心模块；</li> <li>webpack 的核心模块位于<code>./node_modules/webpack/lib/webpack.js</code>  中，然后进入编译构建流程；</li></ol> <h3 id="编译流程"><a href="#编译流程" class="header-anchor">#</a> 编译流程</h3> <p><img src="/myblog/assets/img/webpack构建部分流程.0ee491b7.png" alt="image-20240113172953455"></p> <p>在加载配置文件和 shell 后缀参数申明的插件，并传入构建信息 options 对象后，开始整个 webpack 打包最漫长的一步。</p> <p>而这个时候，真正的 webpack 对象才刚被初始化，具体的初始化逻辑在<code>./node_modules/webpack/lib/webpack.js</code>  中，该文件中定义了 webpack 的核心代码。</p> <blockquote><p>webpack 构建流程：</p> <ol><li>Webpack 启动后会从 Entry 里配置的 Module 开始递归<strong>解析 Entry 依赖的所有 Module</strong>。</li> <li>每找到一个 Module， 就会根据配置的 <strong>Loader 去找出对应的转换规则</strong>，对 Module 进行转换后，再<strong>解析出当前 Module 依赖的 Module</strong>。</li> <li>这些模块会<strong>以 Entry 为单位进行分组</strong>，一个 Entry 和其所有依赖的 Module 被分到一个组也就是一个 Chunk。</li> <li>最后 Webpack 会把<strong>所有 Chunk 转换成文件输出</strong>。</li> <li>在整个流程中 Webpack 会在恰当的时机执行 Plugin 里定义的逻辑。</li></ol></blockquote> <h4 id="编译阶段事件"><a href="#编译阶段事件" class="header-anchor">#</a> <strong>编译阶段事件</strong></h4> <table><thead><tr><th>事件名</th> <th>解释</th></tr></thead> <tbody><tr><td>run</td> <td>启动一次新的编译。</td></tr> <tr><td>watch-run</td> <td>和 run 类似，区别在于它是在监听模式下启动的编译，在这个事件中可以获取到是哪些文件发生了变化导致重新启动一次新的编译。</td></tr> <tr><td>compile</td> <td>该事件是为了告诉插件一次新的编译将要启动，同时会给插件带上 compiler 对象。</td></tr> <tr><td>compilation</td> <td>当 Webpack 以开发模式运行时，每当检测到文件变化，一次新的 Compilation 将被创建。一个 Compilation 对象包含了当前的模块资源、编译生成资源、变化的文件等。Compilation 对象也提供了很多事件回调供插件做扩展。</td></tr> <tr><td>make</td> <td>一个新的 Compilation 创建完毕，即将从 Entry 开始读取文件，根据文件类型和配置的 Loader 对文件进行编译，编译完后再找出该文件依赖的文件，递归的编译和解析。</td></tr> <tr><td>after-compile</td> <td>一次 Compilation 执行完成。</td></tr> <tr><td>invalid</td> <td>当遇到文件不存在、文件编译错误等异常时会触发该事件，该事件不会导致 Webpack 退出。</td></tr></tbody></table> <p>在编译阶段中，最重要的要数 compilation 事件了，因为在 compilation 阶段调用了 Loader 完成了每个模块的转换操作，在 compilation 阶段又包括很多小的事件，它们分别是：</p> <table><thead><tr><th>事件名</th> <th>解释</th></tr></thead> <tbody><tr><td>build-module</td> <td>使用对应的 Loader 去转换一个模块。</td></tr> <tr><td>normal-module-loader</td> <td>在用 Loader 对一个模块转换完后，使用 acorn 解析转换后的内容，输出对应的抽象语法树（AST），以方便 Webpack 后面对代码的分析。</td></tr> <tr><td>program</td> <td>从配置的入口模块开始，分析其 AST，当遇到 <code>require</code> 等导入其它模块语句时，便将其加入到依赖的模块列表，同时对新找出的依赖模块递归分析，最终搞清所有模块的依赖关系。</td></tr> <tr><td>seal</td> <td>所有模块及其依赖的模块都通过 Loader 转换完成后，根据依赖关系开始生成 Chunk。</td></tr></tbody></table> <h4 id="编译对象"><a href="#编译对象" class="header-anchor">#</a> <strong>编译对象</strong></h4> <p>在<code>./node_modules/webpack/lib/webpack.js</code>  中，开始初始化<code>Compiler</code>编译对象，该对象掌控者<code>webpack</code>生命周期，不执行具体的任务，只是进行一些调度工作</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">//生命周期钩子</span>
            <span class="token literal-property property">beforeCompile</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;params&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">compile</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;params&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">afterCompile</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">make</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncParallelHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">entryOption</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;context&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;entry&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment">// 定义了很多不同类型的钩子</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span><span class="token comment">// 检查options,若watch字段为true,则开启watch线程</span>
  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>Compiler</code> 对象继承自 <code>Tapable</code>，初始化时定义了很多钩子函数（<code>Compiler</code> 对象定义在<code>./node_modules/webpack/lib/Compiler.js</code>）</p> <p>根据配置中的 <code>entry</code> 找出所有的入口文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/file.js'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="run-开始编译"><a href="#run-开始编译" class="header-anchor">#</a> <strong>run 开始编译</strong></h4> <p>初始化完成后会调用<code>Compiler</code>的<code>run</code>方法来真正启动<code>webpack</code>编译构建流程，主要流程如下：</p> <ol><li><p><strong><code>compile</code> 开始编译:</strong></p> <ul><li>目的：这是整个编译过程的开始，意味着开始将源代码转换为可执行代码或目标代码。</li> <li>操作：读取源代码文件，并开始进行初步的解析和处理。</li></ul></li> <li><p><strong><code>make</code> 从入口点分析模块及其依赖的模块，创建这些模块对象:</strong></p> <ul><li>目的：确定项目的依赖关系构建一个依赖图，并创建模块对象以供后续处理。</li> <li>操作：
<ol><li>工具（如Webpack）会分析源代码中的import或require语句，分析项目的依赖关系，并确定哪些模块需要被编译。</li> <li>为每个模块创建一个对象，这个对象包含了该模块的所有相关信息。</li> <li>模块对象包括：模块ID、模块路径、模块依赖数组等；</li></ol></li></ul></li> <li><p><strong><code>build-module</code> 构建模块:</strong></p> <ul><li>目的：对每个模块的源代码进行处理和转换。</li> <li>操作：这一步包括将模块的源代码进行转换、优化、合并等操作。例如，Babel会在此阶段将ES6+的语法转换为ES5语法。</li></ul></li> <li><p><strong><code>after-compile</code> 完成构建:</strong></p> <ul><li>目的：在所有模块都构建完成后执行一些全局的操作。</li> <li>操作：例如，可能会进行全局的代码优化、清理临时文件等。</li></ul></li> <li><p><strong><code>seal</code> 封装构建结果:</strong></p> <ul><li>目的：将构建的结果进行封装，以便于部署和分发。</li> <li>操作：可能会将所有的模块和资源打包到一个或多个文件中，并进行压缩、优化等操作。</li></ul></li> <li><p><strong><code>emit</code> 把各个chunk输出到结果文件:</strong></p> <ul><li>目的：将各个模块或chunk输出到结果文件。</li> <li>操作：工具会根据其内部的依赖关系，将每个chunk（例如，由多个模块组成的代码块）输出到指定的结果文件。</li></ul></li> <li><p><strong><code>after-emit</code> 完成输出:</strong></p> <ul><li>目的：在所有chunks都输出到结果文件后执行一些后续操作。</li> <li>操作：例如，可能会复制生成的资源到输出目录、执行一些清理任务等。</li></ul></li></ol> <h4 id="compile-编译"><a href="#compile-编译" class="header-anchor">#</a> compile 编译</h4> <ul><li>目的：这是整个编译过程的开始，意味着开始将源代码转换为可执行代码或目标代码。</li> <li>操作：读取源代码文件，并开始进行初步的解析和处理。</li></ul> <p><strong><code>Compilation</code>对象介绍</strong></p> <p>执行了<code>run</code>方法后，首先会触发<code>compile</code>，主要是构建一个<code>Compilation</code>对象</p> <p><img src="/myblog/assets/img/webpack-Compilation.93b89c42.png" alt="compilation类图"></p> <p>该对象是编译阶段的主要执行者，主要会依次下述流程：</p> <ol><li>负责组织整个打包过程：执行模块创建、依赖收集、分块、打包等主要任务，图中看到比较关键的步骤，如 <code>addEntry()</code> , <code>_addModuleChain()</code> ,<code>buildModule()</code> , <code>seal()</code> , <code>createChunkAssets()</code> (在每一个节点都会触发 webpack 事件去调用各插件)</li> <li>对象内部存放着所有 module ，chunk，生成的 asset 以及用来生成最后打包文件的 template 的信息。</li></ol> <h4 id="compiler-和-compilation-区分"><a href="#compiler-和-compilation-区分" class="header-anchor">#</a> <strong>Compiler 和 Compilation 区分</strong></h4> <blockquote><p>在开发 Plugin 时最常用的两个对象就是 Compiler 和 Compilation，它们是 Plugin 和 Webpack 之间的桥梁。</p> <p>Compiler 和 Compilation 的含义如下：</p> <ul><li>Compiler 对象包含了 Webpack 环境所有的的配置信息，包含 options，loaders，plugins 这些信息，这个对象在 Webpack 启动时候被实例化，它是全局唯一的，可以简单地把它理解为 Webpack 实例；</li> <li>Compilation 对象包含了当前的模块资源、编译生成资源、变化的文件等。当 Webpack 以开发模式运行时，每当检测到一个文件变化，一次新的 Compilation 将被创建。Compilation 对象也提供了很多事件回调供插件做扩展。通过 Compilation 也能读取到 Compiler 对象。</li></ul> <p>Compiler 和 Compilation 的区别在于：<strong>Compiler 代表了整个 Webpack 从启动到关闭的生命周期，而 Compilation 只是代表了一次新的编译。</strong></p></blockquote> <h4 id="make-构建依赖图"><a href="#make-构建依赖图" class="header-anchor">#</a> make 构建依赖图</h4> <ul><li><p>目的：<strong>生成模块依赖关系图</strong>。</p></li> <li><p>操作：工具（如Webpack）会分析源代码中的import或require语句，分析项目的依赖关系，并确定哪些模块需要被编译。为每个模块创建一个对象，这个对象包含了该模块的所有相关信息。</p> <ol><li><strong>生成模块依赖关系图</strong>： 通过遍历入口文件及其依赖的模块，生成一个模块依赖关系图。这个图描述了模块之间的依赖关系，为后续的代码拆分和优化提供了基础。</li> <li><strong>代码拆分</strong>：根据模块依赖关系图，将代码拆分成不同的chunks。每个chunk包含一组相关的模块，这些模块共享相同的入口和出口。</li></ol></li></ul> <p>在创建 module 之前，Compiler 会触发 make，并调用 <code>Compilation.addEntry</code> 方法，通过 options 对象的 entry 字段找到入口js文件。</p> <p>之后，在 addEntry 中调用私有方法<code>_addModuleChain</code>;</p> <p><code>_addModuleChain</code>方法主要做了两件事情:</p> <ul><li>一是根据模块的类型获取对应的模块工厂并<strong>创建模块;</strong></li> <li>二是构建模块;</li></ul> <p><code>_addModuleChain()</code>函数，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">_addModuleChain</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> dependency<span class="token punctuation">,</span> onModule<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token comment">// 根据依赖查找对应的工厂函数</span>
   <span class="token keyword">const</span> Dep <span class="token operator">=</span> <span class="token comment">/** @type {DepConstructor} */</span> <span class="token punctuation">(</span>dependency<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> moduleFactory <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">// 调用工厂函数NormalModuleFactory的create来生成一个空的NormalModule对象</span>
   moduleFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token punctuation">[</span>dependency<span class="token punctuation">]</span>
       <span class="token operator">...</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token operator">...</span>
       <span class="token keyword">const</span> <span class="token function-variable function">afterBuild</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processModuleDependencies</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token comment">// 开始模块编译</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token operator">...</span>
           <span class="token function">afterBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><blockquote><p>过程如下：</p> <ol><li><p><code>_addModuleChain</code>中接收参数<code>dependency</code>传入的入口依赖，使用对应的工厂函数<code>NormalModuleFactory.create</code>方法生成一个空的<code>module</code>对象</p></li> <li><p>回调中会把此<code>module</code>存入<code>compilation.modules</code>对象和<code>dependencies.module</code>对象中，由于是入口文件，也会存入<code>compilation.entries</code>中</p></li> <li><p>随后执行<code>buildModule</code>进入真正的构建模块<code>module</code>内容的过程</p></li></ol></blockquote> <h4 id="build-module-模块编译"><a href="#build-module-模块编译" class="header-anchor">#</a> build-module 模块编译</h4> <ul><li><p>目的：对每个模块的源代码进行处理和转换。</p></li> <li><p>操作：这一步包括将模块的源代码进行转换、优化、合并等操作。例如，Babel会在此阶段将ES6+的语法转换为ES5语法。</p></li></ul> <h5 id="模块编译总流程"><a href="#模块编译总流程" class="header-anchor">#</a> <strong>模块编译总流程：</strong></h5> <ol><li><strong>执行加载器（Loaders）</strong>：对于每个模块，根据配置的加载器对其进行转换和处理。加载器可以将模块的源代码转换为更低级别的代码，或者添加额外的元数据和代码片段等。
<ol><li><strong>loaders 解析模块</strong>： 调用配置的<code>loaders</code>，将我们的模块转成标准的<code>JS</code>模块；</li> <li><strong>生成 AST</strong>： 在用<code>Loader</code> 对一个模块转换完后，使用 <code>acorn</code> 解析转换后的内容，输出对应的抽象语法树（<code>AST</code>），以方便 <code>Webpack</code>后面对代码的分析；</li> <li><strong>构建模块所依赖的模块</strong>： 从配置的入口模块开始，分析其 <code>AST</code>，当遇到<code>require</code>等导入其它模块语句时，便将其加入到依赖的模块列表，同时对新找出的依赖模块递归分析，最终搞清所有模块的依赖关系；</li></ol></li> <li><strong>执行插件（Plugins）</strong>：在<code>make</code>方法中，还会执行一系列的插件。这些插件可以对编译过程进行定制和扩展，例如添加新的功能、修改输出结果等。</li> <li><strong>Tree Shaking</strong>：在上述步骤中，Tree shaking实际上已经隐含地执行了。Tree shaking的核心思想是消除未使用的代码，通过静态分析来确定哪些代码被使用，哪些代码未被使用，并删除未使用的代码。在这个过程中，Webpack会遍历整个依赖图，并根据AST来确定哪些模块是可用的或不可用的。然后，Webpack会删除未使用的模块和代码，从而减小最终输出的文件大小。</li></ol> <h5 id="模块编译流程分析"><a href="#模块编译流程分析" class="header-anchor">#</a> <strong>模块编译流程分析</strong></h5> <h5 id="_1-调用-loaders-解析模块"><a href="#_1-调用-loaders-解析模块" class="header-anchor">#</a> <strong>1.调用 loaders 解析模块</strong></h5> <p>webpack 提供的一个很大的便利就是能将所有资源都整合成模块，不仅仅是 js 文件。</p> <p>所以需要一些 loader ，比如 <code>url-loader</code> ， <code>jsx-loader</code> ， <code>css-loader</code> 等等来让我们可以直接在源文件中引用各类资源。webpack 调用 <code>doBuild()</code> ，对每一个 require() 用对应的 loader 进行加工，最后生成一个 js module。</p> <h5 id="_2-acorn-解析源文件生成-ast"><a href="#_2-acorn-解析源文件生成-ast" class="header-anchor">#</a> <strong>2.<a href="https://github.com/ternjs/acorn" target="_blank" rel="noopener noreferrer">acorn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 解析源文件生成 AST</strong></h5> <p><strong>Acorn 介绍</strong></p> <blockquote><p>Acorn是一个完全使用JavaScript实现的，小型且快速的JavaScript解析器。它可以完成JavaScript代码解析工作，这个代码解析工作的产出即抽象语法树（AST）。</p> <p>Acorn允许使用者通过插件的形式扩展其功能，例如支持JSX语法。</p> <p>在webpack打包流程中，Acorn主要用于解析每一个经loader处理过的source，并生成AST。然后遍历所有节点，当遇到require调用时，会分析是AMD、CMD的调用，或者是require.ensure。</p></blockquote> <p><strong>AST 介绍</strong></p> <blockquote><p><strong>概念</strong>：</p> <ul><li><p>AST（抽象语法树）是<strong>源代码的抽象语法结构的树状表现形式</strong>，以<strong>树状</strong>的形式表现编程语言的语法结构。</p></li> <li><p>AST的每个节点都表示源代码中的一种结构，例如标识符、二元表达式、变量定义、函数定义等。</p></li> <li><p>AST在很多领域有广泛的应用，比如浏览器、智能编辑器、编译器等。</p></li></ul> <p><strong>作用</strong>：</p> <ul><li>AST的主要作用是<strong>提供对源代码的详细分析和操作能力</strong>。</li> <li>通过AST，可以对代码进行各种转换和处理，例如代码压缩、删除无用代码、变量重命名、类型检查等。</li> <li>在JavaScript中，AST的使用非常普遍，许多工具和库都依赖于AST来分析和处理代码。</li> <li>AST还可以用于<strong>编译器和解释器的实现</strong>。
<ul><li>编译器可以将源代码转换成AST，然后对AST进行各种优化和转换，最终生成目标代码。</li> <li>解释器则可以读取AST并执行相应的操作。</li></ul></li></ul> <p>总的来说，AST是一种对源代码进行抽象表示和操作的方式，在编译器、解释器、代码分析、代码转换等领域有广泛的应用。</p></blockquote> <p><strong>acorn 解析AST流程</strong></p> <p><img src="/myblog/assets/img/acorn流程.5027a442.png" alt="image-20240113170035193"></p> <blockquote><ol><li>词法分析：Acorn通过词法分析器将源代码分解成一系列的记号（token），每个记号都代表源代码中的一个特定部分，如关键字、标识符、运算符等。</li> <li>语法分析：接下来，Acorn使用语法分析器将这些记号转换成抽象语法树（AST）的节点。AST是一种树形结构，表示源代码的结构和语义信息。每个节点都代表源代码中的一个结构，如表达式、语句、控制结构等。</li> <li>遍历AST：在生成AST后，Acorn会遍历AST的每个节点，并根据节点类型和属性执行相应的处理逻辑。这些处理逻辑可以包括生成代码、检查语法错误、分析依赖关系等。</li> <li>生成代码：在遍历AST的过程中，Acorn可以生成最终的JavaScript代码。这可以用于将AST还原为原始代码，或者生成优化后的代码。</li></ol></blockquote> <p>调用 <a href="https://github.com/ternjs/acorn" target="_blank" rel="noopener noreferrer">acorn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 解析经 loader 处理后的源文件生成抽象语法树 AST</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>	
<span class="token class-name">Parser</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>parse <span class="token operator">=</span> <span class="token function">functionparse</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> ast<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ast<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// acorn以es6的语法进行解析</span>
    ast <span class="token operator">=</span> acorn<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">ranges</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">locations</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="_3-遍历-ast-构建该模块所依赖的模块"><a href="#_3-遍历-ast-构建该模块所依赖的模块" class="header-anchor">#</a> <strong>3.遍历 AST，构建该模块所依赖的模块</strong></h5> <p>对于当前模块，或许存在着多个依赖模块。</p> <p>当前模块会开辟一个依赖模块的数组 <code>factories</code>，在遍历 AST 时，将 require() 中的模块通过 <code>addDependency()</code> 添加到数组中。</p> <p>当前模块构建完成后，webpack 调用 <code>processModuleDependencies</code> 开始递归处理依赖的 module，接着就会重复之前的构建步骤。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
*dependencies 为依赖模块
**/</span>
<span class="token class-name">Compilation</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addModuleDependencies</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> dependencies<span class="token punctuation">,</span> bail<span class="token punctuation">,</span> cacheGroup<span class="token punctuation">,</span> recursive<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 根据依赖数组(dependencies)创建依赖模块对象,存入 factories</span>
<span class="token keyword">var</span> factories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dependencies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> factory <span class="token operator">=</span> _this<span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    factories<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>factory<span class="token punctuation">,</span> dependencies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token comment">// 与当前模块构建步骤相同</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="4"><li><p><strong>Tree Shaking</strong>： 通过静态分析AST，Tree shaking可以确定哪些代码被使用，哪些代码未被使用，并删除未使用的代码。</p> <blockquote><p>Tree Shaking 可以用来剔除 JavaScript 中用不上的死代码。它依赖静态的 ES6 模块化语法，例如通过 <code>import</code> 和 <code>export</code> 导入导出。 使用 Tree Shaking参考<a href="https://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-10%E4%BD%BF%E7%94%A8TreeShaking.html" target="_blank" rel="noopener noreferrer">使用 Tree Shaking · 深入浅出 Webpack <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li></ol> <p><img src="/myblog/assets/img/treeShake步骤.60622fde.png" alt="image-20240113201127807"></p> <h4 id="构建的核心源码"><a href="#构建的核心源码" class="header-anchor">#</a> <strong>构建的核心源码</strong></h4> <p>module 是 webpack 构建的核心实体，也是所有 module 的 父类，它有几种不同子类：<code>NormalModule</code> , <code>MultiModule</code> , <code>ContextModule</code> , <code>DelegatedModule</code> 等。</p> <p>但这些核心实体都是在构建中都会去调用对应方法，也就是 <code>build()</code> ；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 初始化module信息，如context,id,chunks,dependencies等。</span>
<span class="token class-name">NormalModule</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>build <span class="token operator">=</span> <span class="token function">functionbuild</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> resolver<span class="token punctuation">,</span> fs<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//设置构建时间戳：方法中设置了this.buildTimestamp为当前时间戳，这可能是为了跟踪模块的构建时间</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>buildTimestamp <span class="token operator">=</span> <span class="token function">newDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>built <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//标记模块为已构建</span>
<span class="token comment">//执行构建操作</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doBuild</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> resolver<span class="token punctuation">,</span> fs<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 指定模块引用，不经acorn解析</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>module <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>noParse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>noParse<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//检查是否需要跳过解析：如果配置中有module.noParse选项，并且模块的请求（request）匹配该选项，则跳过解析步骤，直接调用回调函数。</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>noParse<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">regExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token keyword">typeof</span> regExp <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">?</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>regExp<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">:</span>
              regExp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>noParse <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">?</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>noParse<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">:</span>
          options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>noParse<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">// 使用this.parser.parse方法解析模块的源代码。这通常会生成抽象语法树（AST）。由acorn解析生成ast</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_source<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">current</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
		<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compilation</span><span class="token operator">:</span> compilation<span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> options
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//错误处理：如果在解析过程中发生错误，捕获该错误，并创建一个新的ModuleParseError错误对象，然后调用回调函数返回该错误。</span>
        <span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_source<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_source <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ModuleParseError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//调用回调函数：如果一切正常，最后调用回调函数，可能表示构建完成。</span>
	<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><blockquote><p>以上方法主要流程：</p> <ol><li><strong>初始化模块信息</strong>：在开始构建模块之前，该方法首先会初始化一些模块相关的信息，如上下文（context）、ID、chunks（代码块）、依赖关系等。</li> <li><strong>设置构建时间戳</strong>：方法中设置了<code>this.buildTimestamp</code>为当前时间戳，这可能是为了跟踪模块的构建时间。</li> <li><strong>标记模块为已构建</strong>：将<code>this.built</code>设置为<code>true</code>，表示该模块已经被构建过。</li> <li><strong>执行构建操作</strong>：使用<code>this.doBuild</code>方法执行实际的构建操作。这可能包括编译、转换、打包等步骤。</li> <li><strong>检查是否需要跳过解析</strong>：如果配置中有<code>module.noParse</code>选项，并且模块的请求（request）匹配该选项，则跳过解析步骤，直接调用回调函数。</li> <li><strong>解析模块源代码</strong>：如果没有跳过解析，则使用<code>this.parser.parse</code>方法解析模块的源代码。这通常会生成抽象语法树（AST）。</li> <li><strong>错误处理</strong>：如果在解析过程中发生错误，捕获该错误，并创建一个新的<code>ModuleParseError</code>错误对象，然后调用回调函数返回该错误。</li> <li><strong>调用回调函数</strong>：如果一切正常，最后调用回调函数，可能表示构建完成。</li></ol> <p>这个方法基本上是处理一个模块从初始化到构建完成的全过程，包括初始化信息、设置构建时间、执行构建、解析源代码等步骤。</p></blockquote> <h3 id="输出流程"><a href="#输出流程" class="header-anchor">#</a> 输出流程</h3> <p><img src="/myblog/assets/img/webpack输出流程.504b227a.png" alt="image-20240113200152261"></p> <ol><li>在所有模块及其依赖模块 build 完成后，webpack 会监听 <code>seal</code> 事件调用各插件对构建后的结果进行封装；</li> <li>逐次对每个 module 和 chunk 进行整理，生成编译后的源码，合并，拆分，生成 hash 。同时这是我们在开发时进行代码优化和功能添加的关键环节。</li></ol> <h4 id="输出阶段事件"><a href="#输出阶段事件" class="header-anchor">#</a> <strong>输出阶段事件</strong></h4> <table><thead><tr><th>事件名</th> <th>解释</th></tr></thead> <tbody><tr><td>should-emit</td> <td>所有需要输出的文件已经生成好，询问插件哪些文件需要输出，哪些不需要。</td></tr> <tr><td>emit</td> <td>确定好要输出哪些文件后，执行文件输出，可以在这里获取和修改输出内容。</td></tr> <tr><td>after-emit</td> <td>文件输出完毕。</td></tr> <tr><td>done</td> <td>成功完成一次完成的编译和输出流程。</td></tr> <tr><td>failed</td> <td>如果在编译和输出流程中遇到异常导致 Webpack 退出时，就会直接跳转到本步骤，插件可以在本事件中获取到具体的错误原因。</td></tr></tbody></table> <p>在输出阶段已经得到了各个模块经过转换后的结果和其依赖关系，并且把相关模块组合在一起形成一个个 Chunk。 在输出阶段会根据 Chunk 的类型，使用对应的模版生成最终要要输出的文件内容。</p> <h4 id="seal-输出资源"><a href="#seal-输出资源" class="header-anchor">#</a> seal 输出资源</h4> <p><code>seal</code>方法主要是要生成<code>chunks</code>，对<code>chunks</code>进行一系列的优化操作，并生成要输出的代码</p> <p><code>webpack</code> 中的 <code>chunk</code> ，可以理解为配置在 <code>entry</code> 中的模块，或者是动态引入的模块</p> <p>根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 <code>Chunk</code>，再把每个 <code>Chunk</code> 转换成一个单独的文件加入到输出列表</p> <p><code>seal</code> 源码分析：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Compilation</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>seal <span class="token operator">=</span> <span class="token function">functionseal</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 触发插件的seal事件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">applyPlugins</span><span class="token punctuation">(</span><span class="token string">&quot;seal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//对preparedChunks进行排序</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>preparedChunks<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>name <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>name <span class="token operator">&gt;</span> b<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    return1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    return0<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将preparedChunks添加到chunks中</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>preparedChunks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">preparedChunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> module <span class="token operator">=</span> preparedChunk<span class="token punctuation">.</span>module<span class="token punctuation">;</span>
	<span class="token keyword">var</span> chunk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addChunk</span><span class="token punctuation">(</span>preparedChunk<span class="token punctuation">.</span>name<span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>
    chunk<span class="token punctuation">.</span>initial <span class="token operator">=</span> chunk<span class="token punctuation">.</span>entry <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token comment">// 关联模块和chunks:整理每个Module和chunk，每个chunk对应一个输出文件。</span>
    chunk<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>
	module<span class="token punctuation">.</span><span class="token function">addChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//调用插件的&quot;optimize-tree&quot;事件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">applyPluginsAsync</span><span class="token punctuation">(</span><span class="token string">&quot;optimize-tree&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
        <span class="token operator">...</span> <span class="token comment">// 触发插件的事件</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createChunkAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成最终assets</span>
        <span class="token operator">...</span> <span class="token comment">// 触发插件的事件</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><blockquote><p>这段代码是Webpack的编译（Compilation）对象的一个<code>seal</code>方法。</p> <p>Webpack的编译对象是整个编译过程的核心，包含了所有模块、chunk和assets的信息。</p> <p>这个<code>seal</code>方法主要是完成了以下几个步骤：</p> <ol><li><strong>触发插件的&quot;seal&quot;事件</strong>：通过<code>this.applyPlugins(&quot;seal&quot;)</code>，这个方法会触发所有已注册的插件的&quot;seal&quot;事件。这允许开发者在编译过程中插入自定义逻辑，例如优化代码或添加自定义插件。</li> <li><strong>对preparedChunks进行排序</strong>：这个排序基于chunk的名字。如果<code>a.name</code>小于<code>b.name</code>，那么<code>a</code>会被排在<code>b</code>之前。如果名字相同，则不改变它们的顺序。</li> <li><strong>将preparedChunks添加到chunks中</strong>：对于每一个<code>preparedChunk</code>，它首先被添加到编译对象的chunks中。同时，它被标记为初始的和入口的chunk。</li> <li><strong>关联模块和chunks</strong>：每一个chunk都与一个模块关联，每一个模块也与一个或多个chunks关联。这是通过调用<code>chunk.addModule(module)</code>和<code>module.addChunk(chunk)</code>来完成的。</li> <li><strong>应用插件的&quot;optimize-tree&quot;事件</strong>：这个方法会触发所有已注册的插件的&quot;optimize-tree&quot;事件，这通常用于进行进一步的优化，例如压缩代码、去除无用代码等。</li> <li><strong>生成最终的assets</strong>：调用<code>this.createChunkAssets()</code>来生成最终的assets，这些assets是编译结果，会被输出到文件系统上。</li></ol> <p>注意，代码中有一些省略的部分（用&quot;...&quot;表示），这部分可能是其他事件处理或一些其他的逻辑。</p> <p>总的来说，这个<code>seal</code>方法主要是完成Webpack编译过程中的&quot;seal&quot;阶段，它主要是准备并优化所有的chunks和modules，然后生成最终的assets。</p></blockquote> <h5 id="生成-assets-流程"><a href="#生成-assets-流程" class="header-anchor">#</a> <strong>生成 assets 流程</strong></h5> <p>seal 输出资源时，会调用 <code>createChunkAssets</code> 方法进行打包后代码的生成 assets。</p> <p><strong>createChunkAssets 流程如下</strong>：</p> <p><img src="/myblog/assets/img/createChunkAssets流程.32739b98.png" alt="createChunkAssets流程"></p> <blockquote><p>流程分析：</p> <ol><li><p>入口处理：通过判断是入口 js 还是需要异步加载的 js 来选择不同的模板对象进行封装：</p> <ul><li>入口 js 会采用 webpack 事件流的 render 事件来触发 <code>Template类</code> 中的<code>renderChunkModules()</code></li> <li>异步加载的 js 会调用 chunkTemplate 中的 render 方法；</li> <li>在 webpack 中有四个 Template 的子类模块:
<ul><li><code>MainTemplate.js</code> ：<strong>主要模板主要负责生成入口文件的代码</strong>。当你在配置文件(webpack.config.js)中指定entry为入口起点时，Webpack就会从该起点开始，找出所有的依赖模块，然后将这些模块的源代码按照特定的规则捆绑在一起。这个过程就是由MainTemplate完成的。</li> <li><code>ChunkTemplate.js</code>：<strong>块模板负责生成块(chunk)的代码</strong>。块的概念在Webpack中非常重要，一个块就是一个独立的代码块，可以是同步加载的，也可以是异步加载的。当你的项目中有很多小的、独立的部分，或者你想要根据用户的需求来按需加载某些模块时，就会用到块的概念。ChunkTemplate的作用就是把这些模块的源代码按照特定的规则捆绑在一起，生成出块的代码。</li> <li><code>ModuleTemplate.js</code> ：<strong>模块模板负责生成每一个模块的代码</strong>。每一个模块都是一个独立的文件，它们各自负责自己的功能。ModuleTemplate的作用就是把这些模块的源代码按照特定的规则捆绑在一起，生成出每一个模块的代码。</li> <li><code>HotUpdateChunkTemplate.js</code> :<strong>热更新块模板用于生成热更新代码块</strong>。热更新是一种特殊的更新方式，它可以在不刷新页面的情况下，动态地更新页面的某些部分。HotUpdateChunkTemplate的作用就是生成用于热更新的代码块，这个代码块包含了新旧版本的模块代码，以及用于比较新旧版本差异的代码。</li></ul></li></ul></li> <li><p>模块封装：当 chunk.module 为 true 时，进行模块封装。</p> <ul><li>模块在封装的时候和它在构建时一样，都是调用各模块类中的方法。</li> <li>封装通过调用<code>module.source()</code> 来进行各操作，比如说 require() 的替换。</li></ul></li> <li><p>生成 assets：</p> <ul><li>各模块进行 doBlock 后，把 module 的最终代码循环添加到 source 中。</li> <li>一个 source 对应着一个 asset 对象，该对象保存了单个文件的文件名( name )和最终代码( value )。</li></ul></li></ol></blockquote> <h4 id="emit-输出完成"><a href="#emit-输出完成" class="header-anchor">#</a> emit 输出完成</h4> <p>最后一步，webpack 调用 Compiler 中的 <code>emitAssets()</code></p> <p>按照 output 中的配置项将文件输出到了对应的 path 中，从而 webpack 整个打包过程结束。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>要注意的是，若想对结果进行处理，则需要在 <code>emit</code> 触发后对自定义插件进行扩展。</p> <h3 id="构建函数流程图"><a href="#构建函数流程图" class="header-anchor">#</a> <strong>构建函数流程图</strong></h3> <p><img src="/myblog/assets/img/webpack各个阶段任务.9fcb06b7.png" alt="image-20240109150135580"></p> <h3 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> <strong>常见问题</strong></h3> <h3 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h3> <p><a href="https://developer.aliyun.com/article/61047" target="_blank" rel="noopener noreferrer">细说 webpack 之流程篇<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="手动实现打包器"><a href="#手动实现打包器" class="header-anchor">#</a> <strong>手动实现打包器</strong></h2> <h3 id="打包流程"><a href="#打包流程" class="header-anchor">#</a> <strong>打包流程</strong></h3> <ol><li>读取入口文件(比如entry.js)；</li> <li>基于 AST 分析入口文件，并产出依赖列表；</li> <li>使用Babel将相关模块编译到ES5；</li> <li>对每个依赖模块产出一个唯一的ID，方便后续读取模块相关内容；</li> <li>将每个依赖以及经过 Babel编译过后的内容，存储在一个对象中进行维护；</li> <li>遍历上一步中的对象，构建出一个依赖图 (DependencyGraph)；</li> <li>将各模块内容bundle产出；</li></ol> <h3 id="核心步骤"><a href="#核心步骤" class="header-anchor">#</a> 核心步骤</h3> <p><img src="/myblog/assets/img/手动实现打包器.ecfb3848.png" alt="image-20240113192137498"></p> <h3 id="打包器流程图"><a href="#打包器流程图" class="header-anchor">#</a> <strong>打包器流程图</strong></h3> <p><img src="/myblog/assets/img/webpack构建流程.6867751d.png" alt="image-20240113165412460"></p> <h3 id="实现代码"><a href="#实现代码" class="header-anchor">#</a> <strong>实现代码</strong></h3> <p>要实现一个简单的前端打包器，我们需要使用一些工具和库来辅助我们完成上述流程。</p> <p>以下是一个使用Node.js和Babel的基础实现：</p> <ol><li>首先，确保你已经安装了Node.js和npm。然后，创建一个新的项目文件夹，并在其中初始化一个新的npm项目：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> my-packager  
<span class="token builtin class-name">cd</span> my-packager  
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>安装必要的依赖：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bash复制代码

<span class="token function">npm</span> <span class="token function">install</span> babel-loader @babel/core @babel/preset-env webpack --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>创建一个<code>packager.js</code>文件，并开始编写打包器的代码：</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">const</span> BabelLoader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-loader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">const</span> babelCore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">const</span> babelPresetEnv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 配置Babel和Webpack  </span>
<span class="token keyword">const</span> babelLoaderConfig <span class="token operator">=</span> <span class="token punctuation">{</span>  
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 匹配所有.js文件  </span>
  <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 排除node_modules目录  </span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>  
    <span class="token punctuation">{</span>  
      <span class="token literal-property property">loader</span><span class="token operator">:</span> BabelLoader<span class="token punctuation">,</span>  
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
        <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>babelPresetEnv<span class="token punctuation">]</span> <span class="token comment">// 使用@babel/preset-env预设进行转译  </span>
      <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  <span class="token punctuation">]</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
  
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>  
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token comment">// 或者 'production'  </span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/entry.js'</span><span class="token punctuation">,</span> <span class="token comment">// 入口文件路径  </span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 输出目录  </span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span> <span class="token comment">// 打包后的文件名  </span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>  
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>babelLoaderConfig<span class="token punctuation">]</span> <span class="token comment">// 使用Babel进行转译的配置  </span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 读取入口文件并分析AST产出依赖列表  </span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">analyzeAST</span><span class="token punctuation">(</span><span class="token parameter">entryPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> sourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>entryPath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">const</span> ast <span class="token operator">=</span> babelCore<span class="token punctuation">.</span><span class="token function">parseSync</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">'module'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用Babel的解析器生成AST  </span>
  <span class="token keyword">return</span> ast<span class="token punctuation">;</span> <span class="token comment">// 这里只是简单返回AST，实际应用中可能需要进一步分析AST来获取依赖关系。  </span>
<span class="token punctuation">}</span>  
  
<span class="token comment">// 主函数，启动打包流程  </span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">packager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> entryPath <span class="token operator">=</span> webpackConfig<span class="token punctuation">.</span>entry<span class="token punctuation">;</span> <span class="token comment">// 入口文件路径  </span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">analyzeAST</span><span class="token punctuation">(</span>entryPath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分析AST并产出依赖列表（这里简化了）  </span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建Webpack编译器实例并配置webpackConfig作为配置对象传入。  </span>
  compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 运行编译器。err是错误对象，stats是Webpack提供的编译统计信息。  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>   
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'打包失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>   
      <span class="token keyword">return</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'打包过程中发生错误:'</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasWarnings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'打包过程中发生警告:'</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>warnings<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>   
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'打包成功!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>  
<span class="token function">packager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启动打包流程。你可以在需要的时候多次调用此函数来多次打包。例如：packager(), 通常情况下你只需要调用一次就足够了。 打包成功后，你将在项目的dist目录下看到生成的bundle.js文件。这就是你的打包结果。你可以在HTML文件中引用这个文件来运行你的应用。例如：&lt;script src=&quot;dist/bundle.js&quot;&gt;&lt;/script&gt;。这只是一个简单的实现，并不包含Tree Shaking等高级特性。要实现这些特性，你可能需要更深入地学习Webpack并对其进行配置。例如，要启用Tree Shaking，你需要在Webpack的配置中设置mode为production并移除一些不必要的插件和加载器。同时，你可能还需要使用一些第三方工具来帮助你检测你的代码中的死代码并对其进行清理。例如，你可以使用babel-plugin-transform-remove-unused-polyfills插件来删除未使用的polyfills，或者使用babel-plugin-transform-remove-unused-variables插件来删除未使用的变量。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h2 id="参考资料-2"><a href="#参考资料-2" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://webpack.wuhaolin.cn/%E5%89%8D%E8%A8%80.html" target="_blank" rel="noopener noreferrer">深入浅出 WebPack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">January 30, 2024 09:47</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 596777598@qq.com" class="contributor">
          sewar
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/myblog/assets/js/app.9d2b617a.js" defer></script><script src="/myblog/assets/js/layout-Layout.d2d4ce64.js" defer></script><script src="/myblog/assets/js/page-WebPack构建原理.9c29703e.js" defer></script><script src="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" defer></script>
  </body>
</html>
