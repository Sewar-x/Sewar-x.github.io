<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise 专题 | Sewen 博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="./mylogo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="manifest" href="/myblog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://sewar-x.github.io/myblog/atom.xml" title="Sewen 博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 RSS Feed">
    <meta name="description" content="sewen 的前端学习笔记、博客、前端基础总结、技术深度剖析、面试题总结、算法总结、项目过程总结">
    <meta property="og:url" content="https://sewar-x.github.io/myblog/javascript/Promise.html">
    <meta property="og:site_name" content="Sewen 博客">
    <meta property="og:title" content="Promise 专题">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.645fbc6f.css" as="style"><link rel="preload" href="/myblog/assets/js/app.9d2b617a.js" as="script"><link rel="preload" href="/myblog/assets/js/layout-Layout.d2d4ce64.js" as="script"><link rel="preload" href="/myblog/assets/js/page-Promise专题.7869a31b.js" as="script"><link rel="preload" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" as="script"><link rel="prefetch" href="/myblog/assets/js/199.a9216960.js"><link rel="prefetch" href="/myblog/assets/js/200.4c66fc79.js"><link rel="prefetch" href="/myblog/assets/js/layout-Blog.1fca7e90.js"><link rel="prefetch" href="/myblog/assets/js/layout-NotFound.3c74e8aa.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/AlgoliaSearch/Dropdown.70fcebe7.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Anchor.3235541c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleInfo.7b815b20.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleItem.b0e177e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleList.d1cf1b24.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleType.b630b80e.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHero.621312ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHome.4fe44489.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogInfo.b2a94760.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogPage.e0fbe820.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BloggerInfo.0df38355.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/CategoryList.ec1bcd96.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ProjectList.8550a110.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TagList.bcf7b782.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/Timeline.b6cf5471.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TimelineList.3c6e08a6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Clipboard.e940a903.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Common.820a8694.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Home.70383986.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/MyTransition.0de46069.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/DropdownLink.e3f6c118.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLink.93b11770.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLinks.8ba214e6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/Navbar.b90a94f9.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/RepoLink.663a7f55.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/SidebarButton.76b0035a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Page.98b5d09c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageFooter.20bc9bd8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageMeta.b7e6b12f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageNav.8305dd1f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Password.45e0e82a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/DropdownTransition.068c5eea.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/Sidebar.f6f90d52.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarDropdownLink.505127a8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarGroup.7eecf370.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarLink.6e39fe32.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarNavLinks.0f8566cb.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/DarkmodeSwitch.20ac7b92.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeColor.6086e4ed.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeOptions.483238c9.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ArticleIcon.0a22e2b1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/AutoIcon.2ff1c790.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/BookIcon.419b49ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/DarkIcon.7d81873b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EditIcon.8ada485d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EmptyIcon.d704a5cf.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/I18nIcon.ffad8b3e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LightIcon.47d807da.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LinkIcon.1a8a7826.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LockIcon.a29a2b79.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/NextIcon.0214ee59.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/Page404Icon.8bc1ebbb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PresentationIcon.17500d9b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PrevIcon.2ae04a70.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ProjectIcon.b336d567.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/StickyIcon.0f509b9d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Baidu.244b9a41.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Bitbucket.11ba94e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dingding.e8a3d90d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Discord.3295a55b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dribbble.464dac3b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Email.f9254caa.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Evernote.991472fb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Facebook.08e78e47.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Flipboard.a1124d0f.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitee.c44bc20a.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Github.5667e5ae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitlab.ad95c7a7.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gmail.b5acc6bc.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Instagram.56be85f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Lines.d9db3dce.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Linkedin.b82d8d8b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pinterest.0f3ffe71.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pocket.41ef3c92.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/QQ.7558f4ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Qzone.bf658fae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Reddit.9c4c95ee.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Rss.9780139e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Steam.06abbae2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Twitter.26fa5bda.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Wechat.9cac8c4c.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Weibo.5206a632.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Whatsapp.0738f1e3.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Youtube.f41fd7f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Zhihu.4d851d2f.js"><link rel="prefetch" href="/myblog/assets/js/page--0abc50bf.0d6f1484.js"><link rel="prefetch" href="/myblog/assets/js/page--1cd40f4c.dd76c7b3.js"><link rel="prefetch" href="/myblog/assets/js/page--53f93199.e80bdec8.js"><link rel="prefetch" href="/myblog/assets/js/page--5afd2fd0.adea4e92.js"><link rel="prefetch" href="/myblog/assets/js/page--67c584d3.0a3f3cd9.js"><link rel="prefetch" href="/myblog/assets/js/page--776a8506.cdf48aac.js"><link rel="prefetch" href="/myblog/assets/js/page-CSS.eb94b29f.js"><link rel="prefetch" href="/myblog/assets/js/page-Chrome开发工具使用指南.a2675120.js"><link rel="prefetch" href="/myblog/assets/js/page-DevServer.0281863d.js"><link rel="prefetch" href="/myblog/assets/js/page-Echarts二次封装.4387b8ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Elementui与Element-plusui二次封装.82f12a09.js"><link rel="prefetch" href="/myblog/assets/js/page-Git基础.03c616ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Git规范.e2fdc38a.js"><link rel="prefetch" href="/myblog/assets/js/page-HTML.1e3c14b9.js"><link rel="prefetch" href="/myblog/assets/js/page-Home.f0b7e772.js"><link rel="prefetch" href="/myblog/assets/js/page-JSON配置化组件二次封装.12060fd9.js"><link rel="prefetch" href="/myblog/assets/js/page-JS原理实现.3c427e19.js"><link rel="prefetch" href="/myblog/assets/js/page-JS应用题.3d313b34.js"><link rel="prefetch" href="/myblog/assets/js/page-JavaScript基础.551be887.js"><link rel="prefetch" href="/myblog/assets/js/page-Linux.c6159ebd.js"><link rel="prefetch" href="/myblog/assets/js/page-Loader和Plugin原理.b2971b76.js"><link rel="prefetch" href="/myblog/assets/js/page-MySQL.0b1d704a.js"><link rel="prefetch" href="/myblog/assets/js/page-NPM.a55851b2.js"><link rel="prefetch" href="/myblog/assets/js/page-Node.ec405a21.js"><link rel="prefetch" href="/myblog/assets/js/page-Nodejs常见问题集合.12844e69.js"><link rel="prefetch" href="/myblog/assets/js/page-Node性能优化.b4ea1c34.js"><link rel="prefetch" href="/myblog/assets/js/page-React.d76cf0ac.js"><link rel="prefetch" href="/myblog/assets/js/page-SSG移动端项目实践.2122615b.js"><link rel="prefetch" href="/myblog/assets/js/page-TypeScript.4f597fda.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite.637881bf.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite原理解析.6677fdb4.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue25项目webpack构建分析.7bbea0fa.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2VsVue3.10be4140.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2x原理源码分析.e9e753b6.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3基础.210247ff.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3源码分析.17379e04.js"><link rel="prefetch" href="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js"><link rel="prefetch" href="/myblog/assets/js/page-VueRouter原理分析.0a092eb6.js"><link rel="prefetch" href="/myblog/assets/js/page-VueSSR原理分析.63006040.js"><link rel="prefetch" href="/myblog/assets/js/page-VueVsReact.2156be28.js"><link rel="prefetch" href="/myblog/assets/js/page-Vuex原理分析.5ba3e6e4.js"><link rel="prefetch" href="/myblog/assets/js/page-WEB安全.5aa0eeef.js"><link rel="prefetch" href="/myblog/assets/js/page-WebPack构建原理.9c29703e.js"><link rel="prefetch" href="/myblog/assets/js/page-webpackAPI分析.4c8b152b.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack优化.dcc6c3bc.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack基础.3820ee6c.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack项目实践.77e22417.js"><link rel="prefetch" href="/myblog/assets/js/page-一次后台管理系统的性能优化.7c2d8712.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建SSR项目.855376fc.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue2项目和规范设计.93017fd2.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue3单页面应用.de152d54.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建公共组件库.93278073.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js"><link rel="prefetch" href="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js"><link rel="prefetch" href="/myblog/assets/js/page-分治.e3dfc22d.js"><link rel="prefetch" href="/myblog/assets/js/page-前端发版静态资源404问题.9eb1ca89.js"><link rel="prefetch" href="/myblog/assets/js/page-前端存储.cd82cf54.js"><link rel="prefetch" href="/myblog/assets/js/page-前端工程化.1e6e58d0.js"><link rel="prefetch" href="/myblog/assets/js/page-前端性能优化方案.83718d22.js"><link rel="prefetch" href="/myblog/assets/js/page-前端架构实践.171dbc0f.js"><link rel="prefetch" href="/myblog/assets/js/page-前端渲染架构.3b783de8.js"><link rel="prefetch" href="/myblog/assets/js/page-前端自动部署.5076846c.js"><link rel="prefetch" href="/myblog/assets/js/page-前端部署原理.82ecd8a7.js"><link rel="prefetch" href="/myblog/assets/js/page-动态规划.a3af92f1.js"><link rel="prefetch" href="/myblog/assets/js/page-哈希表.c76000e8.js"><link rel="prefetch" href="/myblog/assets/js/page-回溯算法.cd914c32.js"><link rel="prefetch" href="/myblog/assets/js/page-图.dfd9828a.js"><link rel="prefetch" href="/myblog/assets/js/page-基础.7bf5a37b.js"><link rel="prefetch" href="/myblog/assets/js/page-堆.4657e538.js"><link rel="prefetch" href="/myblog/assets/js/page-字符串.252f2a08.js"><link rel="prefetch" href="/myblog/assets/js/page-异步编程.904f4c65.js"><link rel="prefetch" href="/myblog/assets/js/page-性能优化指标和监控.f2175836.js"><link rel="prefetch" href="/myblog/assets/js/page-排序算法.c7a51b99.js"><link rel="prefetch" href="/myblog/assets/js/page-搭建低代码平台.19eaf5ec.js"><link rel="prefetch" href="/myblog/assets/js/page-操作系统.473c4281.js"><link rel="prefetch" href="/myblog/assets/js/page-数学运算.c82748fb.js"><link rel="prefetch" href="/myblog/assets/js/page-数据结构算法.84480586.js"><link rel="prefetch" href="/myblog/assets/js/page-数组.692b0d0a.js"><link rel="prefetch" href="/myblog/assets/js/page-权限管理.c7e10db0.js"><link rel="prefetch" href="/myblog/assets/js/page-查找.790e52df.js"><link rel="prefetch" href="/myblog/assets/js/page-栈和队列.8dbc3586.js"><link rel="prefetch" href="/myblog/assets/js/page-树.24efdeaa.js"><link rel="prefetch" href="/myblog/assets/js/page-浏览器.bee9ec04.js"><link rel="prefetch" href="/myblog/assets/js/page-混合桌面应用开发.9e10d1c3.js"><link rel="prefetch" href="/myblog/assets/js/page-登录.bb830451.js"><link rel="prefetch" href="/myblog/assets/js/page-目录.c85b4d0b.js"><link rel="prefetch" href="/myblog/assets/js/page-移动端开发.56ac22ec.js"><link rel="prefetch" href="/myblog/assets/js/page-组件和组件封装.b5e86da2.js"><link rel="prefetch" href="/myblog/assets/js/page-计算机网络基础.0a106662.js"><link rel="prefetch" href="/myblog/assets/js/page-设计模式.ffdc7cfd.js"><link rel="prefetch" href="/myblog/assets/js/page-调试技巧.485ae36e.js"><link rel="prefetch" href="/myblog/assets/js/page-贪心算法.0f417640.js"><link rel="prefetch" href="/myblog/assets/js/page-输入url到页面展示全过程.510aef2e.js"><link rel="prefetch" href="/myblog/assets/js/page-递归.5e55e552.js"><link rel="prefetch" href="/myblog/assets/js/page-链表.1cf6927f.js"><link rel="prefetch" href="/myblog/assets/js/page-项目总结.ffcd2a4b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~docsearch.f3877d0d.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~5d377965.d9712593.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-components/Blog/ArticleItem~layout-components/Blog/ArticleL~b56f3aac.47bb5cb5.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-NotFound~layout-components/Common~layout-components/Page.57d58db9.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Slide.81546b3b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/AlgoliaSearch/Full.b30f067a.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Blog/BlogPage.bcccbd38.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Navbar/Navbar.e2a7361e.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Page.6c65077c.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Sidebar/Sidebar.34cd9cf7.js"><link rel="prefetch" href="/myblog/assets/js/vendors~photo-swipe.428df1da.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.645fbc6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/myblog/" class="home-link router-link-active"><img src="./mylogo.png" alt="Sewen 博客" class="logo"> <!----> <span class="site-name can-hide">Sewen 博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
        前端基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><a href="/myblog/javascript/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><a href="/myblog/javascript/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><a href="/myblog/javascript/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
        计算机基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><a href="/myblog/javascript/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><a href="/myblog/javascript/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><a href="/myblog/javascript/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><a href="/myblog/javascript/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/myblog/javascript/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
        框架和源码分析
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><a href="/myblog/javascript/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><a href="/myblog/javascript/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><a href="/myblog/javascript/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><a href="/myblog/javascript/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
        浏览器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><a href="/myblog/javascript/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><a href="/myblog/javascript/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
        服务器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><a href="/myblog/javascript/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><a href="/myblog/javascript/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><a href="/myblog/javascript/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><a href="/myblog/javascript/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
        性能优化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><a href="/myblog/javascript/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><a href="/myblog/javascript/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
        前端工程
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><a href="/myblog/javascript/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><a href="/myblog/javascript/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><a href="/myblog/javascript/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><a href="/myblog/javascript/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
        项目实践
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><a href="/myblog/javascript/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
        项目搭建
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><a href="/myblog/javascript/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="./mylogo.png" class="avatar round"> <div property="name" class="name">Sewen 博客</div> <meta property="url" content="../outline.md"></div> <div class="num-wrapper"><div><div class="num">91</div> <div>Articles</div></div> <div><div class="num">0</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">91</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/Sewar-x/myblog" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="1567910907" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up" class="media-link"><span class="sr-only">Wechat</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E"></circle> <path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#FFF"></path> <path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
      前端基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
      计算机基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
      框架和源码分析
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
      浏览器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
      服务器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
      性能优化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
      前端工程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
      项目实践
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
      项目搭建
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><!----> <a href="/myblog/javascript/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/javascript/" aria-current="page" class="sidebar-link">JavaScript 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#es6新特性" class="sidebar-link">ES6新特性</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#严格模式的限制" class="sidebar-link">严格模式的限制</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#script-标签加载脚本" class="sidebar-link">Script 标签加载脚本</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#js-延迟加载方式" class="sidebar-link">JS 延迟加载方式</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#内存分类" class="sidebar-link">内存分类</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#数据类型" class="sidebar-link">数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#undefined-null" class="sidebar-link heading3">undefined &amp; null</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#nan" class="sidebar-link heading3">NaN</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#精度丢失" class="sidebar-link">精度丢失</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#整数相关问题" class="sidebar-link">整数相关问题</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#显示转换-隐式转换" class="sidebar-link">显示转换&amp;隐式转换</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#运算符规则" class="sidebar-link">运算符规则</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#位运算符" class="sidebar-link">位运算符</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#异或运算" class="sidebar-link heading3">异或运算</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#尾后逗号" class="sidebar-link">尾后逗号</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#symbol" class="sidebar-link">Symbol</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#类型判断" class="sidebar-link">类型判断</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#typeof-操作符" class="sidebar-link heading3">typeof 操作符</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#instanceof-操作符" class="sidebar-link heading3">instanceof 操作符</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#数据类型判断方法" class="sidebar-link heading3">数据类型判断方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#数组" class="sidebar-link">数组</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#数组创建和检测" class="sidebar-link heading3">数组创建和检测</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#数组方法" class="sidebar-link heading3">数组方法</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#会改变原数组方法" class="sidebar-link heading3">会改变原数组方法</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#数组迭代" class="sidebar-link heading3">数组迭代</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#for-in-与-for-of-比较" class="sidebar-link heading3">for...in 与 for...of 比较</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#类数组" class="sidebar-link">类数组</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#字符串" class="sidebar-link">字符串</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#字符串的不可变性" class="sidebar-link heading3">字符串的不可变性</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#object-对象" class="sidebar-link">Object 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#对象访问" class="sidebar-link heading3">对象访问</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#对象方法" class="sidebar-link heading3">对象方法</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#对象属性" class="sidebar-link heading3">对象属性</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#对象属性方法" class="sidebar-link heading3">对象属性方法</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#防篡改对象" class="sidebar-link heading3">防篡改对象</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#假值对象" class="sidebar-link heading3">假值对象</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#内置对象" class="sidebar-link heading3">内置对象</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#new操作符" class="sidebar-link heading3">new操作符</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#深浅拷贝" class="sidebar-link">深浅拷贝</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#集合" class="sidebar-link">集合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#set-集合" class="sidebar-link heading3">Set 集合</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#weakset" class="sidebar-link heading3">WeakSet</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#map-集合" class="sidebar-link heading3">Map 集合</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#set、map、object-比较" class="sidebar-link heading3">Set、Map、Object 比较</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#变量" class="sidebar-link">变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#变量声明方式" class="sidebar-link heading3">变量声明方式</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#变量提升和函数提升" class="sidebar-link heading3">变量提升和函数提升</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#this-和-this-绑定" class="sidebar-link">this 和 this 绑定</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#执行环境-环境栈" class="sidebar-link">执行环境&amp;环境栈</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#作用域-作用域链" class="sidebar-link">作用域&amp;作用域链</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#prototype-对象" class="sidebar-link">Prototype 对象</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#prototype属性和proto-属性" class="sidebar-link">Prototype属性和proto 属性</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#获取原型方法" class="sidebar-link">获取原型方法</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#constructor-属性" class="sidebar-link">constructor 属性</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#原型-原型链" class="sidebar-link">原型&amp;原型链</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#es5-函数" class="sidebar-link heading3">ES5 函数</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#箭头函数" class="sidebar-link heading3">箭头函数</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#箭头函数与普通函数的区别" class="sidebar-link heading3">箭头函数与普通函数的区别</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#其他函数" class="sidebar-link heading3">其他函数</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#函数柯里化" class="sidebar-link heading3">函数柯里化</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#对象" class="sidebar-link">对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#创建对象方式有哪些" class="sidebar-link heading3">创建对象方式有哪些</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#创建对象方式比较" class="sidebar-link heading3">创建对象方式比较</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#对象继承方式" class="sidebar-link heading3">对象继承方式</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#对象继承方式比较" class="sidebar-link heading3">对象继承方式比较</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#类" class="sidebar-link">类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#class-类" class="sidebar-link heading3">Class 类</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#class-继承" class="sidebar-link heading3">Class 继承</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#reflect-对象" class="sidebar-link">Reflect 对象</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#object-defineproperty" class="sidebar-link">Object.defineProperty</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#proxy-对象" class="sidebar-link">Proxy 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#object-defineproperty-和-proxy-比较" class="sidebar-link heading3">Object.defineProperty 和 Proxy 比较</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#模块加载方案" class="sidebar-link">模块加载方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#commonjs-模块" class="sidebar-link heading3">CommonJS 模块</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#es6模块" class="sidebar-link heading3">ES6模块</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#模块加载混合引用" class="sidebar-link heading3">模块加载混合引用</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#模块加载循环引用" class="sidebar-link heading3">模块加载循环引用</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#定时器" class="sidebar-link">定时器</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#垃圾回收" class="sidebar-link">垃圾回收</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#内存泄漏" class="sidebar-link heading3">内存泄漏</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#ajax" class="sidebar-link">AJax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#创建-ajax-过程" class="sidebar-link heading3">创建 Ajax 过程</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#消息推送技术" class="sidebar-link">消息推送技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#sse实现" class="sidebar-link heading3">SSE实现</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#websocket-实现" class="sidebar-link heading3">websocket 实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#跨页面通信方法" class="sidebar-link">跨页面通信方法</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#iframe框架" class="sidebar-link">Iframe框架</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#bom" class="sidebar-link">BOM</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#dom" class="sidebar-link">DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#dom事件分类" class="sidebar-link heading3">DOM事件分类</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#事件流" class="sidebar-link">事件流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#事件是如果实现的" class="sidebar-link heading3">事件是如果实现的？</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#事件委托-代理" class="sidebar-link heading3">事件委托(代理)</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#js-兼容性" class="sidebar-link">JS 兼容性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/#兼容性问题" class="sidebar-link heading3">兼容性问题</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/#兼容性统一处理方案" class="sidebar-link heading3">兼容性统一处理方案</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/" class="sidebar-link">异步编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#宏任务-微任务" class="sidebar-link">宏任务&amp;微任务</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#浏览器事件循环" class="sidebar-link">浏览器事件循环</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#node-事件循环" class="sidebar-link">Node 事件循环</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#浏览器-node-事件循环区别" class="sidebar-link">浏览器&amp;Node 事件循环区别</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#异步编程方式" class="sidebar-link">异步编程方式</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#模拟异步操作方式" class="sidebar-link">模拟异步操作方式</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#pomise-对象" class="sidebar-link">Pomise 对象</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#async-await" class="sidebar-link">async await</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#异步循环" class="sidebar-link">异步循环</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#异步串行" class="sidebar-link">异步串行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#回调实现" class="sidebar-link heading3">回调实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#异步并行" class="sidebar-link">异步并行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#全并行" class="sidebar-link heading3">全并行</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#有限并行" class="sidebar-link heading3">有限并行</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#异步题目" class="sidebar-link">异步题目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#异步api执行顺序" class="sidebar-link heading3">异步API执行顺序</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/#settimeout-与-setimmediate-输出顺序" class="sidebar-link heading3">setTimeout 与 setImmediate 输出顺序</a></li></ul></li></ul></li><li><a href="/myblog/javascript/Promise/" aria-current="page" class="active sidebar-link">Promise 专题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-基础" class="sidebar-link">Promise 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-概念" class="sidebar-link heading3">Promise 概念</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#then" class="sidebar-link heading3">then()</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#错误处理" class="sidebar-link heading3">错误处理</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-值穿透" class="sidebar-link heading3">Promise 值穿透</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#finally" class="sidebar-link heading3">finally()</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#包装pomise-对象" class="sidebar-link heading3">包装Pomise 对象</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#并发方法" class="sidebar-link heading3">并发方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-原理实现" class="sidebar-link">Promise 原理实现</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-执行顺序" class="sidebar-link">Promise 执行顺序</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-封装异步操作" class="sidebar-link">Promise 封装异步操作</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-特性" class="sidebar-link">Promise 特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-特性问题" class="sidebar-link heading3">Promise 特性问题</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-应用题" class="sidebar-link heading3">Promise 应用题</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promisec串行" class="sidebar-link">Promisec串行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#串行概念" class="sidebar-link heading3">串行概念</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#pomise-串行实现" class="sidebar-link heading3">Pomise 串行实现</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#串行应用" class="sidebar-link heading3">串行应用</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#promise-并行" class="sidebar-link">Promise 并行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#并行执行-api" class="sidebar-link heading3">并行执行 API</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#并发控制" class="sidebar-link heading3">并发控制</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/Promise/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/" class="sidebar-link">JS原理实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-new-操作符" class="sidebar-link">实现 new 操作符</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-instanceof-操作符" class="sidebar-link">实现 instanceof 操作符</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-object-create" class="sidebar-link">实现 Object.create()</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-call" class="sidebar-link">实现 call()</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-apply" class="sidebar-link">实现 apply()</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-bind" class="sidebar-link">实现 bind()</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-sort" class="sidebar-link">实现 sort()</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现准时的-settimeout" class="sidebar-link">实现准时的 setTimeout</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现深拷贝" class="sidebar-link">实现深拷贝</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现防抖" class="sidebar-link">实现防抖</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现节流" class="sidebar-link">实现节流</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现函数柯里化" class="sidebar-link">实现函数柯里化</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#柯里化函数题目" class="sidebar-link">柯里化函数题目</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现图片懒加载" class="sidebar-link">实现图片懒加载</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-jsonp" class="sidebar-link">实现 JSONP</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现单例模式" class="sidebar-link">实现单例模式</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#观察者模式" class="sidebar-link">观察者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#通用实现" class="sidebar-link heading3">通用实现</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#defineproperty-实现" class="sidebar-link heading3">defineProperty 实现</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#proxy实现" class="sidebar-link heading3">Proxy实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#发布订阅者模式" class="sidebar-link">发布订阅者模式</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现generator" class="sidebar-link">实现Generator</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/#实现-async-await" class="sidebar-link">实现 async await</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/javascript/%E5%BA%94%E7%94%A8%E9%A2%98/" class="sidebar-link">JS应用题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BA%94%E7%94%A8%E9%A2%98/#图片预加载和懒加载" class="sidebar-link">图片预加载和懒加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BA%94%E7%94%A8%E9%A2%98/#图片预加载" class="sidebar-link heading3">图片预加载</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BA%94%E7%94%A8%E9%A2%98/#图片懒加载" class="sidebar-link heading3">图片懒加载</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BA%94%E7%94%A8%E9%A2%98/#url-拆解问题" class="sidebar-link">URL 拆解问题</a></li><li class="sidebar-sub-header"><a href="/myblog/javascript/%E5%BA%94%E7%94%A8%E9%A2%98/#将-http-header-转换成对象" class="sidebar-link">将 HTTP header 转换成对象</a></li></ul></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/myblog/javascript/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">JavaScript 基础</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/myblog/javascript/Promise/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">Promise 专题</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Promise 专题</span></h1> <div class="page-info"><!----> <true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/myblog/javascript/Promise/#promise-基础" class="anchor-link heading2"><div>Promise 基础</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-概念" class="anchor-link heading3"><div>Promise 概念</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#then" class="anchor-link heading3"><div>then()</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#错误处理" class="anchor-link heading3"><div>错误处理</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-值穿透" class="anchor-link heading3"><div>Promise 值穿透</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#finally" class="anchor-link heading3"><div>finally()</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#包装pomise-对象" class="anchor-link heading3"><div>包装Pomise 对象</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#并发方法" class="anchor-link heading3"><div>并发方法</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-原理实现" class="anchor-link heading2"><div>Promise 原理实现</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-执行顺序" class="anchor-link heading2"><div>Promise 执行顺序</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-封装异步操作" class="anchor-link heading2"><div>Promise 封装异步操作</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-特性" class="anchor-link heading2"><div>Promise 特性</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-特性问题" class="anchor-link heading3"><div>Promise 特性问题</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-应用题" class="anchor-link heading3"><div>Promise 应用题</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promisec串行" class="anchor-link heading2"><div>Promisec串行</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#串行概念" class="anchor-link heading3"><div>串行概念</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#pomise-串行实现" class="anchor-link heading3"><div>Pomise 串行实现</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#串行应用" class="anchor-link heading3"><div>串行应用</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#promise-并行" class="anchor-link heading2"><div>Promise 并行</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#并行执行-api" class="anchor-link heading3"><div>并行执行 API</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#并发控制" class="anchor-link heading3"><div>并发控制</div></a></li><li class="anchor"><a href="/myblog/javascript/Promise/#参考资料" class="anchor-link heading2"><div>参考资料</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="promise-专题"><a href="#promise-专题" class="header-anchor">#</a> Promise 专题</h1> <h2 id="promise-基础"><a href="#promise-基础" class="header-anchor">#</a> Promise 基础</h2> <h3 id="promise-概念"><a href="#promise-概念" class="header-anchor">#</a> Promise 概念</h3> <p><img src="/myblog/assets/img/promise1.3f841ca1.png" alt=""></p> <p><img src="data:image/png;base64,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" alt="promise2"></p> <p><img src="/myblog/assets/img/promise3.ba695087.png" alt="promise3"></p> <p><img src="/myblog/assets/img/promise4.6ebcf926.png" alt="promise1"></p> <h3 id="then"><a href="#then" class="header-anchor">#</a> then()</h3> <p><img src="/myblog/assets/img/promise-then.b2aa2e8f.png" alt=""></p> <p><img src="/myblog/assets/img/promise-then2.909c56f0.png" alt="promise-then"></p> <h3 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h3> <p><img src="/myblog/assets/img/promise-err.1994d4be.png" alt=""></p> <h3 id="promise-值穿透"><a href="#promise-值穿透" class="header-anchor">#</a> Promise 值穿透</h3> <p><img src="/myblog/assets/img/promise-chuantou.a8b134cd.png" alt=""></p> <h3 id="finally"><a href="#finally" class="header-anchor">#</a> finally()</h3> <p><img src="/myblog/assets/img/promise-fianlly.fecbf14e.png" alt=""></p> <h3 id="包装pomise-对象"><a href="#包装pomise-对象" class="header-anchor">#</a> 包装Pomise 对象</h3> <p><img src="/myblog/assets/img/promise-baozhuang.a381f5be.png" alt=""></p> <h3 id="并发方法"><a href="#并发方法" class="header-anchor">#</a> 并发方法</h3> <p><img src="/myblog/assets/img/promise-bingfa.f11fb167.png" alt=""></p> <p>promise 基础直接参考 阮一峰<a href="https://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener noreferrer">《ECMAScript 6 入门》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="promise-原理实现"><a href="#promise-原理实现" class="header-anchor">#</a> Promise 原理实现</h2> <p>强烈推荐先看 《<a href="https://mp.weixin.qq.com/s/UNzYgpnKzmW6bAapYxnXRQ" target="_blank" rel="noopener noreferrer">图解 Promise 实现原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 》文章，文章内容将原理讲述透彻，该系列文章有如下几个章节组成：</p> <ol><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzI4NjY4MTU5Nw==&amp;mid=2247486661&amp;idx=1&amp;sn=8e4b3056aa9c110ca08047d0917290f4&amp;chksm=ebd87c57dcaff54168d1a8f94b074fa814270b9753d8c1e7eebe3b4203254ecb0e6989ba1f19&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">图解 Promise 实现原理（一）—— 基础实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://mp.weixin.qq.com/s?__biz=MzI4NjY4MTU5Nw==&amp;mid=2247486706&amp;idx=2&amp;sn=9434eb4f5ea43e46de70a6486afbffbf&amp;chksm=ebd87c60dcaff57669d389cf114a993b15df789b1b14fe1f4c89e38d304d79489dc5394e9296&amp;scene=178&amp;cur_album_id=1500522652875194368#rd" target="_blank" rel="noopener noreferrer">图解 Promise 实现原理（二）—— Promise 链式调用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://mp.weixin.qq.com/s?__biz=MzI4NjY4MTU5Nw==&amp;mid=2247486850&amp;idx=2&amp;sn=647638dbb430da2c23a1320033fc806f&amp;chksm=ebd87d10dcaff40681acb2ee93b5516ae190e1111938fc72da12178e3d7f9c9fe5ffa0569254&amp;scene=178&amp;cur_album_id=1500522652875194368#rd" target="_blank" rel="noopener noreferrer">图解 Promise 实现原理（三）—— Promise 原型方法实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://mp.weixin.qq.com/s?__biz=MzI4NjY4MTU5Nw==&amp;mid=2247486966&amp;idx=2&amp;sn=5c90d287040a811ed06517518fee8e34&amp;chksm=ebd87d64dcaff4726226d01cbb7b12aea5f16429a06b8f8cfbc23a35ecf955c899cd139283b7&amp;scene=178&amp;cur_album_id=1500522652875194368#rd" target="_blank" rel="noopener noreferrer">图解 Promise 实现原理（四）—— Promise 静态方法实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol> <p>Promise 核心原理实现主要分为：<strong>基础方法+链式调用+延迟机制+状态管理+异常处理</strong></p> <ul><li>Promise() 对象最基础包含 constructor()、then()、resolve() 三个方法；</li> <li>链式调用主要原理： then() 返回一个新的 Promise() 对象；</li> <li>延迟机制：
<ul><li>目的:  保证在 resolve 执行之前，then 方法已经注册完所有的回调;</li> <li>实现：
<ul><li>方法1： 使用 setTimeout() 模拟实现</li> <li>方法2： 通过判断状态变化</li></ul></li></ul></li> <li>状态管理：Promise 对象的状态改变，只有两种可能。
<ul><li>Pending 变为 Resolved ：promise变为FULFILLED状态后具有一个唯一的value；</li> <li>Pending 变为 Rejected： promise变为REJECTED状态后具有一个唯一的reason；</li> <li><img src="/myblog/assets/img/promiseState.fb796bbf.png" alt=""></li></ul></li> <li>异常处理：在执行 onFulfilled 或者 onRejected 时，出现的异常处理方法，使用 try-catch 捕获错误，然后将相应的 Promise 状态设置为 rejected 状态
<ul><li>不管是错误也好，异常也罢，最终都是通过 reject 实现的，可见最终对于错误以及异常的处理，都可以通过 then 中的 onRejected 来处理。所以单独增加一个 catch 方法，它是 .then(null, onRejected) 的别名</li></ul></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//异步回调函数队列</span>
  state <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span><span class="token comment">//增加状态</span>
  value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//保存当前promise 异步操作执行结果	</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建Promise对象时立即执行 fn 函数</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// then 函数仅仅是注册了后续需要执行的回调</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 链式调用关键：返回新的promise对象</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_handle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">onFulfilled</span><span class="token operator">:</span> onFulfilled <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// then方法成功回调函数</span>
        <span class="token literal-property property">onRejected</span><span class="token operator">:</span> onRejected <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// then方法失败回调函数</span>
        <span class="token literal-property property">resolve</span><span class="token operator">:</span> resolve<span class="token punctuation">,</span> <span class="token comment">// 新的Promise 对象 resolve 方法</span>
        <span class="token literal-property property">reject</span><span class="token operator">:</span> reject  <span class="token comment">// 新的Promise 对象 reject 方法</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">(</span>onError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> onError<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">finally</span><span class="token punctuation">(</span>onDone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onDone <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">let</span> Promise <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
      <span class="token parameter">value</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">onDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">onDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> reason <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">_handle</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 	<span class="token comment">//获取回调方法</span>
    <span class="token keyword">let</span> cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'fulfilled'</span> <span class="token operator">?</span> callback<span class="token punctuation">.</span>onFulfilled <span class="token operator">:</span> callback<span class="token punctuation">.</span>onRejected<span class="token punctuation">;</span>
 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//如果then中没有传递任何东西</span>
      cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'fulfilled'</span> <span class="token operator">?</span> callback<span class="token punctuation">.</span>resolve <span class="token operator">:</span> callback<span class="token punctuation">.</span>reject<span class="token punctuation">;</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">let</span> ret<span class="token punctuation">;</span>
 
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 执行当前返回异步操作结果的promise的回调函数，并将异步操作结果this.value传入回调函数</span>
      ret <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'fulfilled'</span> <span class="token operator">?</span> callback<span class="token punctuation">.</span>resolve <span class="token operator">:</span> callback<span class="token punctuation">.</span>reject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ret <span class="token operator">=</span> error<span class="token punctuation">;</span>
      cb <span class="token operator">=</span> callback<span class="token punctuation">.</span>reject <span class="token comment">// 回调函数执行报错，执行回调的 reject </span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token comment">//调用当前返回异步操作结果的promise的回调函数的resolve/reject方法，并传入回调执行结果</span>
      <span class="token function">cb</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
  <span class="token punctuation">}</span>
  <span class="token function">_resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//回调函数的执行是在 resolve 方法里面执行的</span>
    <span class="token comment">// Promise 异步操作结果为 Promise 对象,调用 异步操作结果的 then()</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> then <span class="token operator">=</span> value<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span><span class="token comment">//改变状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">//保存结果</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_handle</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行下一个回调函数</span>
  <span class="token punctuation">}</span>
  <span class="token function">_reject</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//回调函数的执行是在reject 方法里面执行的</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> error<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_handle</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p><strong>参考资料</strong></p> <p><a href="https://mp.weixin.qq.com/s/UNzYgpnKzmW6bAapYxnXRQ" target="_blank" rel="noopener noreferrer">图解 Promise 实现原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://www.conardli.top/docs/JavaScript/%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0promise.html#%E5%9F%BA%E7%A1%80%E7%89%88%E6%9C%AC" target="_blank" rel="noopener noreferrer">模拟实现Promise<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="promise-执行顺序"><a href="#promise-执行顺序" class="header-anchor">#</a> Promise 执行顺序</h2> <p>执行顺序题目主要结合 JavaScript 的事件循环和 Promise 的宏任务/微任务考察：</p> <ul><li>Promise 新建后executor就会立即执行;</li> <li>调用 resolve() 或 reject() 并不会终结 Promise 的 executor 函数的执行</li> <li>Promise 的状态一旦变更为成功或者失败，则不会再次改变</li> <li>宏任务： script(主程序代码)，setTimeout(), setInterval(), setImmediate(), I/O, requestAnimationFrame()，UI rendering</li> <li>微任务： Promise.resolve()，Promise.reject()，Promises.then()，Promises.finally()，process.nextTick()，Object.observe()， MutationObserver()</li> <li>执行顺序：script(主程序代码)—&gt;process.nextTick—&gt;Promises.then()——&gt;setTimeout——&gt;setInterval——&gt;setImmediate——&gt; I/O——&gt;UI rendering</li></ul> <p>任务执行流程：</p> <p><img src="/myblog/assets/img/task=performance.d107c2fd.png" alt=""></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输出: 1 2 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>以上代码的输出结果是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这是因为 JavaScript 中的事件循环机制决定了代码执行的顺序。</p> <p>首先，按顺序执行同步代码：</p> <ul><li><code>console.log(1)</code> 输出 1。</li></ul> <p>接下来，执行微任务（Promise）：</p> <ul><li><code>Promise.resolve().then()</code> 创建一个微任务，将其放入微任务队列中。</li> <li><code>console.log(2)</code> 输出 2。</li></ul> <p>然后，执行宏任务（setTimeout）：</p> <ul><li><code>setTimeout(function () { console.log(3); }, 0)</code> 创建一个宏任务，将其放入宏任务队列中。由于延迟时间为 0，所以会尽快执行。</li> <li><code>console.log(3)</code> 输出 3。</li></ul> <p>根据事件循环的规则，微任务优先级高于宏任务。因此，在执行完同步代码后，会先执行微任务队列中的任务，然后再执行宏任务队列中的任务。</p> <p>所以，最终的输出结果是按照顺序输出 1、2、3。</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输出: 1 2 4 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>规则一: promise<code>构造函数的代码会立即执行，</code>then<code>或者</code>reject`里面的代码会放入异步微任务队列，在宏任务结束后会立即执行。</p> <p>规则二：<code>promise</code>的状态一旦变更为成功或者失败，则不会再次改变，所以执行结果为：1,2,4,3。而<code>catch</code>里面的函数不会再执行</p></blockquote> <ul><li></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
             console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'once'</span><span class="token punctuation">)</span>
             <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//执行结果: 过一秒打印 once,success,success</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p><code>promise</code>的构造函数只会执行一次，而<code>then</code>方法可以多次调用，但是第二次是直接返回结果，不会有异步等待的时间</p></blockquote> <ul><li></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">p1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> timeOut1 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> timeOut2 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">reject</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出: 1 2 10 5 6 8 9 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><blockquote><p>第一步：</p> <p>​	执行主程序宏任务，执行 p1，p2，conole.log(10)，输出：1,2,10。
​	这时候事件循环里面有异步任务<code>timeOut1,timeOut2,p2.then,p1.then</code>
​	<code>p2.then,p1.then</code>为微任务，<code>timeOut1,timeOut2</code>为宏任务</p> <p>第二步：</p> <p>​	宏任务执行完后<code>Event Loop</code>会去任务队列取异步任务，微任务会优先执行。</p> <p>​	根据微任务进入异步队列顺序，这时候会先后执行 <code>p2.then -&gt; p1.then</code>，打印 5,6。</p> <p>第三步：</p> <p>​	微任务执行完了，开始宏任务，由于2个<code>settimeout</code>等待时间一样，所以会执行先进入异步队列的顺序，<code>timeOut2</code>先后打印：8。执行宏任务的过程中，<code>p3.then</code> 微任务进入了微任务队列，宏任务执行完毕会执行微任务，输出：9。</p> <p>​	之后继续执行下一个宏任务<code>timeOut1</code>, 输出：3。</p> <p>第四步：</p> <p>​	结合规则6，由于p2这个<code>Promise</code>对象的执行结果已经确定，所以4不会被打印</p></blockquote> <ul><li><strong>错误捕获</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error!!!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//输出：then:  Error: error!!!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>这里的陷阱在于只有抛出错误时才会执行 .catch()，题目中并不是抛出错误，所以执行 .then()。</p> <p>改成如下方式会执行 .catch():</p> <p>return Promise.reject(new Error('error!!!'))
throw new Error('error!!!')</p></blockquote> <ul><li></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> promise
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>答案
程序报错：<code>TypeError: Chaining cycle detected for promise #&lt;Promise&gt;</code>
解读
<code>.then() 或 .catch() 返回的值不能是 promise 本身，否则会造成死循环</code></p></blockquote> <ul><li></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">//输出：1 3 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>先执行整体代码，没有发现微任务；
再执行下一个宏任务—setTimeout回调函数，打印出1；
遇到微任务—Promise 回调函数；
立即执行微任务，打印出3；
微任务队列被清空，执行下一个宏任务—下一个setTimeout回调函数，打印出2。</p></blockquote> <ul><li></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> pro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pro<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
pro<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//输出： 1 1 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>promise 对象赋值给了变量 pro，每个 <code>.then()</code> 都是独立的，遇到 .then() 都会加入微任务队列，然后进行事件循环</p></blockquote> <ul><li></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token keyword">new</span> <span class="token class-name">Promise</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//------输出--------</span>
script start
async1 start
async2
promise1
script end
async1 end
promise2
setTimeout

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><blockquote><p>注意以下几点:</p> <ul><li>定义 async1()，async2()，不会立即执行</li> <li>await async2(); 表示先执行 async2()，然后将 await 后面的代码当作 .then() 中的回调来处理，因此执行 async2() 以后，返回值和后面代码添加到微任务队列中</li> <li>初始化 promise，promise 中的代码会立即执行</li></ul></blockquote> <h2 id="promise-封装异步操作"><a href="#promise-封装异步操作" class="header-anchor">#</a> Promise 封装异步操作</h2> <ul><li><p>题目一：使用 promise 封装 setTimeout</p> <ul><li>实现:
<ul><li>参数： ms 毫秒数</li> <li>返回值： 新的promise</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve，reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>ms<span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>ms<span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">saySomething</span><span class="token punctuation">(</span><span class="token string">&quot;10 seconds&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>failureCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>分析：因为 <code>setTimeout</code> 并不会真的执行失败，那么我们可以在这种情况下忽略 reject</p></li></ul></li> <li><p>题目二：使用 promise 封装 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation/getCurrentPosition" target="_blank" rel="noopener noreferrer">navigator.geolocation.getCurrentPosition(success, error, options)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 接口</p> <ul><li><p>实现：</p> <ul><li><p>参数： options</p></li> <li><p>返回值： promise</p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">getLocation</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">,</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ul></li> <li><p>题目三：封装 XMLHttpRequest</p> <ul><li><p>实现</p> <ul><li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myAsyncFunction</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul></li></ul></li></ul> <h2 id="promise-特性"><a href="#promise-特性" class="header-anchor">#</a> Promise 特性</h2> <h3 id="promise-特性问题"><a href="#promise-特性问题" class="header-anchor">#</a> <strong>Promise 特性问题</strong></h3> <p><strong>如何取消一个Promise？</strong></p> <ul><li><p>在要停止的<code>promise</code>链位置添加一个方法，返回一个永远不执行<code>resolve</code>或者<code>reject</code>的<code>Promise</code>，那么这个<code>promise</code>永远处于<code>pending</code>状态，所以永远也不会向下执行<code>then</code>或<code>catch</code>了。这样我们就停止了一个<code>promise</code>链</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok1'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 返回“pending”状态的Promise对象</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 后续的函数不会被调用</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err-&gt;'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>Promise.race竞速方法</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok2'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p2<span class="token punctuation">,</span> p1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">//ok1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul> <p><strong>如果向Promise.all()和Promise.race()传递空数组，运行结果会有什么不同？</strong></p> <ul><li><img src="data:image/png;base64,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" alt=""></li> <li>all会立即决议，决议结果是fullfilled，值是undefined; race会永远都不决议，程序卡死</li></ul> <p><strong>Promise链上返回的最后一个Promise出错了怎么办？</strong></p> <ul><li><p><code>catch</code>在<code>promise</code>链式调用的末尾调用，用于捕获链条中的错误信息，但是<code>catch</code>方法内部也可能出现错误，所以有些<code>promise</code>实现中增加了一个方法<code>done</code>，<code>done</code>相当于提供了一个不会出错的<code>catch</code>方法，并且不再返回一个<code>promise</code>，一般用来结束一个<code>promise</code>链</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//调用 Promise 的 catch 方法</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> reason<span class="token punctuation">;</span> <span class="token comment">// 向外抛出错误</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <h3 id="promise-应用题"><a href="#promise-应用题" class="header-anchor">#</a> Promise 应用题</h3> <ul><li>题目一：<strong>顺序加载10张图片，图片地址已知，但是同时最多加载3张图片，要求用<code>promise</code>实现</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> baseUrl <span class="token operator">=</span> <span class="token string">'http://img.aizhifou.cn/'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1.png'</span><span class="token punctuation">,</span> <span class="token string">'2.png'</span><span class="token punctuation">,</span> <span class="token string">'3.png'</span><span class="token punctuation">,</span> <span class="token string">'4.png'</span><span class="token punctuation">,</span> <span class="token string">'5.png'</span><span class="token punctuation">,</span><span class="token string">'6.png'</span><span class="token punctuation">,</span> <span class="token string">'7.png'</span><span class="token punctuation">,</span> <span class="token string">'8.png'</span><span class="token punctuation">,</span> <span class="token string">'9.png'</span><span class="token punctuation">,</span> <span class="token string">'10.png'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">loadImg</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">// 加载一张图片</span>
			<span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			image<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">reject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
			image<span class="token punctuation">.</span>src <span class="token operator">=</span> baseUrl <span class="token operator">+</span> url<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">startLoadImage</span><span class="token punctuation">(</span><span class="token parameter">urls<span class="token punctuation">,</span> limits<span class="token punctuation">,</span> endHandle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 当前存在的promise队列</span>
	<span class="token keyword">let</span> promiseMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// 当前索引对应的加载状态，无论成功，失败都会标记为true，格式： {0: true, 1: true, 2: true...}</span>
	<span class="token keyword">let</span> loadIndexMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// 当前以及加载到的索引，方便找到下一个未加载的索引，为了节省性能，其实可以不要</span>
	<span class="token keyword">let</span> loadIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token function-variable function">loadAImage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 所有的资源都进入了异步队列</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>loadIndexMap<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> urls<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 所有的资源都加载完毕，或者进入加载状态，递归结束</span>
			<span class="token keyword">const</span> promiseList <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>promiseMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promiseMap<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> arr<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promiseList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// 这里如果没有加载失败，就会在所有加载完毕后执行，如果其中某个错误了，这里的结果就不准确，不过这个不是题目要求的。</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'all'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				endHandle <span class="token operator">&amp;&amp;</span> <span class="token function">endHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end:'</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// 遍历，知道里面有3个promise</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>promiseMap<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> limits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> loadIndex<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> urls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>loadIndexMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						loadIndexMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
						promiseMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">loadImg</span><span class="token punctuation">(</span>urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
						loadIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 获取当前正在进行的promise列表，利用reduce从promiseMap里面获取</span>
			<span class="token keyword">const</span> promiseList <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>promiseMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promiseMap<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> arr<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>promiseList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// 其中一张加载成功，删除当前promise，让PromiseList小于limit，开始递归，加载下一张</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end:'</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
				loadIndexMap<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token keyword">delete</span> promiseMap<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token function">loadAImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// 加载失败也继续</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end：'</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				loadIndexMap<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token keyword">delete</span> promiseMap<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token function">loadAImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">loadAImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">startLoadImage</span><span class="token punctuation">(</span>urls<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><blockquote><p>将代码复制到chrome浏览器可以看到下面的运行结果：
<img src="data:image/png;base64,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" alt="1.png">
可以看到，所有图片加载完成，在没有失败的情况下，打印出来<code>all</code>
解析：<code>Promise.race</code>方法接受的参数中有一个<code>promise</code>对象返回结果了就会立即触发成功或者失败的函数。这里利用这个特性，先将<code>promise</code>队列循环加入，直到达到限制，等待<code>race</code>，<code>race</code>后又加入一个<code>promise</code>，利用递归一直循环这个过程，到最后用<code>promise.all</code>捕获剩下的图片加载</p></blockquote> <h2 id="promisec串行"><a href="#promisec串行" class="header-anchor">#</a> Promisec串行</h2> <h3 id="串行概念"><a href="#串行概念" class="header-anchor">#</a> 串行概念</h3> <ul><li>有多个任务，多个任务必须顺序执行（下一个任务依赖上一个任务结果）</li> <li>使用 Promise 进行异步操作的顺序处理</li> <li>Promise 串行执行实现原理： 利用 Promise.then() 的链式调用</li></ul> <h3 id="pomise-串行实现"><a href="#pomise-串行实现" class="header-anchor">#</a> Pomise 串行实现</h3> <p>模拟三个异步函数，每一个函数依赖上一个函数结果</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">/</span> 异步函数 p1
<span class="token keyword">let</span> <span class="token function-variable function">p1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'p1-&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 异步函数 p2</span>
<span class="token keyword">let</span> <span class="token function-variable function">p2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">'p2-&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 异步函数 p3</span>
<span class="token keyword">let</span> <span class="token function-variable function">p3</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">'p3-&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li><p>实现一：<strong>使用then链式操作</strong></p> <ul><li>缺点：书写比较繁琐</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">p2</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">p3</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出: p1-&gt;p2-&gt;p3-&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>实现二：<strong>forEach循环构建队列</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> sequence <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sequence <span class="token operator">=</span> sequence<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sequence
<span class="token punctuation">}</span>

<span class="token comment">// 执行队列</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出: p1-&gt;p2-&gt;p3-&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>实现三：<strong>reduce循环构建队列</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">promiseChain<span class="token punctuation">,</span> currentFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> promiseChain<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>currentFunction<span class="token punctuation">)</span><span class="token punctuation">,</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//	将初始值使用 promise 包裹</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行队列</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出: p1-&gt;p2-&gt;p3-&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">tasks</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">recordValue</span><span class="token punctuation">(</span><span class="token parameter">results<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> results<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> pushValue <span class="token operator">=</span> <span class="token function">recordValue</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> tasks<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> task<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>pushValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// 执行队列</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>实现四：<strong>使用async、await构建队列</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> promise <span class="token keyword">of</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">promise</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> res
<span class="token punctuation">}</span>

<span class="token comment">// 执行队列</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出: p1-&gt;p2-&gt;p3-&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul> <h3 id="串行应用"><a href="#串行应用" class="header-anchor">#</a> 串行应用</h3> <h4 id="axios请求-响应拦截过程"><a href="#axios请求-响应拦截过程" class="header-anchor">#</a> axios请求/响应拦截过程</h4> <ul><li>axios中请求/响应是过程是顺序执行 [请求拦截器, dispatchRequest, 响应拦截器]  队列的过程</li> <li>队列中请求拦截器， dispatchRequest，响应拦截器 为Promise 对象</li> <li><a href="https://github.com/axios/axios/blob/master/lib/core/Axios.js" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><img src="/myblog/assets/img/axios流程.26defe79.png" alt=""></li></ul> <p>模拟实现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//请求1</span>
<span class="token keyword">let</span> <span class="token function-variable function">req1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request1 start-&gt;'</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'request1-&gt;'</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request1 end-&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 请求2</span>
<span class="token keyword">let</span> <span class="token function-variable function">req2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request2 start-&gt;'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">'request2-&gt;'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request2 end-&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 请求3</span>
<span class="token keyword">let</span> <span class="token function-variable function">req3</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request3 start-&gt;'</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">'request3-&gt;'</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'request3 end-&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//响应1</span>
<span class="token keyword">let</span> <span class="token function-variable function">res1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get response1-&gt;'</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'response1 -&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1100</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//响应数据2</span>
<span class="token keyword">let</span> <span class="token function-variable function">res2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get response2-&gt;'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">'response2-&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">res3</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get response3-&gt;'</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">'response3-&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> chain <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> requeseInter <span class="token operator">=</span> <span class="token punctuation">[</span>req1<span class="token punctuation">,</span>req2<span class="token punctuation">,</span>req3<span class="token punctuation">]</span>
<span class="token keyword">let</span> responseInter <span class="token operator">=</span> <span class="token punctuation">[</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">,</span>res3<span class="token punctuation">]</span>

requeseInter<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>chain<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
responseInter<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>chain<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>chain<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
    promise  <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>chain<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>执行结果：<img src="/myblog/assets/img/moni-axios.3b949e15.png" alt=""></p> <h2 id="promise-并行"><a href="#promise-并行" class="header-anchor">#</a> Promise 并行</h2> <ul><li>并行：多个异步请求同时进行</li></ul> <h3 id="并行执行-api"><a href="#并行执行-api" class="header-anchor">#</a> 并行执行 API</h3> <ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" target="_blank" rel="noopener noreferrer">Promise.all(iterable)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/any" target="_blank" rel="noopener noreferrer">Promise.any()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" target="_blank" rel="noopener noreferrer">Promise.race(iterable)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled" target="_blank" rel="noopener noreferrer">Promise.allSettled()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="并发控制"><a href="#并发控制" class="header-anchor">#</a> 并发控制</h3> <h4 id="并发概念"><a href="#并发概念" class="header-anchor">#</a> 并发概念</h4> <p>​	要求执行 n 个异步任务，但不能 n 个异步任务同时执行 (内存资源限制等原因)，需要控制每次 m ( m&lt;n ) 个异步任务同时进行，但最终结果是执行 n 个异步任务</p> <h4 id="并发思想"><a href="#并发思想" class="header-anchor">#</a> 并发思想</h4> <ul><li>使用 Promise 并行执行 API : Promise.all()、Promise.allSettled()、Promise.race()、Promise.any() 并行执行异步，控制每次并行执行的 Promise 实例;</li> <li>Promise 并发限制，其实根源上就是控制 Promise 的实例化个数；Promise 并不是因为调用 Promise.all 才执行，而是在实例化 Promise 对象的时候就执行了;</li> <li>要实现并发限制，只能从 Promise 实例化上下手，把生成 Promises 数组的控制权，交给并发控制逻辑</li></ul> <h4 id="并发实现"><a href="#并发实现" class="header-anchor">#</a> 并发实现</h4> <ul><li><p>实现一： <strong>使用 async await 和 Promise.all 封装并发任务 (推荐)</strong></p> <ul><li>思路：循环截取列表中 limit 个数据并发执行</li> <li>缺点：
<ul><li>每次并发执行 limit 个，需要等待全部结果返回后，才能执行下一次并发</li></ul></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @params list {Array} - 要迭代的数组
 * @params limit {Number} - 并发数量控制数
 * @params asyncHandle {Function} - 对 list 的每一个项的异步处理函数，参数为当前处理项，必须 return 一个 Promise 来确定是否继续进行迭代 ( 异步处理 Promise 实例化必须在 asyncHandle 中完成 )
 * @return {Promise} - 返回一个 Promise 值来确认所有数据是否迭代完成
**/</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">concurrencyLimit</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span>limit<span class="token punctuation">,</span>asyncHandler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">let</span> partiaList  <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i <span class="token operator">+</span> limit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//遍历列表，每次截取 limit 个数据</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">partiaList is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>partiaList<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//遍历截取的并发数据，使用 asyncHandler 包装异步操作，并返回 Promise 数组，并发执行</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span> partiaList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//------------------------------------------测试demo---------------------------------------------</span>
<span class="token comment">//模拟获取 10 个数据结果</span>
<span class="token keyword">let</span> dataLists <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//生成 1-10的数组，待并发执行数据</span>
<span class="token keyword">let</span> successfulData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//成功获取的数据</span>
<span class="token keyword">let</span> errData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 获取失败的数据</span>
<span class="token function">concurrencyLimit</span><span class="token punctuation">(</span>dataLists<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">curItem</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 异步处理函数</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">return data is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>curItem<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span>curItem <span class="token operator">%</span><span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果数据是 3 的倍数，获取失败</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                 	<span class="token literal-property property">data</span><span class="token operator">:</span> curItem<span class="token punctuation">,</span>
                	<span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">404</span> 
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> curItem<span class="token punctuation">,</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5000</span><span class="token punctuation">)</span>  <span class="token comment">// 设置随机响应时间</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        successfulData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">//获取成功数据保存进入数组</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">get fail: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> 
        errData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">//获取失败数据保存</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></li> <li><p>实现二：<strong>Promise.all 并发执行并递归</strong></p> <ul><li>思路：使用 Promise 并发执行 limit 个异步操作，然后通过递归和 then 的链式调用形成 limit 条并发执行的执行链</li> <li>缺点：
<ul><li>最后只返回 limit 条链的最后执行的结果，不能记录每条执行链的执行顺序和所有结果</li> <li>捕获的错误数据也会返回</li></ul></li> <li>使用递归，如果并发请求量大，会占用较大内存
<ul><li>不能按顺序发起请求</li></ul></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @params list {Array} - 要迭代的数组
 * @params limit {Number} - 并发数量控制数
 * @params asyncHandle {Function} - 对 list 的每一个项的异步处理函数，参数为当前处理项，必须 return 一个 Promise 来确定是否继续进行迭代 ( 异步处理 Promise 实例化必须在 asyncHandle 中完成 )
 * @return {Promise} - 返回一个 Promise 值来确认所有数据是否迭代完成
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">concurrencyLimit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> asyncHandle</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token function-variable function">recursion</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tasks</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//递归迭代数组，形成一条执行链</span>
        <span class="token keyword">return</span> <span class="token function">asyncHandle</span><span class="token punctuation">(</span>tasks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//获取队列头数据，并用异步处理函数处理，返回一个 Promise 实例</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 返回异步处理结果 </span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">recursion</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span>   <span class="token comment">// 数组还未迭代完，递归继续进行迭代</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//迭代完成，返回最终数据</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res is '</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> res 
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//捕获错误</span>
            	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err data is'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            	<span class="token keyword">if</span> <span class="token punctuation">(</span>tasks<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//数组未迭代完成，继续迭代</span>
                    <span class="token keyword">return</span> <span class="token function">recursion</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span>   <span class="token comment">// 数组还未迭代完，递归继续进行迭代</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//迭代完成，返回最终数据</span>
                    <span class="token keyword">return</span> err
                <span class="token punctuation">}</span>
        	<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">let</span> listCopy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拷贝需要处理的列表</span>
    <span class="token keyword">let</span> asyncList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 正在进行的数量为 limit 个并发异步操作</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>limit<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 控制并发数量，通过 Promise.all 形成 limit 条并发执行的执行链</span>
        asyncList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> <span class="token function">recursion</span><span class="token punctuation">(</span>listCopy<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//实例化 limit 个 Promise 异步操作实例</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>asyncList<span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 返回 limit 条并发执行的执行链的最后一个执行结果</span>
        	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">all data is </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>response<span class="token punctuation">)</span>
    	<span class="token punctuation">}</span><span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 所有并发异步操作都完成后，本次并发控制迭代完成</span>
<span class="token punctuation">}</span>


<span class="token comment">//-------------测试demo--------------------</span>
<span class="token keyword">let</span> dataLists <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//生成 1-10的数组</span>
<span class="token function">concurrencyLimit</span><span class="token punctuation">(</span>dataLists<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">curItem</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">return data is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>curItem<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>curItem <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果数据是 4 的倍数，获取失败</span>
            	<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                 	<span class="token literal-property property">data</span><span class="token operator">:</span> curItem<span class="token punctuation">,</span>
                	<span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">404</span> 
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> curItem<span class="token punctuation">,</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5000</span><span class="token punctuation">)</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div></li> <li><p>实现三：<strong>使用递归和队列 (推荐)</strong></p> <ul><li>思路：将待请求数据存入数组，形成并发执行的异步操作队列，然后进行遍历，取出数组中每一项数据执行异步操作。进行调用控制并发数的同时，每结束一个请求并发起一个新的请求。使用递归的方式，添加一个请求队列，然后我们只要维护这个队列，每次发起一个请求就添加进去，结束一个就丢出来，继而实现了控制并发</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @params list {Array} - 要迭代的任务数组
 * @params limit {Number} - 并发数量控制数
 * @params asyncHandle {Function} - 对 list 的每一个任务的异步处理函数，参数为当前处理项，必须 return 一个 Promise 来确定是否继续进行迭代 ( 异步处理 Promise 实例化必须在 asyncHandle 中完成 )
 * @params callback {Function} - 所有异步操作结束后执行的回调
 * @return {Promise} - 返回一个 Promise 值来确认所有数据是否迭代完成
**/</span>
<span class="token keyword">const</span> <span class="token function-variable function">concurrencyLimit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> asyncHandle<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 异步任务数量</span>
    <span class="token keyword">const</span> tasksQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//并发任务队列，每次执行一个任务就添加进去，结束一个就丢出来，继而实现了控制并发</span>
    <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 任务执行结果</span>
    <span class="token keyword">let</span>   tasksList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拷贝需要处理的任务列表</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">resultHandle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//结果处理函数，维护请求队列</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'current tasks queue is:'</span><span class="token punctuation">,</span>tasksQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> resultNum <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存结果，并返回执行完成的异步任务数量</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>resultNum <span class="token operator">&lt;</span> count <span class="token operator">&amp;&amp;</span> tasksList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//返回结束任务数量和待处理任务列表不为空</span>
            tasksQueue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//任务队列中移除已经完成的异步任务</span>
            <span class="token function">handleTask</span><span class="token punctuation">(</span>tasksList<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//从任务列表中添加一个任务进行处理</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>resultNum <span class="token operator">===</span> count <span class="token operator">&amp;&amp;</span> tasksList<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token comment">//任务列表任务处理完成并所有执行结果返回</span>
            <span class="token string">'function'</span> <span class="token operator">===</span> <span class="token keyword">typeof</span> callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">handleTask</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//任务处理方法，控制任务并发数量</span>
        <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token function">asyncHandle</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token comment">//任务处理</span>
        	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           		<span class="token function">resultHandle</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> 
       		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token function">resultHandle</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span><span class="token punctuation">(</span>tasksQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">&lt;</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//并发执行任务数量小于限制数量,[].push 操作后返回当前数组长度</span>
            <span class="token function">handleTask</span><span class="token punctuation">(</span>tasksList<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加并发任务处理</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//将任务列表任务添加到任务处理方法</span>
    <span class="token function">handleTask</span><span class="token punctuation">(</span>tasksList<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">//--------------------测试demo--------------------------------------</span>
<span class="token keyword">let</span> dataLists <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//生成 1-10的数组</span>
<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'all tasks finished! results is:'</span><span class="token punctuation">,</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">concurrencyLimit</span><span class="token punctuation">(</span>dataLists<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">curItem</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">return data is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>curItem<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>curItem <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果数据是 3 的倍数，获取失败</span>
            	<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                 	<span class="token literal-property property">data</span><span class="token operator">:</span> curItem<span class="token punctuation">,</span>
                	<span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">404</span> 
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> curItem<span class="token punctuation">,</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5000</span><span class="token punctuation">)</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div></li></ul> <h4 id="并发应用"><a href="#并发应用" class="header-anchor">#</a> 并发应用</h4> <ul><li><p>题目一：<strong>网页中预加载20张图片资源，分步加载，一次加载10张，两次完成，怎么控制图片请求的并发，怎样感知当前异步请求是否已完成？</strong></p> <p>答案参考 <a href="https://zhuanlan.zhihu.com/p/29792886" target="_blank" rel="noopener noreferrer">Promise 异步流程控制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">Promises/A+<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://es6.ruanyifeng.com/#docs/promise#Promise-all" target="_blank" rel="noopener noreferrer">es6文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises" target="_blank" rel="noopener noreferrer">使用 Promise<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://liubin.org/promises-book/#ch2-promise-all" target="_blank" rel="noopener noreferrer">promise并行<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">January 26, 2024 09:47</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 596777598@qq.com" class="contributor">
          sewar
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/myblog/javascript/%E5%BC%82%E6%AD%A5/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        异步编程
      </a></span> <span class="next"><a href="/myblog/javascript/%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0/">
        JS原理实现
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/myblog/assets/js/app.9d2b617a.js" defer></script><script src="/myblog/assets/js/layout-Layout.d2d4ce64.js" defer></script><script src="/myblog/assets/js/page-Promise专题.7869a31b.js" defer></script><script src="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" defer></script>
  </body>
</html>
