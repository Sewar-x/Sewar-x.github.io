<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端自动部署 | Sewen 博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="./mylogo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="manifest" href="/myblog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://sewar-x.github.io/myblog/atom.xml" title="Sewen 博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 RSS Feed">
    <meta name="description" content="sewen 的前端学习笔记、博客、前端基础总结、技术深度剖析、面试题总结、算法总结、项目过程总结">
    <meta property="og:url" content="https://sewar-x.github.io/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2.html">
    <meta property="og:site_name" content="Sewen 博客">
    <meta property="og:title" content="前端自动部署">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.645fbc6f.css" as="style"><link rel="preload" href="/myblog/assets/js/app.9d2b617a.js" as="script"><link rel="preload" href="/myblog/assets/js/layout-Layout.d2d4ce64.js" as="script"><link rel="preload" href="/myblog/assets/js/page-前端自动部署.5076846c.js" as="script"><link rel="preload" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" as="script"><link rel="prefetch" href="/myblog/assets/js/199.a9216960.js"><link rel="prefetch" href="/myblog/assets/js/200.4c66fc79.js"><link rel="prefetch" href="/myblog/assets/js/layout-Blog.1fca7e90.js"><link rel="prefetch" href="/myblog/assets/js/layout-NotFound.3c74e8aa.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/AlgoliaSearch/Dropdown.70fcebe7.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Anchor.3235541c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleInfo.7b815b20.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleItem.b0e177e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleList.d1cf1b24.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleType.b630b80e.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHero.621312ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHome.4fe44489.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogInfo.b2a94760.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogPage.e0fbe820.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BloggerInfo.0df38355.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/CategoryList.ec1bcd96.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ProjectList.8550a110.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TagList.bcf7b782.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/Timeline.b6cf5471.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TimelineList.3c6e08a6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Clipboard.e940a903.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Common.820a8694.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Home.70383986.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/MyTransition.0de46069.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/DropdownLink.e3f6c118.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLink.93b11770.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLinks.8ba214e6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/Navbar.b90a94f9.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/RepoLink.663a7f55.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/SidebarButton.76b0035a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Page.98b5d09c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageFooter.20bc9bd8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageMeta.b7e6b12f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageNav.8305dd1f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Password.45e0e82a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/DropdownTransition.068c5eea.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/Sidebar.f6f90d52.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarDropdownLink.505127a8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarGroup.7eecf370.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarLink.6e39fe32.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarNavLinks.0f8566cb.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/DarkmodeSwitch.20ac7b92.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeColor.6086e4ed.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeOptions.483238c9.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ArticleIcon.0a22e2b1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/AutoIcon.2ff1c790.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/BookIcon.419b49ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/DarkIcon.7d81873b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EditIcon.8ada485d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EmptyIcon.d704a5cf.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/I18nIcon.ffad8b3e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LightIcon.47d807da.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LinkIcon.1a8a7826.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LockIcon.a29a2b79.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/NextIcon.0214ee59.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/Page404Icon.8bc1ebbb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PresentationIcon.17500d9b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PrevIcon.2ae04a70.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ProjectIcon.b336d567.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/StickyIcon.0f509b9d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Baidu.244b9a41.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Bitbucket.11ba94e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dingding.e8a3d90d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Discord.3295a55b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dribbble.464dac3b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Email.f9254caa.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Evernote.991472fb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Facebook.08e78e47.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Flipboard.a1124d0f.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitee.c44bc20a.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Github.5667e5ae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitlab.ad95c7a7.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gmail.b5acc6bc.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Instagram.56be85f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Lines.d9db3dce.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Linkedin.b82d8d8b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pinterest.0f3ffe71.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pocket.41ef3c92.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/QQ.7558f4ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Qzone.bf658fae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Reddit.9c4c95ee.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Rss.9780139e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Steam.06abbae2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Twitter.26fa5bda.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Wechat.9cac8c4c.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Weibo.5206a632.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Whatsapp.0738f1e3.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Youtube.f41fd7f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Zhihu.4d851d2f.js"><link rel="prefetch" href="/myblog/assets/js/page--0abc50bf.0d6f1484.js"><link rel="prefetch" href="/myblog/assets/js/page--1cd40f4c.dd76c7b3.js"><link rel="prefetch" href="/myblog/assets/js/page--53f93199.e80bdec8.js"><link rel="prefetch" href="/myblog/assets/js/page--5afd2fd0.adea4e92.js"><link rel="prefetch" href="/myblog/assets/js/page--67c584d3.0a3f3cd9.js"><link rel="prefetch" href="/myblog/assets/js/page--776a8506.cdf48aac.js"><link rel="prefetch" href="/myblog/assets/js/page-CSS.eb94b29f.js"><link rel="prefetch" href="/myblog/assets/js/page-Chrome开发工具使用指南.a2675120.js"><link rel="prefetch" href="/myblog/assets/js/page-DevServer.0281863d.js"><link rel="prefetch" href="/myblog/assets/js/page-Echarts二次封装.4387b8ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Elementui与Element-plusui二次封装.82f12a09.js"><link rel="prefetch" href="/myblog/assets/js/page-Git基础.03c616ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Git规范.e2fdc38a.js"><link rel="prefetch" href="/myblog/assets/js/page-HTML.1e3c14b9.js"><link rel="prefetch" href="/myblog/assets/js/page-Home.f0b7e772.js"><link rel="prefetch" href="/myblog/assets/js/page-JSON配置化组件二次封装.12060fd9.js"><link rel="prefetch" href="/myblog/assets/js/page-JS原理实现.3c427e19.js"><link rel="prefetch" href="/myblog/assets/js/page-JS应用题.3d313b34.js"><link rel="prefetch" href="/myblog/assets/js/page-JavaScript基础.551be887.js"><link rel="prefetch" href="/myblog/assets/js/page-Linux.c6159ebd.js"><link rel="prefetch" href="/myblog/assets/js/page-Loader和Plugin原理.b2971b76.js"><link rel="prefetch" href="/myblog/assets/js/page-MySQL.0b1d704a.js"><link rel="prefetch" href="/myblog/assets/js/page-NPM.a55851b2.js"><link rel="prefetch" href="/myblog/assets/js/page-Node.ec405a21.js"><link rel="prefetch" href="/myblog/assets/js/page-Nodejs常见问题集合.12844e69.js"><link rel="prefetch" href="/myblog/assets/js/page-Node性能优化.b4ea1c34.js"><link rel="prefetch" href="/myblog/assets/js/page-Promise专题.7869a31b.js"><link rel="prefetch" href="/myblog/assets/js/page-React.d76cf0ac.js"><link rel="prefetch" href="/myblog/assets/js/page-SSG移动端项目实践.2122615b.js"><link rel="prefetch" href="/myblog/assets/js/page-TypeScript.4f597fda.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite.637881bf.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite原理解析.6677fdb4.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue25项目webpack构建分析.7bbea0fa.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2VsVue3.10be4140.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2x原理源码分析.e9e753b6.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3基础.210247ff.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3源码分析.17379e04.js"><link rel="prefetch" href="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js"><link rel="prefetch" href="/myblog/assets/js/page-VueRouter原理分析.0a092eb6.js"><link rel="prefetch" href="/myblog/assets/js/page-VueSSR原理分析.63006040.js"><link rel="prefetch" href="/myblog/assets/js/page-VueVsReact.2156be28.js"><link rel="prefetch" href="/myblog/assets/js/page-Vuex原理分析.5ba3e6e4.js"><link rel="prefetch" href="/myblog/assets/js/page-WEB安全.5aa0eeef.js"><link rel="prefetch" href="/myblog/assets/js/page-WebPack构建原理.9c29703e.js"><link rel="prefetch" href="/myblog/assets/js/page-webpackAPI分析.4c8b152b.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack优化.dcc6c3bc.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack基础.3820ee6c.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack项目实践.77e22417.js"><link rel="prefetch" href="/myblog/assets/js/page-一次后台管理系统的性能优化.7c2d8712.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建SSR项目.855376fc.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue2项目和规范设计.93017fd2.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue3单页面应用.de152d54.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建公共组件库.93278073.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js"><link rel="prefetch" href="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js"><link rel="prefetch" href="/myblog/assets/js/page-分治.e3dfc22d.js"><link rel="prefetch" href="/myblog/assets/js/page-前端发版静态资源404问题.9eb1ca89.js"><link rel="prefetch" href="/myblog/assets/js/page-前端存储.cd82cf54.js"><link rel="prefetch" href="/myblog/assets/js/page-前端工程化.1e6e58d0.js"><link rel="prefetch" href="/myblog/assets/js/page-前端性能优化方案.83718d22.js"><link rel="prefetch" href="/myblog/assets/js/page-前端架构实践.171dbc0f.js"><link rel="prefetch" href="/myblog/assets/js/page-前端渲染架构.3b783de8.js"><link rel="prefetch" href="/myblog/assets/js/page-前端部署原理.82ecd8a7.js"><link rel="prefetch" href="/myblog/assets/js/page-动态规划.a3af92f1.js"><link rel="prefetch" href="/myblog/assets/js/page-哈希表.c76000e8.js"><link rel="prefetch" href="/myblog/assets/js/page-回溯算法.cd914c32.js"><link rel="prefetch" href="/myblog/assets/js/page-图.dfd9828a.js"><link rel="prefetch" href="/myblog/assets/js/page-基础.7bf5a37b.js"><link rel="prefetch" href="/myblog/assets/js/page-堆.4657e538.js"><link rel="prefetch" href="/myblog/assets/js/page-字符串.252f2a08.js"><link rel="prefetch" href="/myblog/assets/js/page-异步编程.904f4c65.js"><link rel="prefetch" href="/myblog/assets/js/page-性能优化指标和监控.f2175836.js"><link rel="prefetch" href="/myblog/assets/js/page-排序算法.c7a51b99.js"><link rel="prefetch" href="/myblog/assets/js/page-搭建低代码平台.19eaf5ec.js"><link rel="prefetch" href="/myblog/assets/js/page-操作系统.473c4281.js"><link rel="prefetch" href="/myblog/assets/js/page-数学运算.c82748fb.js"><link rel="prefetch" href="/myblog/assets/js/page-数据结构算法.84480586.js"><link rel="prefetch" href="/myblog/assets/js/page-数组.692b0d0a.js"><link rel="prefetch" href="/myblog/assets/js/page-权限管理.c7e10db0.js"><link rel="prefetch" href="/myblog/assets/js/page-查找.790e52df.js"><link rel="prefetch" href="/myblog/assets/js/page-栈和队列.8dbc3586.js"><link rel="prefetch" href="/myblog/assets/js/page-树.24efdeaa.js"><link rel="prefetch" href="/myblog/assets/js/page-浏览器.bee9ec04.js"><link rel="prefetch" href="/myblog/assets/js/page-混合桌面应用开发.9e10d1c3.js"><link rel="prefetch" href="/myblog/assets/js/page-登录.bb830451.js"><link rel="prefetch" href="/myblog/assets/js/page-目录.c85b4d0b.js"><link rel="prefetch" href="/myblog/assets/js/page-移动端开发.56ac22ec.js"><link rel="prefetch" href="/myblog/assets/js/page-组件和组件封装.b5e86da2.js"><link rel="prefetch" href="/myblog/assets/js/page-计算机网络基础.0a106662.js"><link rel="prefetch" href="/myblog/assets/js/page-设计模式.ffdc7cfd.js"><link rel="prefetch" href="/myblog/assets/js/page-调试技巧.485ae36e.js"><link rel="prefetch" href="/myblog/assets/js/page-贪心算法.0f417640.js"><link rel="prefetch" href="/myblog/assets/js/page-输入url到页面展示全过程.510aef2e.js"><link rel="prefetch" href="/myblog/assets/js/page-递归.5e55e552.js"><link rel="prefetch" href="/myblog/assets/js/page-链表.1cf6927f.js"><link rel="prefetch" href="/myblog/assets/js/page-项目总结.ffcd2a4b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~docsearch.f3877d0d.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~5d377965.d9712593.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-components/Blog/ArticleItem~layout-components/Blog/ArticleL~b56f3aac.47bb5cb5.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-NotFound~layout-components/Common~layout-components/Page.57d58db9.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Slide.81546b3b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/AlgoliaSearch/Full.b30f067a.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Blog/BlogPage.bcccbd38.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Navbar/Navbar.e2a7361e.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Page.6c65077c.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Sidebar/Sidebar.34cd9cf7.js"><link rel="prefetch" href="/myblog/assets/js/vendors~photo-swipe.428df1da.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.645fbc6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/myblog/" class="home-link router-link-active"><img src="./mylogo.png" alt="Sewen 博客" class="logo"> <!----> <span class="site-name can-hide">Sewen 博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
        前端基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
        计算机基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
        框架和源码分析
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
        浏览器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
        服务器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
        性能优化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
        前端工程
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
        项目实践
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
        项目搭建
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><a href="/myblog/projectDeploy/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="./mylogo.png" class="avatar round"> <div property="name" class="name">Sewen 博客</div> <meta property="url" content="../outline.md"></div> <div class="num-wrapper"><div><div class="num">91</div> <div>Articles</div></div> <div><div class="num">0</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">91</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/Sewar-x/myblog" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="1567910907" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up" class="media-link"><span class="sr-only">Wechat</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E"></circle> <path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#FFF"></path> <path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
      前端基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
      计算机基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
      框架和源码分析
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
      浏览器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
      服务器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
      性能优化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
      前端工程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
      项目实践
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
      项目搭建
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectDeploy/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/projectDeploy/" aria-current="page" class="sidebar-link">目录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/#自动构建和部署" class="sidebar-link">自动构建和部署</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/#前端部署原理" class="sidebar-link">前端部署原理</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/#前端发版静态资源404问题" class="sidebar-link">前端发版静态资源404问题</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/" class="sidebar-link">前端部署原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#前端手动部署" class="sidebar-link">前端手动部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#前端手动发版流程" class="sidebar-link heading3">前端手动发版流程</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#静态资源服务搭建" class="sidebar-link heading3">静态资源服务搭建</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#存在问题" class="sidebar-link heading3">存在问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#前端自动化部署" class="sidebar-link">前端自动化部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#概念" class="sidebar-link heading3">概念</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#流程" class="sidebar-link heading3">流程</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#方案" class="sidebar-link heading3">方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#前端部署发展过程" class="sidebar-link">前端部署发展过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#原始部署" class="sidebar-link heading3">原始部署</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#使用强制缓存" class="sidebar-link heading3">使用强制缓存</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#静态资源添加版本号" class="sidebar-link heading3">静态资源添加版本号</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#文件级别的精确缓存控制" class="sidebar-link heading3">文件级别的精确缓存控制</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#动静资源分离部署" class="sidebar-link heading3">动静资源分离部署</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#非覆盖式发布" class="sidebar-link heading3">非覆盖式发布</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#静态资源优化方案总结" class="sidebar-link heading3">静态资源优化方案总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86/#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/" aria-current="page" class="active sidebar-link">前端自动部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#cicd-概念" class="sidebar-link">CICD 概念</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#cicd-方案" class="sidebar-link">CICD 方案</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#自定义脚本部署" class="sidebar-link">自定义脚本部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#所需资源" class="sidebar-link heading3">所需资源</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#使用技术" class="sidebar-link heading3">使用技术</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#部署规范" class="sidebar-link heading3">部署规范</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#实现方案" class="sidebar-link heading3">实现方案</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#总结" class="sidebar-link heading3">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#jenkins-部署" class="sidebar-link">Jenkins 部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#jenkins" class="sidebar-link heading3">Jenkins</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#使用npm构建node-js和react应用" class="sidebar-link heading3">使用npm构建Node.js和React应用</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#在docker中运行jenkins" class="sidebar-link heading3">在Docker中运行Jenkins</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#参考资料" class="sidebar-link">参考资料</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#现状" class="sidebar-link">现状</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#代码自动回滚方案" class="sidebar-link">代码自动回滚方案</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#使用-node-脚本回滚" class="sidebar-link">使用 Node 脚本回滚</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#参考资料-2" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/" class="sidebar-link">前端发版静态资源404问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#现象描述" class="sidebar-link">现象描述</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#问题复现" class="sidebar-link">问题复现</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#原因分析" class="sidebar-link">原因分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#模块按需加载问题" class="sidebar-link heading3">模块按需加载问题</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#浏览器缓存问题" class="sidebar-link heading3">浏览器缓存问题</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#资源404原因分析" class="sidebar-link heading3">资源404原因分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#解决方案" class="sidebar-link">解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#nginx反向代理" class="sidebar-link heading3">nginx反向代理</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#在-html-页面加-meta-标签" class="sidebar-link heading3">在 html 页面加 `meta` 标签</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#输出文件添加版本号" class="sidebar-link heading3">输出文件添加版本号</a></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#版本更新检查插件" class="sidebar-link heading3">版本更新检查插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/projectDeploy/%E5%89%8D%E7%AB%AF%E5%8F%91%E7%89%88%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90404%E9%97%AE%E9%A2%98/#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/myblog/projectDeploy/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">目录</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">前端自动部署</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">前端自动部署</span></h1> <div class="page-info"><!----> <true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#cicd-概念" class="anchor-link heading2"><div>CICD 概念</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#cicd-方案" class="anchor-link heading2"><div>CICD 方案</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#自定义脚本部署" class="anchor-link heading2"><div>自定义脚本部署</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#所需资源" class="anchor-link heading3"><div>所需资源</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#使用技术" class="anchor-link heading3"><div>使用技术</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#部署规范" class="anchor-link heading3"><div>部署规范</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#实现方案" class="anchor-link heading3"><div>实现方案</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#总结" class="anchor-link heading3"><div>总结</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#jenkins-部署" class="anchor-link heading2"><div>Jenkins 部署</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#jenkins" class="anchor-link heading3"><div>Jenkins</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#使用npm构建node-js和react应用" class="anchor-link heading3"><div>使用npm构建Node.js和React应用</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#在docker中运行jenkins" class="anchor-link heading3"><div>在Docker中运行Jenkins</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#参考资料" class="anchor-link heading2"><div>参考资料</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#现状" class="anchor-link heading2"><div>现状</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#代码自动回滚方案" class="anchor-link heading2"><div>代码自动回滚方案</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#使用-node-脚本回滚" class="anchor-link heading2"><div>使用 Node 脚本回滚</div></a></li><li class="anchor"><a href="/myblog/projectDeploy/%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2/#参考资料-2" class="anchor-link heading2"><div>参考资料</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="前端自动部署"><a href="#前端自动部署" class="header-anchor">#</a> 前端自动部署</h1> <hr> <h2 id="cicd-概念"><a href="#cicd-概念" class="header-anchor">#</a> CICD 概念</h2> <p>前端 CICD（Continuous Integration and Continuous Deployment）是指前端开发中的持续集成和持续部署流程。它是一种自动化的工作流程，旨在将代码的集成、构建、测试和部署过程自动化，以提高开发团队的效率和产品的质量。</p> <p>前端 CICD 的目标是实现以下几个方面的自动化：</p> <ol><li><strong>代码集成</strong>：将多个开发人员的代码合并到主分支或开发分支，确保代码的一致性和兼容性。</li> <li><strong>构建</strong>：将源代码转换为可在生产环境中运行的静态文件，例如将 TypeScript 转换为 JavaScript、将 SCSS 转换为 CSS、将模块打包等。</li> <li><strong>测试</strong>：自动运行各种类型的测试，例如单元测试、集成测试和端到端测试，以确保代码的质量和功能的正确性。</li> <li><strong>部署</strong>：将构建好的静态文件部署到服务器、CDN 或其他托管服务上，使得应用程序能够在线上环境中运行。</li></ol> <hr> <h2 id="cicd-方案"><a href="#cicd-方案" class="header-anchor">#</a> CICD 方案</h2> <ul><li><strong>自定义脚本</strong>：使用自定义的脚本和工具实现前端 CICD 流程，例如使用 Shell 脚本、Node.js 脚本或其他构建工具（如Grunt、Gulp）来执行代码的构建、测试和部署。</li> <li><strong>持续集成工具</strong>：使用专门的持续集成工具，如Jenkins、Travis CI、CircleCI、GitLab CI/CD等，配置和管理前端 CICD 流程。这些工具提供了可视化界面、插件和集成能力，使得配置和管理更加方便。</li> <li><strong>云原生方案</strong>：使用云原生的解决方案，如AWS CodePipeline、Google Cloud Build、Azure DevOps等。这些平台提供了托管的构建和部署服务，可以与云服务（如AWS S3、Azure Blob Storage）和容器平台（如Docker、Kubernetes）集成，实现全自动化的前端 CICD 流程。</li> <li><strong>版本控制托管平台集成</strong>：结合代码托管平台（如GitHub、GitLab、Bitbucket）的特性，利用其提供的 Webhooks、Actions、Pipelines等功能，实现前端 CICD 的集成和自动化。</li></ul> <hr> <h2 id="自定义脚本部署"><a href="#自定义脚本部署" class="header-anchor">#</a> 自定义脚本部署</h2> <p>考虑到团队前端人数较少，项目数量不是非常多，服务器资源和其他资源较少，而使用 <strong>持续集成工具</strong> 需要一个服务器来执行构建和测试任务，因此使用自定义脚本部署方案部署前端代码。</p> <p>以下介绍自定义脚本部署方案实现过程：</p> <h3 id="所需资源"><a href="#所需资源" class="header-anchor">#</a> <strong>所需资源</strong></h3> <table><thead><tr><th>资源</th> <th>作用</th> <th>备注</th></tr></thead> <tbody><tr><td>静态资源服务器</td> <td>部署前端构建的静态资源</td> <td>可以使用 <code>nginx</code> 部署</td></tr> <tr><td>FTP</td> <td>上传静态前端资源到服务器</td> <td>FTP 服务和账号</td></tr> <tr><td>node 环境</td> <td>构建脚本和上传</td> <td></td></tr></tbody></table> <h3 id="使用技术"><a href="#使用技术" class="header-anchor">#</a> <strong>使用技术</strong></h3> <table><thead><tr><th>插件</th> <th>作用</th></tr></thead> <tbody><tr><td>husky</td> <td>设定 <code>git hook</code>, 在执行分支操作时自动执行 shell 脚本</td></tr> <tr><td>shell 脚本</td> <td>根据分支自动执行相对应环境 <code>npm script</code> 脚本</td></tr> <tr><td><code>npm script</code></td> <td>自动构建脚本命令</td></tr> <tr><td><a href="https://www.npmjs.com/package/ftp-deploy" target="_blank" rel="noopener noreferrer">ftp-deploy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>上传静态资源</td></tr></tbody></table> <h3 id="部署规范"><a href="#部署规范" class="header-anchor">#</a> <strong>部署规范</strong></h3> <p>部署流程一般会通过结合 <code>git</code> 分支操作进行规范流程，在我们项目中，设定了以下部署规范：</p> <ul><li>测试分支 <code>test</code> 代码构建产物只能推送到 测试服，其他代码构建产物不能直接推送到测试服；</li> <li>正式分支 <code>master</code>、<code>prod</code> 代码构建产物只能推送到 正式服，其他代码构建产物不能直接推送到 正式服；正式分支通常设置为保护分支，不能直接在正式分支提交代码，必须提交 PR 流程；</li></ul> <p>通过以上规则，主要避免以下情况：</p> <ul><li>通过设置测试分支 <code>test</code> 构建产物只能推送测试服，可以避免在多人开发不同模块时候竞争使用测试服资源，相互覆盖对方代码的情况；在该规则情况下，所有要上测试服的代码必须先合并到测试分支 <code>test</code> 才能上测试服。</li> <li>正式分支 <code>master</code>、<code>prod</code> 代码构建产物只能推送到 正式服，可以避免将其他分支代码推送到正式环境；</li></ul> <p>具体分支流程规范，可以参考我的这篇文章：<a href="https://sewar-x.github.io/git/Git%E6%B5%81%E7%A8%8B%E8%A7%84%E8%8C%83/#%E5%88%86%E6%94%AF%E4%BB%8B%E7%BB%8D" target="_blank" rel="noopener noreferrer">Git 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="实现方案"><a href="#实现方案" class="header-anchor">#</a> <strong>实现方案</strong></h3> <h4 id="总体流程"><a href="#总体流程" class="header-anchor">#</a> 总体流程</h4> <ol><li>本地切换分支到 <code>test</code> ;</li> <li>合并开发分支代码，推送代码到远程仓库；</li> <li>触发 <code>git hooks</code>  钩子，执行 shell 脚本；</li> <li>shell 脚本检查分支，执行对应分支的 <code>npm script</code> 脚本；</li> <li>本地构建生成静态资源；</li> <li>上传静态资源；</li> <li>同步代码到 git 仓库。</li></ol> <p><img src="/myblog/assets/img/自动部署脚本流程.4ad2e7c9.png" alt=""></p> <p>下面将详细介绍每一个流程中实现方案</p> <h4 id="git-hooks"><a href="#git-hooks" class="header-anchor">#</a> <strong>Git Hooks</strong></h4> <p>Git hooks是Git版本控制系统中的脚本钩子，它们允许你在特定的Git操作（如提交、推送、合并等）发生时触发自定义脚本。</p> <p>通过使用Git hooks，你可以在这些关键操作之前或之后执行自定义的脚本，以实现一些自动化、验证或其他定制化的操作。</p> <p>Git hooks有两种类型：客户端钩子（Client-side hooks）和服务器端钩子（Server-side hooks）。</p> <ol><li><strong>客户端钩子</strong>：客户端钩子在开发者本地执行，用于控制提交、合并等操作。以下是常见的客户端钩子：
<ul><li><code>pre-commit</code>：在执行提交操作之前触发。可以用于运行代码风格检查、单元测试等操作，确保提交的代码符合规范。</li> <li><code>pre-push</code>：在执行推送操作之前触发。可以用于运行集成测试、代码质量检查等操作，确保推送的代码符合要求。</li> <li><code>prepare-commit-msg</code>：在生成提交信息之前触发。可以用于自动填充提交信息，如添加分支名、问题号等。</li> <li><code>post-commit</code>：在提交操作完成后触发。可以用于触发通知、更新依赖等操作。</li></ul></li> <li><strong>服务器端钩子</strong>：服务器端钩子在代码推送到远程仓库时执行，用于控制接受或拒绝推送，以及执行其他自定义操作。以下是常见的服务器端钩子：
<ul><li><code>pre-receive</code>：在接收推送操作之前触发。可以用于验证提交的代码、检查权限等操作，拒绝不符合要求的推送。</li> <li><code>post-receive</code>：在接收推送操作完成后触发。可以用于触发部署、通知等操作。</li></ul></li></ol> <p>要配置Git hooks，你需要在Git仓库的<code>.git/hooks/</code>目录下创建相应的钩子脚本文件。这些脚本文件默认是被禁用的，你需要将它们重命名为去掉<code>.sample</code>后缀，并添加相应的逻辑。</p> <h4 id="husky"><a href="#husky" class="header-anchor">#</a> <strong>Husky</strong></h4> <p>Husky 是一个用于在 Gi 仓库中设置和管理 Git hooks 的工具。它可以帮助你更方便地配置和使用Git hooks，并确保这些钩子在团队中的各个开发环境中一致地运行。</p> <p>Husky 提供了一个简单的命令行接口，可以在项目中安装和配置Git hooks。</p> <p>它的优点之一是使用简单的配置文件，而不需要手动创建和管理钩子脚本文件。</p> <p>Husky支持常见的客户端钩子，如pre-commit、pre-push等。</p> <p>使用Husky的主要步骤如下：</p> <ol><li><p><strong>安装Husky</strong>：在项目根目录中运行以下命令，使用npm或者yarn安装Husky：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> husky --save-dev
<span class="token comment"># 或者</span>
<span class="token function">yarn</span> <span class="token function">add</span> husky <span class="token parameter variable">--dev</span>
```
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><strong>配置Git hooks</strong>：在<code>package.json</code>文件中添加一个<code>husky</code>字段，用于配置Git hooks。你可以指定要运行的钩子以及相应的命令。例如，以下配置示例在提交之前运行ESLint检查：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token string-property property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;pre-push&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span> <span class="token comment">//值为你要执行的 npm script 脚本</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><strong>创建 husky 文件</strong>：在根目录下创建一个 <code>.husky</code> 文件夹，该文件夹下面包含 <code>_</code> 文件夹和 <code>pre-push</code> 钩子文件：</p> <p><img src="/myblog/assets/img/husky.b4cc1a72.png" alt="image-20231215111207735"></p> <p>在 <code>./husky/_</code> 文件夹下创建 <code>husky.sh</code>  shell 文件：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$husky_skip_init</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function-name function">debug</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$HUSKY_DEBUG</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token builtin class-name">echo</span> <span class="token string">&quot;husky (debug) - <span class="token variable">$1</span>&quot;</span>
    <span class="token keyword">fi</span>
  <span class="token punctuation">}</span>

  <span class="token builtin class-name">readonly</span> <span class="token assign-left variable">hook_name</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
  debug <span class="token string">&quot;starting <span class="token variable">$hook_name</span>...&quot;</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$HUSKY</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    debug <span class="token string">&quot;HUSKY env variable is set to 0, skipping hook&quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
  <span class="token keyword">fi</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> ~/.huskyrc <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    debug <span class="token string">&quot;sourcing ~/.huskyrc&quot;</span>
    <span class="token builtin class-name">.</span> ~/.huskyrc
  <span class="token keyword">fi</span>

  <span class="token builtin class-name">export</span> <span class="token builtin class-name">readonly</span> <span class="token assign-left variable">husky_skip_init</span><span class="token operator">=</span><span class="token number">1</span>
  <span class="token function">sh</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
  <span class="token assign-left variable">exitCode</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$?</span>&quot;</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$exitCode</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;husky - <span class="token variable">$hook_name</span> hook exited with code <span class="token variable">$exitCode</span> (error)&quot;</span>
  <span class="token keyword">fi</span>

  <span class="token builtin class-name">exit</span> <span class="token variable">$exitCode</span>
<span class="token keyword">fi</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li> <li><p><strong>创建 Git 钩子</strong>： 在 <code>./husky</code> 目录下创建 <code>pre-push</code> 钩子shell 脚本，该文件脚本会在git push 之前执行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">)</span></span>/_/husky.sh&quot;</span>

<span class="token comment"># 代码推送前根据当前分支进行自动构建(仅对 prod 分支和 test 分支进行构建)</span>
<span class="token comment"># doc: https://typicode.github.io/husky/#/?id=install</span>
<span class="token keyword">function</span> <span class="token function-name function">current_branch</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">branch</span><span class="token operator">=</span><span class="token string">''</span>
    <span class="token assign-left variable">testBranch</span><span class="token operator">=</span><span class="token string">'test'</span>
    <span class="token assign-left variable">masterBranch</span><span class="token operator">=</span><span class="token string">&quot;prod&quot;</span>
    <span class="token builtin class-name">cd</span> <span class="token environment constant">$PWD</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">'.git'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">git</span> describe <span class="token parameter variable">--contains</span> <span class="token parameter variable">--all</span> HEAD<span class="token operator">|</span><span class="token function">tr</span> <span class="token parameter variable">-s</span> <span class="token string">''</span><span class="token variable">`</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$output</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token assign-left variable">branch</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${output}</span>&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$branch</span> <span class="token operator">==</span> <span class="token variable">$testBranch</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;自动构建并上传 test 分支代码&quot;</span>
        <span class="token function">npm</span> run build:test
    <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$branch</span> <span class="token operator">==</span> <span class="token variable">$masterBranch</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span> 
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;自动构建并上传 prod 分支代码&quot;</span>
        <span class="token function">npm</span> run build:prod
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

current_branch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>该脚本主要执行以下操作：</p> <ol><li>获取当前分支；</li> <li>检查当前分支是否为测试分支，是则执行构建测试脚本；</li> <li>检查当前分支是否为正式分支，是则执行构建正式脚本；</li></ol></blockquote></li></ol> <h4 id="npm-script"><a href="#npm-script" class="header-anchor">#</a> <strong>npm Script</strong></h4> <p>npm script是npm提供的一种功能，允许你在<code>package.json</code>文件中定义和运行自定义的命令脚本。</p> <p>通过使用npm script，你可以在项目中方便地运行各种任务和操作，例如构建项目、运行测试、启动开发服务器等。</p> <p>在<code>package.json</code>文件中，有一个特殊的字段<code>&quot;scripts&quot;</code>，其中可以定义一组键值对，每个键表示一个自定义的命令，而对应的值则是要运行的命令脚本。</p> <p><strong>添加构建脚本</strong></p> <p>在 <code>package.json</code> 文件的 <code>script</code> 字段添加如下脚本：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=test vite build --mode test &amp;&amp; esno ./build/script/postBuild.ts &amp;&amp; npm run deploy:test&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production vite build --mode production &amp;&amp; esno ./build/script/postBuild.ts &amp;&amp; npm run deploy:prod&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deploy:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=test &amp;&amp; node ./deploy/index.ts&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deploy:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; node ./deploy/index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>脚本说明:</p> <table><thead><tr><th>脚本</th> <th>作用</th></tr></thead> <tbody><tr><td>npm run build:test</td> <td>本地构建测试分支代码并上传资源到测试服</td></tr> <tr><td>npm run build:prod</td> <td>本地构建正式分支代码并上传资源到正式服</td></tr> <tr><td>npm run  deploy:test</td> <td>上传资源到测试服</td></tr> <tr><td>npm run  deploy:prod</td> <td>上传资源到正式服</td></tr></tbody></table> <h4 id="ftp-上传资源"><a href="#ftp-上传资源" class="header-anchor">#</a> <strong>FTP 上传资源</strong></h4> <p>在本地构建资源完成，将在根目录下生成 <code>/dist</code>  静态资源文件夹，然后通过上传资源脚本将该文件夹所有文件上传到静态资源服务器中。</p> <p>上传脚本放置统一文件夹下面管理 <code>/deploy</code> :</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdsAAADHCAMAAABmxwlSAAAAnFBMVEUkJCbAmWKbv80Aes7Nzc0kJl1ZWVg2NjwyMjIeHh5OmLjMza0kg60jYZ2BJCbCzch+h4TNv56Brc1fJCY8cpnMrYGuzMytgyabYiZimsQnJ4MpU3hRmq02PCZNeH8vd7mPkJB0WC8lKz44ibdiODjKsI3NzcOLeWiKsc1AXkmabUMsQXU8KCkyQUEDdcL8/vyvikCJNjyMqa96KoUBDfg7AAAXcklEQVR42uxdDUPaPBAurJgT6VAGKErcpg6Zgr7b/v9/e5NLP5I2SZO2KB/JJjTpB9Cnd/dccpdEoCtRKAdbzvMSBWwDtqEEbEPZc2xJKAdbArangi2p/IU7FOQ2lD3Htiq2AdvjlVs8Zhv+DvKvhG1ZcoPcHnCJJGxJMLfHrZNziW0I7vqXe2soH+wDQY6xoFLbzOTKm+a6QLG8v8DW5Rqh3kVdx6VIK6VsltttkKTPs7cysMQKbfLrKducFptBJ++vTiaK5BIVXEXqXvu/nkTDdN7L99+O4/gXojiJ4/g/tjN+nrOmDNtH1nr1ZzuNX3jl4k9FkkO9s/pWb28ziGnedbGtnP7av3pSoGV7buezLVlwKBds55SBO40ZjLfzXwLbyYphur7489qflSR5W/qeod6qvjXyZKrYXNNjIiR3Ou4VTROEm2F2O34RG9/HTHjJkEkob53zCn99ZAeKY4Ko7bIemfuliI1KbTi4035PuuBkJizrdsp0c8x18ZRLKr4ybKcMYnbousdx3T5e/QkG8SN9IJL7PhKZMtFbppbnvQeZL/VS1jRdpbhNUTj5a9G6nuGR6/8Cbf5onlxyg3TCnm29/n1WuTDXya/zTPtyOo1yy60vk2ZsFa/Ti39ciLfB491F3calVLaswKnKmur8MObERBK51Jojt3hhLWwDm3MuhRzstf83+ES7Klubf0vq/Vt94Xa2h/x3zcztjKP9g230Mla8iIVDxLZWL3oqEMrO+hw9yJSVrRHZ3mrK4urJcJFtqLeqy1sVLiX8ICLZW1Uhbz2kLVm9GGjYzPwVgyvTor61yC0ptHEHg3yiB6paHi/++GiBUPerZ42RLe6CyS9paBfxhKlObre349VLMLYfwKV0OpkY4y62pq2tg/Wt/TpB/jqQV71OfiaVET7wIE7NxHAbFHJn9bLkSdhe/iTV7guzVGnBNH5SLQXbBoS6FmHJ3l5ePmUcuVDOEUSbCKL0fRPlDWfFjuKf3JL/x5eNsncTyVdN36WLs4pyyVC315XX7F3OB7q8/OmR63UWcqkOKNfrnmFL5KF5ErA9FmxluRWjuAzdgO1xYPv8VCXKAdvjwPYJlBBlErA9GmyfaEVqgQRsjwLbL1/ekjslWopZ3YDtsWD75e3tjijjuFZs76ZYfkcPd9P7rdsHjuL4pT+TGkDzUt4d6qY6WG6hgi0rb28JlTunjKdybJPlcsj+3w+Gw+Vw+BtMnyiVZHUTDTi22r267xzqxrqH3L4JdBPZ6lrl9jyKvi8pA2zIRPeRbxk+tPhmo4uvmv2Lq29Bhe5WJ39BeN/uPPouUmzvo+jhwUklB2w/C1uhlj14MmI7eBwOFXs76MdxfI3GNeawJZg80ouiSRyvrv712Va0juOLH4g0O3rFDuMnMY0dimuBml0Stu/vcQrunXvfxXehiV85uvm+2zkzqKPraMGhWjP8kjF7GfEak9vzAcd2wjDH5lxu1+yk5U2gR951B7kdLt77QisnOVWmddiilX0ALrtLWlKxt/Pr9DUZX3Px7AmdzDeS8Y2kofkJuJuPEIWyC538Pk/pFOXIUme5/c64VCbBvKx7ghML5CYpkgq2I4RfxpYpcK0tDqVeMev9EhnbyftC8Km3IrbGeIGSveWuUJSBO2mELXsroxu0bzNtXMG2/z7P6JS7vX29Y4DCw910Krm3VZ28qmCLrGmhYpueEVBri2oFW25tJaJMfMaB1ONSLnWOXEqQpjK2g37GpdZsA1v/fpOwDaUFS9bIbebgplxK0sm12JbKLfN4uEguVnHM+xer2KKbdLVktQnyqNXVE/eEArQdoq74QKkTxH2gtGfKzpNbz648cmFPQR37i6y+7+JN0OQ8Fs50pU7GgSazIGVtVDF490vdSSmavjrZ8ZGCwV9U2TctrhGKwQ/KNlRs0dre6WJqKqe3lVuexmntYQwjPZH3yE+dTk62cvh5My4Vyr71S4lBoEiJvHDHFjrQK6F0eb8UbN+SV6BK0khtfzL44QLd/JBAlT3lFrEs5c0T470+8wUQgvC2LtShBUzYKkmarWJYwQNlCBi3Q9hJbrX5QOCOLQRZ/CzbS12wJbL0Vp4X2oQnQ4sHlIZ6Q7S1c5mIYfl6nQwtH7UwFN8hn6w2aue0b+bfduQEBR2+A/8WypPsyjE1YMYWmj97wQnq1OmxYEuqTLnRGB/dhQoKxdulqHIphxxNcPWBtA3ljYBiJ6bWTSfL04dFtjG+u/vp9N6aD7SuBpUnphGCQb8XYO7kAQC7f0v0/cmgYJvwNKDhspoPlJcJYiuUNA/CiLPoVT221icWSi2nUXcBE1zklpSktqY/WZcPVC0iuAJjqKJkZsAWCmxpFKmBUxDE0fk2UIu9JeqiBcSo5av5QGD4BohtIZQ2nZxvh6C43fFk5/7kND55qeYD8Vi4Gc8BYX98EP7iaxEZlYzT3CAcn0egb+crtoHYrjEcbrTCfKJkLNKJTt4l6sS/NfFksGJbzQfq8UDymQiIQliLyKgiN4iDzzeScY9nAnFss4BllFv+wiNbQ6mgDnXuJph1srY/Wbm+kg9EdPlAEwXbXoFtmhuUZLqaYxxt+GYeQIXYCsscuiWbdhkY5mHNt510sj4faGKS2zRWeYQrzcS9Qf86tber3BQLeztZzZTfFlSxV1ePyxifg73FfKAc20kV2yJ7usA2bZKwHV+rXIo1zU5a+0IThMHYd0GopJmJ1seUsMV8oOghUfKB0KvFWS1ybJMctjw3KHeGUplmbaMssSDnydXodChpqSOtu3fDgodOll9r46W0BclRzqWE0zNCapz5t3lKUPT3Kx6+QS51PopFsi5y5qTnmHlwmsa3VqatOpkoOpk6Y4vOSy/TycxscoC4XxQjK85yg5jGFc6Q8HWwjT0RKOLMGF/z5gBtcyus5ckkX2rEOg5U86EhIWSP+i7KE/6ZuBRY5BZ21rV0Sj2PtHtsy4vxNY1zZFY1taah7PjRlpkYlKiyaYxPGQcCT2zRtHYILagPdGkAmEbHVbdIL20styRdrFoqzXjyHjzWx99t4ZU3X+HIpG78tqGHHcyvxw+D5r9cx5OltAJzjuBZ29sdYiz2kSc30MmgsZMmsYfwBOwAWzngglhyvWyxcE1ze6AO1tNC2c0eU+str+HJ3edWw6fekuMchM+vRK08ubQsObX6QPBJzzPoascAK3XmUZ5zY+uWrXaUW+haQlvZ3INEGbrvpNLEOVb7LnSfdGa98YEC7c67a+wDlbmy8ek5a/t8tYSfhoeg7u5q4hypTKhacykwmnoXehzkv/ZemB0T/XrzjmtR3GHKyP1vKHJG8IQiyCIv8hg7bSDH1HoInAqQpmPAg0ulo7eURKbIdsQWU0aG9zxeasjj4dJSg+0uCz3wequHFozYnpXGCYjL+C2PhTtPFracESu2xhVG3HijIS4EDqzuLcRO50rY/sB1NImpP1lvb0XOyPJeBCmbv5Mbtp37Ugelgh3GXbwYpLL+7eXzpuziOmE7eFwupZwR4NFvyep5Hq+y1BCxWgwPgJqJlUdE9iZGTIXVY3ZUJGzJPQP3Zylx3ig7tpwRHu6WxFlqSL5aTLZeGwYnl1aP2SxvPCX1iMWZdqEFVGw3ZwxcRSPX62SRM/Kg5owgtnlqyCpbLQZD0vnG6OJfFkxVrB7T+DfSk0BYS4qrdtuwzggZcMFVu5PNNtSWMyKwVdIHGKS42JeISl3n6QLuq8fAsQordKOerHOHnV3+uDzblEaCjB+j2FvMmy9yRpILPba5Z4Rx6TKXWqy8fCT32PvjHfjx5FLPTxtS6nY03sA8Z4RXSmvIqHKbrxaTBywnqk7mJY94pT5QGh69fZ/mugst5DfH7uVPUg2ZiixzmRj7RRDblZwaIpJuebZP0sP03EXd6jEnFqBj73ejjX6mvN58Ofe2SZwjVOS2WC0GszK5bkb+dPVNrB4Th9VjdmTE9XEX1Nm//XiiAUdx37vljFAnt/b8W/gcbIP41bRVKQfVY0uUKNbPWosCXAySy9SeB0CSd0mnauS21r/9UHV1pLQKdvTDKvHJxMEH+hidDC1OOIAxH3D9OY0HUCxz/uXrVoOOip99XF8RHKOwdt7tBnXYknLQlI/cQrXzAXbyo2hk7uc4CEf2w/ulqsB6zJ98koZyZwCD37kGR9Guk7uxt3iRjaYRan/aCUYzUssdqQ3AsK5XUEx1AVSOcwR/bKFjqwL+bsR+RUPBB2tocx4facOTO1uYwP+Rh/11ZrtV3dQL2wqytOGa5F2z45ZO/6fD2iZVAHwlwB6fTAxzmZTXv63NqzxK+rkrz452fQPsudXEd822huIFXd2foynQwdNr0MnE095CUxTAH6kD68qATnsoWmBLwDMWzuvOuqpv2iFOe0+h2k8PYJprwjZWoMyJUMbFkA/U6ZMLg348G6WRy/SwFTPs5Crg7wNRt7gLUz6Qn4FY4AzZ2l2TdNZ7jzsEeyG/0AmeYFF4fvFSGp3sllfA84HOa/KBjCVfW0ZT9IHLIrQK2j3TeybK0J3A01r/1mhvaRVbYz6QQ6nAB47YHhsNjryXAmrUL0VK/clQI7dSPlB66BqXgMF5HUVOyDq+GmfpBWlW0KA/68fXUg4YxqZz2NazBYao8wPTIxK2NRNIp+vL8LdZM9W26/pnEAK39QoI+IwDafOBeNDx6FoIGA9UncTXWchjT8oKytaRkZQzzpg+iXtiRnw8RzwO19H5JDXK+RoktzNTJ/p+9mTQdkC3i7vIIxyJpl+KarHV5gOlgC3QkjIQcP0CDjjHNcsKQvSktWVEFDp/xcMxcDnDFi+YaWjEFqX5fB89XdoOMP/VhI1m2zi/FFHXNrbKbTUfCLnthBNgvi4MJhTczm842nlWkICqmBxdLDyTZPkHMrYi20TBll2mdwgmlXasZx2fH5N/S3zWv9XmA/Eo80xCoxzACa4ElGcFCaiK3Or/u7sW3rZxGJwUS0QX7S3Xxw23jEGSBS3WZsBh///HnSU/ZetBSZTtNkCByI1tSZ9IkRQfD0HYqs18/TlMkJiJMZt9auQXdYrrzbFrjAeqgWhxq7C9+/upXwWqgqpLjdHjyWNsK8Jf63Lyv55afWiaQczc5oYU4qnfpAOR/RxtQvufv+oCQCUY35+LGs7Nzdd1sWqjgmoybGvL1LLUt9UY2+qeB1U8t5bKSlHNnitj4SoPen+SoV6BGOy3rd8FBNmT1UZb14Z5kapPhW1RV9urooJ6LLaqLaO+VPv0CFt1z383Fbaqvkz599JBi4vGMpccNrhj5JRgtF2IPP7JRZE0Ydbwes/k4oT2R8gAOOF+JPDkhnCxFZmtT9zmGYDjYy1mvlhBKm+gWkJdL2HLaQ+xdBv/uVs3hucPgSm5fxBxI328jvq3i4jRbEj2C83C6DkIXI6/m8MnIcX3AGz6rbDXrZ4H22turrUIAYqwWOMebdOB+vFALv12iVwxKj0VH8lGGqT4Z9GYG3tIt6Sc9rzVi2A66CdgzJi89CzLxenFMqRbHGy4ETwZbPvb1fPrcChIR9ofyRLJWpV8aLsQA3nK+pxt2EuBgCXELmv4EFABL28CL48IqG1MoFtY9qKHD0JwTL82YytQhNcryA4be26IGXbeoHzmiR51I1lKc4UzxQOBjm1Ob2pIvgfm5yC0QixhEblI6oGrjmZNtzC/7YITf8OhGWsi+hnPLdAtS4GWGw7sVLBNnPYhvWMC75p3gjFGjuLbtO2M01xnBBJsjmjVQCCGgQFpJJi2xnpfUp0aOZaF7V+BjNwdf+urIXNQQSO/VlXMCNGBGnKs3sUJ7Xa4EiOm6eM28GRBrsd3f6uCRg6Vv9SvhW+9OOO7o+9Nea7zHEigu/5t0cQV3HpryJg/591pGhVoGsKeJqFFfD0+E08G+35bYytjRiKmauPEFhhGjnnxnCavBy2rHDiw3ckiMpfGboHms3k0Ybv5+eO2H6O5f73WNLk/Ho9v8vvxKK8d3g7HU3NR/XfXb8epMrAAimVeJZDa5+H57e44qBAkYmNGFLaSJje7S3F+LRR5HsqLTyWS1/pizZOLVdfOl1eKVO8BA9ue7SNZoobARe7kyeW0v160hJ3euIIqZkToMSMt3e5fH+WuvH9T/Pei8G0utjy5144eSLQdnsXtLUAZhyQpAoMGpMvJv3e7S0RdryZmBAd0W5wlCy5J9ig/ZfsgQa4vtnTbay/KyrN4G1tY/mRJt7oSRMJWxs3/6HhyIbGtGDFuyg0Vnk6KLouSbhVe8mJPluraiXshJk1VPjvEVEqPC1uxaeiWXGvxfS/HdL7XYkZaupWNkg+rtvw8NSLTobpyLvl0v80yXvBYnhYrThHHHqcDYUW3fZuycbOAldueLLdacSix3avt9PouyXJzqrFtLpY/Oh9ObZuTMMKfE318ByxsFnI8dkS3j7plyke35o9Ubi7HElul+5SisNpupQ4k/ykvYsWzyx+e3lU7btLmpb7ATmcOqx7xpzHdapYpp5zsPO8GquxbzMz0MMM99vOSSJE3ymKn+ydvenKyMMvJeWtRoHdUEDQ+t46JngdBhK4TaYBhJ17rftvPaQ8RPHk2vSB/Vm1I7SUkLGz6e2Bsc9y9XoVmU7bO1ax+F8mWnk+Q5NO/eMf2ZN0bzitLwfLghCWuOMyHIUVOvo6KURD9LnL5w/HoFxFSC8FByiYpARMwgQPy5JfqIEWREuvFbhpnDhGYkR+H1DpNT0Zryx0mHL5wYMcW6ITDlEQNs5EDsCxH0t3RsZ+6oI1ObIWerAaF9V1bHuqABP3PrlAaO4Ek84djmiFy+cHUaxVsdAv0+NuQIA3g2pjzZsmfUQDzulKEwt7D9tTPU8NZ+2laFQAX0yGYaFFQsB3AOl9OBG6fMphs1vPXUoBIujXyZItz2da+pfN2HCeYfb8sA6Pe2G2RJCkR8uBp8bs4/dajRgSpJnkcjdGK48Bs9DeHnJ4Etke/PeGQJTPxZMjGoAjPCPov0MTv4N7ljAy2G7gN+y2E5GG1vimfjRD9UwgEHoh5VyRG/KbttiGtBMWtFdz7reisycKbP3kQD2R7u6wUorIyTlr5KBATmKsH+V6s7bco3PmThzGaKh7oRxsPZOtliy1lZSNtxDD9AvBscpDGeDJwOI+c7LZL9eKBLDVk2jS4OrYhaTdDhxWshvBKQwtwugWznKwlDgOqD2sVD3ReJWILuQh00gyZ2TtB5usuukVB90/W4oHuJKLf//m2uXmRWY5Vduu6JozCWqVnXHft+HFNtXmj+4Jd3KZzeGRnEIa8cMJZtxoM2A7jgRpsa7qtsZUXNn8erw3d1m1MXunOTEsh1WVMByoMzomJx/LRsdjm+NvupM9kkRlhK8Mz+/FAZmxV/mPseLJqXyliCTVRafBBL2ThkGnPgADrxMppHEzNe/7TFA9kxnb18PLcxHhV9WNenvkmFZPuBg7UwvOv5JX2x/WBUIAvHmhQQ6Z478UDgR1bWdTnuS9Llfvx82qyz0KIdDop3FO32ht/W8cD6TVkqhJ6X0fYtuJyKycP1V4G8yROht9sSRogCtuh2dEbf2t8m6zkU9JoU1qt2W+roiGqzI8swna/XplMGjn0ROSFKLIKL7IvCwijW/2owBDkZcR2ZIn68vJalVbrdCCp8pTfFLbl93XdDgIF01dAlEcMUHuZpZRmmL+nKwdRz57slqVmzAtCtfZBVtjTlgXYVTX0307II+bxl4rJjZ0MK4eBAtKo0R4lmFz2Pmf2C3DbLkRAzbbFfeJPGCCSWSw56ZVTTtZtjvpoth8L1c/yia2jOT6bV+e35By7DOHOSBhWaAnwwG4By/TjlC+zXDbmYRVL4MkTUSIuhubYFWtXbmxBjuMLN9lB8O8YJxO5yRCCBS0M6nvcHJl1oKbufCcnRyoTENpPaucxA3kjtZcQgk9K8gOgMxyDCcJmu3DnT85hVgHW5yPhlV7ekSdUALJA7efJDb2CQU5epcUN5pyWGZ3seN/Kuvt32P4PrB2/bLIH+kwAAAAASUVORK5CYII=" alt="image-20231215112404502"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> /deploy
 -- config.ts // ftp-deploy 服务器脚本配置
 -- gitCheck.ts //上传规范检查脚本，用于强制限制正式服只能上传 prod 分支代码；测试服只能上传 <span class="token builtin class-name">test</span> 分支代码<span class="token punctuation">;</span>
 -- serverConfig.ts // 命令行交互脚本，用于获取 shell 交互中输入的用户名称和密码
 -- utils.ts // 工具函数，获取环境变量
 -- users.ts // 用户 <span class="token function">ftp</span> 账号密码配置，仅仅保存在本地，不能上传到 Git 仓库中，要添加到 .gitignore 文件
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>发布脚本思路</strong></p> <ol><li>本地检查分支，强制限制正式服只能上传 prod 分支代码；测试服只能上传 test 分支代码;</li> <li>上传代码:</li></ol> <p>实现代码:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> FtpDeploy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ftp-deploy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ftpDeploy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FtpDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DeployConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config.ts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gitCheck <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./gitCheck.ts&quot;</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * 上传文件函数
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> DeployConfig<span class="token punctuation">.</span><span class="token function">getFtpDeployConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ftpDeploy
    <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished:'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>

  ftpDeploy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uploading'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'total file count being transferred: '</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>totalFilesCount<span class="token punctuation">)</span> <span class="token comment">// total file count being transferred</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>transferredFileCount<span class="token punctuation">,</span> <span class="token string">' of files transferred'</span><span class="token punctuation">)</span> <span class="token comment">// number of files transferred</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'partial path with filename being uploaded:'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>filename<span class="token punctuation">)</span> <span class="token comment">// partial path with filename being uploaded</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  ftpDeploy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uploaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'uploaded: '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token comment">// same data as uploading event</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  ftpDeploy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'upload-error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'upload error: '</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>err<span class="token punctuation">)</span> <span class="token comment">// data will also include filename, relativePath, and other goodies</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>


<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">gitCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><strong>git 分支检查</strong>：强制限制 test 分支构建产物上传到 测试服， prod 分支构建产物上传到 正式服，在 <code>/deploy/gitCheck.ts</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">/**
 * 上传规范:
 *  1. 正式服只能上传 prod 分支代码；测试服只能上传 test 分支代码;
 */</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取当前 git 分支名称</span>
<span class="token keyword">function</span> <span class="token function">getCurrentBranchName</span><span class="token punctuation">(</span><span class="token parameter">p <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> gitHeadPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>p<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/.git/HEAD</span><span class="token template-punctuation string">`</span></span>

    <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        <span class="token operator">?</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>gitHeadPath<span class="token punctuation">)</span>
            <span class="token operator">?</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>gitHeadPath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token operator">:</span> <span class="token function">getCurrentBranchName</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * git 分支检查
 * @returns 
 */</span>
<span class="token keyword">function</span> <span class="token function">getCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取当前 git 分支名称</span>
    <span class="token keyword">const</span> currentBranchName <span class="token operator">=</span> <span class="token function">getCurrentBranchName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 上传的服务器环境与 git 分支对应表: key 为上传的服务器环境, value 对应的 git 分支代码</span>
    <span class="token keyword">const</span> envtoGitbranchMap <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'test'</span><span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'production'</span><span class="token operator">:</span> <span class="token string">'master'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>envtoGitbranchMap<span class="token punctuation">[</span>utils<span class="token punctuation">.</span><span class="token function">getNodeEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">!==</span> currentBranchName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'请检查分支代码!!! 测试服仅能上传 test 分支代码, 正式服仅能上传 master 分支代码!!'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> getCheck
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p><strong>shell 交互获取用户账号密码</strong>： 在 <code>/deploy/serverConfig.ts</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// const OUTPUT_DIR = require(&quot;../build/constant.ts&quot;).OUTPUT_DIR;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> inquirer
    <span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请输入用户名,按回车确认：'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">validate</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> val <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token string">&quot;请输入非空字符串&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'password'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请输入密码,按回车确认：'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">validate</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> val <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token string">&quot;请输入非空字符串&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      info<span class="token punctuation">.</span>user <span class="token operator">=</span> answers<span class="token punctuation">.</span>user
      info<span class="token punctuation">.</span>password <span class="token operator">=</span> answers<span class="token punctuation">.</span>password
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> info
<span class="token punctuation">}</span>

<span class="token comment">//获取上传配置信息</span>
<span class="token keyword">const</span> <span class="token function-variable function">getConfig</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    users <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./users.ts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户信息文件不存在 '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>users<span class="token punctuation">.</span>user <span class="token operator">||</span> <span class="token operator">!</span>users<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      users <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> users<span class="token operator">?.</span>user<span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> users<span class="token operator">?.</span>password<span class="token punctuation">,</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token string">&quot;测试服 ftp 地址&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">production</span><span class="token operator">:</span> <span class="token string">&quot;正式服 ftp 地址&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span>  <span class="token string">&quot;测试服 ftp 端口号&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">production</span><span class="token operator">:</span> <span class="token string">&quot;正式服 ftp 端口号&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">localRoot</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../dist</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">remoteRoot</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 远程静态资源文件路径</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span>  <span class="token string">&quot;测试服 ftp 目录&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">production</span><span class="token operator">:</span> <span class="token string">&quot;正式服 ftp 目录&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> getConfig

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p><strong>获取 FTP 配置</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> deployConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./serverConfig.ts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">getFtpDeployConfig</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getFtpDeployConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">deployConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> config<span class="token punctuation">.</span>user<span class="token punctuation">[</span>utils<span class="token punctuation">.</span><span class="token function">getNodeEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 服务器登录账号</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> config<span class="token punctuation">.</span>password<span class="token punctuation">[</span>utils<span class="token punctuation">.</span><span class="token function">getNodeEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 服务器密码</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> config<span class="token punctuation">.</span>host<span class="token punctuation">[</span>utils<span class="token punctuation">.</span><span class="token function">getNodeEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 服务器地址</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> config<span class="token punctuation">.</span>port<span class="token punctuation">[</span>utils<span class="token punctuation">.</span><span class="token function">getNodeEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ftp的服务器端口</span>
    <span class="token literal-property property">localRoot</span><span class="token operator">:</span> config<span class="token punctuation">.</span>localRoot<span class="token punctuation">,</span> <span class="token comment">// 上传的文件</span>
    <span class="token literal-property property">remoteRoot</span><span class="token operator">:</span> config<span class="token punctuation">.</span>remoteRoot<span class="token punctuation">[</span>utils<span class="token punctuation">.</span><span class="token function">getNodeEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 远程服务器文件存储路径</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'**/*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 这将上传除了点文件之外的所有文件</span>
    <span class="token comment">// 排除sourcemaps和node_modules中的所有文件</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dist/**/*.map&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules/**/.*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.git/**&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">deleteRemote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果为true，则在上传前删除目的地的所有现有文件</span>
    <span class="token literal-property property">forcePasv</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 主动模式/被动模式</span>
    <span class="token literal-property property">sftp</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 使用 sftp协议 或 ftp协议</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <h4 id="特点"><a href="#特点" class="header-anchor">#</a> <strong>特点</strong></h4> <p>自动化部署方案需要考虑各自团队规模，团队成员习惯，规范等，个人经验总结，自定义脚本方案适用于以下<strong>特点</strong>：</p> <ul><li><strong>前端团队规模较小</strong>：管理方便，能统一团队成员习惯；</li> <li><strong>资源较少</strong>：自定义脚本方案通常在开发人员本地打开构建，最后只要上传到测试服即可，因此不需要单独的服务器资源做自动化打包部署工具；</li> <li><strong>不能自动回退特定版本</strong>：版本发布频率较低，自定义脚本方案不能自动回退特定版本，需要手动回退版本，因此比较难自动快速回退特定版本，需要人工手动回退；</li> <li>需要统一管理版本发布人员，由于本地脚发布方案是任何团队都可以在本地构建发布，因此需要有一个人单独管理正式服发版版本。</li></ul> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> <strong>优点</strong></h4> <ul><li><strong>无需服务器</strong>，开发人员本地构建项目，适用于服务器资源较少的团队，但发版速度受限于开发人员本地构建速度；</li> <li><strong>发布流程简单快速</strong>，本地构建即可发布，不同成员发布时候不会导致竞争服务器发布资源，开发人员直接将代码合并到测试服，本地构建完成直接上到测试服即可，多个开发人员构建可以并行，相互不影响。</li> <li><strong>灵活性和自定义能力：</strong> 根据项目需求自定义发布流程和操作。你可以使用git hooks和shell脚本来实现各种自定义逻辑和操作，如分支合并检查、环境选择和本地打包。这种灵活性允许你根据特定项目的要求进行精确的控制和处理。</li> <li>**直接控制和可视化：**允许你直接在本地执行和监控发布流程。你可以通过git hooks和shell脚本将构建和部署过程与本地开发环境集成在一起，使整个过程更加可视化和直观。</li> <li><strong>快速迭代和验证：</strong> 能够快速迭代和验证发布流程。通过本地合并分支和推送来触发发布流程，你可以更快地检查和验证构建结果，<strong>减少了与持续集成工具中的构建和部署的等待时间</strong>。</li></ul> <h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> <strong>缺点</strong></h4> <ul><li><strong>不能快速回退特点版本</strong></li> <li>**依赖开发者环境：**自定义脚本方案依赖于开发者本地环境的配置和设置。如果你的团队中有多个开发者，每个开发者的配置可能会有所不同，这可能导致发布流程的一致性问题。</li> <li>**可扩展性有限：**自定义脚本方案在规模化或多人协作项目中可能会遇到一些限制。当项目变得庞大且团队规模扩大时，手动执行和管理发布流程可能会变得更加复杂和困难。</li> <li><strong>缺乏自动化和集中化：</strong> 自定义脚本方案在自动化和集中化方面相对较弱。虽然使用git hooks和shell脚本可以部分自动化发布流程，但整个流程仍然依赖于开发者手动触发和执行。此外，你需要在每个开发者的本地环境中设置并维护发布流程，这可能增加了管理和维护的工作量。</li></ul> <hr> <p>持续集成工具（如 Jenkins）的方案相对于自定义脚本方案有以下优点：</p> <ol><li><strong>自动化和集中化：</strong> 持续集成工具提供了自动化和集中化的发布流程管理。你可以配置构建和部署的自动化流程，减少了手动干预的需求，并将流程集中管理在持续集成工具中。</li> <li><strong>可扩展性和并行处理：</strong> 持续集成工具可以轻松处理大型和多人协作项目的发布流程。它们支持并行处理和分布式构建，可以处理多个分支和多个环境的同时构建和部署。</li> <li><strong>环境隔离和一致性：</strong> 持续集成工具提供了环境隔离和一致性，确保每次构建和部署在相同的环境中进行。这有助于减少由于开发者本地环境差异引起的问题，并提供更可靠和可重复的结果。</li></ol> <p>然而，持续集成工具也有一些限制和不足，例如学习和配置的复杂性、依赖外部工具和服务、额外的基础设施要求等。</p> <hr> <h2 id="jenkins-部署"><a href="#jenkins-部署" class="header-anchor">#</a> Jenkins 部署</h2> <h3 id="jenkins"><a href="#jenkins" class="header-anchor">#</a> Jenkins</h3> <p><a href="https://www.jenkins.io/zh/doc/" target="_blank" rel="noopener noreferrer">Jenkins <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一款开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。</p> <p>Jenkins 支持各种运行方式，可通过系统包、Docker 或者通过一个独立的 Java 程序。</p> <p>在前端 CICD 中，使用 jenkins 主要执行以下操作：</p> <ul><li><strong>代码集成</strong>：将多个开发人员的代码合并到主分支或开发分支。</li> <li><strong>测试</strong>：在测试服自动运行各种类型的测试，例如单元测试、集成测试和端到端测试，以确保代码的质量和功能的正确性。</li> <li><strong>构建</strong>：在测试服打包构建代码，生成静态资源。</li> <li><strong>部署</strong>：将构建好的静态文件部署到服务器、CDN 或其他托管服务上，使得应用程序能够在线上环境中运行。</li></ul> <p>除以上主要流程，Jenkins 还可以给发布版本打标签，记录软件发布版本，也可以根据发布版本快速回退版本。</p> <p>使用 Jenkins 部署前端流程如下：</p> <p><img src="/myblog/assets/img/Jenkins部署.9eb767f2.png" alt="image-20231216115432167"></p> <ol><li>本地开发测试完成，合并到测试分支，提交代码；</li> <li>触发 <code>git hooks</code> 的钩子，在钩子中执行 Eslint 检查、测试等；</li> <li>提交后触发git 仓库中的 webhook 钩子，webhook 通知 Jenkins 开始构建任务；</li> <li>Jenkins 开始构建：
<ol><li>同步仓库代码，合并分支，打版本标签</li> <li>构建</li> <li>测试</li> <li>部署，上传资源到测试服</li></ol></li></ol> <p>大多数最基本的持续交付 Pipeline 至少会有三个阶段：构建、测试和部署;</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Jenkinsfile</span> <span class="token punctuation">(</span>Declarative Pipeline<span class="token punctuation">)</span>
pipeline <span class="token punctuation">{</span>
    agent any
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'Building'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'Testing'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Deploy'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'Deploying'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="使用npm构建node-js和react应用"><a href="#使用npm构建node-js和react应用" class="header-anchor">#</a> <a href="https://www.jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/#run-jenkins-in-docker" target="_blank" rel="noopener noreferrer">使用npm构建Node.js和React应用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <h3 id="在docker中运行jenkins"><a href="#在docker中运行jenkins" class="header-anchor">#</a> <a href="https://www.jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/#run-jenkins-in-docker" target="_blank" rel="noopener noreferrer">在Docker中运行Jenkins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p>[<a href="https://segmentfault.com/a/1190000022688363" target="_blank" rel="noopener noreferrer">前端自动化部署——jenkins一键部署<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>]</p> <p><a href="https://www.jenkins.io/zh/doc/pipeline/tour/getting-started/" target="_blank" rel="noopener noreferrer">Jenkins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="版本回滚"><a href="#版本回滚" class="header-anchor">#</a> 版本回滚</h1> <h2 id="现状"><a href="#现状" class="header-anchor">#</a> 现状</h2> <p>当前版本回滚没有任何流程化管理模式，使用最原始的分支管理和 git 命令直接回滚</p> <p><strong>当前回滚版本流程：</strong></p> <blockquote><p>以某系统为例，目前生产服对应 prod 分支代码，测试服对应 test 分支代码，（master 为保护分支，定期将 prod 代码合并到 master）假如生产服某个版本出现重大问题，需要回滚，通过以下 Git 操作流程回滚：</p></blockquote> <ol><li>使用 <code>git checkout prod</code> 切换到 prod 分支，使用 <code>git log</code> 查看提交记录；</li> <li>创建新的回滚分支：基于发现bug的版本号或提交ID，从prod分支上创建一个新的回滚分支，命名为rollback_xxx（xxx为对应的版本号或提交ID）。</li> <li>查找到需要回滚的提交记录 hash 值，复制提交记录 hash 值；</li> <li>使用命令 <code>git reset --hard &lt;commit-hash&gt;</code> 强制回滚，也可以使用 <code>git revert &lt;commit-hash&gt;</code> 去除提交记录（两个命令区别可以参考文章：<a href="https://sewar-x.github.io/git/#git-%E5%9B%9E%E6%BB%9A" target="_blank" rel="noopener noreferrer">git 回滚<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）；</li> <li>强制推送到远程分支：<code>git push --force origin &lt;branch-name&gt;</code>;</li> <li>执行命令<code>npm run build</code>重新构建并上传当前分支代码；</li></ol> <p><strong>手动回滚的方式缺点非常明显</strong>：</p> <ul><li>学习成本高：对于不熟悉 git 命令的开发人员，需要熟悉 Git 各个命令作用和回滚流程；</li> <li>容易出错：首先要熟悉 git 命令和分支管理流程，此外要准确使用 git reset 命令，否则将可能出现不可估量的错误；</li> <li>操作繁琐：每次回滚，都要本地执行以上多个步骤；</li> <li>回滚速度慢：通过手动执行以上命令，需要一定的操作时间，当发布的版本有重大bug时候，回滚速度将严重影响软件质量；</li></ul> <p>为了避免以上问题，为了能够快速回滚代码，需要将回滚流程自动化；</p> <h2 id="代码自动回滚方案"><a href="#代码自动回滚方案" class="header-anchor">#</a> 代码自动回滚方案</h2> <ol><li><strong>持续集成/持续部署（CI/CD）工具</strong>：利用CI/CD工具（如Jenkins、GitLab CI、Travis CI等）来实现自动化回滚。可以在发现严重bug后，配置CI/CD工具自动触发回滚操作，例如通过执行预先编写好的回滚脚本或命令来自动回滚代码。</li> <li><strong>脚本自动化</strong>：编写脚本来实现自动化回滚操作。可以使用Shell脚本、Python脚本等编程语言编写自动化回滚脚本，通过调用版本控制系统的API或命令行工具来实现回滚代码的自动化操作。</li> <li><strong>版本控制系统的钩子</strong>（Hooks）：版本控制系统（如Git）提供了钩子机制，可以在特定事件发生时触发自定义的脚本。可以编写钩子脚本，在发现严重bug时触发自动化回滚操作。</li> <li><strong>自动化测试框架</strong>：在自动化测试框架中集成回滚代码的逻辑，当发现严重bug时，自动触发回滚操作并进行回滚后的自动化测试，以验证回滚的效果。</li> <li><strong>监控和告警系统</strong>：结合监控和告警系统，当发现严重bug时，自动触发回滚操作。可以通过配置监控系统来监视应用程序的健康状态，一旦发现异常情况，自动触发回滚操作以快速修复问题。</li></ol> <h2 id="使用-node-脚本回滚"><a href="#使用-node-脚本回滚" class="header-anchor">#</a> 使用 Node 脚本回滚</h2> <p><strong>使用流程</strong></p> <blockquote><p>使用 node.js 实现一个版本自动回滚的脚本:</p> <ol><li>需要通过 npm script 脚本执行命令；</li> <li>通过交互式方式，提示用户输入回滚分支；</li> <li>然后命令行列举出所有分支 git 日志 log 和 hash；</li> <li>然后用户输入回滚节点hash 后，自动回滚分支代码；</li></ol></blockquote> <p>实现版本自动回滚脚本需要使用以下库：</p> <table><thead><tr><th>库</th> <th>作用</th></tr></thead> <tbody><tr><td><code>inquirer</code></td> <td>用于实现交互式命令行，以便提示用户输入回滚分支和回滚节点hash</td></tr> <tr><td><code>child_process</code></td> <td>用于执行命令行操作，例如执行git命令</td></tr></tbody></table> <p><strong>实现思路</strong></p> <ol><li>安装所需库</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> inquirer child_process --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>实现思路</li></ol> <ul><li>创建一个Node.js脚本，例如<code>rollback.mjs</code>，用于执行版本自动回滚的操作。</li> <li>使用<code>inquirer</code>库来提示用户输入回滚分支和回滚节点hash。</li> <li>使用<code>child_process</code>库来执行git命令，包括列举分支的日志和hash，以及执行回滚操作。</li> <li>创建回滚命令： <code>&quot;rollback&quot;: &quot;node deploy/rollback.mjs&quot;</code></li></ul> <ol start="3"><li>详细实现代码: <code>rollback.mjs</code></li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 引入所需的库</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'child_process'</span>
<span class="token keyword">import</span> inquirer <span class="token keyword">from</span> <span class="token string">'inquirer'</span>

<span class="token comment">/**
 * 执行命令
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token parameter">command <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>command<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">执行命令 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>command<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// 执行git revert命令，回滚指定分支到指定提交</span>
    <span class="token function">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">执行命令 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 时发生错误：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stderr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">命令 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 执行过程中出现错误：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stderr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>stderr<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 *
 * @param {*} model 回滚模式
 * @param {*} commitHash git 提交 hash
 * @returns
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">rollBack</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> commitHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'revert'</span><span class="token operator">:</span>
      <span class="token comment">// 执行git revert命令，检出问题节点</span>
      <span class="token keyword">await</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git revert </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git revert </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'revert 检出问题节点已完成！'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token comment">// 执行git reset命令，强制回滚</span>
      <span class="token keyword">await</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git reset --hard </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git reset --hard </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reset 强制回滚已完成！'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'回滚模式错误，退出！'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 获取回滚分支名称
 * @returns
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startRollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 交互式命令行，提示用户输入回滚分支</span>
  <span class="token keyword">const</span> branchAnswers <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'branch'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请输入要回滚的分支名称：'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> branch <span class="token operator">=</span> branchAnswers<span class="token punctuation">.</span>branch
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'以下是该分支前 20 条提交记录：'</span><span class="token punctuation">)</span>
  <span class="token comment">// 执行git log命令，列举出指定分支的前20条提交记录</span>
  <span class="token keyword">await</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git log --oneline </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -n 20  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git log --oneline </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请保存你要回滚的节点 hash 值!'</span><span class="token punctuation">)</span>
  <span class="token comment">// 交互式命令行，提示用户输入要回滚的方式</span>
  <span class="token keyword">const</span> modeAnswers <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'model'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请选择回滚模式:'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">choices</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'revert'</span><span class="token punctuation">,</span> <span class="token string">'reset'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注意:reset 强制回滚后回滚节点后的节点将会丢失! 请注意区分 git revert 和 git reset 区别!'</span><span class="token punctuation">)</span>

  <span class="token comment">// 交互式命令行，提示用户输入要回滚的提交的hash</span>
  <span class="token keyword">const</span> commitHashAnswers <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'commitHash'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'请输入要回滚的提交的hash：'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// 执行git checkout命令，切换到回滚分支并同步代码</span>
  <span class="token keyword">await</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git checkout </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &amp;&amp; git pull</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git checkout </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &amp;&amp; git pull</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'已切换到回滚分支!'</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行git branch命令，创建回滚分支作为备份！</span>
    <span class="token keyword">await</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git branch rollback_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git branch rollback_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">创建回滚分支: rollback_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 作为备份！</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可能已经存在相同的分支名称</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">已存在相同的分支名称 rollback_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 回滚模式</span>
  <span class="token keyword">const</span> model <span class="token operator">=</span> modeAnswers<span class="token punctuation">.</span>model
  <span class="token comment">// 回滚hash 值</span>
  <span class="token keyword">const</span> commitHash <span class="token operator">=</span> commitHashAnswers<span class="token punctuation">.</span>commitHash
  <span class="token keyword">let</span> rollbackStatus <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    rollbackStatus <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">rollBack</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> commitHash<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">在尝试使用 git </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>model<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 命令来撤销一个特定的提交（</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">），但是遇到了问题:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>rollbackStatus <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 执行git push命令，强制同步远程分支代码</span>
      <span class="token keyword">await</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git add . &amp;&amp; git commit -m&quot;fix: 回滚</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 提交&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git add . &amp;&amp; git commit -m&quot;fix: 回滚</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commitHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 提交&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token comment">// 执行git push命令，强制同步远程分支代码</span>
      <span class="token keyword">await</span> <span class="token function">execCommands</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git push --force origin </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git push --force origin </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>branch<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'回滚操作完成！请运行开发环境查看回滚是否正确！'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 开始执行回滚操作</span>
<span class="token function">startRollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br></div></div><blockquote><p>上述代码中，我们使用了<code>inquirer</code>库来实现交互式命令行;</p> <p>首先提示用户输入要回滚的分支名称，然后执行<code>git log</code>命令列举出该分支的提交记录，接着提示用户输入要回滚的提交的hash 和使用的回滚模式，最后执行<code>git revert</code> 或 <code>git reset</code>命令来回滚指定分支到指定提交。</p> <p>注意：创建 <code>.mjs</code> 的后缀文件名称，因为 node 中使用 commonjs 模块规范，而<code>inquirer</code>库 是使用了 ES 模块规范，因此直接创建 <code>.js</code> 文件时，执行 <code>node rollback.js</code> 会报错:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Error <span class="token punctuation">[</span>ERR_REQUIRE_ESM<span class="token punctuation">]</span>: Must use <span class="token function">import</span> to load ES Module: D:<span class="token punctuation">\</span>MyData<span class="token punctuation">\</span>TCL<span class="token punctuation">\</span>srdpm-admin<span class="token punctuation">\</span>node_modules<span class="token punctuation">\</span>inquirer<span class="token punctuation">\</span>lib<span class="token punctuation">\</span>inquirer.js
require<span class="token punctuation">(</span><span class="token punctuation">)</span> of ES modules is not supported.
require<span class="token punctuation">(</span><span class="token punctuation">)</span> of D:<span class="token punctuation">\</span>MyData<span class="token punctuation">\</span>TCL<span class="token punctuation">\</span>srdpm-admin<span class="token punctuation">\</span>node_modules<span class="token punctuation">\</span>inquirer<span class="token punctuation">\</span>lib<span class="token punctuation">\</span>inquirer.js from D:<span class="token punctuation">\</span>MyData<span class="token punctuation">\</span>TCL<span class="token punctuation">\</span>srdpm-admin<span class="token punctuation">\</span>deploy<span class="token punctuation">\</span>rollback.js is an ES module <span class="token function">file</span> as it is a .js <span class="token function">file</span> whose nearest parent package.json contains <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;module&quot;</span> <span class="token function">which</span> defines all .js files <span class="token keyword">in</span> that package scope as ES modules.
Instead <span class="token function">rename</span> inquirer.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>下面是该错误的其他解决方案：</p> <ol><li><p><strong>使用 Babel</strong>：
Babel 是一个广泛使用的 JavaScript 编译器，可以将 ES6+ 代码转换为 ES5 代码，这样旧版本的 Node.js 也可以运行。你可以配置 Babel 来处理你的 <code>require</code> 导入。</p></li> <li><p><strong>使用 Rollup 或 Webpack</strong>：
这些是打包工具，它们可以处理 ES 模块的导入。使用它们，你可以将 ES 模块打包为可以在旧版本 Node.js 上运行的 CommonJS 模块。</p></li> <li><p><strong>修改 package.json</strong>：
你可以修改 <code>package.json</code> 中的 &quot;type&quot; 字段为 &quot;commonjs&quot;，这样 Node.js 会将所有的 <code>.js</code> 文件视为 CommonJS 模块，而不是 ES 模块。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>  
  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commonjs&quot;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><strong>更新 Node.js</strong>：
考虑升级到最新版本的 Node.js，因为新版本可能支持更多的 ES 特性。</p></li> <li><p><strong>考虑使用 ES6 模块的 polyfill</strong>：
尽管这不是最佳实践，但如果你只是需要一个简单的解决方案，可以考虑使用一个 polyfill 来模拟 ES6 的 <code>import</code> 和 <code>export</code>。但请注意，这种方法可能不是最可靠或最有效的。</p></li> <li><p><strong>手动转换</strong>：
如果你只是需要引入一个或几个 ES 模块，并且不想使用 Babel、Rollup 或 Webpack，你可以手动将 <code>import</code> 语句转换为 <code>require</code> 语句。例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ES 模块  </span>
<span class="token keyword">import</span> module <span class="token keyword">from</span> <span class="token string">'module'</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 转换为 CommonJS  </span>
<span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><strong>兼容性问题</strong>：
如果项目中有其他代码使用了 ES 特性（如 <code>import</code> 和 <code>export</code>），你可能还需要确保这些代码也被适当地转换或更新。</p></li></ol> <p>最后，选择哪种方法取决于你的具体需求和项目的复杂性。如果项目较大或有特定的构建/部署流程，Babel、Rollup 或 Webpack 可能是一个更好的选择。如果只是一个简单的项目或只需要处理几个文件，手动转换或使用 polyfill 可能更简单。</p></blockquote> <ol start="4"><li><p>使用：</p> <p><img src="/myblog/assets/img/git回滚实践.badf0fa2.png" alt="image-20240105141457435"></p></li></ol> <p><img src="/myblog/assets/img/git回滚实践2.0c8b45e5.png" alt="image-20240105141653155"></p> <h2 id="参考资料-2"><a href="#参考资料-2" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://juejin.cn/post/7296308638687625226?searchId=2024010419133141E7FAA904594B206262" target="_blank" rel="noopener noreferrer">自动打tag的可回滚发布模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">February 19, 2024 09:22</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 596777598@qq.com" class="contributor">
          sewar
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/myblog/assets/js/app.9d2b617a.js" defer></script><script src="/myblog/assets/js/layout-Layout.d2d4ce64.js" defer></script><script src="/myblog/assets/js/page-前端自动部署.5076846c.js" defer></script><script src="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" defer></script>
  </body>
</html>
