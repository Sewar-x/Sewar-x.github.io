<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从零到一搭建移动端SSG项目 | Sewen 博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="./mylogo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="manifest" href="/myblog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://sewar-x.github.io/myblog/atom.xml" title="Sewen 博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 RSS Feed">
    <meta name="description" content="sewen 的前端学习笔记、博客、前端基础总结、技术深度剖析、面试题总结、算法总结、项目过程总结">
    <meta property="og:url" content="https://sewar-x.github.io/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE.html">
    <meta property="og:site_name" content="Sewen 博客">
    <meta property="og:title" content="从零到一搭建移动端SSG项目">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.645fbc6f.css" as="style"><link rel="preload" href="/myblog/assets/js/app.9d2b617a.js" as="script"><link rel="preload" href="/myblog/assets/js/layout-Layout.d2d4ce64.js" as="script"><link rel="preload" href="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js" as="script"><link rel="preload" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" as="script"><link rel="prefetch" href="/myblog/assets/js/199.a9216960.js"><link rel="prefetch" href="/myblog/assets/js/200.4c66fc79.js"><link rel="prefetch" href="/myblog/assets/js/layout-Blog.1fca7e90.js"><link rel="prefetch" href="/myblog/assets/js/layout-NotFound.3c74e8aa.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/AlgoliaSearch/Dropdown.70fcebe7.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Anchor.3235541c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleInfo.7b815b20.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleItem.b0e177e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleList.d1cf1b24.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleType.b630b80e.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHero.621312ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHome.4fe44489.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogInfo.b2a94760.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogPage.e0fbe820.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BloggerInfo.0df38355.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/CategoryList.ec1bcd96.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ProjectList.8550a110.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TagList.bcf7b782.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/Timeline.b6cf5471.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TimelineList.3c6e08a6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Clipboard.e940a903.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Common.820a8694.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Home.70383986.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/MyTransition.0de46069.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/DropdownLink.e3f6c118.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLink.93b11770.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLinks.8ba214e6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/Navbar.b90a94f9.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/RepoLink.663a7f55.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/SidebarButton.76b0035a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Page.98b5d09c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageFooter.20bc9bd8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageMeta.b7e6b12f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageNav.8305dd1f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Password.45e0e82a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/DropdownTransition.068c5eea.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/Sidebar.f6f90d52.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarDropdownLink.505127a8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarGroup.7eecf370.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarLink.6e39fe32.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarNavLinks.0f8566cb.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/DarkmodeSwitch.20ac7b92.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeColor.6086e4ed.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeOptions.483238c9.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ArticleIcon.0a22e2b1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/AutoIcon.2ff1c790.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/BookIcon.419b49ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/DarkIcon.7d81873b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EditIcon.8ada485d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EmptyIcon.d704a5cf.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/I18nIcon.ffad8b3e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LightIcon.47d807da.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LinkIcon.1a8a7826.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LockIcon.a29a2b79.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/NextIcon.0214ee59.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/Page404Icon.8bc1ebbb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PresentationIcon.17500d9b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PrevIcon.2ae04a70.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ProjectIcon.b336d567.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/StickyIcon.0f509b9d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Baidu.244b9a41.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Bitbucket.11ba94e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dingding.e8a3d90d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Discord.3295a55b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dribbble.464dac3b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Email.f9254caa.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Evernote.991472fb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Facebook.08e78e47.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Flipboard.a1124d0f.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitee.c44bc20a.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Github.5667e5ae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitlab.ad95c7a7.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gmail.b5acc6bc.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Instagram.56be85f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Lines.d9db3dce.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Linkedin.b82d8d8b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pinterest.0f3ffe71.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pocket.41ef3c92.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/QQ.7558f4ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Qzone.bf658fae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Reddit.9c4c95ee.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Rss.9780139e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Steam.06abbae2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Twitter.26fa5bda.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Wechat.9cac8c4c.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Weibo.5206a632.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Whatsapp.0738f1e3.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Youtube.f41fd7f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Zhihu.4d851d2f.js"><link rel="prefetch" href="/myblog/assets/js/page--0abc50bf.0d6f1484.js"><link rel="prefetch" href="/myblog/assets/js/page--1cd40f4c.dd76c7b3.js"><link rel="prefetch" href="/myblog/assets/js/page--53f93199.e80bdec8.js"><link rel="prefetch" href="/myblog/assets/js/page--5afd2fd0.adea4e92.js"><link rel="prefetch" href="/myblog/assets/js/page--67c584d3.0a3f3cd9.js"><link rel="prefetch" href="/myblog/assets/js/page--776a8506.cdf48aac.js"><link rel="prefetch" href="/myblog/assets/js/page-CSS.eb94b29f.js"><link rel="prefetch" href="/myblog/assets/js/page-Chrome开发工具使用指南.a2675120.js"><link rel="prefetch" href="/myblog/assets/js/page-DevServer.0281863d.js"><link rel="prefetch" href="/myblog/assets/js/page-Echarts二次封装.4387b8ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Elementui与Element-plusui二次封装.82f12a09.js"><link rel="prefetch" href="/myblog/assets/js/page-Git基础.03c616ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Git规范.e2fdc38a.js"><link rel="prefetch" href="/myblog/assets/js/page-HTML.1e3c14b9.js"><link rel="prefetch" href="/myblog/assets/js/page-Home.f0b7e772.js"><link rel="prefetch" href="/myblog/assets/js/page-JSON配置化组件二次封装.12060fd9.js"><link rel="prefetch" href="/myblog/assets/js/page-JS原理实现.3c427e19.js"><link rel="prefetch" href="/myblog/assets/js/page-JS应用题.3d313b34.js"><link rel="prefetch" href="/myblog/assets/js/page-JavaScript基础.551be887.js"><link rel="prefetch" href="/myblog/assets/js/page-Linux.c6159ebd.js"><link rel="prefetch" href="/myblog/assets/js/page-Loader和Plugin原理.b2971b76.js"><link rel="prefetch" href="/myblog/assets/js/page-MySQL.0b1d704a.js"><link rel="prefetch" href="/myblog/assets/js/page-NPM.a55851b2.js"><link rel="prefetch" href="/myblog/assets/js/page-Node.ec405a21.js"><link rel="prefetch" href="/myblog/assets/js/page-Nodejs常见问题集合.12844e69.js"><link rel="prefetch" href="/myblog/assets/js/page-Node性能优化.b4ea1c34.js"><link rel="prefetch" href="/myblog/assets/js/page-Promise专题.7869a31b.js"><link rel="prefetch" href="/myblog/assets/js/page-React.d76cf0ac.js"><link rel="prefetch" href="/myblog/assets/js/page-SSG移动端项目实践.2122615b.js"><link rel="prefetch" href="/myblog/assets/js/page-TypeScript.4f597fda.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite.637881bf.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite原理解析.6677fdb4.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue25项目webpack构建分析.7bbea0fa.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2VsVue3.10be4140.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2x原理源码分析.e9e753b6.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3基础.210247ff.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3源码分析.17379e04.js"><link rel="prefetch" href="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js"><link rel="prefetch" href="/myblog/assets/js/page-VueRouter原理分析.0a092eb6.js"><link rel="prefetch" href="/myblog/assets/js/page-VueSSR原理分析.63006040.js"><link rel="prefetch" href="/myblog/assets/js/page-VueVsReact.2156be28.js"><link rel="prefetch" href="/myblog/assets/js/page-Vuex原理分析.5ba3e6e4.js"><link rel="prefetch" href="/myblog/assets/js/page-WEB安全.5aa0eeef.js"><link rel="prefetch" href="/myblog/assets/js/page-WebPack构建原理.9c29703e.js"><link rel="prefetch" href="/myblog/assets/js/page-webpackAPI分析.4c8b152b.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack优化.dcc6c3bc.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack基础.3820ee6c.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack项目实践.77e22417.js"><link rel="prefetch" href="/myblog/assets/js/page-一次后台管理系统的性能优化.7c2d8712.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建SSR项目.855376fc.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue2项目和规范设计.93017fd2.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue3单页面应用.de152d54.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建公共组件库.93278073.js"><link rel="prefetch" href="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js"><link rel="prefetch" href="/myblog/assets/js/page-分治.e3dfc22d.js"><link rel="prefetch" href="/myblog/assets/js/page-前端发版静态资源404问题.9eb1ca89.js"><link rel="prefetch" href="/myblog/assets/js/page-前端存储.cd82cf54.js"><link rel="prefetch" href="/myblog/assets/js/page-前端工程化.1e6e58d0.js"><link rel="prefetch" href="/myblog/assets/js/page-前端性能优化方案.83718d22.js"><link rel="prefetch" href="/myblog/assets/js/page-前端架构实践.171dbc0f.js"><link rel="prefetch" href="/myblog/assets/js/page-前端渲染架构.3b783de8.js"><link rel="prefetch" href="/myblog/assets/js/page-前端自动部署.5076846c.js"><link rel="prefetch" href="/myblog/assets/js/page-前端部署原理.82ecd8a7.js"><link rel="prefetch" href="/myblog/assets/js/page-动态规划.a3af92f1.js"><link rel="prefetch" href="/myblog/assets/js/page-哈希表.c76000e8.js"><link rel="prefetch" href="/myblog/assets/js/page-回溯算法.cd914c32.js"><link rel="prefetch" href="/myblog/assets/js/page-图.dfd9828a.js"><link rel="prefetch" href="/myblog/assets/js/page-基础.7bf5a37b.js"><link rel="prefetch" href="/myblog/assets/js/page-堆.4657e538.js"><link rel="prefetch" href="/myblog/assets/js/page-字符串.252f2a08.js"><link rel="prefetch" href="/myblog/assets/js/page-异步编程.904f4c65.js"><link rel="prefetch" href="/myblog/assets/js/page-性能优化指标和监控.f2175836.js"><link rel="prefetch" href="/myblog/assets/js/page-排序算法.c7a51b99.js"><link rel="prefetch" href="/myblog/assets/js/page-搭建低代码平台.19eaf5ec.js"><link rel="prefetch" href="/myblog/assets/js/page-操作系统.473c4281.js"><link rel="prefetch" href="/myblog/assets/js/page-数学运算.c82748fb.js"><link rel="prefetch" href="/myblog/assets/js/page-数据结构算法.84480586.js"><link rel="prefetch" href="/myblog/assets/js/page-数组.692b0d0a.js"><link rel="prefetch" href="/myblog/assets/js/page-权限管理.c7e10db0.js"><link rel="prefetch" href="/myblog/assets/js/page-查找.790e52df.js"><link rel="prefetch" href="/myblog/assets/js/page-栈和队列.8dbc3586.js"><link rel="prefetch" href="/myblog/assets/js/page-树.24efdeaa.js"><link rel="prefetch" href="/myblog/assets/js/page-浏览器.bee9ec04.js"><link rel="prefetch" href="/myblog/assets/js/page-混合桌面应用开发.9e10d1c3.js"><link rel="prefetch" href="/myblog/assets/js/page-登录.bb830451.js"><link rel="prefetch" href="/myblog/assets/js/page-目录.c85b4d0b.js"><link rel="prefetch" href="/myblog/assets/js/page-移动端开发.56ac22ec.js"><link rel="prefetch" href="/myblog/assets/js/page-组件和组件封装.b5e86da2.js"><link rel="prefetch" href="/myblog/assets/js/page-计算机网络基础.0a106662.js"><link rel="prefetch" href="/myblog/assets/js/page-设计模式.ffdc7cfd.js"><link rel="prefetch" href="/myblog/assets/js/page-调试技巧.485ae36e.js"><link rel="prefetch" href="/myblog/assets/js/page-贪心算法.0f417640.js"><link rel="prefetch" href="/myblog/assets/js/page-输入url到页面展示全过程.510aef2e.js"><link rel="prefetch" href="/myblog/assets/js/page-递归.5e55e552.js"><link rel="prefetch" href="/myblog/assets/js/page-链表.1cf6927f.js"><link rel="prefetch" href="/myblog/assets/js/page-项目总结.ffcd2a4b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~docsearch.f3877d0d.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~5d377965.d9712593.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-components/Blog/ArticleItem~layout-components/Blog/ArticleL~b56f3aac.47bb5cb5.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-NotFound~layout-components/Common~layout-components/Page.57d58db9.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Slide.81546b3b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/AlgoliaSearch/Full.b30f067a.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Blog/BlogPage.bcccbd38.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Navbar/Navbar.e2a7361e.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Page.6c65077c.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Sidebar/Sidebar.34cd9cf7.js"><link rel="prefetch" href="/myblog/assets/js/vendors~photo-swipe.428df1da.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.645fbc6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/myblog/" class="home-link router-link-active"><img src="./mylogo.png" alt="Sewen 博客" class="logo"> <!----> <span class="site-name can-hide">Sewen 博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
        前端基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
        计算机基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
        框架和源码分析
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
        浏览器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
        服务器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
        性能优化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
        前端工程
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
        项目实践
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
        项目搭建
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="./mylogo.png" class="avatar round"> <div property="name" class="name">Sewen 博客</div> <meta property="url" content="../outline.md"></div> <div class="num-wrapper"><div><div class="num">91</div> <div>Articles</div></div> <div><div class="num">0</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">91</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/Sewar-x/myblog" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="1567910907" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up" class="media-link"><span class="sr-only">Wechat</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E"></circle> <path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#FFF"></path> <path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
      前端基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
      计算机基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
      框架和源码分析
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
      浏览器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
      服务器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
      性能优化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
      前端工程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
      项目实践
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
      项目搭建
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <!----> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/myblog/projectsSummary/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">项目总结</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">从零到一搭建移动端SSG项目</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">从零到一搭建移动端SSG项目</span></h1> <div class="page-info"><!----> <true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#预渲染-ssg" class="anchor-link heading2"><div>预渲染 (SSG )</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#概念" class="anchor-link heading3"><div>概念</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#特点" class="anchor-link heading3"><div>特点</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#适应场景" class="anchor-link heading3"><div>适应场景</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#不适应场景" class="anchor-link heading3"><div>不适应场景</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#项目特性" class="anchor-link heading2"><div>项目特性</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#技术栈" class="anchor-link heading2"><div>技术栈</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#项目目录" class="anchor-link heading2"><div>项目目录</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#构建流程" class="anchor-link heading2"><div>构建流程</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#构建命令" class="anchor-link heading2"><div>构建命令</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#参数处理" class="anchor-link heading2"><div>参数处理</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#参数格式" class="anchor-link heading3"><div>参数格式</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#参数说明" class="anchor-link heading3"><div>参数说明</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#参数处理流程" class="anchor-link heading3"><div>参数处理流程</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#webpack-构建" class="anchor-link heading2"><div>Webpack 构建</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#清除静态资源" class="anchor-link heading3"><div>清除静态资源</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#启动构建" class="anchor-link heading3"><div>启动构建</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#根据平台构建" class="anchor-link heading3"><div>根据平台构建</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#webpack-实例" class="anchor-link heading3"><div>Webpack 实例</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#webpack-构建配置" class="anchor-link heading3"><div>Webpack 构建配置</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#构建入口文件" class="anchor-link heading3"><div>构建入口文件</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#生成路由表" class="anchor-link heading2"><div>生成路由表</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#路由表分类" class="anchor-link heading3"><div>路由表分类</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#路由表生成规则" class="anchor-link heading3"><div>路由表生成规则</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#生成路由表-2" class="anchor-link heading3"><div>生成路由表</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#渲染-html-页面" class="anchor-link heading2"><div>渲染 HTML 页面</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#生成-vue-server-render-对象" class="anchor-link heading3"><div>生成 vue-server-render 对象</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#html-处理" class="anchor-link heading2"><div>HTML 处理</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#页面发布路径处理" class="anchor-link heading2"><div>页面发布路径处理</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#写进文件" class="anchor-link heading2"><div>写进文件</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#打包后的-html-目录结构" class="anchor-link heading2"><div>打包后的 html 目录结构</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#上传静态资源到-s3" class="anchor-link heading2"><div>上传静态资源到 S3</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#typescript-支持" class="anchor-link heading2"><div>TypeScript 支持</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#amp" class="anchor-link heading2"><div>AMP</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#本地开发" class="anchor-link heading3"><div>本地开发</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#其他" class="anchor-link heading2"><div>其他</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#开发" class="anchor-link heading2"><div>开发</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#接口" class="anchor-link heading3"><div>接口</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#多语言" class="anchor-link heading3"><div>多语言</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#amp-2" class="anchor-link heading3"><div>AMP</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#规范" class="anchor-link heading3"><div>规范</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#其他-2" class="anchor-link heading3"><div>其他</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#静态化" class="anchor-link heading3"><div>静态化</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#命令" class="anchor-link heading3"><div>命令</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#生成路由表-3" class="anchor-link heading3"><div>生成路由表</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#amp-3" class="anchor-link heading3"><div>AMP</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#页面发布路径处理-2" class="anchor-link heading3"><div>页面发布路径处理</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#上传静态资源到-s3-2" class="anchor-link heading3"><div>上传静态资源到 S3</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#说明" class="anchor-link heading2"><div>说明</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AFSSG%E9%A1%B9%E7%9B%AE/#参考资料" class="anchor-link heading3"><div>参考资料</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="从零到一搭建移动端ssg项目"><a href="#从零到一搭建移动端ssg项目" class="header-anchor">#</a> 从零到一搭建移动端SSG项目</h1> <blockquote><p>详细项目代码参考： <a href="https://github.com/Sewar-x/SSG-Demo" target="_blank" rel="noopener noreferrer">Sewar-x/SSG-Demo: 《从零到一搭建移动端SSG项目实践》| Sewen 博客 示例项目，项目仅作学习使用 (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="预渲染-ssg"><a href="#预渲染-ssg" class="header-anchor">#</a> <strong>预渲染 (SSG )</strong></h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> <strong>概念</strong></h3> <ul><li>SSG是指在<strong>构建时（build time）生成静态HTML文件</strong>，这些文件可以直接提供给浏览器，而不需要在服务器上进行动态渲染。</li> <li>在构建过程中，组件会被渲染成静态HTML，并保存在文件中。这意味着每个页面都是预渲染的，并且可以以纯静态文件的形式提供给浏览器，无需运行 JavaScript 代码，会有一些辅助的JS来增强页面交互；</li></ul> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> <strong>特点</strong></h3> <ul><li><strong>静态HTML文件</strong>：预渲染生成的页面是纯静态的HTML文件，不需要在浏览器端执行JavaScript代码。</li> <li><strong>快速加载速度</strong>：由于页面已经在构建时生成，没有额外的网络请求和JavaScript执行，预渲染的页面加载速度非常快。</li> <li><strong>支持SEO</strong>：预渲染的HTML文件包含了完整的页面内容，对搜索引擎更友好，有助于提高网站的搜索引擎排名。</li></ul> <h3 id="适应场景"><a href="#适应场景" class="header-anchor">#</a> <strong>适应场景</strong></h3> <ul><li><strong>静态内容</strong>：适用于<strong>内容相对稳定的页面，页面内容不频繁变化的情况</strong>下，可以使用预渲染来生成静态HTML文件。</li> <li><strong>高性能要求</strong>：对于<strong>追求快速加载速度和响应性能的网站</strong>，预渲染可以大幅减少页面的加载时间，提供更好的用户体验。</li> <li><strong>SEO优化</strong>：对于需要更好的搜索引擎优化（SEO）的网站，预渲染可以确保搜索引擎能够看到完整的渲染结果，提高网站的可索引性和排名。</li></ul> <h3 id="不适应场景"><a href="#不适应场景" class="header-anchor">#</a> <strong>不适应场景</strong></h3> <ul><li><p><strong>动态内容</strong>：如果页面内容需要实时获取并根据用户交互进行更新，预渲染的静态HTML文件无法满足这种需求。</p></li> <li><p><strong>大规模网站</strong>：对于大规模网站或包含大量动态内容的网站，预渲染可能不太实用，因为构建和维护大量静态HTML文件可能变得复杂和耗时。</p></li> <li><p><strong>频繁变化的内容</strong>：如果页面内容需要频繁更新，每次更新都需要重新构建和生成静态HTML文件，预渲染的成本可能会很高。</p></li> <li><p><strong>大量路由场景</strong>。 如果您的站点有成百上千个路由，则预渲染将非常缓慢。当然，每个更新只需要执行一次，但是可能要花一些时间。大多数人并没有最终获得数千个静态网页，而是以防万一。</p></li></ul> <h2 id="项目特性"><a href="#项目特性" class="header-anchor">#</a> <strong>项目特性</strong></h2> <ul><li><strong>注重 SEO</strong>: 项目偏向内容类站点，主要通过 Google、Biying 等国外搜索引擎增加曝光度。</li> <li><strong>静态展示网站</strong>：站点偏向于媒体资讯类静态内容的站点。</li> <li><strong>国际化</strong>：站点面向多个国家，不同国家站点有不同的皮肤风格设计。</li></ul> <h2 id="技术栈"><a href="#技术栈" class="header-anchor">#</a> <strong>技术栈</strong></h2> <p>项目基于 Vue SSR 官方demo：<a href="https://github.com/vuejs/vue-hackernews-2.0" target="_blank" rel="noopener noreferrer"> vue-hackernews-2.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行二次开发，项目结构等基础参考 <a href="https://ssr.vuejs.org/zh/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93-ssr-%EF%BC%9F" target="_blank" rel="noopener noreferrer">vue-ssr 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong><code>dependencies</code> 项目生产环境中运行所必需依赖的模块：</strong></p> <table><thead><tr><th style="text-align:center;">类别</th> <th style="text-align:center;">框架/插件</th> <th style="text-align:center;">版本</th> <th style="text-align:center;">作用</th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>UI框架</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Vue.js</td> <td style="text-align:center;">vue</td> <td style="text-align:center;">^2.5.22</td> <td style="text-align:center;">用于构建用户界面的渐进式框架，提供了响应式数据绑定和组件化的系统</td></tr> <tr><td style="text-align:center;">Vant</td> <td style="text-align:center;">vant</td> <td style="text-align:center;">^2.10.10</td> <td style="text-align:center;">基于 Vue.js 的移动端 UI 组件库</td></tr> <tr><td style="text-align:center;">Swiper</td> <td style="text-align:center;">swiper</td> <td style="text-align:center;">^6.3.5</td> <td style="text-align:center;">移动端触摸滑动库，用于实现轮播图、滑动页面等效果</td></tr> <tr><td style="text-align:center;"><strong>状态管理</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Vuex</td> <td style="text-align:center;">vuex</td> <td style="text-align:center;">^3.0.1</td> <td style="text-align:center;">Vue.js 的状态管理模式和库，用于集中存储和管理应用的所有组件的状态</td></tr> <tr><td style="text-align:center;">Vuex-Router-Sync</td> <td style="text-align:center;">vuex-router-sync</td> <td style="text-align:center;">^5.0.0</td> <td style="text-align:center;">同步 Vue Router 和 Vuex 的状态，使得路由变化能够触发状态变化</td></tr> <tr><td style="text-align:center;"><strong>路由管理</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Vue Router</td> <td style="text-align:center;">vue-router</td> <td style="text-align:center;">^3.0.1</td> <td style="text-align:center;">Vue.js 的官方路由库，用于构建单页面应用</td></tr> <tr><td style="text-align:center;"><strong>国际化</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Vue I18n</td> <td style="text-align:center;">vue-i18n</td> <td style="text-align:center;">^8.15.3</td> <td style="text-align:center;">Vue.js 的国际化插件，用于实现多语言支持</td></tr> <tr><td style="text-align:center;"><strong>HTTP请求</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Axios</td> <td style="text-align:center;">axios</td> <td style="text-align:center;">^0.19.0</td> <td style="text-align:center;">基于 Promise 的 HTTP 客户端，用于浏览器和 node.js 中发送 HTTP 请求</td></tr> <tr><td style="text-align:center;"><strong>数据存储</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Firebase</td> <td style="text-align:center;">firebase</td> <td style="text-align:center;">7.6.2</td> <td style="text-align:center;">移动和网页应用的实时数据库和后端服务</td></tr> <tr><td style="text-align:center;">LRU Cache</td> <td style="text-align:center;">lru-cache</td> <td style="text-align:center;">^4.1.1</td> <td style="text-align:center;">基于 LRU (Least Recently Used) 算法的缓存库，用于在内存中存储数据</td></tr> <tr><td style="text-align:center;"><strong>工具库</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Cross-Env</td> <td style="text-align:center;">cross-env</td> <td style="text-align:center;">^5.1.1</td> <td style="text-align:center;">跨平台设置和使用环境变量</td></tr> <tr><td style="text-align:center;">Day.js</td> <td style="text-align:center;">dayjs</td> <td style="text-align:center;">^1.9.3</td> <td style="text-align:center;">轻量级的日期处理库，用于解析、验证、操作和显示日期</td></tr> <tr><td style="text-align:center;">ES6 Promise</td> <td style="text-align:center;">es6-promise</td> <td style="text-align:center;">^4.1.1</td> <td style="text-align:center;">提供统一的 Promise API，用于处理异步操作</td></tr> <tr><td style="text-align:center;">JS Cookie</td> <td style="text-align:center;">js-cookie</td> <td style="text-align:center;">^2.2.1</td> <td style="text-align:center;">用于在浏览器中创建、读取、写入和删除 cookies 的库</td></tr> <tr><td style="text-align:center;">Route Cache</td> <td style="text-align:center;">route-cache</td> <td style="text-align:center;">0.4.3</td> <td style="text-align:center;">用于缓存路由信息的库，提高路由查找效率</td></tr> <tr><td style="text-align:center;">Serve Favicon</td> <td style="text-align:center;">serve-favicon</td> <td style="text-align:center;">^2.4.5</td> <td style="text-align:center;">用于为 Express 应用提供 favicon 服务的中间件</td></tr> <tr><td style="text-align:center;">XSS</td> <td style="text-align:center;">xss</td> <td style="text-align:center;">^1.0.8</td> <td style="text-align:center;">用于过滤和转义 HTML 中的 XSS 攻击代码的库</td></tr> <tr><td style="text-align:center;"><strong>视频插件</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Vue Youtube</td> <td style="text-align:center;">vue-youtube</td> <td style="text-align:center;">^1.4.0</td> <td style="text-align:center;">Vue.js 的 YouTube 视频播放器插件</td></tr> <tr><td style="text-align:center;"><strong>性能优化</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Compression</td> <td style="text-align:center;">compression</td> <td style="text-align:center;">^1.7.1</td> <td style="text-align:center;">用于 Express 应用的压缩中间件，提高响应速度和减少网络带宽使用</td></tr> <tr><td style="text-align:center;"><strong>分析工具</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Vue Analytics</td> <td style="text-align:center;">vue-analytics</td> <td style="text-align:center;">^5.22.1</td> <td style="text-align:center;">用于 Vue.js 应用的 Google Analytics 插件</td></tr> <tr><td style="text-align:center;"><strong>服务器端渲染</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Vue Server Renderer</td> <td style="text-align:center;">vue-server-renderer</td> <td style="text-align:center;">^2.5.22</td> <td style="text-align:center;">Vue.js 的服务器端渲染工具，用于在服务器端生成 HTML</td></tr></tbody></table> <p><strong><code>devDependencies</code> 开发依赖的模块：</strong></p> <table><thead><tr><th style="text-align:center;">类别</th> <th style="text-align:center;">框架/插件</th> <th style="text-align:center;">版本</th> <th style="text-align:center;">作用</th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>前端构建工具</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">webpack</td> <td style="text-align:center;"><code>^4.44.1</code></td> <td style="text-align:center;">用于模块打包的前端资源构建工具</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">webpack-cli</td> <td style="text-align:center;"><code>^3.3.12</code></td> <td style="text-align:center;">webpack的命令行接口</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">webpack-dev-middleware</td> <td style="text-align:center;"><code>^3.7.2</code></td> <td style="text-align:center;">提供实时重载的开发服务器中间件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">webpack-hot-middleware</td> <td style="text-align:center;"><code>^2.25.0</code></td> <td style="text-align:center;">提供模块热替换功能的中间件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">webpack-merge</td> <td style="text-align:center;"><code>^4.2.1</code></td> <td style="text-align:center;">用于合并webpack配置的工具</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">mini-css-extract-plugin</td> <td style="text-align:center;"><code>^0.11.2</code></td> <td style="text-align:center;">从JS中提取CSS到单独文件的webpack插件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">extract-css-chunks-webpack-plugin</td> <td style="text-align:center;"><code>^4.7.5</code></td> <td style="text-align:center;">提取CSS到单独文件的webpack插件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">copy-webpack-plugin</td> <td style="text-align:center;"><code>^6.2.1</code></td> <td style="text-align:center;">将文件或目录复制到构建目录的webpack插件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">fork-ts-checker-webpack-plugin</td> <td style="text-align:center;"><code>^5.2.0</code></td> <td style="text-align:center;">用于在webpack中检查TypeScript的插件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">friendly-errors-webpack-plugin</td> <td style="text-align:center;"><code>^1.6.1</code></td> <td style="text-align:center;">提供更友好的错误信息的webpack插件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">progress-bar-webpack-plugin</td> <td style="text-align:center;"><code>^2.1.0</code></td> <td style="text-align:center;">在webpack构建过程中显示进度条的插件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">terser-webpack-plugin</td> <td style="text-align:center;"><code>^4.2.0</code></td> <td style="text-align:center;">用于压缩JavaScript代码的webpack插件</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">css-loader</td> <td style="text-align:center;"><code>^0.28.7</code></td> <td style="text-align:center;">将CSS转换为CommonJS的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">style-loader</td> <td style="text-align:center;"><code>^1.0.0</code></td> <td style="text-align:center;">将JS中的CSS样式注入到DOM中的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">postcss-loader</td> <td style="text-align:center;"><code>^4.0.1</code></td> <td style="text-align:center;">使用PostCSS转换CSS的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">sass-loader</td> <td style="text-align:center;"><code>^7.3.1</code></td> <td style="text-align:center;">将Sass/SCSS转换为CSS的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">vue-loader</td> <td style="text-align:center;"><code>^15.3.0</code></td> <td style="text-align:center;">用于加载Vue单文件组件的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">ts-loader</td> <td style="text-align:center;"><code>^8.0.3</code></td> <td style="text-align:center;">用于加载TypeScript文件的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">file-loader</td> <td style="text-align:center;"><code>^1.1.5</code></td> <td style="text-align:center;">将文件输出为url的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">url-loader</td> <td style="text-align:center;"><code>^0.6.2</code></td> <td style="text-align:center;">将文件转换为Base64 URL的webpack加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"><strong>前端UI库</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">vue-social-sharing</td> <td style="text-align:center;"><code>^2.4.7</code></td> <td style="text-align:center;">Vue.js的社交分享组件库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"><strong>前端工具库</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">vue-template-compiler</td> <td style="text-align:center;"><code>^2.5.22</code></td> <td style="text-align:center;">Vue.js的模板编译器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">moment</td> <td style="text-align:center;"><code>^2.26.0</code></td> <td style="text-align:center;">用于解析、验证、操作和显示日期和时间的JavaScript库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"><strong>Node.js工具库</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">execa</td> <td style="text-align:center;"><code>^4.0.3</code></td> <td style="text-align:center;">创建子进程的Node.js库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">iconv-lite</td> <td style="text-align:center;"><code>^0.6.2</code></td> <td style="text-align:center;">用于字符编码转换的Node.js库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">node-sass</td> <td style="text-align:center;"><code>^4.13.0</code></td> <td style="text-align:center;">Node.js的Sass编译器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">ssh2</td> <td style="text-align:center;"><code>^0.8.9</code></td> <td style="text-align:center;">Node.js的SSH2客户端和服务端库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">xxtea-node</td> <td style="text-align:center;"><code>^1.1.4</code></td> <td style="text-align:center;">XXTEA加密算法的Node.js实现</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">s3</td> <td style="text-align:center;"><code>^4.4.0</code></td> <td style="text-align:center;">AWS S3的Node.js客户端库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">fs-extra</td> <td style="text-align:center;"><code>^9.0.1</code></td> <td style="text-align:center;">扩展Node.js内置<code>fs</code>模块的库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">rimraf</td> <td style="text-align:center;"><code>^2.6.2</code></td> <td style="text-align:center;">用于删除文件和目录的Node.js库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">yargs</td> <td style="text-align:center;"><code>^15.4.1</code></td> <td style="text-align:center;">解析命令行参数和生成用户友好帮助输出的库</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"><strong>前端验证和格式化工具</strong></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">eslint</td> <td style="text-align:center;"><code>^7.0.0</code></td> <td style="text-align:center;">用于JavaScript代码静态检查的工具</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">eslint-loader</td> <td style="text-align:center;"><code>^4.0.2</code></td> <td style="text-align:center;">将ESLint集成到webpack中的加载器</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">eslint-config-standard</td> <td style="text-align:center;"><code>^14.1.1</code></td> <td style="text-align:center;">ESLint的配置，遵循标准风格</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">eslint-plugin-html</td> <td style="text-align:center;"><code>^6.0.2</code></td> <td style="text-align:center;">ESLint的插件</td> <td style="text-align:center;"></td></tr></tbody></table> <h2 id="项目目录"><a href="#项目目录" class="header-anchor">#</a> <strong>项目目录</strong></h2> <p><img src="/myblog/assets/img/SSG项目目录.e29c45eb.png" alt="image-20240206144049713"></p> <h2 id="构建流程"><a href="#构建流程" class="header-anchor">#</a> <strong>构建流程</strong></h2> <p><strong>构建总流程</strong></p> <p><img src="/myblog/assets/img/总体流程图.34761bab.png" alt="img"></p> <p><strong>构建详细流程</strong></p> <p><img src="/myblog/assets/img/详细流程图.9dda5288.png" alt="img"></p> <p><strong>流程</strong></p> <ol><li>获取命令行参数，解析参数；</li> <li>是否通过 webpack 构建？
<ul><li>是，构建webpack，生成资源目录；</li> <li>否，进入静态路由判断</li></ul></li> <li>是否为静态页面路由？
<ul><li>是，生成静态路由表；</li> <li>否，生成动态路由表；</li></ul></li> <li>生成 <code>vue-server-render</code> 对象；</li> <li>生成 HTML ;</li> <li>上传静态资源到 S3；</li> <li>HTML 处理，如：AMP 处理、资源页面内容等逻辑处理；</li> <li>页面发布目录路径处理；</li> <li>写入文件；</li></ol> <h2 id="构建命令"><a href="#构建命令" class="header-anchor">#</a> <strong>构建命令</strong></h2> <table><thead><tr><th>命令</th> <th>说明</th> <th>api</th> <th>S3</th></tr></thead> <tbody><tr><td>npm run dev</td> <td>开发</td> <td>测服</td> <td>静态资源不上传 S3，放本地</td></tr> <tr><td>npm run start</td> <td>预览打包后的文件</td> <td>根据打包命令为区分(npm run build:test / npm run build)</td> <td>根据打包命令为区分(npm run build:test / npm run build)</td></tr> <tr><td>npm run build:test</td> <td>打包生成 dist-ssr</td> <td>测服</td> <td>测服(test-cdn-car-static)</td></tr> <tr><td>npm run build</td> <td>打包生成 dist-ssr</td> <td>正服</td> <td>正服(cdn-car-static)</td></tr> <tr><td>npm run generate:test</td> <td>静态化生成 html</td> <td>测服</td> <td>测服(test-cdn-car-static)，自动上传</td></tr> <tr><td>npm run generate</td> <td>静态化生成 html</td> <td>正服</td> <td>正服(cdn-car-static)，手动上传</td></tr></tbody></table> <p>所有构建命令在 <code>package.json</code> 文件中的 <code>script</code> 字段：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server.js --localDev=true&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:client:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./build/webpack.client.build.js --env=development&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:server:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./build/webpack.server.build.js --env=development&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:client&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./build/webpack.client.build.js --env=production&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./build/webpack.server.build.js --env=production&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .js --ext .vue src/ build/ public/ static-cli/&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;lint-fix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --fix --ext .js --ext .vue src/ build/ public/ static-cli/ script-amp/&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;static-server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node static-server.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;generate:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env node -r esm generate.js --env=test&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;generate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env node -r esm generate.js --env=production&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;deploy-s3&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node deployS3.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build-ssr:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./build/webpack.ssr.build.js --env=development --staticSource=dist&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build-ssr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./build/webpack.ssr.build.js --env=production --staticSource=dist&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;deploy-not-CDN&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node notCDNPublic/deploy.js&quot;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>通过执行构建命令: <code>npm run generate --target=routeName --lang=国家语言标识 --env=test --webpack=true --seconedLang=一国多语言标识 --params=**</code> 后，将执行项目中 <code>./generate.js</code> 脚本：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token comment">/**
 * #!/usr/bin/env node 为系统环境头，表示使用当前环境 node 的命令行脚本
 * 运行命令
 * 静态路由: node -r esm generate.js --target=index --lang=my-en --env=test --webpack=false
 * 动态路由: node -r esm generate.js --target=newsInfo --params=1234 --lang=my-en  --env=test --webpack=true
 * esm 文档：https://www.npmjs.com/package/esm
 */</span>
<span class="token comment">// 立即执行函数</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 引入静态化脚手架对象，调用 run 方法开始静态化</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./static-cli/cli'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>该入口文件使用立即执行函数：引入静态化脚手架，并执行 run 方法，立即执行脚本；</p></blockquote> <p>静态化脚手架脚本位于 <code>./static-cli/cli.js</code> 中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./argv/cli-argv'</span><span class="token punctuation">)</span> <span class="token comment">//处理命令行参数</span>
<span class="token keyword">const</span> Builer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./builder/cli-builder'</span><span class="token punctuation">)</span> <span class="token comment">// 静态化构建脚本</span>
<span class="token keyword">const</span> Generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./generator/cli-generator'</span><span class="token punctuation">)</span><span class="token comment">// 生成静态化页面</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> argvs <span class="token operator">=</span> <span class="token keyword">await</span> Argv<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token comment">// 命令行参数处理</span>
    consola<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 命令行参数:\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>argvs<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argvs<span class="token punctuation">.</span>webpack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./clean/cli-clean'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>argvs<span class="token punctuation">)</span> <span class="token comment">// 删除dist目录</span>
      <span class="token keyword">await</span> Builer<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>argvs<span class="token punctuation">)</span> <span class="token comment">// 执行 npm run build 脚本命令</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">await</span> Generator<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>argvs<span class="token punctuation">)</span> <span class="token comment">// 生成静态化页面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argvs<span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> uploadToS3 <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./s3/cli-s3'</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> <span class="token function">uploadToS3</span><span class="token punctuation">(</span>argvs<span class="token punctuation">)</span> <span class="token comment">// 测试服上传静态资源到 s3</span>
    <span class="token punctuation">}</span>
    consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;&gt; All Finish!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p>该脚本主要执行以下逻辑：</p> <ol><li><strong>命令行参数梳理</strong></li> <li><strong>根据参数是否需要执行 webpack 构建，决定是否执行 webpack 流程；</strong></li> <li><strong>生成静态化页面；</strong></li> <li><strong>上传到 S3;</strong></li></ol></blockquote> <p>以下将详细分析以上四个步骤。</p> <h2 id="参数处理"><a href="#参数处理" class="header-anchor">#</a> <strong>参数处理</strong></h2> <blockquote><p>参数处理库：<a href="https://github.com/yargs/yargs" target="_blank" rel="noopener noreferrer">yargs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="参数格式"><a href="#参数格式" class="header-anchor">#</a> <strong>参数格式</strong></h3> <p>生成静态化站点命令：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>node <span class="token operator">-</span>r esm generate<span class="token punctuation">.</span>js <span class="token operator">--</span>target<span class="token operator">=</span>routeName <span class="token operator">--</span>lang<span class="token operator">=</span>国家语言标识 <span class="token operator">--</span>env<span class="token operator">=</span>test <span class="token operator">--</span>webpack<span class="token operator">=</span><span class="token boolean">true</span>  <span class="token operator">--</span>seconedLang<span class="token operator">=</span>一国多语言标识 <span class="token operator">--</span>params<span class="token operator">=</span><span class="token operator">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>s3 测试服链接：
npm run generate <span class="token operator">--</span> <span class="token operator">--</span>target<span class="token operator">=</span>routeName <span class="token operator">--</span>lang<span class="token operator">=</span><span class="token operator">**</span><span class="token operator">*</span>  <span class="token operator">*</span><span class="token operator">--</span>env<span class="token operator">=</span><span class="token operator">**</span> <span class="token operator">--</span>webpack<span class="token operator">=</span><span class="token boolean">true</span> <span class="token operator">--</span>seconedLang<span class="token operator">=</span>一国多语言标识  <span class="token operator">--</span>params<span class="token operator">=</span><span class="token operator">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>s3 正式服链接：
npm run generate<span class="token operator">:</span>s3 <span class="token operator">--</span> <span class="token operator">--</span>target<span class="token operator">=</span>routeName <span class="token operator">--</span>lang<span class="token operator">=</span><span class="token operator">**</span> <span class="token operator">--</span>env<span class="token operator">=</span><span class="token operator">**</span> <span class="token operator">--</span>webpack<span class="token operator">=</span><span class="token boolean">true</span>  <span class="token operator">--</span>seconedLang<span class="token operator">=</span>一国多语言标识  <span class="token operator">--</span>params<span class="token operator">=</span><span class="token operator">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>【注意格式：<em>npm run generate –- 参数</em>】</p> <ul><li><p><code>target</code>：静态化目标路由名称（必填）。</p> <ul><li>对应 <em><code>src/router/routes.js</code></em> 中的 name 字段（webpackChunkName 不可省略）</li></ul></li> <li><p><code>params</code>：静态化静态路由（可选）。用于静态化动态路由生成路由表的时候使用。</p></li> <li><p><code>lang</code>：国家语言标识，默认 <code>my-en</code>。格式：国家-语言。</p></li> <li><p><code>seconedLang</code>： 一国多语言参数，同一国家第二种语言参数。</p></li> <li><p><code>env</code>：部署环境，test 或者 production，默认 production，用于区别接口请求域名。</p></li> <li><p><code>webpack</code>：是否执行 webpack 生成 <code>dist-ssr</code> 目录。默认 true，不执行 webpack 值为 false 或者 0。</p></li> <li><p><code>groupCount</code>: 静态化页面打包每次分组数量，并发执行打包数量。</p></li> <li><p><s>amp：是否是 amp 页面。默认为 false。</s></p></li></ul> <h3 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> <strong>参数说明</strong></h3> <h4 id="静态路由参数"><a href="#静态路由参数" class="header-anchor">#</a> <strong>静态路由参数</strong></h4> <ul><li><p>字段： <code>--target</code> = 静态化目标路由名称</p></li> <li><p>作用： 查找路由对象；</p></li> <li><p>问题： 不同国家路由模式相同，路由不同；</p></li> <li><p>解决方案：</p> <ul><li><p>建立国家和路由的map，根据当前打包的国家参数获取路由；</p></li> <li><p>判断路由对象方法：</p> <ul><li>参数 tartget 对应路由 name 字段；</li> <li>注意：webpackChunkName 不可省略，并且路由 name 与 webpackChunkName 相同；</li></ul></li></ul></li></ul> <h4 id="动态路由参数"><a href="#动态路由参数" class="header-anchor">#</a> <strong>动态路由参数</strong></h4> <ul><li>字段：<code>--params</code></li> <li>选项:
<ul><li>all： 静态化所有页面，如 生成所有xx页面 ;</li> <li>页面自定义参数： 静态化指定页面，如: 静态化 proton X50 特定车系，传入 brandCode, modelCode;</li></ul></li> <li>静态化静态路由可不传。用于静态化动态路由生成路由表的时候使用。</li></ul> <h4 id="语言参数"><a href="#语言参数" class="header-anchor">#</a> <strong>语言参数</strong></h4> <ul><li>字段：<code>--lang</code></li> <li>作用： 指定静态化国家页面和默认语言文案（静态化默认使用指定国家的默认语言）</li></ul> <h4 id="一国多语言参数"><a href="#一国多语言参数" class="header-anchor">#</a> <strong>一国多语言参数</strong></h4> <ul><li><p>字段： <code>--secondLang</code></p></li> <li><p>作用： 指定国家的第二语言，第二语言参数指定使用文案;</p></li> <li><p>问题： 第一语言 lang 指定语言和主题，第二语言 secondLang 仅仅使用在部分路由页面中，如资讯文案 bm 路由使用马来语，zh路由使用中文；seconedLand 不能覆盖 lang 参数</p></li> <li><p>解决方案：</p> <ul><li><p>方案一：通过 nodejs 对全局文件变量进行更改，通过读取文件变量设置多语言。</p></li> <li><p>方案二：package.json 变量配置。</p> <ul><li><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// package.json 配置</span>
<span class="token string-property property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;lang&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-en&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 脚本控制</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> lang <span class="token operator">=</span> argvs<span class="token punctuation">.</span>lang <span class="token operator">||</span> <span class="token string">'my-en'</span>
    <span class="token keyword">await</span> <span class="token function">execCmd</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm config set wapcar-ssr=th:lang </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    consola<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 多语言 package.json - config - lang 设置失败~ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul></li> <li><p>方案三: 配置多个 npm script 命令。</p> <ul><li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;dev:my-en&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server --PAGE_LANG=my-en&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;dev:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server --PAGE_LANG=th-th&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; npm run dev&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start:my-en&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; npm run dev:my-en&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production &amp;&amp; npm run dev:th-th&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf dist-ssr &amp;&amp; npm run build:client &amp;&amp; npm run build:server&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:client&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack --config build/webpack.client.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack --config build/webpack.server.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:my-en&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf dist-ssr &amp;&amp; npm run build:client:my-en &amp;&amp; npm run build:server:my-en&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:client:my-en&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production PAGE_LANG=my-en webpack --config build/webpack.client.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:server:my-en&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production PAGE_LANG=my-en webpack --config build/webpack.server.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf dist-ssr &amp;&amp; npm run build:client:th-th &amp;&amp; npm run build:server:th-th&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:client:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production PAGE_LANG=th-th webpack --config build/webpack.client.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build:server:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production PAGE_LANG=th-th webpack --config build/webpack.server.config.js --progress --hide-modules&quot;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul></li> <li><p>方案四：webpack 使用 nodejs 方式重构，这样各种参数可以使用 nodejs 命令行参数进行传递，而不用通过 cross-env 进行设置。</p></li> <li><p>方案五：</p> <ul><li>不通过命令行静态化时传参，第二语言参数一般跟路由相互绑定，因此可以在路由中携带第二语言参数</li> <li>开发模式，需要有第二语言的路由才能访问，通过路由中 meta 来设置第二语言参数</li> <li>静态化通过 cli-generate context 注入 secondLang，再传到业务代码 entry-server 传参</li> <li>业务逻辑中通过 this.$route.meta 获取第二语言参数</li></ul></li></ul></li></ul> <h3 id="参数处理流程"><a href="#参数处理流程" class="header-anchor">#</a> <strong>参数处理流程</strong></h3> <ul><li>格式化命令行参数;</li> <li>获取 target参数路由对象;;</li> <li>合并路由对象和参数对象;</li></ul> <p>参数处理逻辑位于静态化脚手架目录 <code>./static-cli/argv/cli-argv.js</code> 文件中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> argv <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>
  _ROUTES_NULL<span class="token punctuation">,</span> <span class="token comment">// 路由表为空</span>
  _STATIC_ROUTE<span class="token punctuation">,</span> <span class="token comment">// 静态路由</span>
  _DYNAMIC_ROUTE <span class="token comment">// 动态路由</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../common/routeState'</span><span class="token punctuation">)</span>

<span class="token comment">// host</span>
<span class="token keyword">const</span> hostMap <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../src/api/hostMap'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Argv</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * @param {String} target 静态化目标路由名称，对应 src/router/routes.js 中的 name
   * @param {String} params 参数（构建动态路由或者处理页面发布路径用）
   * @param {String} lang 国家语言标识默认 'my-en'
   * @param {String} secondLang 一国多语言标识，第二语言，默认为空
   * @param {String} env 发布环境，默认 'production', 'test' or 'production'
   * @param {Boolean} webpack 是否执行 webpack 流程
   * @param {*} groupCount 静态化页面打包每次分组数量
   */</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span> secondLang <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> env <span class="token operator">=</span> <span class="token string">'production'</span><span class="token punctuation">,</span> webpack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> groupCount <span class="token operator">=</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_argvs <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>routerName <span class="token operator">=</span> target <span class="token comment">//静态化目标路由名称，对应 src/router/routes.js 中的 name</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> params <span class="token comment">//参数（构建动态路由或者处理页面发布路径用）</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lang <span class="token operator">=</span> lang <span class="token comment">// 国家语言标识</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>secondLang <span class="token operator">=</span> secondLang <span class="token comment">//一国多语言标识，第二语言，默认为空</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>env <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span> <span class="token operator">?</span> env<span class="token punctuation">[</span>env<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> env <span class="token comment">//发布环境，默认 'production', 'test' or 'production'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> hostMap<span class="token punctuation">[</span>env <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> env <span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>lang<span class="token punctuation">]</span> <span class="token comment">// 发布站点 url</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webpack <span class="token operator">=</span> webpack <span class="token operator">!=</span> <span class="token string">'false'</span> <span class="token operator">&amp;&amp;</span> webpack <span class="token operator">!=</span> <span class="token number">0</span> <span class="token comment">// 是否执行 webpack 流程</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>groupCount <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>groupCount<span class="token punctuation">)</span> <span class="token comment">// 静态化页面打包每次分组数量，并发执行打包数量</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../src/router/routes'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 静态路由</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 参数格式化</span>
  <span class="token keyword">static</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Argv<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建 Argv 单例</span>
  <span class="token keyword">static</span> <span class="token function">from</span> <span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_argvs <span class="token keyword">instanceof</span> <span class="token class-name">Argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_argvs
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_argvs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Argv</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_argvs
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取路由对象和状态</span>
    <span class="token keyword">const</span> routeStateObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getRouteState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> cmdOptions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 参数选项</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerName<span class="token punctuation">,</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">,</span>
      <span class="token literal-property property">lang</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lang<span class="token punctuation">,</span>
      <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>env<span class="token punctuation">,</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>host<span class="token punctuation">,</span>
      <span class="token literal-property property">webpack</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webpack<span class="token punctuation">,</span>
      <span class="token literal-property property">secondLang</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secondLang<span class="token punctuation">,</span>
      <span class="token literal-property property">groupCount</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>groupCount
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>routeStateObj<span class="token punctuation">.</span>routeState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token literal-property property">_ROUTES_NULL</span><span class="token operator">:</span> <span class="token comment">// 路由表为空</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Route List is Null!'</span><span class="token punctuation">)</span>
      <span class="token keyword">case</span> <span class="token literal-property property">_STATIC_ROUTE</span><span class="token operator">:</span> <span class="token comment">// 静态路由，返回参数选项和路由状态对象</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token operator">...</span>routeStateObj<span class="token punctuation">,</span>
          <span class="token operator">...</span>cmdOptions
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">case</span> <span class="token literal-property property">_DYNAMIC_ROUTE</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span> 动态路由，返回参数选项和路由状态对象
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token operator">...</span>routeStateObj<span class="token punctuation">,</span>
          <span class="token operator">...</span>cmdOptions
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 获取路由对象和状态
   */</span>
  <span class="token function">_getRouteState</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 路由对象为空，返回路由状态标识</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>routes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">routeState</span><span class="token operator">:</span> _ROUTES_NULL <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 从项目中定义的路由对象中查找参数指定的路由对象，并返回路由状态</span>
    <span class="token keyword">const</span> routeStateObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> ifDynamicRoute <span class="token operator">=</span> item<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerName <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span> <span class="token comment">// 动态路由</span>
        <span class="token keyword">delete</span> item<span class="token punctuation">.</span>component
        item<span class="token punctuation">.</span>routeState <span class="token operator">=</span> ifDynamicRoute <span class="token operator">?</span> _DYNAMIC_ROUTE <span class="token operator">:</span> _STATIC_ROUTE
        <span class="token keyword">return</span> item
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> routeStateObj
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Argv
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div><blockquote><p>以上代码主要逻辑：</p> <p>定义一个 Argv 对象，该对象主要作用：</p> <ol><li>格式化命令行参数;</li> <li>获取 target参数路由对象;</li> <li>合并路由对象和参数对象;</li></ol></blockquote> <h2 id="webpack-构建"><a href="#webpack-构建" class="header-anchor">#</a> <strong>Webpack 构建</strong></h2> <p>在执行参数处理后，根据命令行参数 <code>--webpack=true</code> ,执行 webpack 构建流程。</p> <h3 id="清除静态资源"><a href="#清除静态资源" class="header-anchor">#</a> <strong>清除静态资源</strong></h3> <p>执行 webpack 构建之前，会先将构建模板的本地静态资源删除，删除脚本在 <code>./static-cli/clean/cli-clean.js</code> 文件中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 删除 dist-srr/${lang} 目录
 * @param {String} lang
 */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  lang <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  staticSource <span class="token operator">=</span> <span class="token string">'s3'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lang<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> distPath <span class="token operator">=</span> staticSource <span class="token operator">===</span> <span class="token string">'s3'</span> <span class="token operator">?</span> <span class="token string">'dist-static'</span> <span class="token operator">:</span> <span class="token string">'dist-ssr'</span>
      <span class="token keyword">const</span> targetPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      fse<span class="token punctuation">.</span><span class="token function">emptyDirSync</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span>
      fse<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span>
      consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 删除 /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 目录成功!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>以上删除脚本会根据 国家语言标识作为文件夹名称区分静态资源目录：</p> <ol><li>根据命令行参数 <code>--lang</code> 获取国家语言标识，获取资源目录；</li> <li>删除目标目录资源；</li></ol></blockquote> <h3 id="启动构建"><a href="#启动构建" class="header-anchor">#</a> <strong>启动构建</strong></h3> <p>在移除静态资源目录后，开始 webpack 构建。webpack 构建脚本位于 <code>./static-cli/builder/cli-builder.js</code> 目录下，详细代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> execCmd <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../common/util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   *
   * @param {String} lang 语言
   * @param {String} env 环境
   * @param {String} secondLang 第二语言，默认为空
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span> env <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">,</span> secondLang <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_builder <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lang <span class="token operator">=</span> lang <span class="token comment">// 国家语言标识</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>env <span class="token operator">=</span> env <span class="token comment">// 发布环境</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>secondLang <span class="token operator">=</span> secondLang <span class="token comment">// 一国多语言，第二语言</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 参数格式化</span>
  <span class="token keyword">static</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Builder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建 builder 单例</span>
  <span class="token keyword">static</span> <span class="token function">from</span><span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_builder <span class="token keyword">instanceof</span> <span class="token class-name">Builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_builder
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Builder</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_builder
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> spinnerBuild
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// shell 输出构建信息</span>
      spinnerBuild <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 正在构建: client \n</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 执行 client 脚本构建</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">runWebpackBuild</span><span class="token punctuation">(</span><span class="token string">'client'</span><span class="token punctuation">)</span>
      spinnerBuild<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// shell 输出构建信息</span>
      spinnerBuild <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 正在构建: server \n</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 执行 server 脚本构建</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">runWebpackBuild</span><span class="token punctuation">(</span><span class="token string">'server'</span><span class="token punctuation">)</span>
      spinnerBuild<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; Build</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">'test'</span> <span class="token operator">?</span> <span class="token string">' test '</span> <span class="token operator">:</span> <span class="token string">' '</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">bundles successfully!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      spinnerBuild<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      spinnerBuild<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 执行 webpack 构建</span>
  <span class="token keyword">async</span> <span class="token function">runWebpackBuild</span><span class="token punctuation">(</span>platform <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 构建脚本路径，根据平台参数获取</span>
        <span class="token keyword">const</span> builderPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../build/webpack.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>platform<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.build.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token comment">// node 脚本参数</span>
        <span class="token keyword">const</span> nodeCmd <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">node </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>builderPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --lang=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --secondLang=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>secondLang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --env=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">'test'</span> <span class="token operator">?</span> <span class="token string">'development'</span> <span class="token operator">:</span> <span class="token string">'production'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token comment">// 执行 node 命令</span>
        <span class="token keyword">await</span> <span class="token function">execCmd</span><span class="token punctuation">(</span>nodeCmd<span class="token punctuation">)</span>
        consola<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 构建完成: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>platform<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Builder
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><blockquote><p>以上脚本主要逻辑：</p> <ol><li>实例化 Builder 类单例；</li> <li>根据不同平台，对平台脚本使用 node 启动构建；</li></ol></blockquote> <h3 id="根据平台构建"><a href="#根据平台构建" class="header-anchor">#</a> <strong>根据平台构建</strong></h3> <p>webpack 构建会根据不同平台（client 浏览器包和 server 包）进行构建产生不同的包。</p> <p>SSR 架构如下：</p> <p><img src="/myblog/assets/img/SSR架构.08daea42.png" alt="SSR架构"></p> <p>Vue SSR 框架为同构框架，应用代码编译过程 Vue SSR 提供了两个编译入口，服务端应用和客户端应用，作为抹平由于环境不同的代码差异；</p> <p>由于用例和平台 API 的差异，当运行在不同环境中时，代码将不会完全相同。</p> <p>通过 webpack 构建将产生两个包： <code>Server Bundle</code>  和 <code>Client Bundle</code>。</p> <ul><li><code>Server Bundle</code> 用于生成 <code>vue-ssr-server-bundle.json</code>， <code>sourceMap</code> 和需要在服务端运行的代码列表都在这个产物中。<code>Server Bundle</code> 运行在 Node Server。</li> <li><code>Client Bundle</code> 用于生成 <code>vue-ssr-client-manifest.json</code>，包含所有的静态资源，首次渲染需要加载的 script 标签，以及需要在客户端运行的代码。</li></ul> <p><strong>构建文件目录</strong></p> <p>构建文件位于 <code>./build/</code> 目录下，该目录下包含所有 webpack 构建的脚本：</p> <p><img src="/myblog/assets/img/SSG-webpack目录.f476a905.png" alt="image-20240206161117549"></p> <p>构建入口文件为：</p> <ul><li>浏览器构建： <code>webpack.client.build.js</code></li> <li>服务端构建： <code>webpack.server.build.js</code></li></ul> <p>这两个文件逻辑相同，只是引入的配置脚本不同，以  <code>webpack.client.build.js</code> 讲解：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Compiler <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./common'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> clientWebpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.client.config'</span><span class="token punctuation">)</span>

<span class="token comment">// 立即执行函数</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取命令行参数</span>
    <span class="token keyword">const</span> argvs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argv
    <span class="token comment">// 获取 Client webpack 构建配置</span>
    <span class="token keyword">const</span> clientConfig <span class="token operator">=</span> <span class="token function">clientWebpack</span><span class="token punctuation">(</span>argvs<span class="token punctuation">)</span>
    <span class="token comment">// 创建 webpack 实例</span>
    <span class="token keyword">const</span> ClientCmpiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>clientConfig<span class="token punctuation">)</span>
    <span class="token comment">// 启动 webpack 构建</span>
    <span class="token keyword">await</span> ClientCmpiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    consola<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>以上构建主要逻辑：</p> <ol><li>获取命令行参数;</li> <li>获取 webpack 构建配置;</li> <li>创建 webpack 实例;</li> <li>启动 webpack 构建;</li></ol></blockquote> <h3 id="webpack-实例"><a href="#webpack-实例" class="header-anchor">#</a> <strong>Webpack 实例</strong></h3> <p>以上通过 <code>Compiler</code> 对象为 webpack 构建实例，该实例在 <code>./build/common.js</code> 文件中定义：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token comment">// const consola = require(&quot;consola&quot;);</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">COUNTRY_MAP_CDN_HOST</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/enum'</span><span class="token punctuation">)</span>


<span class="token comment">// Compiler 类，用于执行 webpack 构建</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构建参数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
  <span class="token punctuation">}</span>
  <span class="token comment">// 执行构建</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 通过 webpack 对象执行构建</span>
      <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">||</span> stat<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 获取构建结果信息</span>
          <span class="token keyword">const</span> info <span class="token operator">=</span> stat<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">error</span><span class="token operator">:</span> err <span class="token operator">||</span> info<span class="token punctuation">.</span>errors<span class="token punctuation">,</span>
            <span class="token literal-property property">warning</span><span class="token operator">:</span> info<span class="token punctuation">.</span>warnings
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 获取命令行传入的国家语言标识
 * @param {*} argvLang 1. npm run dev/start: 通过 node 环境获取，--PAGE_LANG=** 传入，require('yargs').argv.PAGE_LANG 获取
 * @param {*} processLang 2. npm run build: 通过 cross-env 设置，PAGE_LANG=** 传入，process.env.PAGE_LANG 获取
 */</span>
<span class="token keyword">function</span> <span class="token function">getCmdLang</span><span class="token punctuation">(</span>argvLang <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> processLang <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> argvLang <span class="token operator">||</span> processLang
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 获取主题样式标识
 * @param {*} lang
 */</span>
<span class="token keyword">function</span> <span class="token function">getStyleVarByLang</span><span class="token punctuation">(</span><span class="token parameter">lang</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>lang<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'th-th'</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">'id-id'</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">'ph-en'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">'autofun'</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">'main'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 获取 S3 发布域名
 * @param {*} env
 * @param {*} lang
 */</span>
<span class="token keyword">function</span> <span class="token function">getPublishPath</span><span class="token punctuation">(</span><span class="token punctuation">{</span> env <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">'my-en'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> countryCode <span class="token operator">=</span> lang<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> env <span class="token operator">===</span> <span class="token string">'production'</span>
    <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">COUNTRY_MAP_CDN_HOST</span><span class="token punctuation">[</span>countryCode<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://xxxx.amazonaws.com/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  getCmdLang<span class="token punctuation">,</span>
  getStyleVarByLang<span class="token punctuation">,</span>
  getPublishPath<span class="token punctuation">,</span>
  Compiler
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><blockquote><p>以上代码定义了 Compiler 类，用于执行 webpack 构建，并对外暴露了几个方法：</p> <ul><li><code>getCmdLang</code>: 获取命令行传入的国家语言标识；</li> <li><code>getStyleVarByLang</code>:  获取主题样式标识;</li> <li><code>getPublishPath</code>: 获取 S3 发布域名;</li></ul></blockquote> <p>通过以上 webapck 构建实例构建之前，需要获取 webpack 构建配置参数，以下分析不同平台下 webpack 构建配置参数。</p> <h3 id="webpack-构建配置"><a href="#webpack-构建配置" class="header-anchor">#</a> <strong>Webpack 构建配置</strong></h3> <h4 id="webpack-base-config-js"><a href="#webpack-base-config-js" class="header-anchor">#</a> <strong><code>webpack.base.config.js</code></strong></h4> <p>该文件为 浏览器和服务端 webpack 公共配置项</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token comment">// 处理文件路径的Node.js模块。 </span>
<span class="token keyword">const</span> px2rem <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-px2rem'</span><span class="token punctuation">)</span> <span class="token comment">//一个PostCSS插件，用于将像素值转换为rem。</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">//用于优化和压缩JavaScript代码的Webpack插件。</span>
<span class="token keyword">const</span> FriendlyErrorsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">//用于提供更友好的错误输出的Webpack插件。</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span> <span class="token comment">//用于将CSS文件提取到单独的文件中的Webpack插件。</span>
<span class="token keyword">const</span> ForkTsCheckerWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fork-ts-checker-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">//用于在Webpack中检查TypeScript代码的Webpack插件。</span>
<span class="token keyword">const</span> CopyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'copy-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">//用于在Webpack构建过程中复制文件的插件。</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> VueLoaderPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-loader'</span><span class="token punctuation">)</span> <span class="token comment">//用于处理Vue.js文件的Webpack加载器</span>
<span class="token keyword">const</span> commonTool <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./common'</span><span class="token punctuation">)</span>

<span class="token comment">/**
   * get client webpack config
   * @param {String} lang 主要语言（第一语言），默认为 'my-en'
   * @param {String} env 开发环境，测服/正式服，默认测服
   * @param {Boolean} localDev 本地开发还是静态化打包。本地开发是为 true。默认为 false
   */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span>
  env <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  localDev <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  staticSource <span class="token operator">=</span> <span class="token string">'s3'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取主题样式标识</span>
  <span class="token keyword">const</span> styleLang <span class="token operator">=</span> commonTool<span class="token punctuation">.</span><span class="token function">getStyleVarByLang</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span>
  <span class="token comment">// 静态化页面静态资源在s3上，这里和ssr页面做一个区分</span>
  <span class="token keyword">const</span> distPath <span class="token operator">=</span> staticSource <span class="token operator">===</span> <span class="token string">'s3'</span> <span class="token operator">?</span> <span class="token string">'dist-static'</span> <span class="token operator">:</span> <span class="token string">'dist-ssr'</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> localDev <span class="token operator">?</span> <span class="token string">'development'</span> <span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 发布环境</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span> localDev <span class="token operator">?</span> <span class="token string">'#cheap-module-source-map'</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 本地开发环境下需要 sourceMap</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 输出文件路径</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 静态资源发布路径</span>
      <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token operator">!</span>localDev <span class="token operator">&amp;&amp;</span> staticSource <span class="token operator">===</span> <span class="token string">'s3'</span>
        <span class="token operator">?</span> commonTool<span class="token punctuation">.</span><span class="token function">getPublishPath</span><span class="token punctuation">(</span><span class="token punctuation">{</span> env<span class="token punctuation">,</span> <span class="token literal-property property">lang</span><span class="token operator">:</span> lang <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token comment">// 块文件名</span>
      <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'common/[name].[chunkhash:8].js'</span><span class="token punctuation">,</span>
      <span class="token comment">// 文件名</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'common/[name].[chunkhash:8].js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 文件扩展名</span>
      <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.scss'</span><span class="token punctuation">,</span> <span class="token string">'.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 别名</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-property property">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置 webpack 的 optimization 属性，用于配置 webpack 的优化规则</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token operator">!</span>localDev<span class="token punctuation">,</span>
      <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">//插件用于在生产环境中对打包的 JavaScript 代码进行压缩优化。</span>
          <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//并发处理,这样可以提高压缩效率。</span>
          <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> localDev<span class="token punctuation">,</span> <span class="token comment">// 如果在生产环境中使用 source-maps，必须设置为 true</span>
          <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// https://github.com/webpack-contrib/terser-webpack-plugin#terseroptions</span>
            <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//配置压缩选项</span>
              <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token literal-property property">drop_console</span><span class="token operator">:</span> env <span class="token operator">!==</span> <span class="token string">'development'</span><span class="token punctuation">,</span><span class="token comment">//在生产环境中删除控制台和调试代码。</span>
              <span class="token literal-property property">drop_debugger</span><span class="token operator">:</span> env <span class="token operator">!==</span> <span class="token string">'development'</span><span class="token comment">//在生产环境中删除控制台和调试代码。</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//禁用输出注释</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">extractComments</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//不提取注释到source-maps</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//控制代码分</span>
        <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//定义不同的分割规则</span>
          <span class="token literal-property property">vanUI</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'vanUI'</span><span class="token punctuation">,</span><span class="token comment">//分割后的chunk的名称prefix</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](.*vant.*)[\\/](lib)[\\/](toast|icon|popup|overlay|info|loading|style)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//正则表达式用于匹配vanUI组件的相关代码</span>
            <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span><span class="token comment">//这个属性表示将匹配到的所有代码都打包成一个chunk。如果设置为'async'，则只会将匹配到的代码打包成一个chunk，但这个chunk会异步加载，并不会影响页面的初始加载速度。</span>
            <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//当没有找到对应的chunk时，强制创建一个chunk</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">es6-promise\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// avoid webpack shimming process</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(vue|js)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">fix</span><span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">compilerOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">preserveWhitespace</span><span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpg|jpeg|gif|svg|eot|woff2?|ttf|otf)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'static/img/[name].[contenthash:8].[ext]'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(ts|tsx)?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">appendTsSuffixTo</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span> <span class="token comment">// 为 script 有 lang='ts' 标识的脚本文件添加 ts 后缀</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(c|sa|sc)ss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            localDev <span class="token operator">?</span> <span class="token string">'vue-style-loader'</span> <span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token operator">!</span>localDev <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">postcssOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token function">px2rem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                      <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">100</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// data: `@import '~@/assets/index.scss'; @import '~@/assets/scss/variables/${styleLang}.scss';`,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import '~@/assets/scss/variables/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styleLang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.scss';</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">outputStyle</span><span class="token operator">:</span> <span class="token string">'expanded'</span> <span class="token comment">// https://github.com/neilgao000/blog/issues/15</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">performance</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">hints</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//关闭 Webpack 的性能提示。</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token operator">!</span>localDev 
      <span class="token operator">?</span> <span class="token punctuation">[</span> <span class="token comment">// 生产环境下 webpack 插件</span>
        <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Vue.js 加载器。</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">//使用 MiniCSS 插件来提取 CSS 文件。</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'common/[name].[contenthash:8].css'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">ignoreOrder</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CopyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">//使用 CopyPlugin 插件来复制静态文件</span>
          <span class="token literal-property property">patterns</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">from</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../public/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">to</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/public</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span>
      <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 开发环境下 webpack 插件</span>
        <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Vue.js 加载器。</span>
        <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//使用 FriendlyErrors 插件来处理错误。</span>
        <span class="token keyword">new</span> <span class="token class-name">ForkTsCheckerWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//使用 ForkTsCheckerWebpack 插件来检查 TypeScript 文件。</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br></div></div><h4 id="webpack-client-config-js"><a href="#webpack-client-config-js" class="header-anchor">#</a> <strong><code>webpack.client.config.js</code></strong></h4> <p>该文件用于构建 client 文件的 webpack 配置代码，通过 <code>webpack-merge</code> 插件，将 webpack 基础配置项和 client 端 webpack 配置项合并：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ProgressBarPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'progress-bar-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> VueSSRClientPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer/client-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * get client webpack config
 * @param {String} lang 主要语言（第一语言），默认为 'my-en'
 * @param {String} env 开发环境，测服/正式服，默认测服
 * @param {Boolean} localDev 本地开发还是静态化打包。本地开发是为 true。默认为 false
 */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span>
  env <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  localDev <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  staticSource <span class="token operator">=</span> <span class="token string">'s3'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpack 公共配置项</span>
    <span class="token keyword">const</span> baseConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.config'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang<span class="token punctuation">,</span> env<span class="token punctuation">,</span> localDev<span class="token punctuation">,</span> staticSource <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 合并 webpack 配置</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">'./src/entry-client.js'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">'create-api'</span><span class="token operator">:</span> <span class="token string">'./create-api-client.js'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 进度条插件</span>
        <span class="token keyword">new</span> <span class="token class-name">ProgressBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'Build Client [:bar] '</span> <span class="token operator">+</span> chalk<span class="token punctuation">.</span>green<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token string">':percent'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' (:current/:total)'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">clear</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">complete</span><span class="token operator">:</span> <span class="token string">'█'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">incomplete</span><span class="token operator">:</span> <span class="token string">'░'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 在 process 对象中定义不同的环境变量</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string-property property">'process.env'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token constant">LANG</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token constant">API_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token constant">VUE_ENV</span><span class="token operator">:</span> <span class="token string">'&quot;client&quot;'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// vue 客户端渲染插件</span>
        <span class="token keyword">new</span> <span class="token class-name">VueSSRClientPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    consola<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>使用该 webpack 构建的文件为 <code>./src/entry-client.js</code>。</p> <h4 id="webpack-server-config-js"><a href="#webpack-server-config-js" class="header-anchor">#</a> <strong><code>webpack.server.config.js</code></strong></h4> <p>该文件用于构建 server 文件的 webpack 配置代码，通过 <code>webpack-merge</code> 插件，将 webpack 基础配置项和 server 端 webpack 配置项合并：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> nodeExternals <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-node-externals'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ProgressBarPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'progress-bar-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> VueSSRServerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer/server-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * get server webpack config
 * @param {String} lang 主要语言（第一语言），默认为 'my-en'
 * @param {String} env 开发环境，测服/正式服，默认测服
 * @param {Boolean} localDev 本地开发还是静态化打包。本地开发是为 true。默认为 false
 */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span>
  env <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  localDev <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  staticSource <span class="token operator">=</span> <span class="token string">'s3'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpack 公共配置项</span>
    <span class="token keyword">const</span> baseConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.config'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang<span class="token punctuation">,</span> env<span class="token punctuation">,</span> localDev<span class="token punctuation">,</span> staticSource <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 合并 webpack 配置</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token comment">// 指定目标环境，这里设置为Node.js</span>
      <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'#source-map'</span><span class="token punctuation">,</span> <span class="token comment">//开发过程中查看源代码maps</span>
      <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/entry-server.js'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'server-bundle.js'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'commonjs2'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 路径别名</span>
          <span class="token string-property property">'create-api'</span><span class="token operator">:</span> <span class="token string">'./create-api-server.js'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">//使用nodeExternals插件来外部化某些模块，避免在构建过程中包含不必要的依赖</span>
      <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token function">nodeExternals</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">//whitelist 参数中被指定为忽略CSS文件的外部化，以及vant/lib模块的不外部化。</span>
        <span class="token literal-property property">whitelist</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vant\/lib</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">//添加一个进度条来显示构建过程中的进度。</span>
        <span class="token keyword">new</span> <span class="token class-name">ProgressBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'Build Server [:bar] '</span> <span class="token operator">+</span> chalk<span class="token punctuation">.</span>green<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token string">':percent'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' (:current/:total)'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">clear</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">complete</span><span class="token operator">:</span> <span class="token string">'█'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">incomplete</span><span class="token operator">:</span> <span class="token string">'░'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//定义一些环境变量，这些变量在编译时会被替换为实际的值。</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token string-property property">'process.env'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token constant">LANG</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token constant">API_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token constant">VUE_ENV</span><span class="token operator">:</span> <span class="token string">'&quot;server&quot;'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//使用VueSSRServerPlugin插件来处理Vue组件的SSR（服务器端渲染）。</span>
        <span class="token keyword">new</span> <span class="token class-name">VueSSRServerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 解决 mini-css-extract-plugin 静态化 render route 时 document is not defined 问题</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>LimitChunkCountPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">maxChunks</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    consola<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>使用该 webpack 构建的文件为 <code>./src/entry-server.js</code>。</p> <h3 id="构建入口文件"><a href="#构建入口文件" class="header-anchor">#</a> <strong>构建入口文件</strong></h3> <p>构建文件是指，通过 webpack 进行构建的代码入口，根据以上 webpack 配置分析可知，在不同平台下构建不同的入口文件：</p> <ul><li><code>Client</code>:  构建的文件为 <code>./src/entry-client.js</code>;</li> <li><code>Server</code>:  构建的文件为 <code>./src/entry-server.js</code>。</li></ul> <p>关于入口文件详细解释，可以参考 <a href="https://sewar-x.github.io/vue2/VueSSR%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" target="_blank" rel="noopener noreferrer">VueSSR原理分析 | Sewen 博客 (sewar-x.github.io)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="entry-client-js"><a href="#entry-client-js" class="header-anchor">#</a> <strong><code>entry-client.js</code></strong></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token string">'es6-promise/auto'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/app'</span>
<span class="token keyword">import</span> <span class="token string">'./plugin/index.js'</span> <span class="token comment">// 登录插件</span>
<span class="token keyword">import</span> lgs <span class="token keyword">from</span> <span class="token string">'@/directives/lgs'</span> <span class="token comment">// 埋点上报插件</span>
<span class="token keyword">import</span> link <span class="token keyword">from</span> <span class="token string">'@/directives/link'</span>
<span class="token keyword">import</span> analysis <span class="token keyword">from</span> <span class="token string">'@/directives/analysis'</span> <span class="token comment">// 数据分析插件</span>
<span class="token keyword">import</span> scroll <span class="token keyword">from</span> <span class="token string">'@/directives/scroll.js'</span>
<span class="token keyword">import</span> <span class="token string">'@/common/firebaseInit.js'</span>
<span class="token keyword">import</span> <span class="token string">'@/assets/font/arrow/iconfont.css'</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'lgs'</span><span class="token punctuation">,</span> lgs<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">,</span> link<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'analysis'</span><span class="token punctuation">,</span> analysis<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> scroll<span class="token punctuation">)</span>

<span class="token comment">// 全局 mixin：当组件参数发生变化时，调用组件内的 asyncData，用于预获取路由页面客户端渲染数据 </span>
<span class="token comment">// 此函数会在组件实例化之前调用，所以它无法访问 this</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">beforeRouteUpdate</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> asyncData <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options
    <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">store</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">,</span>
        <span class="token literal-property property">route</span><span class="token operator">:</span> to
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 当使用 template 时，context.state 将作为 window.__INITIAL_STATE__ 状态，自动嵌入到最终的 HTML 中</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__INITIAL_STATE__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>__INITIAL_STATE__<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等到路由器在钩子和异步组件之前解析了所有的异步</span>
router<span class="token punctuation">.</span><span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 添加路由钩子函数，用于处理 asyncData.</span>
  <span class="token comment">// 在初始路由 resolve 后执行，以便我们不会二次预取(double-fetch)已有的数据。</span>
  <span class="token comment">// 使用 `router.beforeResolve()`，以便确保所有异步组件都 resolve。</span>
  router<span class="token punctuation">.</span><span class="token function">beforeResolve</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取路由匹配的进入和离开的异步组件</span>
    <span class="token keyword">const</span> matched <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">getMatchedComponents</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
    <span class="token keyword">const</span> prevMatched <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">getMatchedComponents</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span>
    <span class="token comment">// 我们只关心非预渲染的组件， 所以我们对比它们，找出两个匹配列表的差异组件</span>
    <span class="token keyword">let</span> diffed <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// 比较进入和离开组件是否相同</span>
    <span class="token keyword">const</span> activated <span class="token operator">=</span> matched<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> diffed <span class="token operator">||</span> <span class="token punctuation">(</span>diffed <span class="token operator">=</span> prevMatched<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 过滤获取激活组件异步获取数据钩子</span>
    <span class="token keyword">const</span> asyncDataHooks <span class="token operator">=</span> activated<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>asyncData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">)</span>
    <span class="token comment">// 不存在获取数据钩子，直接进入导航页面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>asyncDataHooks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//根据 asyncData 获取数据</span>
    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>asyncDataHooks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">hook</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">hook</span><span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> <span class="token literal-property property">route</span><span class="token operator">:</span> to <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//挂载 dom </span>
  app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><blockquote><p>客户端渲染主要逻辑：</p> <ol><li>获取 app、router 和 store 实例；</li> <li>获取 <code>window.__INITIAL_STATE__</code> 状态，注入到store 中；（<code>window.__INITIAL_STATE__</code> 是通过服务端渲染预先获取的数据，并注入在 HTML 页面中的 <code>window.__INITIAL_STATE__</code> 变量中）；</li> <li>全局 mixin：在客户端激活后，当组件参数发生变化时，调用组件内的 asyncData 钩子，用于预获取路由页面客户端渲染的数据；</li> <li>挂载 dom ；</li> <li>监听路由变化，当路由变化时：
<ul><li>获取路由匹配的进入和离开的异步组件；</li> <li>比较进入和离开组件是否相同；</li> <li>过滤获取激活组件获取数据 asyncData 钩子；</li> <li>根据 asyncData 获取数据；</li></ul></li> <li>进入路由页面，客户端渲染页面。</li></ol></blockquote> <h4 id="entry-server-js"><a href="#entry-server-js" class="header-anchor">#</a> <strong><code>entry-server.js</code></strong></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>

<span class="token comment">// 暴露一个方法用于 bundleRenderer 调用。在服务端渲染时主要执行数据预取，定义应用状态。</span>
<span class="token comment">// 一旦数据完成同步，该方法将返回一个 Promise app 实例。</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> s <span class="token operator">=</span> isDev <span class="token operator">&amp;&amp;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 记录请求时间</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 每次请求获取新的 app 、 router、 store  对象</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> context <span class="token comment">// 请求 url</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> fullPath <span class="token punctuation">}</span> <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>route <span class="token comment">// 解析 url 获取路由路径</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>fullPath <span class="token operator">!==</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> fullPath <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 设置服务器端 router 的位置</span>
    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>

    <span class="token comment">// 等到 router 将可能的异步组件和钩子函数解析完</span>
    router<span class="token punctuation">.</span><span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取路由匹配的组件</span>
      <span class="token keyword">const</span> matchedComponents <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">getMatchedComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 没有匹配的组件，返回 404</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matchedComponents<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">404</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
 
      <span class="token comment">// 调用路由匹配到的组件的 asyncData 钩子，asyncData 钩子分发 store action，当异步动作完成并 store 同步状态完成则返回 Promise。</span>
      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>matchedComponents<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> asyncData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> asyncData <span class="token operator">&amp;&amp;</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        store<span class="token punctuation">,</span>
        <span class="token literal-property property">route</span><span class="token operator">:</span> router<span class="token punctuation">.</span>currentRoute
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开发环境下控制台输出获取数据时间</span>
        isDev <span class="token operator">&amp;&amp;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data pre-fetch: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> s<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token comment">// 在所有预取钩子(preFetch hook) resolve 后，我们的 store 现在已经填充入渲染应用程序所需的状态。</span>
        <span class="token comment">// 当我们将状态附加到上下文， 并且 `template` 选项用于 renderer 时，</span>
        <span class="token comment">// 状态将自动序列化为 `window.__INITIAL_STATE__`，并注入 HTML。</span>
        context<span class="token punctuation">.</span>state <span class="token operator">=</span> store<span class="token punctuation">.</span>state
        <span class="token function">resolve</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><blockquote><p>服务端渲染过程主要执行逻辑：</p> <ol><li>解析 url 获取路由路径；</li> <li>获取路由匹配的组件；</li> <li>调用路由匹配到的组件的 asyncData 钩子预先获取组件数据；</li> <li>获取异步数据后，将数据填入 store，并自动序列化为 <code>window.__INITIAL_STATE__</code>，注入到 HTML。</li></ol></blockquote> <h2 id="生成路由表"><a href="#生成路由表" class="header-anchor">#</a> <strong>生成路由表</strong></h2> <h3 id="路由表分类"><a href="#路由表分类" class="header-anchor">#</a> <strong>路由表分类</strong></h3> <p>在Vue.js中，路由是指根据不同的URL地址展示不同的内容或页面。</p> <p>根据 URL 地址是固定配置还是动态参数生成，将路由分为静态路由和动态路由：</p> <ul><li>静态路由：指的是在路由配置中，提前定义好所有的路由规则，包括路径和对应的组件。
<ul><li>静态路由规则在应用<strong>启动时就已经确定</strong>，不会随着应用的运行而改变；</li> <li>例如，在Vue Router中，可以通过定义<code>routes</code>数组来配置静态路由，每个路由对象都包含<code>path</code>和<code>component</code>属性，分别表示路径和对应的组件。</li></ul></li> <li>动态路由：指在应用运行过程中，根据用户的操作或其他条件动态地添加、删除或修改路由规则。
<ul><li>动态路由更加灵活，可以根据不同的需求加载不同的路由，实现不同的页面渲染；</li> <li>例如，在Vue中，可以使用路由参数用户 id 获取不同用户信息 <code>user/id</code> ;</li></ul></li></ul> <h3 id="路由表生成规则"><a href="#路由表生成规则" class="header-anchor">#</a> <strong>路由表生成规则</strong></h3> <h4 id="静态路由表"><a href="#静态路由表" class="header-anchor">#</a> <strong>静态路由表</strong></h4> <p>根据路由文件 <code>routes.js</code> 中的 <code>path</code> 生成文件目录结构。</p> <ul><li><p>如某活动页面路由表配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// npm run generate:test -- --target=Campaign --lang=my-en --env=test --webpack=0</span>
<span class="token comment">// npm run generate:test -- --target=Wheel --lang=my-en --env=test --webpack=0</span>
<span class="token keyword">const</span> <span class="token function-variable function">activityLibrary</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/activity/xxx1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Campaign'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;Campaign&quot; */</span><span class="token string">'@/views/activity/campaign'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/activity/xxx2</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Wheel'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;Wheel&quot; */</span><span class="token string">'@/views/activity/wheel'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> activityLibrary
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul> <h4 id="动态路由表"><a href="#动态路由表" class="header-anchor">#</a> <strong>动态路由表</strong></h4> <p>根据 <code>/static-addition-config/routeHooks/routeName.js</code> 中的 <code>createDynamicRoutes</code> 函数生成路由表，该函数返回路由表数组。（动态路由必须有该文件，文件名称对应 routes.js 中的 name）</p> <ul><li>输入：{ params: ... }</li> <li>输出：路由表数组。</li></ul> <p>如某新闻资讯页面的动态路由，路由为 <code>/news/新闻id</code> ，通过新闻 id 动态区分资源内容，因此在静态化所有新闻资讯页面的路由时候，需要预先获取所有新闻资讯的 id 和新闻资讯内容，将内容传入组件中进行静态化。</p> <p>创建新闻资源的方法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">/**
   * 创建动态路由表
   * @param {*} options
   */</span>
  <span class="token keyword">async</span> <span class="token function">createDynamicRoutes</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取命令行参数</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> params <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> host <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> secondLang <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span> <span class="token operator">=</span> options
      <span class="token keyword">const</span> languageCode <span class="token operator">=</span> lang
      <span class="token keyword">const</span> countryCode <span class="token operator">=</span> lang<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> isGenerateSingleRoutes <span class="token operator">=</span> params <span class="token operator">!==</span> <span class="token string">'all'</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!==</span> <span class="token string">''</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isGenerateSingleRoutes<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 单个路由情况，从输入的参数无法直接得出资讯title，需要先实行一次请求详情</span>
        <span class="token comment">//  根据新闻资讯 id 获取资讯详细内容</span>
        <span class="token keyword">const</span> detailRes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNewsDetail</span><span class="token punctuation">(</span><span class="token punctuation">{</span> host<span class="token punctuation">,</span> countryCode<span class="token punctuation">,</span> languageCode<span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> singleParams <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> detailRes<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> params
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
          <span class="token comment">// 创建单个路由</span>
          <span class="token keyword">await</span> <span class="token function">createSingleNewsRoute</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            languageCode<span class="token punctuation">,</span>
            secondLang<span class="token punctuation">,</span>
            <span class="token literal-property property">params</span><span class="token operator">:</span> singleParams
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建所有新闻页面路由</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">createAllNewsRoutes</span><span class="token punctuation">(</span><span class="token punctuation">{</span> host<span class="token punctuation">,</span> languageCode<span class="token punctuation">,</span> secondLang<span class="token punctuation">,</span> countryCode <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error :&gt;&gt; '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 创建单个路由
   * @param {*} params carModelCode,brandCode
   */</span>
  <span class="token keyword">async</span> <span class="token function">createSingleNewsRoute</span><span class="token punctuation">(</span><span class="token punctuation">{</span> languageCode <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> secondLang <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> useLang <span class="token operator">=</span> <span class="token punctuation">(</span>secondLang <span class="token operator">&amp;&amp;</span> secondLang <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">?</span> secondLang <span class="token operator">:</span> languageCode
    <span class="token keyword">return</span> url<span class="token punctuation">[</span>useLang<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">news</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>title<span class="token punctuation">,</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 创建全部路由
   * @param {*} host
   */</span>
  <span class="token keyword">async</span> <span class="token function">createAllNewsRoutes</span><span class="token punctuation">(</span><span class="token punctuation">{</span> host <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> languageCode <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> secondLang <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> countryCode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> listParams <span class="token operator">=</span> <span class="token punctuation">{</span>
        host<span class="token punctuation">,</span>
        countryCode<span class="token punctuation">,</span>
        languageCode<span class="token punctuation">,</span>
        <span class="token literal-property property">secondLang</span><span class="token operator">:</span> secondLang<span class="token punctuation">,</span>
        <span class="token literal-property property">pageNo</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">99999</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sortType</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 获取新闻资讯列表</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">list</span><span class="token operator">:</span> newsList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNewsList</span><span class="token punctuation">(</span>listParams<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">handleNewsList</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newsList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> routeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token comment">// 遍历新闻资讯列表，获取创建新闻资讯列表路由</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newsList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> title <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> id <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span> <span class="token operator">=</span> newsList<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSingleNewsRoute</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          languageCode<span class="token punctuation">,</span>
          secondLang<span class="token punctuation">,</span>
          <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            title<span class="token punctuation">,</span>
            id
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        routeList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 返回所有路由列表</span>
      <span class="token keyword">return</span> routeList
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><h3 id="生成路由表-2"><a href="#生成路由表-2" class="header-anchor">#</a> <strong>生成路由表</strong></h3> <p>通过以上方法获取到静态路由和动态路由之后，下一步生成路由。</p> <p>生成路由脚本在 <code>./static-cli/generator/cli-generator.js</code> 中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// support ECMAScript module loader</span>
require <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'esm'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>module<span class="token comment">/*, options */</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cli-server'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../common/publishConfig'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  resolve<span class="token punctuation">,</span>
  readFileData<span class="token punctuation">,</span>
  writeFileData<span class="token punctuation">,</span>
  copyData
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../common/util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  _ROUTES_NULL<span class="token punctuation">,</span> <span class="token comment">// 路由表为空</span>
  _STATIC_ROUTE<span class="token punctuation">,</span> <span class="token comment">// 静态路由</span>
  _DYNAMIC_ROUTE <span class="token comment">// 动态路由</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../common/routeState'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * @param {String} target 静态化目标路由名称，对应 src/router/routes.js 中的 name
   * @param {String} params 参数（构建动态路由或者处理页面发布路径用）
   * @param {String} lang 默认 'my-en'
   * @param {String} env 默认 'production', 'test' or 'production'
   * @param {Boolean} webpack 是否执行 webpack 流程
   * @param {String} params
   * @param {*} groupCount 静态化页面打包每次分组数量
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span> env <span class="token operator">=</span> <span class="token string">'production'</span><span class="token punctuation">,</span> host <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> webpack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> groupCount <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> secondLang <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_generator <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// Generator  实例</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routerName <span class="token operator">=</span> target <span class="token comment">// 静态化目标路由名称，对应 src/router/routes.js 中的 name</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> params <span class="token comment">// 参数（构建动态路由或者处理页面发布路径用）</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lang <span class="token operator">=</span> lang <span class="token comment">// 国家语言标识</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>secondLang <span class="token operator">=</span> secondLang <span class="token comment">// 国家第二语言标识</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>env <span class="token operator">=</span> env <span class="token comment">// 构建环境</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host <span class="token comment">// 发布服务地址</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webpack <span class="token operator">=</span> webpack <span class="token comment">// 是否需要 webpack 构建</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> config<span class="token punctuation">[</span>env<span class="token punctuation">]</span> <span class="token comment">// 发布路径配置等</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>groupCount <span class="token operator">=</span> groupCount <span class="token comment">// 并发构建数量</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routeList <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../../src/router/routes'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 所有的路由表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderRouteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 当前需要进行 render 的路由表</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 执行生成</span>
  <span class="token keyword">static</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Generator<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 生成 Generator 单例</span>
  <span class="token keyword">static</span> <span class="token function">from</span><span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_generator <span class="token keyword">instanceof</span> <span class="token class-name">Generator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_generator
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_generator
  <span class="token punctuation">}</span>
  <span class="token comment">// 执行静态化生成器</span>
  <span class="token keyword">async</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>routeState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token literal-property property">_ROUTES_NULL</span><span class="token operator">:</span>  <span class="token comment">// 路由表为空</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Route List is Null!'</span><span class="token punctuation">)</span>
          <span class="token keyword">case</span> <span class="token literal-property property">_STATIC_ROUTE</span><span class="token operator">:</span> <span class="token comment">// 静态路由</span>
            <span class="token comment">// 获取当前需要进行 render 静态路由表</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>routeList <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStaticRoutesMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
          <span class="token keyword">case</span> <span class="token literal-property property">_DYNAMIC_ROUTE</span><span class="token operator">:</span> <span class="token comment">// 动态路由</span>
            <span class="token comment">// 获取当前需要进行 render 动态路由表</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>routeList <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDynamicRoutesMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
          <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 路由表长度</span>
        <span class="token keyword">const</span> routeLen <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeList<span class="token punctuation">.</span>length
        <span class="token keyword">if</span> <span class="token punctuation">(</span>routeLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          consola<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 总共 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeLen<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 个静态页面! </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token comment">// 构建服务对象</span>
          <span class="token keyword">const</span> generatePerCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>groupCount <span class="token comment">// 并发构建数量</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> routeLen<span class="token punctuation">;</span> i <span class="token operator">+=</span> generatePerCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> curRouteGroup <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeList<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> generatePerCount<span class="token punctuation">)</span>
            <span class="token comment">// 生成路由</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateGroupRoutes</span><span class="token punctuation">(</span>curRouteGroup<span class="token punctuation">,</span> server<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> generatePerCount <span class="token operator">&gt;=</span> routeLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 静态化页面构建进度: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeLen<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> / </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeLen<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
              consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 所有静态化页面构建已完成!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
              <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; 静态化页面构建进度: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> generatePerCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> / </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeLen<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 获取当前需要进行 render 静态路由表</span>
  <span class="token keyword">async</span> <span class="token function">getStaticRoutesMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 命令行参数没有生命需要进行 render 的路由 name</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;&gt; target is null! 【目标路由名不能为空】'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> routeList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> isTargetRoute <span class="token operator">=</span> cur<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>target <span class="token comment">// 是否命中目标路由</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isTargetRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        prev <span class="token operator">=</span> prev<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> prev
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> routeList
  <span class="token punctuation">}</span>
  <span class="token comment">// 获取当前需要进行 render 动态路由表</span>
  <span class="token keyword">async</span> <span class="token function">getDynamicRoutesMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">/** ********** 生成动态路由表，非框架逻辑 start ***********/</span>
        <span class="token comment">// 调用 createDynamicRoutes 钩子，createDynamicRoutes 钩子通常返回动态路由列表</span>
        <span class="token keyword">let</span> routesList <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callRouteHook</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routerName<span class="token punctuation">,</span> <span class="token string">'createDynamicRoutes'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span>
        <span class="token comment">/** ********** 生成动态路由表，非框架逻辑 end ***********/</span>

        <span class="token comment">// 转化数据接口 [] =&gt; [{}]</span>
        routesList <span class="token operator">=</span> routesList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> item<span class="token punctuation">,</span>
            <span class="token literal-property property">routeState</span><span class="token operator">:</span> _DYNAMIC_ROUTE
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>routesList<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 生成路由表组</span>
  <span class="token keyword">async</span> <span class="token function">generateGroupRoutes</span><span class="token punctuation">(</span><span class="token parameter">routeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> server <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>routeList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateSingleRoute</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">route</span><span class="token operator">:</span> item<span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      consola<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 生成单个路由</span>
  <span class="token keyword">async</span> <span class="token function">generateSingleRoute</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> route<span class="token punctuation">,</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> server <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>server<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Render Object null!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token comment">// render to html, 获取目标路由 html</span>
        <span class="token keyword">let</span> htmlData <span class="token operator">=</span> <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">renderHtml</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> route<span class="token punctuation">.</span>path <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">/** ********** 非框架层面处理函数调用 start **************/</span>
        htmlData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callRouteHook</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routerName<span class="token punctuation">,</span> <span class="token string">'createHtml'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">html</span><span class="token operator">:</span> htmlData<span class="token punctuation">,</span> <span class="token literal-property property">routeName</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>target<span class="token punctuation">,</span> <span class="token literal-property property">routePath</span><span class="token operator">:</span> route<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> targetPagePath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callRouteHook</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routerName<span class="token punctuation">,</span> <span class="token string">'createPublishPath'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">route</span><span class="token operator">:</span> route<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">/** ********** 非框架层面处理函数调用 end **************/</span>

        <span class="token keyword">let</span> routePublishPath <span class="token comment">// html 目录文件（路由发布路径）</span>
        <span class="token keyword">const</span> lang <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secondLang <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lang
        <span class="token keyword">const</span> country <span class="token operator">=</span> lang<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 为了打包到旧项目 html 目录的临时处理</span>
          <span class="token keyword">const</span> langMapPrefixPath <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'my-en'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token string-property property">'id-id'</span><span class="token operator">:</span> <span class="token string">'/id'</span><span class="token punctuation">,</span>
            <span class="token string-property property">'th-th'</span><span class="token operator">:</span> <span class="token string">'/th'</span><span class="token punctuation">,</span>
            <span class="token string-property property">'my-zh'</span><span class="token operator">:</span> <span class="token string">'/my-zh'</span><span class="token punctuation">,</span>
            <span class="token string-property property">'my-my'</span><span class="token operator">:</span> <span class="token string">'/my-my'</span><span class="token punctuation">,</span>
            <span class="token string-property property">'ph-en'</span><span class="token operator">:</span> <span class="token string">'/ph'</span>
          <span class="token punctuation">}</span>
          routePublishPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>langMapPrefixPath<span class="token punctuation">[</span>lang<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>targetPagePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          routePublishPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../../'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span> country<span class="token punctuation">,</span> targetPagePath<span class="token punctuation">)</span> <span class="token comment">// html 目录文件（路由发布路径）</span>
        <span class="token punctuation">}</span>
        fse<span class="token punctuation">.</span><span class="token function">ensureDirSync</span><span class="token punctuation">(</span>routePublishPath<span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">writeFileData</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>routePublishPath<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> htmlData<span class="token punctuation">)</span>
        <span class="token comment">// ora(`&gt;&gt;&gt;&gt; ${targetPagePath} 静态化页面构建完成!`).succeed()</span>
        consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&gt;&gt;&gt;&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>targetPagePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 静态化页面构建完成!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        consola<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 调用路由钩子</span>
  <span class="token keyword">async</span> <span class="token function">callRouteHook</span><span class="token punctuation">(</span>routeName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> hookName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取路由钩子路径，默认存放在 ../../static-addition-config/routeHooks/ 目录下，通过路由名称定义文件名称，文件对外暴露 hookName 方法</span>
      <span class="token keyword">const</span> hookPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../static-addition-config/routeHooks/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fse<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>hookPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//判断是否存在文件，存在则调用路由钩子</span>
        <span class="token keyword">const</span> lifeCycle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../static-addition-config/routeHooks/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> hookObj <span class="token operator">=</span> lifeCycle<span class="token punctuation">.</span>default <span class="token operator">||</span> lifeCycle
        <span class="token comment">// 获取文件指定钩子的函数名称</span>
        <span class="token comment">// eslint-disable-next-line no-prototype-builtins</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hookObj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>hookName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">switch</span> <span class="token punctuation">(</span>hookName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'createDynamicRoutes'</span><span class="token operator">:</span> <span class="token comment">// 调用 createDynamicRoutes 钩子</span>
              <span class="token keyword">return</span> hookObj<span class="token punctuation">.</span><span class="token function">createDynamicRoutes</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">case</span> <span class="token string">'createHtml'</span><span class="token operator">:</span> <span class="token comment">// 调用 createHtml 钩子</span>
              <span class="token keyword">return</span> hookObj<span class="token punctuation">.</span><span class="token function">createHtml</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">||</span> payload<span class="token punctuation">.</span>html
            <span class="token keyword">case</span> <span class="token string">'createPublishPath'</span><span class="token operator">:</span> <span class="token comment">// 调用 createPublishPath 钩子</span>
              <span class="token keyword">return</span> hookObj<span class="token punctuation">.</span><span class="token function">createPublishPath</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">||</span> payload<span class="token punctuation">.</span>route
            <span class="token keyword">default</span><span class="token operator">:</span>
              <span class="token keyword">break</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 其他情况返回原有数据</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>hookName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'createDynamicRoutes'</span><span class="token operator">:</span>
          <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">case</span> <span class="token string">'createHtml'</span><span class="token operator">:</span>
          <span class="token keyword">return</span> payload<span class="token punctuation">.</span>html
        <span class="token keyword">case</span> <span class="token string">'createPublishPath'</span><span class="token operator">:</span>
          <span class="token keyword">return</span> payload<span class="token punctuation">.</span>route
        <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Generator

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br></div></div><blockquote><p>以上代码主要逻辑为：</p> <ol><li>定义 Generator 对象，用于生成路由表；</li> <li>调用 <code>Generator.run</code>  方法时，执行路由静态化生成器：</li> <li>匹配路由状态，获取当前需要进行 render 路由表；
<ul><li>动态路由中调用自定义路由方法钩子函数 <code>createDynamicRoutes</code> 创建路由表；</li> <li>静态路由直接根据路由配置表获取路由；</li></ul></li> <li>路由表分组，生成页面数据；</li> <li>对路由组切片，调用生成单个路由方法 <code>generateSingleRoute</code>；</li> <li>生成单个路由方法时，创建 <code>Server</code> 对象：
<ul><li>调用自定义 <code>createHtml</code> 钩子，生成目标路由的 THML 字符串。</li> <li>调用自定义 <code>createPublishPath</code> 钩子，生成目标路由的 发布路径。</li> <li>获取路由钩子路径，默认存放在 <code>./static-addition-config/routeHooks/</code> 目录下，通过路由名称定义文件名称，文件对外暴露 <code>hookName</code>方法。</li></ul></li> <li>创建 HTML 文件，将 THML 字符串写入并将文件写入到发布路径。</li></ol></blockquote> <h2 id="渲染-html-页面"><a href="#渲染-html-页面" class="header-anchor">#</a> <strong>渲染 HTML 页面</strong></h2> <p>以上生成路由表时，根据路由表创建 <code>Server</code> 对象，用于生成 HTML 字符串。</p> <h3 id="生成-vue-server-render-对象"><a href="#生成-vue-server-render-对象" class="header-anchor">#</a> <strong>生成 vue-server-render 对象</strong></h3> <ul><li><p><code>vue-server-render</code>  对象 <code>serverRender</code> (<code>static-cli/generator/cli-server</code>)</p></li> <li><p>作用： 用于生成 HTML 字符串。</p></li> <li><p>流程：</p> <ul><li>获取打包生成的 <code>vue-ssr-server-bundle.json</code>   和  <code>vue-ssr-client-manifest.json</code> 和模板文件；</li> <li>通过 <code>dist-ssr/vue-ssr-server-bundle.json</code>和 <code>dist-ssr/vue-ssr-client-manifest.json</code>生成 <code>serverRender</code> 对象，同时设置 <code>preload</code>、<code>prefetch</code> 等配置。</li></ul></li> <li><p>注意： 服务端代码静态化时执行，客户端代码浏览器中执行。</p> <ul><li>静态化生成 HTML 文件时，执行的是服务端入口代码 <code>entry-server.js</code> 打包结果；客户端入口代码 <code>entry-client.js</code> 被打包后的文件 <code>app.js</code> 不会执行，而是在浏览器请求到 html  doc 文件后加载后浏览器执行。</li></ul></li></ul> <p><code>Server</code> 对象实际为 <code>vue-server-render</code> 对象，位于 <code>static-cli/generator/cli-server</code> 目录下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../common/util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createBundleRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> getDefaultTDK <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../common/getDefaultTDK'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   *
   * @param {String} lang 语言
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span> env <span class="token operator">=</span> <span class="token string">'production'</span><span class="token punctuation">,</span> secondLang <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this.app = express() </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_server <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// node 服务器对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lang <span class="token operator">=</span> lang <span class="token comment">// 国家语言标识</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>serverBundle <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 使用 webpack 构建 entry-server 获取的服务端资源</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>clientManifest <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 使用 webpack 构建 entry-client 获取的客户端清单资源</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 渲染器对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>secondLang <span class="token operator">=</span> secondLang <span class="token comment">// 国家语言第二语言参数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isProd <span class="token operator">=</span> env <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token comment">// 是否为生产环境</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 开始初始化</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 使用 webpack 构建 entry-server 获取的服务端资源 vue-ssr-server-bundle.json</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>serverBundle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../dist-static/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/vue-ssr-server-bundle.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// 使用 webpack 构建 entry-client 获取的客户端清单资源 vue-ssr-client-manifest.json</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>clientManifest <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../dist-static/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/vue-ssr-client-manifest.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// HTML 模板资源</span>
      <span class="token keyword">const</span> templatePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../../src/index.template.html'</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建渲染器实例</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_createRenderer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>serverBundle<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span> fse<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">clientManifest</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clientManifest<span class="token punctuation">,</span>
        <span class="token function-variable function">shouldPreload</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// https://fetch.spec.whatwg.org/#concept-request-destination</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">shouldPrefetch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">runInNewContext</span><span class="token operator">:</span> <span class="token string">'once'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      consola<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 渲染组件成 HTML 字符串</span>
  <span class="token function">renderHtml</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 没有路由 url 时报错</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Not router render url!'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 获取渲染上下文</span>
      <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token function">getDefaultTDK</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lang<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isProd<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 获取 TDK, SEO 三大关键： title、discription、 key</span>
        <span class="token literal-property property">lang</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">secondLang</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secondLang<span class="token punctuation">,</span>
        url
      <span class="token punctuation">}</span>
      <span class="token comment">// 调用渲染器对象 renderToString 方法将组件渲染成 HTML 字符串</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 返回 HTML 字符串</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建渲染器对象</span>
  <span class="token function">_createRenderer</span><span class="token punctuation">(</span><span class="token parameter">bundle<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createBundleRenderer</span><span class="token punctuation">(</span>bundle<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Server

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><blockquote><p>以上 <code>Server</code> 对象主要逻辑:</p> <ol><li>初始化参数；</li> <li>获取使用 webpack 构建 <code>entry-server.js</code>获取的服务端资源 <code>vue-ssr-server-bundle.json</code> 文件；</li> <li>获取使用 webpack 构建 <code>entry-client.js</code> 获取的客户端清单资源 <code>vue-ssr-client-manifest.json</code> 文件；</li> <li>获取HTML 模板；</li> <li>创建渲染器实例；</li> <li>获取渲染上下文，调用渲染器对象 <code>renderToString</code> 方法将组件渲染成 HTML 字符串；</li> <li>返回 HTML 字符串;</li></ol></blockquote> <h2 id="html-处理"><a href="#html-处理" class="header-anchor">#</a> <strong>HTML 处理</strong></h2> <ul><li><p><strong>HTML 处理时机</strong>：</p> <ul><li>在以上生成路由表过程中，生成单个路由方法时，调用自定义 <code>createHtml</code> 钩子中，在该钩子中开发者自定义对 HTML 进行特殊处理。</li></ul></li> <li><p><strong><code>createHtml</code>钩子</strong>：</p> <ul><li>钩子<code>createHtml</code> 位于<code>/static-addition-config/routeHooks/routeName.js</code> 目录中;</li> <li>输入<code>{ html: ... }</code>；</li> <li>输出 <code>html</code> 字符串数据</li> <li>文件名称对应 <code>routes.js</code> 中的 name</li></ul></li></ul> <p><strong><code>createHtml</code>钩子使用示例：</strong></p> <p>假如在生成 HTML 页面时，同时需要生成 APM 页面，则将 HTML 转化为 APM 时需要删除 <code>script</code> 外链和脚本并添加默认配置；</p> <p>因此在生成  HTML 页面时，可以在 <code>/static-addition-config/routeHooks/routeName.js</code> 目录中 自定义 <code>createHtml</code> 钩子，钩子如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 钩子函数</span>
<span class="token function">createHtml</span><span class="token punctuation">(</span><span class="token punctuation">{</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> routeName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> routePath <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">convertHtmlToAMP</span><span class="token punctuation">(</span><span class="token punctuation">{</span> html<span class="token punctuation">,</span> routeName<span class="token punctuation">,</span> <span class="token literal-property property">ampCustomEleScripts</span><span class="token operator">:</span> NewsAmp<span class="token punctuation">,</span> routePath <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 将 html 转化为 amp（删除 script 外链和脚本，添加默认配置）
 * @param {*} html
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">convertHtmlToAMP</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> routeName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> removeScriptLink <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> inlineCss <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> ampCustomEleScripts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> routePath<span class="token punctuation">,</span> hostType <span class="token operator">=</span> <span class="token string">'main'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.trace('-----convertHtmlToAMP', routeName, isProd, inlineCss)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> allCss <span class="token operator">=</span> <span class="token function">getAllCss</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> inlineCss<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span>

  <span class="token comment">// 【注意，在计算散列时包括前导和后导空白，并且必须与内联脚本中使用的空白精确匹配。】</span>
  <span class="token comment">// https://www.npmjs.com/package/@ampproject/toolbox-script-csp</span>
  <span class="token comment">// 生成脚本 meta hash 值</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> metaHash <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">html</span><span class="token operator">:</span> newHtml <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">generateMetaHash</span><span class="token punctuation">(</span>routeName<span class="token punctuation">,</span> html<span class="token punctuation">)</span>
  <span class="token keyword">const</span> genHtmlByRoute <span class="token operator">=</span> replaceAmpHtmlByRoute<span class="token punctuation">[</span>routeName<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>genHtmlByRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newHtml <span class="token operator">=</span> <span class="token function">genHtmlByRoute</span><span class="token punctuation">(</span>newHtml<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  newHtml <span class="token operator">=</span> newHtml
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;(html[\s\S]+?)&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">$1<span class="token punctuation">,</span> $2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> amp&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 添加 amp 标志</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;style[\s\S]+?&lt;\/style&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// 删除 style 标签</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;link\s*rel=&quot;stylesheet&quot;\s*href=&quot;([\s\S]*?)&quot;&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// 删除 link css 标签</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;link\s+?rel=&quot;preload&quot;[\s\S]+?&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// 删除 preload</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;link\s+?rel=&quot;prefetch&quot;[\s\S]+?&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// 删除 prefetch</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">amp\-template</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'template'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
      <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;\/head&gt;</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 添加 amp 所需内容</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ampCustomEleScripts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> s<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;script async src=&quot;https://cdn.ampproject.org/v0.js&quot;&gt;&lt;/script&gt;
    &lt;meta name=&quot;amp-script-src&quot; content=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>metaHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;
    &lt;style amp-boilerplate&gt;body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}&lt;/style&gt;
    &lt;noscript&gt;&lt;style amp-boilerplate&gt;body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}&lt;/style&gt;&lt;/noscript&gt;
    &lt;style amp-custom type=&quot;text/css&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>allCss<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/style&gt;&lt;/head&gt;</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\!important</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// 删除 !important</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>removeScriptLink<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有生产环境才执行的逻辑</span>
    newHtml <span class="token operator">=</span> newHtml
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;script\s+?src[\s\S]*?&lt;\/script&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// 开发环境不处理外链，生产环境删除外链</span>
      <span class="token comment">// .replace(/&lt;script&gt;window\.__INITIAL_STATE__[\s\S]+?&lt;\/script&gt;/, '') // 删除window.__INITIAL_STATE__的内容</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\&lt;img(.*?)src\=\&quot;(.*?)\&quot;(.*?)\&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">$0<span class="token punctuation">,</span> $1<span class="token punctuation">,</span> $2<span class="token punctuation">,</span> $3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 把img标签转为amp-img</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>$0<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">layout</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;amp-img</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">src=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$3<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;/amp-img&gt;</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;amp-img</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">src=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; layout=&quot;fixed&quot; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$3<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;/amp-img&gt;</span><span class="token template-punctuation string">`</span></span><span class="token comment">// 如果img标签没有指定layout的话主动加上一个layout</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;script&gt;[\s\S]*?&lt;\/script&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// 删除内嵌 script，包括window.__INITIAL_STATE__的内容</span>
    <span class="token comment">// await ampValidator(newHtml, routePath, hostType)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> newHtml
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="页面发布路径处理"><a href="#页面发布路径处理" class="header-anchor">#</a> <strong>页面发布路径处理</strong></h2> <ul><li><p><strong>页面发布路径处理时机</strong>：</p> <ul><li>在以上生成路由表过程中，生成单个路由方法时，调用自定义 <code>createPublishPath</code> 钩子中，在该钩子中开发者自定义对 发布路径进行特殊处理。</li></ul></li> <li><p><strong><code>createPublishPath</code>钩子</strong>：</p> <ul><li>钩子<code>createHtml</code> 位于 <code>/static-addition-config/routeHooks/routeName.js</code> 目录中;</li> <li>输入<code>{ route: ... }</code>；</li> <li>输出新路由 url；</li> <li>文件名称对应 <code>routes.js</code> 中的 name；</li> <li>处理页面发布路径，默认根据路由生成页面发布目录结构。</li></ul></li></ul> <p><strong><code>createPublishPath</code>钩子使用示例：</strong></p> <p>如： 资讯页面路由<code>&quot;/news/how-is-this-possible-proton-x50-is-cheaper-than-taxfree-honda-hrv-7508&quot;</code>，需要将发布路径替换为<code>&quot;/news/7508&quot;</code>并将文件写入到发布路径。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">async</span> <span class="token function">createPublishPath</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> route <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// route: &quot;/news/how-is-this-possible-proton-x50-is-cheaper-than-taxfree-honda-hrv-7508&quot;</span>
    <span class="token keyword">const</span> getNewRouteRes <span class="token operator">=</span> route<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\/[^\/]*\/).*-(\d+)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>getNewRouteRes <span class="token operator">&amp;&amp;</span> getNewRouteRes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> getNewRouteRes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// newRoute: &quot;/news/7508&quot;</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>getNewRouteRes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>getNewRouteRes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> route
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="写进文件"><a href="#写进文件" class="header-anchor">#</a> <strong>写进文件</strong></h2> <ul><li>写进根目录下的 <code>/html</code> 文件中。</li></ul> <h2 id="打包后的-html-目录结构"><a href="#打包后的-html-目录结构" class="header-anchor">#</a> <strong>打包后的 html 目录结构</strong></h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>html        
|───page1
|     └───index.html
|───page2
|      └───index.html
|───...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="上传静态资源到-s3"><a href="#上传静态资源到-s3" class="header-anchor">#</a> <strong>上传静态资源到 S3</strong></h2> <p>完成页面渲染后，最后一步将静态资源上传到 S3。</p> <p>根据 S3 标志，将打包的静态资源上传到对应的 S3 Bucket。</p> <blockquote><ul><li>S3 是什么？</li></ul> <p>Amazon S3（Simple Storage Service）是亚马逊Web Services（AWS）提供的一项云存储服务。它是一个高度可扩展的对象存储服务，用于在互联网上存储和检索任意数量的数据。</p> <p>Amazon S3的主要用途和解决的问题包括：</p> <ol><li><strong>数据存储和备份</strong>：S3为各种应用程序提供了一种可靠、安全和可扩展的数据存储解决方案。无论是用于存档、备份还是主存储，S3都能满足需求。</li> <li><strong>内容分发</strong>：S3与Amazon CloudFront集成，可以提供快速、高效的内容分发，适用于网站、移动应用程序和其他数字内容分发场景。</li> <li><strong>数据共享和协作</strong>：通过S3的访问控制和预签名URL功能，可以轻松地在团队或组织之间共享数据，同时保持对数据的精细控制。</li> <li><strong>数据保护和恢复</strong>：S3提供了数据冗余、加密、版本控制等功能，以确保数据的安全性和可恢复性。</li></ol> <p>在此处主要使用 S3 的内容分发 CDN 服务。</p> <ul><li>内容分发网络（CDN）是一种网络架构，用于将网站的内容（如HTML页面、图片、JavaScript文件、CSS文件等）分发到全球各地的服务器上。当用户访问网站时，他们会从离自己最近的服务器上获取内容，从而加快网站的加载速度，提高用户体验。</li></ul></blockquote> <p>上传到 S3 的脚本位于 <code>./static-cli/s3/cli-s3.js</code> 目录下，该文件对外暴露 <code>uploadToS3</code> 方法，调用该方法将指定目录静态资源上传到 S3：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> s3 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'s3'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> consola <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consola'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>

<span class="token comment">// https://www.npmjs.com/package/s3</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> s3<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">maxAsyncS3</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// this is the default</span>
  <span class="token literal-property property">s3RetryCount</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// this is the default</span>
  <span class="token literal-property property">s3RetryDelay</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// this is the default</span>
  <span class="token literal-property property">s3Options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">accessKeyId</span><span class="token operator">:</span> <span class="token string">'accessKeyId'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">secretAccessKey</span><span class="token operator">:</span> <span class="token string">'secretAccessKey'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token string">'region'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">uploadToS3Handle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span> s3 <span class="token operator">=</span> <span class="token string">'test'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">deleteRemoved</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// default false, whether to remove s3 objects that have no corresponding local file.</span>
      <span class="token literal-property property">localDir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../dist-static/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 本地资源路径</span>
      <span class="token literal-property property">s3Params</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
        <span class="token literal-property property">Bucket</span><span class="token operator">:</span> s3 <span class="token operator">===</span> <span class="token string">'test'</span> <span class="token operator">?</span> <span class="token string">'test-cdn-car-static'</span> <span class="token operator">:</span> <span class="token string">'cdn-car-static'</span><span class="token punctuation">,</span>  <span class="token comment">// S3 文件目录</span>
        <span class="token literal-property property">Prefix</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 文件前缀</span>
        <span class="token constant">ACL</span><span class="token operator">:</span> <span class="token string">'public-read'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> uploader <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">uploadDir</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    uploader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    uploader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">uploadToS3</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang <span class="token operator">=</span> <span class="token string">'my-en'</span><span class="token punctuation">,</span> s3 <span class="token operator">=</span> <span class="token string">'test'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spinnerBuild <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;&gt; S3 uploading...\n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">uploadToS3Handle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lang<span class="token punctuation">,</span> s3 <span class="token punctuation">}</span><span class="token punctuation">)</span>
      spinnerBuild<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      consola<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;&gt; 静态资源上传到 s3 完成!'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      spinnerBuild<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      spinnerBuild<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="typescript-支持"><a href="#typescript-支持" class="header-anchor">#</a> <strong>TypeScript 支持</strong></h2> <ul><li>项目支持 typescript，基于<a href="https://github.com/kaorun343/vue-property-decorator#readme" target="_blank" rel="noopener noreferrer">vue-property-decorator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ul> <h2 id="amp"><a href="#amp" class="header-anchor">#</a> <strong>AMP</strong></h2> <h3 id="本地开发"><a href="#本地开发" class="header-anchor">#</a> <strong>本地开发</strong></h3> <p>本地服务器访问链接携带 <code>?ampRouteName=***</code>参数，<code>#development=1</code> 忽略以下 AMP 报错：</p> <ul><li><code>CSS syntax error in tag 'style amp-custom'</code></li> <li><code>Custom JavaScript is not allowed.</code></li></ul> <p>在<code>/static-addition-config/routeHooks/routeName.js</code>*中的钩子 <code>createHtml</code>进行处理，将 HTML 数据转化为 AMP。</p> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> <strong>其他</strong></h2> <ul><li>接口请求：跟登录态相关的接口请求，放 mounted 处理。</li> <li>vscode 配置：安装 ESLint 插件，保存自动格式化。</li></ul> <h2 id="开发"><a href="#开发" class="header-anchor">#</a> <strong>开发</strong></h2> <h3 id="接口"><a href="#接口" class="header-anchor">#</a> <strong>接口</strong></h3> <ul><li><p>跟登录态相关的接口请求，放 mounted 处理；</p></li> <li><p>在 <code>src/api</code> 下新建文件，管理接口。</p></li></ul> <h3 id="多语言"><a href="#多语言" class="header-anchor">#</a> <strong>多语言</strong></h3> <p>默认 my-en。</p> <p>当需要新增多语言时，在 package.json 下添加脚本命令，如添加 th-th:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span> 
    <span class="token property">&quot;build:th-th:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf dist-ssr &amp;&amp; npm run build:th-th:client:test &amp;&amp; npm run build:th-th:server:test&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:th-th:client:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development PAGE_LANG=th-th webpack --config build/webpack.client.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:th-th:server:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development PAGE_LANG=th-th webpack --config build/webpack.server.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf dist-ssr &amp;&amp; npm run build:th-th:client &amp;&amp; npm run build:th-th:server&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:th-th:client&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production PAGE_LANG=th-th webpack --config build/webpack.client.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:th-th:server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production PAGE_LANG=th-th webpack --config build/webpack.server.config.js --progress --hide-modules&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env WEBPACK_TYPE=LOCAL_DEV node server --PAGE_LANG=th-th&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:th-th&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production node server --PAGE_LANG=th-th&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="amp-2"><a href="#amp-2" class="header-anchor">#</a> <strong>AMP</strong></h3> <ol><li><p>在 <code>/static-addition-config/routeHooks/routeName.js</code>  中的钩子 <code>createHtml</code> 进行处理，调用 <code>/static-addition-config/common/convertHtmlToAMP.js</code> 将 HTML 数据转化为 AMP。该函数输入 <code>{ html: ... }</code> ，输出 html 数据。（文件名称对应 routes.js 中的 name）</p></li> <li><p>本地服务器访问链接携带 <code>?ampRouteName=**</code> 参数，<code>#development=1</code> 忽略以下 AMP 报错：</p></li></ol> <ul><li><p><code>CSS syntax error in tag 'style amp-custom'</code></p></li> <li><p><code>Custom JavaScript is not allowed.</code></p></li></ul> <ol start="3"><li>AMP 的自定义脚本在 <code>/script-amp/</code>  目录中。目录结构为：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>routeName
|───script01.js
|───script03js
|───...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="规范"><a href="#规范" class="header-anchor">#</a> <strong>规范</strong></h3> <ul><li><p>组件命名：大驼峰</p></li> <li><p>使用 typescript。如果是 vue 组件或者页面<code>&lt;script lang=&quot;ts&quot;&gt;&lt;/script&gt;</code>，添加<code>lang=&quot;ts&quot;</code>标签属性；</p></li> <li><p>减少使用魔术数字，用常量或者枚举类型替代。</p></li></ul> <h3 id="其他-2"><a href="#其他-2" class="header-anchor">#</a> <strong>其他</strong></h3> <ul><li>vscode 配置：安装 ESLint 插件，保存自动格式化。</li></ul> <h3 id="静态化"><a href="#静态化" class="header-anchor">#</a> <strong>静态化</strong></h3> <h3 id="命令"><a href="#命令" class="header-anchor">#</a> <strong>命令</strong></h3> <p>S3 测试服链接：<code>npm run generate -- --target=routeName --params=** --lang=** --env=** --webpack=true</code></p> <p>S3 正式服链接：<code>npm run generate:s3 -- --target=routeName --params=** --lang=** --env=** --webpack=true</code></p> <p>【注意格式：<code>npm run generate -- 参数</code>】</p> <ul><li><p>target：静态化目标路由名称，对应 <code>src/router/routes.js</code> 中的 name 字段（webpackChunkName 不可省略）</p></li> <li><p>params：静态化静态路由可不传。用于静态化动态路由生成路由表的时候使用。</p></li> <li><p>lang：语言，默认 my-en。格式：国家-语言。</p></li> <li><p>env：环境，test 或者 production，默认 production，用于区别接口请求域名。</p></li> <li><p>webpack：是否执行 webpack 生成 dist-ssr 目录。默认 true，不执行 webpack 值为 false 或者 0。</p></li></ul> <h3 id="生成路由表-3"><a href="#生成路由表-3" class="header-anchor">#</a> <strong>生成路由表</strong></h3> <ul><li><p>静态路由表：根据路由文件 routes.js 中的 path 生成文件目录结构。</p></li> <li><p>动态路由表：根据 <code>/static-addition-config/routeHooks/routeName.js</code> 中的钩子  createDynamicRoutes 进行更改。输入：{  params: ... }，输出：路由表数组。【动态路由的接口请求统一使用全局唯一的接口管理 src/api 目录下的接口】</p></li></ul> <h3 id="amp-3"><a href="#amp-3" class="header-anchor">#</a> <strong>AMP</strong></h3> <p>在 <code>/static-addition-config/routeHooks/routeName.js</code>  中的钩子 createHtml 进行处理，调用 <code>/static-addition-config/common/convertHtmlToAMP.js</code> 将 HTML 数据转化为 AMP。该函数输入 <code>{ html: ... }</code> ，输出 html 数据。（文件名称对应 routes.js 中的 name）</p> <h3 id="页面发布路径处理-2"><a href="#页面发布路径处理-2" class="header-anchor">#</a> <strong>页面发布路径处理</strong></h3> <p>处理页面发布路径，默认根据路由生成页面发布目录结构。如果需要更改，在 <code>/static-addition-config/routeHooks/routeName.js</code> 中的钩子 createPublishPath 进行处理，该函数输入<code>{ route: ... }</code> ，输出新路由 url。（文件名称对应 routes.js 中的 name）</p> <h3 id="上传静态资源到-s3-2"><a href="#上传静态资源到-s3-2" class="header-anchor">#</a> <strong>上传静态资源到 S3</strong></h3> <p><code>npm run deploy-s3</code> 或者 <code>node deployS3.js</code></p> <p>参数说明：</p> <ul><li><code>--lang</code>：语言</li> <li><code>--env</code>：S3 正测服对应的 Bucket</li></ul> <h2 id="说明"><a href="#说明" class="header-anchor">#</a> <strong>说明</strong></h2> <ul><li>项目思想参照 nuxt 思想和 ssr 项目思想</li></ul> <h3 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> <strong>参考资料</strong></h3> <p><a href="https://github.com/Sewar-x/SSG-Demo" target="_blank" rel="noopener noreferrer">Sewar-x/SSG-Demo: 《从零到一搭建移动端SSG项目实践》| Sewen 博客 示例项目，项目仅作学习使用 (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/nuxt/nuxt.js/blob/dev/packages/generator/src/generator.js" target="_blank" rel="noopener noreferrer">Nuxt源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/vuejs/vue-hackernews-2.0" target="_blank" rel="noopener noreferrer">SSR 源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">February 7, 2024 11:23</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 596777598@qq.com" class="contributor">
          sewar
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/myblog/assets/js/app.9d2b617a.js" defer></script><script src="/myblog/assets/js/layout-Layout.d2d4ce64.js" defer></script><script src="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js" defer></script><script src="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" defer></script>
  </body>
</html>
