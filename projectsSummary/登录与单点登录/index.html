<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>登录 | Sewen 博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="./mylogo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="manifest" href="/myblog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="alternate" type="application/atom+xml" href="https://sewar-x.github.io/myblog/atom.xml" title="Sewen 博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://sewar-x.github.io/myblog/rss.xml" title="Sewen 博客 RSS Feed">
    <meta name="description" content="sewen 的前端学习笔记、博客、前端基础总结、技术深度剖析、面试题总结、算法总结、项目过程总结">
    <meta property="og:url" content="https://sewar-x.github.io/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95.html">
    <meta property="og:site_name" content="Sewen 博客">
    <meta property="og:title" content="登录">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.645fbc6f.css" as="style"><link rel="preload" href="/myblog/assets/js/app.9d2b617a.js" as="script"><link rel="preload" href="/myblog/assets/js/layout-Layout.d2d4ce64.js" as="script"><link rel="preload" href="/myblog/assets/js/page-登录.bb830451.js" as="script"><link rel="preload" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" as="script"><link rel="prefetch" href="/myblog/assets/js/199.a9216960.js"><link rel="prefetch" href="/myblog/assets/js/200.4c66fc79.js"><link rel="prefetch" href="/myblog/assets/js/layout-Blog.1fca7e90.js"><link rel="prefetch" href="/myblog/assets/js/layout-NotFound.3c74e8aa.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/AlgoliaSearch/Dropdown.70fcebe7.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Anchor.3235541c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleInfo.7b815b20.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleItem.b0e177e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleList.d1cf1b24.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ArticleType.b630b80e.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHero.621312ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogHome.4fe44489.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogInfo.b2a94760.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BlogPage.e0fbe820.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/BloggerInfo.0df38355.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/CategoryList.ec1bcd96.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/ProjectList.8550a110.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TagList.bcf7b782.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/Timeline.b6cf5471.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Blog/TimelineList.3c6e08a6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Clipboard.e940a903.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Common.820a8694.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Home.70383986.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/MyTransition.0de46069.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/DropdownLink.e3f6c118.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLink.93b11770.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/NavLinks.8ba214e6.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/Navbar.b90a94f9.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/RepoLink.663a7f55.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Navbar/SidebarButton.76b0035a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Page.98b5d09c.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageFooter.20bc9bd8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageMeta.b7e6b12f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/PageNav.8305dd1f.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Password.45e0e82a.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/DropdownTransition.068c5eea.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/Sidebar.f6f90d52.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarDropdownLink.505127a8.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarGroup.7eecf370.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarLink.6e39fe32.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Sidebar/SidebarNavLinks.0f8566cb.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/DarkmodeSwitch.20ac7b92.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeColor.6086e4ed.js"><link rel="prefetch" href="/myblog/assets/js/layout-components/Theme/ThemeOptions.483238c9.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ArticleIcon.0a22e2b1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/AutoIcon.2ff1c790.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/BookIcon.419b49ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/DarkIcon.7d81873b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EditIcon.8ada485d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/EmptyIcon.d704a5cf.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/I18nIcon.ffad8b3e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LightIcon.47d807da.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LinkIcon.1a8a7826.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/LockIcon.a29a2b79.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/NextIcon.0214ee59.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/Page404Icon.8bc1ebbb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PresentationIcon.17500d9b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/PrevIcon.2ae04a70.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/ProjectIcon.b336d567.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/StickyIcon.0f509b9d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Baidu.244b9a41.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Bitbucket.11ba94e1.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dingding.e8a3d90d.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Discord.3295a55b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Dribbble.464dac3b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Email.f9254caa.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Evernote.991472fb.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Facebook.08e78e47.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Flipboard.a1124d0f.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitee.c44bc20a.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Github.5667e5ae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gitlab.ad95c7a7.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Gmail.b5acc6bc.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Instagram.56be85f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Lines.d9db3dce.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Linkedin.b82d8d8b.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pinterest.0f3ffe71.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Pocket.41ef3c92.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/QQ.7558f4ba.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Qzone.bf658fae.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Reddit.9c4c95ee.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Rss.9780139e.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Steam.06abbae2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Twitter.26fa5bda.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Wechat.9cac8c4c.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Weibo.5206a632.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Whatsapp.0738f1e3.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Youtube.f41fd7f2.js"><link rel="prefetch" href="/myblog/assets/js/layout-icons/media/Zhihu.4d851d2f.js"><link rel="prefetch" href="/myblog/assets/js/page--0abc50bf.0d6f1484.js"><link rel="prefetch" href="/myblog/assets/js/page--1cd40f4c.dd76c7b3.js"><link rel="prefetch" href="/myblog/assets/js/page--53f93199.e80bdec8.js"><link rel="prefetch" href="/myblog/assets/js/page--5afd2fd0.adea4e92.js"><link rel="prefetch" href="/myblog/assets/js/page--67c584d3.0a3f3cd9.js"><link rel="prefetch" href="/myblog/assets/js/page--776a8506.cdf48aac.js"><link rel="prefetch" href="/myblog/assets/js/page-CSS.eb94b29f.js"><link rel="prefetch" href="/myblog/assets/js/page-Chrome开发工具使用指南.a2675120.js"><link rel="prefetch" href="/myblog/assets/js/page-DevServer.0281863d.js"><link rel="prefetch" href="/myblog/assets/js/page-Echarts二次封装.4387b8ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Elementui与Element-plusui二次封装.82f12a09.js"><link rel="prefetch" href="/myblog/assets/js/page-Git基础.03c616ad.js"><link rel="prefetch" href="/myblog/assets/js/page-Git规范.e2fdc38a.js"><link rel="prefetch" href="/myblog/assets/js/page-HTML.1e3c14b9.js"><link rel="prefetch" href="/myblog/assets/js/page-Home.f0b7e772.js"><link rel="prefetch" href="/myblog/assets/js/page-JSON配置化组件二次封装.12060fd9.js"><link rel="prefetch" href="/myblog/assets/js/page-JS原理实现.3c427e19.js"><link rel="prefetch" href="/myblog/assets/js/page-JS应用题.3d313b34.js"><link rel="prefetch" href="/myblog/assets/js/page-JavaScript基础.551be887.js"><link rel="prefetch" href="/myblog/assets/js/page-Linux.c6159ebd.js"><link rel="prefetch" href="/myblog/assets/js/page-Loader和Plugin原理.b2971b76.js"><link rel="prefetch" href="/myblog/assets/js/page-MySQL.0b1d704a.js"><link rel="prefetch" href="/myblog/assets/js/page-NPM.a55851b2.js"><link rel="prefetch" href="/myblog/assets/js/page-Node.ec405a21.js"><link rel="prefetch" href="/myblog/assets/js/page-Nodejs常见问题集合.12844e69.js"><link rel="prefetch" href="/myblog/assets/js/page-Node性能优化.b4ea1c34.js"><link rel="prefetch" href="/myblog/assets/js/page-Promise专题.7869a31b.js"><link rel="prefetch" href="/myblog/assets/js/page-React.d76cf0ac.js"><link rel="prefetch" href="/myblog/assets/js/page-SSG移动端项目实践.2122615b.js"><link rel="prefetch" href="/myblog/assets/js/page-TypeScript.4f597fda.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite.637881bf.js"><link rel="prefetch" href="/myblog/assets/js/page-Vite原理解析.6677fdb4.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue25项目webpack构建分析.7bbea0fa.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2VsVue3.10be4140.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue2x原理源码分析.e9e753b6.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3基础.210247ff.js"><link rel="prefetch" href="/myblog/assets/js/page-Vue3源码分析.17379e04.js"><link rel="prefetch" href="/myblog/assets/js/page-VueCli源码分析.afc3c83f.js"><link rel="prefetch" href="/myblog/assets/js/page-VueRouter原理分析.0a092eb6.js"><link rel="prefetch" href="/myblog/assets/js/page-VueSSR原理分析.63006040.js"><link rel="prefetch" href="/myblog/assets/js/page-VueVsReact.2156be28.js"><link rel="prefetch" href="/myblog/assets/js/page-Vuex原理分析.5ba3e6e4.js"><link rel="prefetch" href="/myblog/assets/js/page-WEB安全.5aa0eeef.js"><link rel="prefetch" href="/myblog/assets/js/page-WebPack构建原理.9c29703e.js"><link rel="prefetch" href="/myblog/assets/js/page-webpackAPI分析.4c8b152b.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack优化.dcc6c3bc.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack基础.3820ee6c.js"><link rel="prefetch" href="/myblog/assets/js/page-webpack项目实践.77e22417.js"><link rel="prefetch" href="/myblog/assets/js/page-一次后台管理系统的性能优化.7c2d8712.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建SSR项目.855376fc.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue2项目和规范设计.93017fd2.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建Vue3单页面应用.de152d54.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建公共组件库.93278073.js"><link rel="prefetch" href="/myblog/assets/js/page-从零到一搭建移动端SSG项目.9c113d06.js"><link rel="prefetch" href="/myblog/assets/js/page-使用docker部署Node服务.5cf328fd.js"><link rel="prefetch" href="/myblog/assets/js/page-分治.e3dfc22d.js"><link rel="prefetch" href="/myblog/assets/js/page-前端发版静态资源404问题.9eb1ca89.js"><link rel="prefetch" href="/myblog/assets/js/page-前端存储.cd82cf54.js"><link rel="prefetch" href="/myblog/assets/js/page-前端工程化.1e6e58d0.js"><link rel="prefetch" href="/myblog/assets/js/page-前端性能优化方案.83718d22.js"><link rel="prefetch" href="/myblog/assets/js/page-前端架构实践.171dbc0f.js"><link rel="prefetch" href="/myblog/assets/js/page-前端渲染架构.3b783de8.js"><link rel="prefetch" href="/myblog/assets/js/page-前端自动部署.5076846c.js"><link rel="prefetch" href="/myblog/assets/js/page-前端部署原理.82ecd8a7.js"><link rel="prefetch" href="/myblog/assets/js/page-动态规划.a3af92f1.js"><link rel="prefetch" href="/myblog/assets/js/page-哈希表.c76000e8.js"><link rel="prefetch" href="/myblog/assets/js/page-回溯算法.cd914c32.js"><link rel="prefetch" href="/myblog/assets/js/page-图.dfd9828a.js"><link rel="prefetch" href="/myblog/assets/js/page-基础.7bf5a37b.js"><link rel="prefetch" href="/myblog/assets/js/page-堆.4657e538.js"><link rel="prefetch" href="/myblog/assets/js/page-字符串.252f2a08.js"><link rel="prefetch" href="/myblog/assets/js/page-异步编程.904f4c65.js"><link rel="prefetch" href="/myblog/assets/js/page-性能优化指标和监控.f2175836.js"><link rel="prefetch" href="/myblog/assets/js/page-排序算法.c7a51b99.js"><link rel="prefetch" href="/myblog/assets/js/page-搭建低代码平台.19eaf5ec.js"><link rel="prefetch" href="/myblog/assets/js/page-操作系统.473c4281.js"><link rel="prefetch" href="/myblog/assets/js/page-数学运算.c82748fb.js"><link rel="prefetch" href="/myblog/assets/js/page-数据结构算法.84480586.js"><link rel="prefetch" href="/myblog/assets/js/page-数组.692b0d0a.js"><link rel="prefetch" href="/myblog/assets/js/page-权限管理.c7e10db0.js"><link rel="prefetch" href="/myblog/assets/js/page-查找.790e52df.js"><link rel="prefetch" href="/myblog/assets/js/page-栈和队列.8dbc3586.js"><link rel="prefetch" href="/myblog/assets/js/page-树.24efdeaa.js"><link rel="prefetch" href="/myblog/assets/js/page-浏览器.bee9ec04.js"><link rel="prefetch" href="/myblog/assets/js/page-混合桌面应用开发.9e10d1c3.js"><link rel="prefetch" href="/myblog/assets/js/page-目录.c85b4d0b.js"><link rel="prefetch" href="/myblog/assets/js/page-移动端开发.56ac22ec.js"><link rel="prefetch" href="/myblog/assets/js/page-组件和组件封装.b5e86da2.js"><link rel="prefetch" href="/myblog/assets/js/page-计算机网络基础.0a106662.js"><link rel="prefetch" href="/myblog/assets/js/page-设计模式.ffdc7cfd.js"><link rel="prefetch" href="/myblog/assets/js/page-调试技巧.485ae36e.js"><link rel="prefetch" href="/myblog/assets/js/page-贪心算法.0f417640.js"><link rel="prefetch" href="/myblog/assets/js/page-输入url到页面展示全过程.510aef2e.js"><link rel="prefetch" href="/myblog/assets/js/page-递归.5e55e552.js"><link rel="prefetch" href="/myblog/assets/js/page-链表.1cf6927f.js"><link rel="prefetch" href="/myblog/assets/js/page-项目总结.ffcd2a4b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~docsearch.f3877d0d.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~5d377965.d9712593.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-components/Blog/ArticleItem~layout-components/Blog/ArticleL~b56f3aac.47bb5cb5.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-NotFound~layout-components/Common~layout-components/Page.57d58db9.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-Slide.81546b3b.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/AlgoliaSearch/Full.b30f067a.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Blog/BlogPage.bcccbd38.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Navbar/Navbar.e2a7361e.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Page.6c65077c.js"><link rel="prefetch" href="/myblog/assets/js/vendors~layout-components/Sidebar/Sidebar.34cd9cf7.js"><link rel="prefetch" href="/myblog/assets/js/vendors~photo-swipe.428df1da.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.645fbc6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/myblog/" class="home-link router-link-active"><img src="./mylogo.png" alt="Sewen 博客" class="logo"> <!----> <span class="site-name can-hide">Sewen 博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
        前端基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
        计算机基础
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
        框架和源码分析
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
        浏览器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
        服务器
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
        性能优化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
        前端工程
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
        项目实践
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
        项目搭建
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><a href="/myblog/projectsSummary/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="./mylogo.png" class="avatar round"> <div property="name" class="name">Sewen 博客</div> <meta property="url" content="../outline.md"></div> <div class="num-wrapper"><div><div class="num">91</div> <div>Articles</div></div> <div><div class="num">0</div> <div>Category</div></div> <div><div class="num">0</div> <div>Tags</div></div> <div><div class="num">91</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="https://github.com/Sewar-x/myblog" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a><a href="1567910907" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up" class="media-link"><span class="sr-only">Wechat</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E"></circle> <path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#FFF"></path> <path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="Front-end Basics" class="dropdown-title"><span class="title"><!---->
      前端基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/css/" class="nav-link"><!---->
  Css
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/javascript/" class="nav-link"><!---->
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/typescript/" class="nav-link"><!---->
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title"><!---->
      计算机基础
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/algorithms/" class="nav-link"><!---->
  数据结构和算法
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/network/" class="nav-link"><!---->
  计算机网络/HTTP
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/network/输入url到页面展示全过程/" class="nav-link"><!---->
  输入url到页面展示全过程
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/operating-system/" class="nav-link"><!---->
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/design-model/" class="nav-link"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Web-Security/" class="nav-link"><!---->
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="框架和源码分析" class="dropdown-title"><span class="title"><!---->
      框架和源码分析
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/vue/Vue2原理和源码分析.html" class="nav-link"><!---->
  Vue 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/React/" class="nav-link"><!---->
  React 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/webpack/webpack构建原理.html" class="nav-link"><!---->
  webpack 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/vite/" class="nav-link"><!---->
  vite 专题
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/axios/" class="nav-link"><!---->
  Axios 专题
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器" class="dropdown-title"><span class="title"><!---->
      浏览器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/browser/浏览器原理/" class="nav-link"><!---->
  浏览器原理
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/browser/前端缓存和存储/" class="nav-link"><!---->
  前端缓存和存储
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/前端调试技巧/" class="nav-link"><!---->
  前端调试技巧
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="node.js" class="dropdown-title"><span class="title"><!---->
      服务器
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/node/" class="nav-link"><!---->
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/linux/" class="nav-link"><!---->
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/docker/" class="nav-link"><!---->
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="浏览器和性能优化" class="dropdown-title"><span class="title"><!---->
      性能优化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/性能优化指标和监控/" class="nav-link"><!---->
  性能优化指标和监控
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/前端性能优化方案/" class="nav-link"><!---->
  前端性能优化方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/performance/一次管理后台的渲染优化/" class="nav-link"><!---->
  一次管理后台的渲染优化
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端工程" class="dropdown-title"><span class="title"><!---->
      前端工程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/前端工程化/" class="nav-link"><!---->
  前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/前端渲染架构/" class="nav-link"><!---->
  前端渲染架构
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/前端架构实践/" class="nav-link"><!---->
  前端架构实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/Front-end-Engineering/npm/" class="nav-link"><!---->
  npm
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectDeploy/自动构建和部署/" class="nav-link"><!---->
  自动构建和部署
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目实践" class="dropdown-title"><span class="title"><!---->
      项目实践
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectDeploy/" class="nav-link"><!---->
  前端部署
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/componentsEncapsulation/组件和组件封装实践.html" class="nav-link"><!---->
  组件和组件封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/登录与单点登录/" class="nav-link"><!---->
  登录与单点登录
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/权限管理方案实践/" class="nav-link"><!---->
  权限管理方案实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/Echarts二次封装实践/" class="nav-link"><!---->
  Echarts二次封装实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/文档在线预览和编辑方案/" class="nav-link"><!---->
  文档在线预览和编辑方案
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/移动端开发实践/" class="nav-link"><!---->
  移动端开发实践
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目搭建到原理分析" class="dropdown-title"><span class="title"><!---->
      项目搭建
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建SSR项目/" class="nav-link"><!---->
  从零到一搭建SSR项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建移动端SSG项目/" class="nav-link"><!---->
  从零到一搭建移动端SSG项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/移动端SSG项目实践/" class="nav-link"><!---->
  移动端SSG项目实践
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue2工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue2工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/从零到一搭建Vue3工程化项目/" class="nav-link"><!---->
  从零到一搭建Vue3工程化项目
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/搭建低代码平台/" class="nav-link"><!---->
  搭建低代码平台
</a></li><li class="dropdown-item"><!----> <a href="/myblog/projectsSummary/projectsSummary/混合桌面应用开发实践/" class="nav-link"><!---->
  混合桌面应用开发实践
</a></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <!----> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/myblog/projectsSummary/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">项目总结</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">登录</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">登录</span></h1> <div class="page-info"><!----> <true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info><true-info defaultAuthor="" categoryPath="/category/$category/" tagPath="/tag/$tag/"></true-info></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#登录" class="anchor-link heading2"><div>登录</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#jwt-鉴权机制" class="anchor-link heading2"><div>JWT 鉴权机制</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#概念" class="anchor-link heading3"><div>概念</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#令牌验证过程" class="anchor-link heading3"><div>令牌验证过程</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#jwt-优点" class="anchor-link heading3"><div>JWT 优点</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#为什么使用-jwt" class="anchor-link heading3"><div>为什么使用 JWT？</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#使用流程" class="anchor-link heading3"><div>使用流程</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#node-token-中间件" class="anchor-link heading3"><div>Node Token 中间件</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#前端如何保存-token" class="anchor-link heading3"><div>前端如何保存 Token?</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#token-更新流程" class="anchor-link heading3"><div>Token 更新流程</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#单点登录" class="anchor-link heading2"><div>单点登录</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#概念-2" class="anchor-link heading3"><div>概念</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#为什么要用单点登录" class="anchor-link heading3"><div>为什么要用单点登录?</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#单点登录实现" class="anchor-link heading3"><div>单点登录实现</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#单点登录-认证中心实现" class="anchor-link heading3"><div>单点登录-认证中心实现</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#使用-node-实现单点登录" class="anchor-link heading3"><div>使用 Node 实现单点登录</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#登录-单点登录实现" class="anchor-link heading3"><div>登录+单点登录实现</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#单设备登录" class="anchor-link heading2"><div>单设备登录</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#使用数据库记录登录状态" class="anchor-link heading3"><div>使用数据库记录登录状态</div></a></li><li class="anchor"><a href="/myblog/projectsSummary/%E7%99%BB%E5%BD%95%E4%B8%8E%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/#使用-token-令牌验证机制" class="anchor-link heading3"><div>使用 Token 令牌验证机制</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="登录"><a href="#登录" class="header-anchor">#</a> 登录</h2> <h2 id="jwt-鉴权机制"><a href="#jwt-鉴权机制" class="header-anchor">#</a> JWT 鉴权机制</h2> <p><img src="/myblog/assets/img/JWT鉴权机制.64ad675a.png" alt="image-20231216165846706"></p> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>JWT（JSON Web Token）是一种开放标准（RFC 7519），用于在网络应用间传递信息的一种方式。它是一种基于JSON的轻量级、自包含的安全令牌，用于在客户端和服务器之间进行身份验证和授权。</p> <p>JWT由三部分组成：头部（Header）、载荷（Payload）和签名（Signature）。</p> <ul><li><p>头部（Header）：描述JWT的元数据和签名算法。</p> <ul><li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>  <span class="token string-property property">&quot;alg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JWT&quot;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><ul><li><code>alg</code>: 声明算法类型</li></ul> <p>因为 JWT 是字符串，还需要对 JWT 进行 base64 编码，最终为一串字符串：</p> <p><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</code></p></blockquote></li></ul></li> <li><p>载荷（Payload）：包含要传递的信息，如用户身份、权限等。</p> <ul><li><p>载荷即消息体， 这里会存放实际的内容， 也就是 token 的数据声明 ，例如用户的 id 和 name，默认情况下也会携带令牌的签发时间 iat，还可以设置过期时间</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;sub&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;iat&quot;</span><span class="token operator">:</span> <span class="token number">1516239022</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>同样会进行 base64 编码，生成字符串：<code>eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ</code></p></blockquote></li></ul></li> <li><p>签名（Signature）：使用密钥对头部和载荷进行签名，用于验证JWT的真实性和完整性。</p> <ul><li>公式：<code>Signature = HMACSHA256(base64Url(header)+.+base64Url(payload),secretKey)</code></li> <li>一旦前面两部分数据被篡改，只要服务器加密用的密钥没有泄露，得到的签名肯定和之前的签名不 一致。</li></ul></li></ul> <h3 id="令牌验证过程"><a href="#令牌验证过程" class="header-anchor">#</a> 令牌验证过程</h3> <p>当应用系统使用 JWT 作为令牌格式进行验证时，需要以下参数来验证JWT令牌的有效性：</p> <ol><li><strong>令牌本身</strong>（Token）： 应用系统需要接收到从前端传递过来的JWT令牌，通常作为HTTP请求头的一部分（例如，Authorization头）或作为请求参数的一部分。</li> <li><strong>公钥或共享密钥</strong>（Public Key/Shared Key）： 应用系统需要拥有与JWT令牌进行签名验证所需的公钥或共享密钥。这个密钥是在JWT令牌生成的过程中由发行令牌的身份提供者生成的。</li> <li><strong>签名算法</strong>（Signing Algorithm）： 应用系统需要知道用于JWT令牌签名的算法，以正确验证签名。常见的签名算法包括HMAC（基于共享密钥）和RSA（基于公钥/私钥对）。</li></ol> <p>因此，不同系统之间需要对同一个  JWT 令牌验证时候，需要获取到 SSO 认证中心的 <strong>公钥或共享密钥</strong> 和 <strong>签名算法</strong>；</p> <p>当前端携带令牌请求某个应用系统时，该应用系统会将令牌发送到令牌验证服务进行验证。验证服务会执行以下步骤：</p> <ol><li><strong>解析令牌</strong>：验证服务首先会解析令牌，提取其中的信息，例如用户ID、过期时间等。</li> <li><strong>验证签名</strong>：验证服务会使用事先共享的密钥或公钥对令牌的签名进行验证，以确保令牌未被篡改。</li> <li><strong>验证有效期</strong>：验证服务会检查令牌的有效期，以确保令牌未过期。</li> <li><strong>验证权限</strong>：验证服务可能会进一步检查令牌中包含的用户角色或权限信息，以确保用户具有访问所请求资源的权限。</li> <li><strong>返回验证结果</strong>：验证服务会向应用系统返回验证结果，指示令牌是否有效。</li></ol> <h3 id="jwt-优点"><a href="#jwt-优点" class="header-anchor">#</a> JWT 优点</h3> <ol><li><strong>无状态和可扩展性</strong>：由于JWT是自包含的，服务端不需要存储会话信息，使其成为无状态的身份验证解决方案。这使得应用程序具有更好的可扩展性，可以轻松地添加或删除服务器实例。</li> <li><strong>跨平台和跨语言</strong>：JWT是基于标准的<strong>JSON格式</strong>，可以在不同的平台和编程语言之间进行交互和使用。这使得它成为构建跨平台应用程序和微服务架构的理想选择。</li> <li><strong>安全性</strong>：<strong>JWT使用签名进行验证，确保令牌的真实性和完整性</strong>。通过使用密钥进行签名，可以防止令牌被伪造或篡改。此外，可以使用加密的JWT来保护敏感信息。</li> <li><strong>灵活性</strong>：JWT的载荷部分可以包含自定义的信息，可以根据应用程序的需求灵活定义和使用。这使得JWT成为在身份验证和授权之外传递其他相关信息的有效方式。</li></ol> <p>然而，JWT也有一些缺点：</p> <ol><li><strong>无法撤销</strong>：一旦JWT被签发，就无法撤销或失效，除非等待其过期时间。因此，在某些情况下，例如用户密码被重置或权限被撤销时，需要采取额外的机制来处理失效的令牌。</li> <li><strong>增加网络传输负载</strong>：由于JWT包含了自身的信息和签名，因此它的大小相对较大，可能会增加网络传输的负载。这在大量的API请求中可能会产生一定的开销。</li> <li><strong>不适用于存储敏感信息</strong>：尽管JWT可以进行签名和加密，但不建议在JWT中存储敏感信息，因为JWT的载荷部分是可以被解码的。对于敏感信息的保护，应该使用其他安全机制。</li></ol> <h3 id="为什么使用-jwt"><a href="#为什么使用-jwt" class="header-anchor">#</a> 为什么使用 JWT？</h3> <p>JWT （JSON Web Token）主要作用是用户身份认证，通过 JWT 可以识别登录的唯一用户，获取用户信息。</p> <p>JWT适用于许多情况，特别是在以下场景中需要使用JWT：</p> <ol><li><strong>分布式身份验证</strong>：当应用程序由多个独立的服务组成时，JWT可以作为一种有效的身份验证解决方案。用户在登录成功后，服务器颁发一个JWT给客户端，并在后续的请求中使用该令牌<strong>进行身份验证</strong>，而无需在每个服务中进行数据库查询或共享会话状态。</li> <li><strong>跨域身份验证</strong>：当应用程序的前端和后端部署在不同的域名下时，由于浏览器的同源策略限制，传统的基于Cookie的身份验证无法直接使用。在这种情况下，可以使用JWT作为身份验证的方式，因为JWT可以在HTTP请求头或URL参数中进行传递。</li> <li><strong>单点登录（SSO）</strong>：JWT可以用作实现单点登录的一种方式。用户在通过身份验证后，可以使用JWT在多个关联的应用程序之间进行无缝的身份验证和授权。</li> <li><strong>移动应用程序身份验证</strong>：对于移动应用程序，JWT可以作为一种轻量级和安全的身份验证机制。移动应用程序可以在用户登录后，将JWT保存在本地，并在后续的请求中附加JWT作为身份验证凭证。</li> <li><strong>微服务架构</strong>：在微服务架构中，各个服务可以使用JWT进行身份验证和授权，而无需依赖中心化的身份验证服务。这样可以简化系统的复杂性并提高可扩展性。</li></ol> <h3 id="使用流程"><a href="#使用流程" class="header-anchor">#</a> 使用流程</h3> <ul><li>服务端：登录验证，成功后，服务端根据用户信息生成 token;</li> <li>客户端：本地保存 token，每次请求时请求头带上 token 信息；</li> <li>服务端：验证token ： 访问某些资源或者接口时 ， 验证token。</li></ul> <h3 id="node-token-中间件"><a href="#node-token-中间件" class="header-anchor">#</a> Node Token 中间件</h3> <blockquote><p>token 中间件使用 jsonwebtoken 封装</p></blockquote> <ul><li><p>JWT 对象：创建、验证 Token:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use strict'</span>


<span class="token comment">/**
 * ==================================================
 *  token 方法插件封装
 * ==================================================
 */</span>

<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">TOKEN</span><span class="token punctuation">,</span> <span class="token constant">APP</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> codeEnums<span class="token punctuation">,</span> codeMsgEnums<span class="token punctuation">,</span> tokenCodeMsgEnums<span class="token punctuation">,</span> tokenCodeEnums <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@enums/response.js'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">JwtToken</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">expiresIn<span class="token punctuation">,</span> secret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>expiresIn <span class="token operator">=</span> expiresIn
    <span class="token keyword">this</span><span class="token punctuation">.</span>secret <span class="token operator">=</span> secret
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">createToken</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">'USER'</span><span class="token punctuation">,</span> <span class="token operator">...</span>user <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secret<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expiresIn <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">'GUEST'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secret<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expiresIn <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 验证 Token
   * @param {*} token
   * @returns
   */</span>
  <span class="token keyword">async</span> <span class="token function">verifyToken</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res_data <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> tokenCodeEnums<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> tokenCodeMsgEnums<span class="token punctuation">[</span>tokenCodeEnums<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> tokenCodeMsgEnums<span class="token punctuation">[</span>tokenCodeEnums<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res_data
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenStartsWithStr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Remove tag from string</span>
      token <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenStartsWithStr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> token<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> decoded <span class="token operator">=</span> <span class="token keyword">await</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secret<span class="token punctuation">)</span>
      res_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> codeEnums<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> codeMsgEnums<span class="token punctuation">[</span>codeEnums<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> codeMsgEnums<span class="token punctuation">[</span>codeEnums<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> decoded
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> tokenCodeEnums<span class="token punctuation">.</span>InvalidToken<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> err<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> err
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res_data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">expiresIn<span class="token punctuation">,</span> secret</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtToken</span><span class="token punctuation">(</span>expiresIn <span class="token operator">||</span> <span class="token constant">TOKEN</span><span class="token punctuation">.</span>sessionExpiresIn<span class="token punctuation">,</span> secret <span class="token operator">||</span> <span class="token constant">APP</span><span class="token punctuation">.</span><span class="token constant">APP_SECRET</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div></li> <li><p>token 中间件：请求时候，根据路由名单，验证用户 token:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * =====================================================
 * 校验客户端请求token中间件,处理检查请求头部token是否正确
 * 文档：https://www.npmjs.com/package/jsonwebtoken
 * 参考资料：https://segmentfault.com/a/1190000015255975
 * =====================================================
 */</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">TOKEN</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> tokenKit <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@plugins/token'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> codeEnums<span class="token punctuation">,</span> tokenCodeMsgEnums<span class="token punctuation">,</span> tokenCodeEnums <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@enums/response.js'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 以下是一些常见的标准的 token 错误码：
 * 401 Unauthorized：没有提供 token 或者提供的 token 无效。
 * 403 Forbidden：提供的 token 是有效的，但用户没有足够的权限访问所请求的资源。
 * 419 Authentication Timeout（或 440 Login Timeout）：token 已过期或超时。\
 * 498 Invalid Token：提供的 token 无效。
 * 499 Token Required：没有提供 token。
 * 500 Internal Server Error：服务器在尝试验证 token 时遇到了内部错误。
 */</span>

<span class="token comment">/**
 * token 验证中间件
 * @param {*} req
 * @param {*} res
 * @param {*} next
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">tokenAuth</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenAuthWhiteList<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> req<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//判断当前访问路径是否存在于白名单,不存在白名单内进行验证</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> tokenCodeEnums<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> tokenCodeMsgEnums<span class="token punctuation">[</span>tokenCodeEnums<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> decoded <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">tokenKit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verifyToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>decoded<span class="token punctuation">.</span>code <span class="token operator">===</span> codeEnums<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将用户信息存储到请求对象中</span>
        req<span class="token punctuation">.</span>user <span class="token operator">=</span> decoded<span class="token punctuation">.</span>data
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">code</span><span class="token operator">:</span> tokenCodeEnums<span class="token punctuation">.</span>InvalidToken<span class="token punctuation">,</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> decoded<span class="token punctuation">.</span>data
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> tokenCodeEnums<span class="token punctuation">.</span>InvalidToken<span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> tokenCodeMsgEnums<span class="token punctuation">[</span>tokenCodeEnums<span class="token punctuation">.</span>InvalidToken<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> e
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 白名单域名</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> tokenAuth

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div></li> <li><p>服务端创建 token: 用户登录成功后，根据用户信息，创建 token 并返回。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> passwordValidator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'password-validator'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> tokenKit <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@plugins/token'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">TOKEN</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Users <span class="token punctuation">}</span> <span class="token operator">=</span> db
<span class="token keyword">const</span> <span class="token punctuation">{</span> codeEnums <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@enums/response.js'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 用户注册
 */</span>

<span class="token keyword">const</span> <span class="token function-variable function">regsiter</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getReqParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">passwordValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> validMsg <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token string">'长度必须至少为8个字符'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uppercase</span><span class="token operator">:</span> <span class="token string">'必须包含至少一个大写字母'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lowercase</span><span class="token operator">:</span> <span class="token string">'必须包含至少一个小写字母'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">digits</span><span class="token operator">:</span> <span class="token string">'必须包含至少一个数字'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">spaces</span><span class="token operator">:</span> <span class="token string">'不能包含空格'</span>
    <span class="token punctuation">}</span>
    schema
      <span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> validMsg<span class="token punctuation">.</span>min<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">uppercase</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> validMsg<span class="token punctuation">.</span>uppercase<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">lowercase</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> validMsg<span class="token punctuation">.</span>lowercase<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">digits</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> validMsg<span class="token punctuation">.</span>digits<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">spaces</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> validMsg<span class="token punctuation">.</span>spaces<span class="token punctuation">)</span>

    <span class="token keyword">const</span> isValidPassword <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isValidPassword<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> msgs <span class="token operator">=</span> isValidPassword<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">msg</span> <span class="token operator">=&gt;</span> validMsg<span class="token punctuation">[</span>msg<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> codeEnums<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">密码设置错误! 密码 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msgs<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建新用户记录</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> created<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findOrCreate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        username
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">defaults</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> password
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>created<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> codeEnums<span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'该用户已存在！'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token keyword">null</span>
      user<span class="token punctuation">.</span>salt <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'注册成功!'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> user
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'系统错误'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> error
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 用户登录
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getReqParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> username <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">raw</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">未找到对应的用户 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，请核查！</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//密码验证</span>
    <span class="token keyword">let</span> ok <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">validatePassword</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>salt<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 登录密码密码不正确，请核查！</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">tokenKit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createToken</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token comment">// 设置 cookie</span>
    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenCookiesKey<span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sameSite</span><span class="token operator">:</span> <span class="token string">'none'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> userData <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">tokenName</span><span class="token operator">:</span> <span class="token string">'Authorization'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">tokenValue</span><span class="token operator">:</span> <span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenStartsWithStr <span class="token operator">+</span> token<span class="token punctuation">,</span>
        <span class="token literal-property property">isLogin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">loginId</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        <span class="token literal-property property">loginType</span><span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">tokenTimeout</span><span class="token operator">:</span> <span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenExpMinutes<span class="token punctuation">,</span>
        <span class="token literal-property property">sessionTimeout</span><span class="token operator">:</span> <span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenExpMinutes<span class="token punctuation">,</span>
        <span class="token literal-property property">tokenSessionTimeout</span><span class="token operator">:</span> <span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenExpMinutes<span class="token punctuation">,</span>
        <span class="token literal-property property">tokenActivityTimeout</span><span class="token operator">:</span> <span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenExpMinutes<span class="token punctuation">,</span>
        <span class="token literal-property property">loginDevice</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">userinfo</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">nickname</span><span class="token operator">:</span> user<span class="token punctuation">.</span>nick<span class="token punctuation">,</span>
        <span class="token literal-property property">department_id</span><span class="token operator">:</span> user<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span>
        <span class="token literal-property property">depId</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">posId</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">depName</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">posName</span><span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    res<span class="token punctuation">.</span><span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'操作成功'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> userData
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> error<span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> error
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 退出登录
 * @param {*} req
 * @param {*} res
 * @param {*} next
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> codeEnums<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">,</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'未授权'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除客户端 cookies</span>
    res<span class="token punctuation">.</span><span class="token function">clearCookie</span><span class="token punctuation">(</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span>tokenCookiesKey<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'注销成功'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">code</span><span class="token operator">:</span> codeEnums<span class="token punctuation">.</span>BadRequest<span class="token punctuation">,</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'注销失败'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> error
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  regsiter<span class="token punctuation">,</span>
  login<span class="token punctuation">,</span>
  logout
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br></div></div></li></ul> <h3 id="前端如何保存-token"><a href="#前端如何保存-token" class="header-anchor">#</a> 前端如何保存 Token?</h3> <h4 id="前端保存-token-流程"><a href="#前端保存-token-流程" class="header-anchor">#</a> 前端保存 Token 流程</h4> <ul><li>前端登录，登录成功后，服务端返回 token;</li> <li>前端本地存储 token;</li> <li>在所有请求中，加入 token；</li></ul> <h4 id="前端实现"><a href="#前端实现" class="header-anchor">#</a> 前端实现</h4> <p>**第一步：前端本地存储 token **</p> <blockquote><p>前端本地存储Token的常见方案包括以下几种：</p> <ol><li><strong>LocalStorage</strong>：LocalStorage是HTML5提供的一种本地存储方案，可以将数据以键值对的形式存储在浏览器中。使用LocalStorage存储Token时，可以使用<code>localStorage.setItem('token', 'your-token')</code>进行存储，使用<code>localStorage.getItem('token')</code>进行获取。LocalStorage中的数据会一直保留，除非主动清除或用户清除浏览器缓存。</li> <li><strong>SessionStorage</strong>：SessionStorage与LocalStorage类似，也是HTML5提供的本地存储方案，但是数据的生命周期仅限于会话期间。当用户关闭浏览器标签页或浏览器时，SessionStorage中的数据会被清除。使用方法与LocalStorage类似，可以使用<code>sessionStorage.setItem('token', 'your-token')</code>进行存储，使用<code>sessionStorage.getItem('token')</code>进行获取。</li> <li><strong>Cookie</strong>：Cookie是一种在浏览器和服务器之间传递的小型数据片段，可以用于存储Token。使用JavaScript可以通过<code>document.cookie</code>来操作Cookie。存储Token时，可以将Token作为Cookie的值进行设置，例如<code>document.cookie = 'token=your-token'</code>。在后续的请求中，浏览器会自动将Cookie作为请求头的一部分发送给服务器。</li> <li><strong>IndexedDB</strong>：IndexedDB是浏览器提供的一种高级的客户端存储数据库，可以用于存储大量结构化数据。与LocalStorage和SessionStorage相比，IndexedDB提供更丰富的查询和事务支持。存储Token时，需要使用IndexedDB的API进行操作，例如创建数据库、创建对象存储空间、存储Token数据等。</li></ol></blockquote> <p>在前端本地存储 token 一般封装一个公共类或扩展工具函数，在此处使用 <code>js-cookie</code> 封装；</p> <ul><li><p>使用 <code>js-cookie</code> 封装 storage 工具函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">SetCookies</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">GetCookies</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">RemoveCookies</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>Token 存储封装：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> SetCookies<span class="token punctuation">,</span> GetCookies<span class="token punctuation">,</span> RemoveCookies <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/storage.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createIframe<span class="token punctuation">,</span> destroyIframe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/index.js'</span>
<span class="token keyword">import</span> Settings <span class="token keyword">from</span> <span class="token string">'@/settings/encrypt.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OaUrl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/settings/constants.js'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> TokenKey<span class="token punctuation">,</span> OATokenKeys<span class="token punctuation">,</span> OALoginToken <span class="token punctuation">}</span> <span class="token operator">=</span> Settings<span class="token punctuation">.</span><span class="token constant">TOKEN</span>


<span class="token comment">/**
 * 设置 Token 信息
 * @param {*} param
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setTokenInfo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> token<span class="token punctuation">,</span> expire<span class="token punctuation">,</span> key<span class="token punctuation">,</span> ticketName<span class="token punctuation">,</span> ticketValue <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">SetCookies</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">,</span> token<span class="token punctuation">)</span>
  <span class="token function">setOAToken</span><span class="token punctuation">(</span>ticketName<span class="token punctuation">,</span> ticketValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 移除 Token 信息
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeAuthToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">removeOAToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 获取 Token
 * @param {*} key
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">GetCookies</span><span class="token punctuation">(</span>key <span class="token operator">||</span> TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 设置 Token
 * @param {*} token
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setToken</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">SetCookies</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">,</span> token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 移除 Token
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">RemoveCookies</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 获取 Token, 由于 OA 使用三个 token，因此需要遍历获取 token
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getOAToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">let</span> oaToken <span class="token operator">=</span> <span class="token keyword">null</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> keys <span class="token keyword">of</span> OATokenKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    oaToken <span class="token operator">=</span> <span class="token function">GetCookies</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token string">'.tcl.com'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oaToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      key <span class="token operator">=</span> keys
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    key<span class="token punctuation">,</span>
    oaToken
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 设置 OA token
 * @param {*} tokenKey
 * @param {*} token
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setOAToken</span><span class="token punctuation">(</span><span class="token parameter">tokenKey<span class="token punctuation">,</span> token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">SetCookies</span><span class="token punctuation">(</span>tokenKey<span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">expires</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 清空所有 oa token
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeOAToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  OATokenKeys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span>
    <span class="token function">RemoveCookies</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 获取新 oa token:LtpaToken, 通过创建 iframe,重定向获取 oa 登录 token
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getOALoginToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 存在 token 或 开发环境下不获取</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> oaToken <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getOAToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token function">getToken</span><span class="token punctuation">(</span>OALoginToken<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token operator">!</span>oaToken <span class="token operator">||</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
  <span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span>body
  <span class="token keyword">const</span> iframe <span class="token operator">=</span> <span class="token function">createIframe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    dom<span class="token punctuation">,</span>
    <span class="token function-variable function">onload</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">destroyIframe</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">src</span><span class="token operator">:</span> OaUrl<span class="token punctuation">,</span>
    <span class="token literal-property property">hidden</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">onerror</span><span class="token operator">:</span> <span class="token function">destroyIframe</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br></div></div></li></ul> <p><strong>第二步：请求携带 Token</strong></p> <ul><li><p>在此处使用 axios 作为请求工具，在 axios 请求拦截器中，请求时候在请求头中添加token：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'accessToken'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>完整 axios 请求拦截配置代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OnlyMessageBox <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/plugins/modules/onlyMsgbox.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MessageBox <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>

<span class="token comment">// create an axios instance</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE_API</span><span class="token punctuation">,</span> <span class="token comment">// url = base url + request url</span>
  <span class="token comment">// withCredentials: true, // send cookies when cross-domain requests</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">60000</span> <span class="token comment">// request timeout</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// request interceptor</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token keyword">async</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something before request is sent</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// let each request carry token</span>
      config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'accessToken'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something with request error</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// for debug</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// response interceptor</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token comment">/**
   * If you want to get http information such as headers or status
   * Please return  response =&gt; response
  */</span>

  <span class="token comment">/**
   * Determine the request status by custom code
   * Here is just an example
   * You can also judge the status by HTTP Status Code
   */</span>
  <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> response<span class="token punctuation">.</span>data
    <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">40029</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 登录过期</span>
      MessageBox<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'您的登录时间已过期,请重新登录!'</span><span class="token punctuation">,</span> <span class="token string">'登录过期'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">confirmButtonText</span><span class="token operator">:</span> <span class="token string">'确定'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/logout'</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      OnlyMessageBox<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> res<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'Error'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">1000</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    OnlyMessageBox<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> error <span class="token operator">||</span> <span class="token string">'Error'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> service

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h3 id="token-更新流程"><a href="#token-更新流程" class="header-anchor">#</a> <strong>Token 更新</strong>流程</h3> <p><img src="/myblog/assets/img/Token更新.e0862675.png" alt=""></p> <hr> <h2 id="单点登录"><a href="#单点登录" class="header-anchor">#</a> 单点登录</h2> <h3 id="概念-2"><a href="#概念-2" class="header-anchor">#</a> <strong>概念</strong></h3> <ul><li><p>单点登录（Single Sign-On，简称SSO）是一种身份验证和授权的机制，允许用户<strong>只需进行一次登录认证，即可在多个相关应用或系统中访问受保护的资源</strong>，而无需为每个应用单独提供凭据。</p></li> <li><p>传统的登录方式要求用户在每个应用或系统中输入用户名和密码进行认证，这对于用户来说可能会导致繁琐的登录流程和多个不同的凭据。而SSO的目标是简化用户登录体验，提高用户的便利性和工作效率。</p></li></ul> <h3 id="为什么要用单点登录"><a href="#为什么要用单点登录" class="header-anchor">#</a> <strong>为什么要用单点登录?</strong></h3> <p>单点登录（Single Sign-On，SSO）是一种身份验证和授权机制，允许用户在多个关联的应用程序或网站之间使用单个登录凭据进行登录，而无需在每个应用程序或网站上重新输入凭据。以下是一些使用单点登录的好处：</p> <ul><li><strong>便利性和用户体验</strong>：单点登录简化了用户的登录流程，用户只需登录一次，即可访问多个应用程序或网站，减少了频繁登录的麻烦。这提供了更好的用户体验，并提高了用户的满意度。</li> <li><strong>提高安全性</strong>：通过单点登录，用户的凭据只需要在认证中心进行验证一次，而不需要在每个应用程序或网站上传输和存储凭据。这减少了凭据被截获或泄露的风险，并提高了整体系统的安全性。</li> <li><strong>简化管理</strong>：单点登录简化了身份验证和用户管理的复杂性。管理员只需在认证中心管理用户的凭据和权限，而不需要在每个应用程序或网站上单独管理用户信息。这降低了管理的工作量，并提高了系统的可维护性。</li> <li><strong>统一用户体验</strong>：通过单点登录，用户可以在不同的应用程序或网站之间实现无缝的用户体验。用户的个人信息和偏好设置可以在不同应用程序间共享，使用户感觉它们是一个整体的系统。</li> <li><strong>降低开发成本</strong>：使用单点登录可以减少开发人员在每个应用程序或网站上实现身份验证和授权的工作量。开发人员只需集成认证中心并使用其提供的API进行身份验证，从而减少了重复劳动和开发成本。</li></ul> <h3 id="单点登录实现"><a href="#单点登录实现" class="header-anchor">#</a> 单点登录实现</h3> <p>在前后端分离的架构中，实现单点登录流程：</p> <ol><li><strong>认证服务</strong>：首先，你需要有一个专门的认证服务（例如使用 OAuth、OpenID Connect 等），用于处理用户的登录和认证。该认证服务可以是单独的服务，也可以是你的后端服务中的一部分。</li> <li><strong>生成令牌</strong>：当用户进行登录操作时，认证服务会验证用户的凭证，并生成一个令牌（例如 JSON Web Token，JWT）。该令牌应包含用户的标识信息和其他必要的认证信息。</li> <li><strong>跨域存储令牌</strong>：在用户成功登录后，认证服务将令牌返回给前端应用。前端应用可以将该令牌存储在 LocalStorage 中。由于 LocalStorage 是浏览器独立于域名的存储机制，因此可以通过 LocalStorage 实现跨域缓存。</li> <li><strong>发送令牌</strong>：当用户访问其他需要认证的前端应用时，前端应用会将存储在 LocalStorage 中的令牌附加在每个请求的请求头中发送给后端服务。</li> <li><strong>验证令牌</strong>：后端服务接收到请求后，会验证该请求中的令牌的有效性。验证令牌的过程包括检查令牌的签名、有效期、权限等信息。如果验证通过，后端服务会允许用户访问相应的资源。</li> <li><strong>单点登录</strong>：由于令牌是跨域存储的，因此当用户在一个前端应用中登录后，其他前端应用也可以通过 LocalStorage 中的令牌获取到用户的身份信息，从而实现单点登录的效果。</li></ol> <p>后端处理-<strong>部署认证中心</strong>：通过独立部署一个认证服务作为认证中心，专门负责所有系统和设备的登录请求的 web 服务。</p> <p>前端处理-<strong>LocalStorage 跨域缓存</strong>：</p> <ul><li><p>单点登录的关键在于，如何让Session ld(或 Token)在多个域中共享。但是 <strong>Cookie 是不支持跨主域名的</strong>，而且浏览器对Cookie的跨域限制越来越严格。</p></li> <li><p>在前后端分离的情况下，完全可以不使用Cookie，我们可以选择将 Sessionld(或Token)保存到浏览器的LocalStorage 中，让前端在每次向后端发送请求时，主动将 LocalStorage 的数据传递给服务端。这些都是由前端来控制的，后端需要做的仅仅是在用户登录成功后，将Sessionid(或Token)放在响应体中传递给前端；</p></li> <li><p>在这样的场景下，单点登录完全可以在前端实现。前端拿到 Sessionld (或Token)后，除了将它写入自己的LocalStorage 中之外，还可以通过特殊手段将它写入多个其他域下的LocalStorage中。</p></li> <li><p>此种实现方式完全由前端控制，几乎不需要后端参与，同样支持跨域。</p></li> <li><p>需要注意的是，使用 LocalStorage 跨域缓存实现单点登录存在一些安全风险，例如 XSS 攻击可能导致令牌被窃取。因此，在实现时需要注意令牌的安全性，例如使用 HTTPS 传输、设置适当的令牌有效期、使用 CSRF 防护等。</p></li></ul> <h3 id="单点登录-认证中心实现"><a href="#单点登录-认证中心实现" class="header-anchor">#</a> <strong>单点登录-认证中心实现</strong></h3> <h4 id="sso-身份验证服务功能"><a href="#sso-身份验证服务功能" class="header-anchor">#</a> SSO 身份验证服务功能</h4> <ol><li><strong>身份验证</strong>：当客户端请求生成Token时，通常需要对用户进行身份验证。这可以涉及验证用户名和密码、检查用户凭据的有效性以及执行其他必要的身份验证步骤。身份验证的目的是确保只有经过授权的用户才能生成有效的Token。</li> <li><strong>授权和权限管理</strong>：OSS认证服务可能需要验证用户的权限以确定其是否有权访问特定的资源或执行特定的操作。这可能涉及到访问控制列表（ACL）的检查、基于角色的访问控制（RBAC）、权限验证等。服务可能需要查询用户的权限信息，并根据用户的权限级别或角色授予或拒绝访问。</li> <li><strong>Token刷新</strong>：JWT通常具有一定的过期时间，过期后需要重新生成Token。OSS认证服务可能需要处理Token的刷新逻辑，当Token接近过期时，为客户端生成新的Token。这可以通过在Token有效期内返回刷新后的Token或使用刷新令牌（refresh token）来实现。</li> <li><strong>Token验证</strong>：当客户端在访问OSS资源时，需要将Token发送给OSS认证服务进行验证。服务端将验证Token的签名、有效性和过期时间等信息，并确保Token是由合法的认证服务生成的。验证成功后，服务端可以根据Token中的信息进行访问控制和授权。</li> <li><strong>错误处理和异常处理</strong>：OSS认证服务可能需要处理各种错误情况和异常情况，例如无效的请求、身份验证失败、权限不足等。服务端需要适当地处理这些错误并向客户端返回适当的错误响应，以提供良好的用户体验和安全性。</li> <li><strong>日志记录</strong>：OSS认证服务可能需要记录生成Token的请求、成功的身份验证、授权和访问操作等相关信息。这可以用于安全审计、故障排除和性能监控等目的。</li></ol> <p>请注意，上述功能和任务取决于具体的应用场景和要求。</p> <h4 id="认证流程"><a href="#认证流程" class="header-anchor">#</a> 认证流程</h4> <ol><li><p>在SSO系统架构中，一般都需要一个独立的认证中心（身份验证系统），通常称为身份提供者（Identity Provider，简称IdP），用户在该系统中进行身份验证；</p></li> <li><p>各个应用系统前端通常直接请求 SSO 认证服务接口，进行身份认证；</p></li> <li><p>一旦用户通过身份验证，前端就会获得一个令牌 Token （通常是加密的），该令牌用于表示用户的身份和授权信息。</p></li> <li><p>前端再将 Token  令牌存储在浏览器本地，以便后面接口请求携带上 Token；</p></li> <li><p>各个应用子系统前端再将令牌携带 直接请求应用服务端，<strong>应用服务端使用与 SSO 认证服务相同的密钥和加密算法进行解密</strong>，验证 Token 令牌是否正确。</p></li></ol> <p><img src="/myblog/assets/img/OSS架构图.5ac1c6b5.png" alt="微服务物理部署架构"></p> <p>示例：</p> <p><img src="/myblog/assets/img/单点登录流程.b89ca8f9.png" alt="image-20231225090014292"></p> <blockquote><ol><li>第 1 步：用户访问 Gmail 或任何电子邮件服务。
<ul><li>Gmail 发现用户未登录，因此将其重定向到 SSO 身份验证服务器（前端后未分离的架构，通过后台重定向到登录页面），该服务器也会发现用户未登录。因此，用户会被重定向到 SSO 登录页面，并在其中输入登录凭据。</li> <li>注意：在前后端分离的架构中，是通过 Gmail 前端直接请求  SSO 身份验证服务器 接口进行身份认证，获得 Token 令牌返回给 Gmail 前端，Gmail 前端再将</li></ul></li> <li>步骤 2-3：SSO 身份验证服务器验证凭据、为用户创建全局会话并创建令牌。</li> <li>步骤 4-7：Gmail 验证 SSO 身份验证服务器中的令牌。认证服务器注册Gmail系统，并返回“valid”。Gmail 将受保护的资源返回给用户。</li> <li>第 8 步：用户从 Gmail 导航到另一个 Google 拥有的网站，例如 YouTube。</li> <li>步骤9-10：YouTube发现用户未登录，然后请求身份验证。SSO 身份验证服务器发现用户已登录并返回令牌。</li> <li>步骤 11-14：YouTube 在 SSO 身份验证服务器中验证令牌。认证服务器注册YouTube系统，并返回“有效”。YouTube 将受保护的资源返回给用户。</li> <li>该过程已完成，用户可以重新访问其帐户。</li></ol> <p>图片来源：<code>bytebytego</code></p></blockquote> <h3 id="使用-node-实现单点登录"><a href="#使用-node-实现单点登录" class="header-anchor">#</a> 使用 Node 实现单点登录</h3> <blockquote><p>使用 Node express +  JWT 实现 OSS 服务，该服务包含以下功能：</p> <ol><li>身份验证</li> <li>授权和权限管理</li> <li>Token刷新</li> <li>错误处理和异常处理</li> <li>日志记录 功能</li></ol></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">'your-secret-key'</span><span class="token punctuation">;</span>

<span class="token comment">// 身份验证中间件</span>
<span class="token keyword">function</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> decoded</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Invalid token'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 将解码后的用户信息存储在请求对象中，以便后续路由使用</span>
      req<span class="token punctuation">.</span>user <span class="token operator">=</span> decoded<span class="token punctuation">;</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Token required'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成Token路由</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/auth/token'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 假设进行身份验证，验证通过后生成Token</span>
  <span class="token keyword">const</span> userId <span class="token operator">=</span> <span class="token string">'user123'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userId <span class="token punctuation">}</span><span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">'1h'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 需要身份验证和授权的受保护路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/files'</span><span class="token punctuation">,</span> authenticate<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在这里进行授权和权限管理的逻辑处理</span>
  <span class="token comment">// 假设根据用户ID检查用户权限，进行访问控制</span>
  <span class="token keyword">const</span> userId <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>userId<span class="token punctuation">;</span>
  
  <span class="token comment">// 根据userId进行授权和权限管理的逻辑处理</span>

  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'file1.txt'</span><span class="token punctuation">,</span> <span class="token string">'file2.txt'</span><span class="token punctuation">,</span> <span class="token string">'file3.txt'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Token刷新路由</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/auth/refresh'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 假设接收旧Token，并生成新Token</span>
  <span class="token keyword">const</span> oldToken <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>token<span class="token punctuation">;</span>

  jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>oldToken<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> decoded</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Invalid token'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 假设从旧Token中获取用户ID</span>
    <span class="token keyword">const</span> userId <span class="token operator">=</span> decoded<span class="token punctuation">.</span>userId<span class="token punctuation">;</span>

    <span class="token comment">// 生成新Token</span>
    <span class="token keyword">const</span> newToken <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userId <span class="token punctuation">}</span><span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">'1h'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">token</span><span class="token operator">:</span> newToken <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 错误处理中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Internal server error'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 日志记录中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server started on port 3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h3 id="登录-单点登录实现"><a href="#登录-单点登录实现" class="header-anchor">#</a> 登录+单点登录实现</h3> <p><img src="/myblog/assets/img/登录流程图.5f34425e.png" alt=""></p> <h2 id="单设备登录"><a href="#单设备登录" class="header-anchor">#</a> 单设备登录</h2> <p><strong>概念：</strong></p> <ul><li><p>在某个给定的时间内，同一个用户只能在一台设备上进行登录，如果在其他设备上尝试登录，先前的会话将会被中断或注销。</p></li> <li><p>单设备登录（Single Device Sign-On）是一种身份验证机制，限制了同一用户在同一时间只能在一个设备上进行登录。</p></li> <li><p>以QQ登录为例，当使用不同的手机（目前QQ支持pad与电脑、手机同时在线，但是相同类型的终端是不可以的）登录同一个QQ账号的时候，后登录的终端会把之前登录的终端给踢下线。也就是说同一账号不能在两台设备上同时登录使用。</p></li></ul> <p><strong>实现:</strong></p> <ul><li>使用数据库记录登录状态</li> <li>使用数据库记录登录状态</li></ul> <h3 id="使用数据库记录登录状态"><a href="#使用数据库记录登录状态" class="header-anchor">#</a> 使用数据库记录登录状态</h3> <p><strong>流程：</strong></p> <ol><li>在用户登录时，记录用户的账号信息、登录设备的唯一标识符(如设备ID或IP地址) 以及登录时间等信息到数据库中的一个登录表。</li> <li>每次用户的登录请求都会查询数据库中的登录表，检查是否存在该用户的登录记录。如果存在记录，则比对登录设备的标识符和当前设备的标识符是否相同：
<ul><li>如果当前设备与登录设备不匹配，拒绝登录并提示用户在其他设备上已登录。</li> <li>若匹配则更新登录时间。</li></ul></li> <li>当用户主动退出登录或超过一定时间没有操作时，清除该用户的登录记录.</li></ol> <h3 id="使用-token-令牌验证机制"><a href="#使用-token-令牌验证机制" class="header-anchor">#</a> 使用 Token 令牌验证机制</h3> <p><strong>流程</strong>：</p> <ol><li>用户登录时生成token，将账号作为key，token作为value，并以其过期时间存入redis中。</li> <li>当用户访问应用时，在拦截器中解析token，获取账号，然后用账号去redis中获取相应的 value：
<ul><li>如果获取到的value的token与当前用户携带的token一致，则允许访问;</li> <li>如果不一致，则提示前端重复登录，让前端清除token，并跳转到登录页面。</li></ul></li> <li>当用户在另一台设备登录时，其token也会存入redis中，这样就刷新了token的值和redis的过期时间。</li></ol></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">January 22, 2024 14:49</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 596777598@qq.com" class="contributor">
          sewar
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/myblog/assets/js/app.9d2b617a.js" defer></script><script src="/myblog/assets/js/layout-Layout.d2d4ce64.js" defer></script><script src="/myblog/assets/js/page-登录.bb830451.js" defer></script><script src="/myblog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-components/Blog/BlogHome~layout-components/~2222f443.5835591a.js" defer></script>
  </body>
</html>
